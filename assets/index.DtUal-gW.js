var yP=Object.defineProperty;var xP=(t,e,n)=>e in t?yP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var wP=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var sa=(t,e,n)=>xP(t,typeof e!="symbol"?e+"":e,n);var Vq=wP((qq,pP)=>{function F2(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var bP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function kP(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var L2={exports:{}},oh={},B2={exports:{}},Re={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hl=Symbol.for("react.element"),_P=Symbol.for("react.portal"),SP=Symbol.for("react.fragment"),CP=Symbol.for("react.strict_mode"),EP=Symbol.for("react.profiler"),AP=Symbol.for("react.provider"),RP=Symbol.for("react.context"),NP=Symbol.for("react.forward_ref"),TP=Symbol.for("react.suspense"),PP=Symbol.for("react.memo"),IP=Symbol.for("react.lazy"),fx=Symbol.iterator;function DP(t){return t===null||typeof t!="object"?null:(t=fx&&t[fx]||t["@@iterator"],typeof t=="function"?t:null)}var V2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},z2=Object.assign,U2={};function bs(t,e,n){this.props=t,this.context=e,this.refs=U2,this.updater=n||V2}bs.prototype.isReactComponent={};bs.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};bs.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function $2(){}$2.prototype=bs.prototype;function ev(t,e,n){this.props=t,this.context=e,this.refs=U2,this.updater=n||V2}var tv=ev.prototype=new $2;tv.constructor=ev;z2(tv,bs.prototype);tv.isPureReactComponent=!0;var px=Array.isArray,W2=Object.prototype.hasOwnProperty,nv={current:null},G2={key:!0,ref:!0,__self:!0,__source:!0};function H2(t,e,n){var r,i={},o=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(o=""+e.key),e)W2.call(e,r)&&!G2.hasOwnProperty(r)&&(i[r]=e[r]);var s=arguments.length-2;if(s===1)i.children=n;else if(1<s){for(var u=Array(s),l=0;l<s;l++)u[l]=arguments[l+2];i.children=u}if(t&&t.defaultProps)for(r in s=t.defaultProps,s)i[r]===void 0&&(i[r]=s[r]);return{$$typeof:hl,type:t,key:o,ref:a,props:i,_owner:nv.current}}function MP(t,e){return{$$typeof:hl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function rv(t){return typeof t=="object"&&t!==null&&t.$$typeof===hl}function OP(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var mx=/\/+/g;function rf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?OP(""+t.key):e.toString(36)}function Pc(t,e,n,r,i){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case hl:case _P:a=!0}}if(a)return a=t,i=i(a),t=r===""?"."+rf(a,0):r,px(i)?(n="",t!=null&&(n=t.replace(mx,"$&/")+"/"),Pc(i,e,n,"",function(l){return l})):i!=null&&(rv(i)&&(i=MP(i,n+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(mx,"$&/")+"/")+t)),e.push(i)),1;if(a=0,r=r===""?".":r+":",px(t))for(var s=0;s<t.length;s++){o=t[s];var u=r+rf(o,s);a+=Pc(o,e,n,u,i)}else if(u=DP(t),typeof u=="function")for(t=u.call(t),s=0;!(o=t.next()).done;)o=o.value,u=r+rf(o,s++),a+=Pc(o,e,n,u,i);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Fl(t,e,n){if(t==null)return t;var r=[],i=0;return Pc(t,r,"","",function(o){return e.call(n,o,i++)}),r}function jP(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var sn={current:null},Ic={transition:null},FP={ReactCurrentDispatcher:sn,ReactCurrentBatchConfig:Ic,ReactCurrentOwner:nv};function K2(){throw Error("act(...) is not supported in production builds of React.")}Re.Children={map:Fl,forEach:function(t,e,n){Fl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Fl(t,function(){e++}),e},toArray:function(t){return Fl(t,function(e){return e})||[]},only:function(t){if(!rv(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Re.Component=bs;Re.Fragment=SP;Re.Profiler=EP;Re.PureComponent=ev;Re.StrictMode=CP;Re.Suspense=TP;Re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=FP;Re.act=K2;Re.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=z2({},t.props),i=t.key,o=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,a=nv.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(u in e)W2.call(e,u)&&!G2.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&s!==void 0?s[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){s=Array(u);for(var l=0;l<u;l++)s[l]=arguments[l+2];r.children=s}return{$$typeof:hl,type:t.type,key:i,ref:o,props:r,_owner:a}};Re.createContext=function(t){return t={$$typeof:RP,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:AP,_context:t},t.Consumer=t};Re.createElement=H2;Re.createFactory=function(t){var e=H2.bind(null,t);return e.type=t,e};Re.createRef=function(){return{current:null}};Re.forwardRef=function(t){return{$$typeof:NP,render:t}};Re.isValidElement=rv;Re.lazy=function(t){return{$$typeof:IP,_payload:{_status:-1,_result:t},_init:jP}};Re.memo=function(t,e){return{$$typeof:PP,type:t,compare:e===void 0?null:e}};Re.startTransition=function(t){var e=Ic.transition;Ic.transition={};try{t()}finally{Ic.transition=e}};Re.unstable_act=K2;Re.useCallback=function(t,e){return sn.current.useCallback(t,e)};Re.useContext=function(t){return sn.current.useContext(t)};Re.useDebugValue=function(){};Re.useDeferredValue=function(t){return sn.current.useDeferredValue(t)};Re.useEffect=function(t,e){return sn.current.useEffect(t,e)};Re.useId=function(){return sn.current.useId()};Re.useImperativeHandle=function(t,e,n){return sn.current.useImperativeHandle(t,e,n)};Re.useInsertionEffect=function(t,e){return sn.current.useInsertionEffect(t,e)};Re.useLayoutEffect=function(t,e){return sn.current.useLayoutEffect(t,e)};Re.useMemo=function(t,e){return sn.current.useMemo(t,e)};Re.useReducer=function(t,e,n){return sn.current.useReducer(t,e,n)};Re.useRef=function(t){return sn.current.useRef(t)};Re.useState=function(t){return sn.current.useState(t)};Re.useSyncExternalStore=function(t,e,n){return sn.current.useSyncExternalStore(t,e,n)};Re.useTransition=function(){return sn.current.useTransition()};Re.version="18.3.1";B2.exports=Re;var A=B2.exports;const ve=Zg(A),q2=F2({__proto__:null,default:ve},[A]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LP=A,BP=Symbol.for("react.element"),VP=Symbol.for("react.fragment"),zP=Object.prototype.hasOwnProperty,UP=LP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$P={key:!0,ref:!0,__self:!0,__source:!0};function X2(t,e,n){var r,i={},o=null,a=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)zP.call(e,r)&&!$P.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:BP,type:t,key:o,ref:a,props:i,_owner:UP.current}}oh.Fragment=VP;oh.jsx=X2;oh.jsxs=X2;L2.exports=oh;var y=L2.exports,Mp={},Y2={exports:{}},On={},J2={exports:{}},Q2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(I,j){var B=I.length;I.push(j);e:for(;0<B;){var K=B-1>>>1,X=I[K];if(0<i(X,j))I[K]=j,I[B]=X,B=K;else break e}}function n(I){return I.length===0?null:I[0]}function r(I){if(I.length===0)return null;var j=I[0],B=I.pop();if(B!==j){I[0]=B;e:for(var K=0,X=I.length,Y=X>>>1;K<Y;){var ie=2*(K+1)-1,fe=I[ie],pe=ie+1,ce=I[pe];if(0>i(fe,B))pe<X&&0>i(ce,fe)?(I[K]=ce,I[pe]=B,K=pe):(I[K]=fe,I[ie]=B,K=ie);else if(pe<X&&0>i(ce,B))I[K]=ce,I[pe]=B,K=pe;else break e}}return j}function i(I,j){var B=I.sortIndex-j.sortIndex;return B!==0?B:I.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();t.unstable_now=function(){return a.now()-s}}var u=[],l=[],c=1,d=null,h=3,f=!1,m=!1,p=!1,v=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(I){for(var j=n(l);j!==null;){if(j.callback===null)r(l);else if(j.startTime<=I)r(l),j.sortIndex=j.expirationTime,e(u,j);else break;j=n(l)}}function b(I){if(p=!1,w(I),!m)if(n(u)!==null)m=!0,W(k);else{var j=n(l);j!==null&&L(b,j.startTime-I)}}function k(I,j){m=!1,p&&(p=!1,g(C),C=-1),f=!0;var B=h;try{for(w(j),d=n(u);d!==null&&(!(d.expirationTime>j)||I&&!D());){var K=d.callback;if(typeof K=="function"){d.callback=null,h=d.priorityLevel;var X=K(d.expirationTime<=j);j=t.unstable_now(),typeof X=="function"?d.callback=X:d===n(u)&&r(u),w(j)}else r(u);d=n(u)}if(d!==null)var Y=!0;else{var ie=n(l);ie!==null&&L(b,ie.startTime-j),Y=!1}return Y}finally{d=null,h=B,f=!1}}var _=!1,S=null,C=-1,E=5,R=-1;function D(){return!(t.unstable_now()-R<E)}function P(){if(S!==null){var I=t.unstable_now();R=I;var j=!0;try{j=S(!0,I)}finally{j?F():(_=!1,S=null)}}else _=!1}var F;if(typeof x=="function")F=function(){x(P)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,z=U.port2;U.port1.onmessage=P,F=function(){z.postMessage(null)}}else F=function(){v(P,0)};function W(I){S=I,_||(_=!0,F())}function L(I,j){C=v(function(){I(t.unstable_now())},j)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(I){I.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,W(k))},t.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<I?Math.floor(1e3/I):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(I){switch(h){case 1:case 2:case 3:var j=3;break;default:j=h}var B=h;h=j;try{return I()}finally{h=B}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(I,j){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var B=h;h=I;try{return j()}finally{h=B}},t.unstable_scheduleCallback=function(I,j,B){var K=t.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?K+B:K):B=K,I){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=B+X,I={id:c++,callback:j,priorityLevel:I,startTime:B,expirationTime:X,sortIndex:-1},B>K?(I.sortIndex=B,e(l,I),n(u)===null&&I===n(l)&&(p?(g(C),C=-1):p=!0,L(b,B-K))):(I.sortIndex=X,e(u,I),m||f||(m=!0,W(k))),I},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(I){var j=h;return function(){var B=h;h=j;try{return I.apply(this,arguments)}finally{h=B}}}})(Q2);J2.exports=Q2;var WP=J2.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GP=A,Dn=WP;function q(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Z2=new Set,Tu={};function qo(t,e){as(t,e),as(t+"Capture",e)}function as(t,e){for(Tu[t]=e,t=0;t<e.length;t++)Z2.add(e[t])}var li=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Op=Object.prototype.hasOwnProperty,HP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,gx={},vx={};function KP(t){return Op.call(vx,t)?!0:Op.call(gx,t)?!1:HP.test(t)?vx[t]=!0:(gx[t]=!0,!1)}function qP(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function XP(t,e,n,r){if(e===null||typeof e>"u"||qP(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function un(t,e,n,r,i,o,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=a}var Ut={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ut[t]=new un(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ut[e]=new un(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ut[t]=new un(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ut[t]=new un(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ut[t]=new un(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ut[t]=new un(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ut[t]=new un(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ut[t]=new un(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ut[t]=new un(t,5,!1,t.toLowerCase(),null,!1,!1)});var iv=/[\-:]([a-z])/g;function ov(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(iv,ov);Ut[e]=new un(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(iv,ov);Ut[e]=new un(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(iv,ov);Ut[e]=new un(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ut[t]=new un(t,1,!1,t.toLowerCase(),null,!1,!1)});Ut.xlinkHref=new un("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ut[t]=new un(t,1,!1,t.toLowerCase(),null,!0,!0)});function av(t,e,n,r){var i=Ut.hasOwnProperty(e)?Ut[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(XP(e,n,i,r)&&(n=null),r||i===null?KP(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var gi=GP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ll=Symbol.for("react.element"),Aa=Symbol.for("react.portal"),Ra=Symbol.for("react.fragment"),sv=Symbol.for("react.strict_mode"),jp=Symbol.for("react.profiler"),ek=Symbol.for("react.provider"),tk=Symbol.for("react.context"),uv=Symbol.for("react.forward_ref"),Fp=Symbol.for("react.suspense"),Lp=Symbol.for("react.suspense_list"),lv=Symbol.for("react.memo"),Ti=Symbol.for("react.lazy"),nk=Symbol.for("react.offscreen"),yx=Symbol.iterator;function Bs(t){return t===null||typeof t!="object"?null:(t=yx&&t[yx]||t["@@iterator"],typeof t=="function"?t:null)}var at=Object.assign,of;function tu(t){if(of===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);of=e&&e[1]||""}return`
`+of+t}var af=!1;function sf(t,e){if(!t||af)return"";af=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){r=l}t.call(e.prototype)}else{try{throw Error()}catch(l){r=l}t()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),o=r.stack.split(`
`),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(a!==1||s!==1)do if(a--,s--,0>s||i[a]!==o[s]){var u=`
`+i[a].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=a&&0<=s);break}}}finally{af=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?tu(t):""}function YP(t){switch(t.tag){case 5:return tu(t.type);case 16:return tu("Lazy");case 13:return tu("Suspense");case 19:return tu("SuspenseList");case 0:case 2:case 15:return t=sf(t.type,!1),t;case 11:return t=sf(t.type.render,!1),t;case 1:return t=sf(t.type,!0),t;default:return""}}function Bp(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ra:return"Fragment";case Aa:return"Portal";case jp:return"Profiler";case sv:return"StrictMode";case Fp:return"Suspense";case Lp:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case tk:return(t.displayName||"Context")+".Consumer";case ek:return(t._context.displayName||"Context")+".Provider";case uv:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case lv:return e=t.displayName||null,e!==null?e:Bp(t.type)||"Memo";case Ti:e=t._payload,t=t._init;try{return Bp(t(e))}catch{}}return null}function JP(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Bp(e);case 8:return e===sv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ji(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function rk(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function QP(t){var e=rk(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,o.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Bl(t){t._valueTracker||(t._valueTracker=QP(t))}function ik(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=rk(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Jc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Vp(t,e){var n=e.checked;return at({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function xx(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ji(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ok(t,e){e=e.checked,e!=null&&av(t,"checked",e,!1)}function zp(t,e){ok(t,e);var n=Ji(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Up(t,e.type,n):e.hasOwnProperty("defaultValue")&&Up(t,e.type,Ji(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function wx(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Up(t,e,n){(e!=="number"||Jc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var nu=Array.isArray;function Wa(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ji(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function $p(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(q(91));return at({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function bx(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(q(92));if(nu(n)){if(1<n.length)throw Error(q(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ji(n)}}function ak(t,e){var n=Ji(e.value),r=Ji(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function kx(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function sk(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Wp(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?sk(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Vl,uk=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Vl=Vl||document.createElement("div"),Vl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Vl.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Pu(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var uu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ZP=["Webkit","ms","Moz","O"];Object.keys(uu).forEach(function(t){ZP.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),uu[e]=uu[t]})});function lk(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||uu.hasOwnProperty(t)&&uu[t]?(""+e).trim():e+"px"}function ck(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=lk(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var eI=at({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Gp(t,e){if(e){if(eI[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(q(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(q(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(q(61))}if(e.style!=null&&typeof e.style!="object")throw Error(q(62))}}function Hp(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kp=null;function cv(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var qp=null,Ga=null,Ha=null;function _x(t){if(t=ml(t)){if(typeof qp!="function")throw Error(q(280));var e=t.stateNode;e&&(e=ch(e),qp(t.stateNode,t.type,e))}}function dk(t){Ga?Ha?Ha.push(t):Ha=[t]:Ga=t}function hk(){if(Ga){var t=Ga,e=Ha;if(Ha=Ga=null,_x(t),e)for(t=0;t<e.length;t++)_x(e[t])}}function fk(t,e){return t(e)}function pk(){}var uf=!1;function mk(t,e,n){if(uf)return t(e,n);uf=!0;try{return fk(t,e,n)}finally{uf=!1,(Ga!==null||Ha!==null)&&(pk(),hk())}}function Iu(t,e){var n=t.stateNode;if(n===null)return null;var r=ch(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(q(231,e,typeof n));return n}var Xp=!1;if(li)try{var Vs={};Object.defineProperty(Vs,"passive",{get:function(){Xp=!0}}),window.addEventListener("test",Vs,Vs),window.removeEventListener("test",Vs,Vs)}catch{Xp=!1}function tI(t,e,n,r,i,o,a,s,u){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(c){this.onError(c)}}var lu=!1,Qc=null,Zc=!1,Yp=null,nI={onError:function(t){lu=!0,Qc=t}};function rI(t,e,n,r,i,o,a,s,u){lu=!1,Qc=null,tI.apply(nI,arguments)}function iI(t,e,n,r,i,o,a,s,u){if(rI.apply(this,arguments),lu){if(lu){var l=Qc;lu=!1,Qc=null}else throw Error(q(198));Zc||(Zc=!0,Yp=l)}}function Xo(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function gk(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Sx(t){if(Xo(t)!==t)throw Error(q(188))}function oI(t){var e=t.alternate;if(!e){if(e=Xo(t),e===null)throw Error(q(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return Sx(i),t;if(o===r)return Sx(i),e;o=o.sibling}throw Error(q(188))}if(n.return!==r.return)n=i,r=o;else{for(var a=!1,s=i.child;s;){if(s===n){a=!0,n=i,r=o;break}if(s===r){a=!0,r=i,n=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===n){a=!0,n=o,r=i;break}if(s===r){a=!0,r=o,n=i;break}s=s.sibling}if(!a)throw Error(q(189))}}if(n.alternate!==r)throw Error(q(190))}if(n.tag!==3)throw Error(q(188));return n.stateNode.current===n?t:e}function vk(t){return t=oI(t),t!==null?yk(t):null}function yk(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=yk(t);if(e!==null)return e;t=t.sibling}return null}var xk=Dn.unstable_scheduleCallback,Cx=Dn.unstable_cancelCallback,aI=Dn.unstable_shouldYield,sI=Dn.unstable_requestPaint,ft=Dn.unstable_now,uI=Dn.unstable_getCurrentPriorityLevel,dv=Dn.unstable_ImmediatePriority,wk=Dn.unstable_UserBlockingPriority,ed=Dn.unstable_NormalPriority,lI=Dn.unstable_LowPriority,bk=Dn.unstable_IdlePriority,ah=null,Mr=null;function cI(t){if(Mr&&typeof Mr.onCommitFiberRoot=="function")try{Mr.onCommitFiberRoot(ah,t,void 0,(t.current.flags&128)===128)}catch{}}var dr=Math.clz32?Math.clz32:fI,dI=Math.log,hI=Math.LN2;function fI(t){return t>>>=0,t===0?32:31-(dI(t)/hI|0)|0}var zl=64,Ul=4194304;function ru(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function td(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,o=t.pingedLanes,a=n&268435455;if(a!==0){var s=a&~i;s!==0?r=ru(s):(o&=a,o!==0&&(r=ru(o)))}else a=n&~i,a!==0?r=ru(a):o!==0&&(r=ru(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-dr(e),i=1<<n,r|=t[n],e&=~i;return r}function pI(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mI(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,o=t.pendingLanes;0<o;){var a=31-dr(o),s=1<<a,u=i[a];u===-1?(!(s&n)||s&r)&&(i[a]=pI(s,e)):u<=e&&(t.expiredLanes|=s),o&=~s}}function Jp(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function kk(){var t=zl;return zl<<=1,!(zl&4194240)&&(zl=64),t}function lf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function fl(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-dr(e),t[e]=n}function gI(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-dr(n),o=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~o}}function hv(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-dr(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Fe=0;function _k(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Sk,fv,Ck,Ek,Ak,Qp=!1,$l=[],Bi=null,Vi=null,zi=null,Du=new Map,Mu=new Map,Ii=[],vI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ex(t,e){switch(t){case"focusin":case"focusout":Bi=null;break;case"dragenter":case"dragleave":Vi=null;break;case"mouseover":case"mouseout":zi=null;break;case"pointerover":case"pointerout":Du.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mu.delete(e.pointerId)}}function zs(t,e,n,r,i,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=ml(e),e!==null&&fv(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function yI(t,e,n,r,i){switch(e){case"focusin":return Bi=zs(Bi,t,e,n,r,i),!0;case"dragenter":return Vi=zs(Vi,t,e,n,r,i),!0;case"mouseover":return zi=zs(zi,t,e,n,r,i),!0;case"pointerover":var o=i.pointerId;return Du.set(o,zs(Du.get(o)||null,t,e,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Mu.set(o,zs(Mu.get(o)||null,t,e,n,r,i)),!0}return!1}function Rk(t){var e=Ro(t.target);if(e!==null){var n=Xo(e);if(n!==null){if(e=n.tag,e===13){if(e=gk(n),e!==null){t.blockedOn=e,Ak(t.priority,function(){Ck(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Dc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Zp(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Kp=r,n.target.dispatchEvent(r),Kp=null}else return e=ml(n),e!==null&&fv(e),t.blockedOn=n,!1;e.shift()}return!0}function Ax(t,e,n){Dc(t)&&n.delete(e)}function xI(){Qp=!1,Bi!==null&&Dc(Bi)&&(Bi=null),Vi!==null&&Dc(Vi)&&(Vi=null),zi!==null&&Dc(zi)&&(zi=null),Du.forEach(Ax),Mu.forEach(Ax)}function Us(t,e){t.blockedOn===e&&(t.blockedOn=null,Qp||(Qp=!0,Dn.unstable_scheduleCallback(Dn.unstable_NormalPriority,xI)))}function Ou(t){function e(i){return Us(i,t)}if(0<$l.length){Us($l[0],t);for(var n=1;n<$l.length;n++){var r=$l[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Bi!==null&&Us(Bi,t),Vi!==null&&Us(Vi,t),zi!==null&&Us(zi,t),Du.forEach(e),Mu.forEach(e),n=0;n<Ii.length;n++)r=Ii[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ii.length&&(n=Ii[0],n.blockedOn===null);)Rk(n),n.blockedOn===null&&Ii.shift()}var Ka=gi.ReactCurrentBatchConfig,nd=!0;function wI(t,e,n,r){var i=Fe,o=Ka.transition;Ka.transition=null;try{Fe=1,pv(t,e,n,r)}finally{Fe=i,Ka.transition=o}}function bI(t,e,n,r){var i=Fe,o=Ka.transition;Ka.transition=null;try{Fe=4,pv(t,e,n,r)}finally{Fe=i,Ka.transition=o}}function pv(t,e,n,r){if(nd){var i=Zp(t,e,n,r);if(i===null)xf(t,e,r,rd,n),Ex(t,r);else if(yI(i,t,e,n,r))r.stopPropagation();else if(Ex(t,r),e&4&&-1<vI.indexOf(t)){for(;i!==null;){var o=ml(i);if(o!==null&&Sk(o),o=Zp(t,e,n,r),o===null&&xf(t,e,r,rd,n),o===i)break;i=o}i!==null&&r.stopPropagation()}else xf(t,e,r,null,n)}}var rd=null;function Zp(t,e,n,r){if(rd=null,t=cv(r),t=Ro(t),t!==null)if(e=Xo(t),e===null)t=null;else if(n=e.tag,n===13){if(t=gk(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return rd=t,null}function Nk(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uI()){case dv:return 1;case wk:return 4;case ed:case lI:return 16;case bk:return 536870912;default:return 16}default:return 16}}var Oi=null,mv=null,Mc=null;function Tk(){if(Mc)return Mc;var t,e=mv,n=e.length,r,i="value"in Oi?Oi.value:Oi.textContent,o=i.length;for(t=0;t<n&&e[t]===i[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===i[o-r];r++);return Mc=i.slice(t,1<r?1-r:void 0)}function Oc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Wl(){return!0}function Rx(){return!1}function jn(t){function e(n,r,i,o,a){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=a,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(n=t[s],this[s]=n?n(o):o[s]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Wl:Rx,this.isPropagationStopped=Rx,this}return at(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Wl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Wl)},persist:function(){},isPersistent:Wl}),e}var ks={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},gv=jn(ks),pl=at({},ks,{view:0,detail:0}),kI=jn(pl),cf,df,$s,sh=at({},pl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vv,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==$s&&($s&&t.type==="mousemove"?(cf=t.screenX-$s.screenX,df=t.screenY-$s.screenY):df=cf=0,$s=t),cf)},movementY:function(t){return"movementY"in t?t.movementY:df}}),Nx=jn(sh),_I=at({},sh,{dataTransfer:0}),SI=jn(_I),CI=at({},pl,{relatedTarget:0}),hf=jn(CI),EI=at({},ks,{animationName:0,elapsedTime:0,pseudoElement:0}),AI=jn(EI),RI=at({},ks,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),NI=jn(RI),TI=at({},ks,{data:0}),Tx=jn(TI),PI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},II={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},DI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function MI(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=DI[t])?!!e[t]:!1}function vv(){return MI}var OI=at({},pl,{key:function(t){if(t.key){var e=PI[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Oc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?II[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vv,charCode:function(t){return t.type==="keypress"?Oc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Oc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),jI=jn(OI),FI=at({},sh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Px=jn(FI),LI=at({},pl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vv}),BI=jn(LI),VI=at({},ks,{propertyName:0,elapsedTime:0,pseudoElement:0}),zI=jn(VI),UI=at({},sh,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),$I=jn(UI),WI=[9,13,27,32],yv=li&&"CompositionEvent"in window,cu=null;li&&"documentMode"in document&&(cu=document.documentMode);var GI=li&&"TextEvent"in window&&!cu,Pk=li&&(!yv||cu&&8<cu&&11>=cu),Ix=" ",Dx=!1;function Ik(t,e){switch(t){case"keyup":return WI.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Dk(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Na=!1;function HI(t,e){switch(t){case"compositionend":return Dk(e);case"keypress":return e.which!==32?null:(Dx=!0,Ix);case"textInput":return t=e.data,t===Ix&&Dx?null:t;default:return null}}function KI(t,e){if(Na)return t==="compositionend"||!yv&&Ik(t,e)?(t=Tk(),Mc=mv=Oi=null,Na=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Pk&&e.locale!=="ko"?null:e.data;default:return null}}var qI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Mx(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!qI[t.type]:e==="textarea"}function Mk(t,e,n,r){dk(r),e=id(e,"onChange"),0<e.length&&(n=new gv("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var du=null,ju=null;function XI(t){Gk(t,0)}function uh(t){var e=Ia(t);if(ik(e))return t}function YI(t,e){if(t==="change")return e}var Ok=!1;if(li){var ff;if(li){var pf="oninput"in document;if(!pf){var Ox=document.createElement("div");Ox.setAttribute("oninput","return;"),pf=typeof Ox.oninput=="function"}ff=pf}else ff=!1;Ok=ff&&(!document.documentMode||9<document.documentMode)}function jx(){du&&(du.detachEvent("onpropertychange",jk),ju=du=null)}function jk(t){if(t.propertyName==="value"&&uh(ju)){var e=[];Mk(e,ju,t,cv(t)),mk(XI,e)}}function JI(t,e,n){t==="focusin"?(jx(),du=e,ju=n,du.attachEvent("onpropertychange",jk)):t==="focusout"&&jx()}function QI(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return uh(ju)}function ZI(t,e){if(t==="click")return uh(e)}function eD(t,e){if(t==="input"||t==="change")return uh(e)}function tD(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var pr=typeof Object.is=="function"?Object.is:tD;function Fu(t,e){if(pr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Op.call(e,i)||!pr(t[i],e[i]))return!1}return!0}function Fx(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Lx(t,e){var n=Fx(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Fx(n)}}function Fk(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Fk(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Lk(){for(var t=window,e=Jc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Jc(t.document)}return e}function xv(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function nD(t){var e=Lk(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Fk(n.ownerDocument.documentElement,n)){if(r!==null&&xv(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!t.extend&&o>r&&(i=r,r=o,o=i),i=Lx(n,o);var a=Lx(n,r);i&&a&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),o>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var rD=li&&"documentMode"in document&&11>=document.documentMode,Ta=null,em=null,hu=null,tm=!1;function Bx(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;tm||Ta==null||Ta!==Jc(r)||(r=Ta,"selectionStart"in r&&xv(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),hu&&Fu(hu,r)||(hu=r,r=id(em,"onSelect"),0<r.length&&(e=new gv("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ta)))}function Gl(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Pa={animationend:Gl("Animation","AnimationEnd"),animationiteration:Gl("Animation","AnimationIteration"),animationstart:Gl("Animation","AnimationStart"),transitionend:Gl("Transition","TransitionEnd")},mf={},Bk={};li&&(Bk=document.createElement("div").style,"AnimationEvent"in window||(delete Pa.animationend.animation,delete Pa.animationiteration.animation,delete Pa.animationstart.animation),"TransitionEvent"in window||delete Pa.transitionend.transition);function lh(t){if(mf[t])return mf[t];if(!Pa[t])return t;var e=Pa[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Bk)return mf[t]=e[n];return t}var Vk=lh("animationend"),zk=lh("animationiteration"),Uk=lh("animationstart"),$k=lh("transitionend"),Wk=new Map,Vx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function io(t,e){Wk.set(t,e),qo(e,[t])}for(var gf=0;gf<Vx.length;gf++){var vf=Vx[gf],iD=vf.toLowerCase(),oD=vf[0].toUpperCase()+vf.slice(1);io(iD,"on"+oD)}io(Vk,"onAnimationEnd");io(zk,"onAnimationIteration");io(Uk,"onAnimationStart");io("dblclick","onDoubleClick");io("focusin","onFocus");io("focusout","onBlur");io($k,"onTransitionEnd");as("onMouseEnter",["mouseout","mouseover"]);as("onMouseLeave",["mouseout","mouseover"]);as("onPointerEnter",["pointerout","pointerover"]);as("onPointerLeave",["pointerout","pointerover"]);qo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));qo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));qo("onBeforeInput",["compositionend","keypress","textInput","paste"]);qo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));qo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));qo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var iu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),aD=new Set("cancel close invalid load scroll toggle".split(" ").concat(iu));function zx(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,iI(r,e,void 0,t),t.currentTarget=null}function Gk(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,l=s.currentTarget;if(s=s.listener,u!==o&&i.isPropagationStopped())break e;zx(i,s,l),o=u}else for(a=0;a<r.length;a++){if(s=r[a],u=s.instance,l=s.currentTarget,s=s.listener,u!==o&&i.isPropagationStopped())break e;zx(i,s,l),o=u}}}if(Zc)throw t=Yp,Zc=!1,Yp=null,t}function We(t,e){var n=e[am];n===void 0&&(n=e[am]=new Set);var r=t+"__bubble";n.has(r)||(Hk(e,t,2,!1),n.add(r))}function yf(t,e,n){var r=0;e&&(r|=4),Hk(n,t,r,e)}var Hl="_reactListening"+Math.random().toString(36).slice(2);function Lu(t){if(!t[Hl]){t[Hl]=!0,Z2.forEach(function(n){n!=="selectionchange"&&(aD.has(n)||yf(n,!1,t),yf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Hl]||(e[Hl]=!0,yf("selectionchange",!1,e))}}function Hk(t,e,n,r){switch(Nk(e)){case 1:var i=wI;break;case 4:i=bI;break;default:i=pv}n=i.bind(null,e,n,t),i=void 0,!Xp||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function xf(t,e,n,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var s=r.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var u=a.tag;if((u===3||u===4)&&(u=a.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;a=a.return}for(;s!==null;){if(a=Ro(s),a===null)return;if(u=a.tag,u===5||u===6){r=o=a;continue e}s=s.parentNode}}r=r.return}mk(function(){var l=o,c=cv(n),d=[];e:{var h=Wk.get(t);if(h!==void 0){var f=gv,m=t;switch(t){case"keypress":if(Oc(n)===0)break e;case"keydown":case"keyup":f=jI;break;case"focusin":m="focus",f=hf;break;case"focusout":m="blur",f=hf;break;case"beforeblur":case"afterblur":f=hf;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Nx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=SI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=BI;break;case Vk:case zk:case Uk:f=AI;break;case $k:f=zI;break;case"scroll":f=kI;break;case"wheel":f=$I;break;case"copy":case"cut":case"paste":f=NI;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Px}var p=(e&4)!==0,v=!p&&t==="scroll",g=p?h!==null?h+"Capture":null:h;p=[];for(var x=l,w;x!==null;){w=x;var b=w.stateNode;if(w.tag===5&&b!==null&&(w=b,g!==null&&(b=Iu(x,g),b!=null&&p.push(Bu(x,b,w)))),v)break;x=x.return}0<p.length&&(h=new f(h,m,null,n,c),d.push({event:h,listeners:p}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&n!==Kp&&(m=n.relatedTarget||n.fromElement)&&(Ro(m)||m[ci]))break e;if((f||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,f?(m=n.relatedTarget||n.toElement,f=l,m=m?Ro(m):null,m!==null&&(v=Xo(m),m!==v||m.tag!==5&&m.tag!==6)&&(m=null)):(f=null,m=l),f!==m)){if(p=Nx,b="onMouseLeave",g="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(p=Px,b="onPointerLeave",g="onPointerEnter",x="pointer"),v=f==null?h:Ia(f),w=m==null?h:Ia(m),h=new p(b,x+"leave",f,n,c),h.target=v,h.relatedTarget=w,b=null,Ro(c)===l&&(p=new p(g,x+"enter",m,n,c),p.target=w,p.relatedTarget=v,b=p),v=b,f&&m)t:{for(p=f,g=m,x=0,w=p;w;w=ua(w))x++;for(w=0,b=g;b;b=ua(b))w++;for(;0<x-w;)p=ua(p),x--;for(;0<w-x;)g=ua(g),w--;for(;x--;){if(p===g||g!==null&&p===g.alternate)break t;p=ua(p),g=ua(g)}p=null}else p=null;f!==null&&Ux(d,h,f,p,!1),m!==null&&v!==null&&Ux(d,v,m,p,!0)}}e:{if(h=l?Ia(l):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var k=YI;else if(Mx(h))if(Ok)k=eD;else{k=QI;var _=JI}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(k=ZI);if(k&&(k=k(t,l))){Mk(d,k,n,c);break e}_&&_(t,h,l),t==="focusout"&&(_=h._wrapperState)&&_.controlled&&h.type==="number"&&Up(h,"number",h.value)}switch(_=l?Ia(l):window,t){case"focusin":(Mx(_)||_.contentEditable==="true")&&(Ta=_,em=l,hu=null);break;case"focusout":hu=em=Ta=null;break;case"mousedown":tm=!0;break;case"contextmenu":case"mouseup":case"dragend":tm=!1,Bx(d,n,c);break;case"selectionchange":if(rD)break;case"keydown":case"keyup":Bx(d,n,c)}var S;if(yv)e:{switch(t){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else Na?Ik(t,n)&&(C="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(C="onCompositionStart");C&&(Pk&&n.locale!=="ko"&&(Na||C!=="onCompositionStart"?C==="onCompositionEnd"&&Na&&(S=Tk()):(Oi=c,mv="value"in Oi?Oi.value:Oi.textContent,Na=!0)),_=id(l,C),0<_.length&&(C=new Tx(C,t,null,n,c),d.push({event:C,listeners:_}),S?C.data=S:(S=Dk(n),S!==null&&(C.data=S)))),(S=GI?HI(t,n):KI(t,n))&&(l=id(l,"onBeforeInput"),0<l.length&&(c=new Tx("onBeforeInput","beforeinput",null,n,c),d.push({event:c,listeners:l}),c.data=S))}Gk(d,e)})}function Bu(t,e,n){return{instance:t,listener:e,currentTarget:n}}function id(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Iu(t,n),o!=null&&r.unshift(Bu(t,o,i)),o=Iu(t,e),o!=null&&r.push(Bu(t,o,i))),t=t.return}return r}function ua(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ux(t,e,n,r,i){for(var o=e._reactName,a=[];n!==null&&n!==r;){var s=n,u=s.alternate,l=s.stateNode;if(u!==null&&u===r)break;s.tag===5&&l!==null&&(s=l,i?(u=Iu(n,o),u!=null&&a.unshift(Bu(n,u,s))):i||(u=Iu(n,o),u!=null&&a.push(Bu(n,u,s)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var sD=/\r\n?/g,uD=/\u0000|\uFFFD/g;function $x(t){return(typeof t=="string"?t:""+t).replace(sD,`
`).replace(uD,"")}function Kl(t,e,n){if(e=$x(e),$x(t)!==e&&n)throw Error(q(425))}function od(){}var nm=null,rm=null;function im(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var om=typeof setTimeout=="function"?setTimeout:void 0,lD=typeof clearTimeout=="function"?clearTimeout:void 0,Wx=typeof Promise=="function"?Promise:void 0,cD=typeof queueMicrotask=="function"?queueMicrotask:typeof Wx<"u"?function(t){return Wx.resolve(null).then(t).catch(dD)}:om;function dD(t){setTimeout(function(){throw t})}function wf(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Ou(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Ou(e)}function Ui(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Gx(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var _s=Math.random().toString(36).slice(2),Tr="__reactFiber$"+_s,Vu="__reactProps$"+_s,ci="__reactContainer$"+_s,am="__reactEvents$"+_s,hD="__reactListeners$"+_s,fD="__reactHandles$"+_s;function Ro(t){var e=t[Tr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ci]||n[Tr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Gx(t);t!==null;){if(n=t[Tr])return n;t=Gx(t)}return e}t=n,n=t.parentNode}return null}function ml(t){return t=t[Tr]||t[ci],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ia(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(q(33))}function ch(t){return t[Vu]||null}var sm=[],Da=-1;function oo(t){return{current:t}}function He(t){0>Da||(t.current=sm[Da],sm[Da]=null,Da--)}function ze(t,e){Da++,sm[Da]=t.current,t.current=e}var Qi={},Qt=oo(Qi),pn=oo(!1),zo=Qi;function ss(t,e){var n=t.type.contextTypes;if(!n)return Qi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in n)i[o]=e[o];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function mn(t){return t=t.childContextTypes,t!=null}function ad(){He(pn),He(Qt)}function Hx(t,e,n){if(Qt.current!==Qi)throw Error(q(168));ze(Qt,e),ze(pn,n)}function Kk(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(q(108,JP(t)||"Unknown",i));return at({},n,r)}function sd(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Qi,zo=Qt.current,ze(Qt,t),ze(pn,pn.current),!0}function Kx(t,e,n){var r=t.stateNode;if(!r)throw Error(q(169));n?(t=Kk(t,e,zo),r.__reactInternalMemoizedMergedChildContext=t,He(pn),He(Qt),ze(Qt,t)):He(pn),ze(pn,n)}var ri=null,dh=!1,bf=!1;function qk(t){ri===null?ri=[t]:ri.push(t)}function pD(t){dh=!0,qk(t)}function ao(){if(!bf&&ri!==null){bf=!0;var t=0,e=Fe;try{var n=ri;for(Fe=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}ri=null,dh=!1}catch(i){throw ri!==null&&(ri=ri.slice(t+1)),xk(dv,ao),i}finally{Fe=e,bf=!1}}return null}var Ma=[],Oa=0,ud=null,ld=0,Vn=[],zn=0,Uo=null,oi=1,ai="";function yo(t,e){Ma[Oa++]=ld,Ma[Oa++]=ud,ud=t,ld=e}function Xk(t,e,n){Vn[zn++]=oi,Vn[zn++]=ai,Vn[zn++]=Uo,Uo=t;var r=oi;t=ai;var i=32-dr(r)-1;r&=~(1<<i),n+=1;var o=32-dr(e)+i;if(30<o){var a=i-i%5;o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,oi=1<<32-dr(e)+i|n<<i|r,ai=o+t}else oi=1<<o|n<<i|r,ai=t}function wv(t){t.return!==null&&(yo(t,1),Xk(t,1,0))}function bv(t){for(;t===ud;)ud=Ma[--Oa],Ma[Oa]=null,ld=Ma[--Oa],Ma[Oa]=null;for(;t===Uo;)Uo=Vn[--zn],Vn[zn]=null,ai=Vn[--zn],Vn[zn]=null,oi=Vn[--zn],Vn[zn]=null}var Pn=null,An=null,qe=!1,sr=null;function Yk(t,e){var n=Wn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function qx(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Pn=t,An=Ui(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Pn=t,An=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Uo!==null?{id:oi,overflow:ai}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Wn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Pn=t,An=null,!0):!1;default:return!1}}function um(t){return(t.mode&1)!==0&&(t.flags&128)===0}function lm(t){if(qe){var e=An;if(e){var n=e;if(!qx(t,e)){if(um(t))throw Error(q(418));e=Ui(n.nextSibling);var r=Pn;e&&qx(t,e)?Yk(r,n):(t.flags=t.flags&-4097|2,qe=!1,Pn=t)}}else{if(um(t))throw Error(q(418));t.flags=t.flags&-4097|2,qe=!1,Pn=t}}}function Xx(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Pn=t}function ql(t){if(t!==Pn)return!1;if(!qe)return Xx(t),qe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!im(t.type,t.memoizedProps)),e&&(e=An)){if(um(t))throw Jk(),Error(q(418));for(;e;)Yk(t,e),e=Ui(e.nextSibling)}if(Xx(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(q(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){An=Ui(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}An=null}}else An=Pn?Ui(t.stateNode.nextSibling):null;return!0}function Jk(){for(var t=An;t;)t=Ui(t.nextSibling)}function us(){An=Pn=null,qe=!1}function kv(t){sr===null?sr=[t]:sr.push(t)}var mD=gi.ReactCurrentBatchConfig;function Ws(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(q(309));var r=n.stateNode}if(!r)throw Error(q(147,t));var i=r,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(a){var s=i.refs;a===null?delete s[o]:s[o]=a},e._stringRef=o,e)}if(typeof t!="string")throw Error(q(284));if(!n._owner)throw Error(q(290,t))}return t}function Xl(t,e){throw t=Object.prototype.toString.call(e),Error(q(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Yx(t){var e=t._init;return e(t._payload)}function Qk(t){function e(g,x){if(t){var w=g.deletions;w===null?(g.deletions=[x],g.flags|=16):w.push(x)}}function n(g,x){if(!t)return null;for(;x!==null;)e(g,x),x=x.sibling;return null}function r(g,x){for(g=new Map;x!==null;)x.key!==null?g.set(x.key,x):g.set(x.index,x),x=x.sibling;return g}function i(g,x){return g=Hi(g,x),g.index=0,g.sibling=null,g}function o(g,x,w){return g.index=w,t?(w=g.alternate,w!==null?(w=w.index,w<x?(g.flags|=2,x):w):(g.flags|=2,x)):(g.flags|=1048576,x)}function a(g){return t&&g.alternate===null&&(g.flags|=2),g}function s(g,x,w,b){return x===null||x.tag!==6?(x=Rf(w,g.mode,b),x.return=g,x):(x=i(x,w),x.return=g,x)}function u(g,x,w,b){var k=w.type;return k===Ra?c(g,x,w.props.children,b,w.key):x!==null&&(x.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Ti&&Yx(k)===x.type)?(b=i(x,w.props),b.ref=Ws(g,x,w),b.return=g,b):(b=Uc(w.type,w.key,w.props,null,g.mode,b),b.ref=Ws(g,x,w),b.return=g,b)}function l(g,x,w,b){return x===null||x.tag!==4||x.stateNode.containerInfo!==w.containerInfo||x.stateNode.implementation!==w.implementation?(x=Nf(w,g.mode,b),x.return=g,x):(x=i(x,w.children||[]),x.return=g,x)}function c(g,x,w,b,k){return x===null||x.tag!==7?(x=Fo(w,g.mode,b,k),x.return=g,x):(x=i(x,w),x.return=g,x)}function d(g,x,w){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Rf(""+x,g.mode,w),x.return=g,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Ll:return w=Uc(x.type,x.key,x.props,null,g.mode,w),w.ref=Ws(g,null,x),w.return=g,w;case Aa:return x=Nf(x,g.mode,w),x.return=g,x;case Ti:var b=x._init;return d(g,b(x._payload),w)}if(nu(x)||Bs(x))return x=Fo(x,g.mode,w,null),x.return=g,x;Xl(g,x)}return null}function h(g,x,w,b){var k=x!==null?x.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return k!==null?null:s(g,x,""+w,b);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Ll:return w.key===k?u(g,x,w,b):null;case Aa:return w.key===k?l(g,x,w,b):null;case Ti:return k=w._init,h(g,x,k(w._payload),b)}if(nu(w)||Bs(w))return k!==null?null:c(g,x,w,b,null);Xl(g,w)}return null}function f(g,x,w,b,k){if(typeof b=="string"&&b!==""||typeof b=="number")return g=g.get(w)||null,s(x,g,""+b,k);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Ll:return g=g.get(b.key===null?w:b.key)||null,u(x,g,b,k);case Aa:return g=g.get(b.key===null?w:b.key)||null,l(x,g,b,k);case Ti:var _=b._init;return f(g,x,w,_(b._payload),k)}if(nu(b)||Bs(b))return g=g.get(w)||null,c(x,g,b,k,null);Xl(x,b)}return null}function m(g,x,w,b){for(var k=null,_=null,S=x,C=x=0,E=null;S!==null&&C<w.length;C++){S.index>C?(E=S,S=null):E=S.sibling;var R=h(g,S,w[C],b);if(R===null){S===null&&(S=E);break}t&&S&&R.alternate===null&&e(g,S),x=o(R,x,C),_===null?k=R:_.sibling=R,_=R,S=E}if(C===w.length)return n(g,S),qe&&yo(g,C),k;if(S===null){for(;C<w.length;C++)S=d(g,w[C],b),S!==null&&(x=o(S,x,C),_===null?k=S:_.sibling=S,_=S);return qe&&yo(g,C),k}for(S=r(g,S);C<w.length;C++)E=f(S,g,C,w[C],b),E!==null&&(t&&E.alternate!==null&&S.delete(E.key===null?C:E.key),x=o(E,x,C),_===null?k=E:_.sibling=E,_=E);return t&&S.forEach(function(D){return e(g,D)}),qe&&yo(g,C),k}function p(g,x,w,b){var k=Bs(w);if(typeof k!="function")throw Error(q(150));if(w=k.call(w),w==null)throw Error(q(151));for(var _=k=null,S=x,C=x=0,E=null,R=w.next();S!==null&&!R.done;C++,R=w.next()){S.index>C?(E=S,S=null):E=S.sibling;var D=h(g,S,R.value,b);if(D===null){S===null&&(S=E);break}t&&S&&D.alternate===null&&e(g,S),x=o(D,x,C),_===null?k=D:_.sibling=D,_=D,S=E}if(R.done)return n(g,S),qe&&yo(g,C),k;if(S===null){for(;!R.done;C++,R=w.next())R=d(g,R.value,b),R!==null&&(x=o(R,x,C),_===null?k=R:_.sibling=R,_=R);return qe&&yo(g,C),k}for(S=r(g,S);!R.done;C++,R=w.next())R=f(S,g,C,R.value,b),R!==null&&(t&&R.alternate!==null&&S.delete(R.key===null?C:R.key),x=o(R,x,C),_===null?k=R:_.sibling=R,_=R);return t&&S.forEach(function(P){return e(g,P)}),qe&&yo(g,C),k}function v(g,x,w,b){if(typeof w=="object"&&w!==null&&w.type===Ra&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case Ll:e:{for(var k=w.key,_=x;_!==null;){if(_.key===k){if(k=w.type,k===Ra){if(_.tag===7){n(g,_.sibling),x=i(_,w.props.children),x.return=g,g=x;break e}}else if(_.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Ti&&Yx(k)===_.type){n(g,_.sibling),x=i(_,w.props),x.ref=Ws(g,_,w),x.return=g,g=x;break e}n(g,_);break}else e(g,_);_=_.sibling}w.type===Ra?(x=Fo(w.props.children,g.mode,b,w.key),x.return=g,g=x):(b=Uc(w.type,w.key,w.props,null,g.mode,b),b.ref=Ws(g,x,w),b.return=g,g=b)}return a(g);case Aa:e:{for(_=w.key;x!==null;){if(x.key===_)if(x.tag===4&&x.stateNode.containerInfo===w.containerInfo&&x.stateNode.implementation===w.implementation){n(g,x.sibling),x=i(x,w.children||[]),x.return=g,g=x;break e}else{n(g,x);break}else e(g,x);x=x.sibling}x=Nf(w,g.mode,b),x.return=g,g=x}return a(g);case Ti:return _=w._init,v(g,x,_(w._payload),b)}if(nu(w))return m(g,x,w,b);if(Bs(w))return p(g,x,w,b);Xl(g,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,x!==null&&x.tag===6?(n(g,x.sibling),x=i(x,w),x.return=g,g=x):(n(g,x),x=Rf(w,g.mode,b),x.return=g,g=x),a(g)):n(g,x)}return v}var ls=Qk(!0),Zk=Qk(!1),cd=oo(null),dd=null,ja=null,_v=null;function Sv(){_v=ja=dd=null}function Cv(t){var e=cd.current;He(cd),t._currentValue=e}function cm(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function qa(t,e){dd=t,_v=ja=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(hn=!0),t.firstContext=null)}function Xn(t){var e=t._currentValue;if(_v!==t)if(t={context:t,memoizedValue:e,next:null},ja===null){if(dd===null)throw Error(q(308));ja=t,dd.dependencies={lanes:0,firstContext:t}}else ja=ja.next=t;return e}var No=null;function Ev(t){No===null?No=[t]:No.push(t)}function e_(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Ev(e)):(n.next=i.next,i.next=n),e.interleaved=n,di(t,r)}function di(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Pi=!1;function Av(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function t_(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function si(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function $i(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Ie&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,di(t,n)}return i=r.interleaved,i===null?(e.next=e,Ev(r)):(e.next=i.next,i.next=e),r.interleaved=e,di(t,n)}function jc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,hv(t,n)}}function Jx(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?i=o=a:o=o.next=a,n=n.next}while(n!==null);o===null?i=o=e:o=o.next=e}else i=o=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function hd(t,e,n,r){var i=t.updateQueue;Pi=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var u=s,l=u.next;u.next=null,a===null?o=l:a.next=l,a=u;var c=t.alternate;c!==null&&(c=c.updateQueue,s=c.lastBaseUpdate,s!==a&&(s===null?c.firstBaseUpdate=l:s.next=l,c.lastBaseUpdate=u))}if(o!==null){var d=i.baseState;a=0,c=l=u=null,s=o;do{var h=s.lane,f=s.eventTime;if((r&h)===h){c!==null&&(c=c.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var m=t,p=s;switch(h=e,f=n,p.tag){case 1:if(m=p.payload,typeof m=="function"){d=m.call(f,d,h);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=p.payload,h=typeof m=="function"?m.call(f,d,h):m,h==null)break e;d=at({},d,h);break e;case 2:Pi=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,h=i.effects,h===null?i.effects=[s]:h.push(s))}else f={eventTime:f,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},c===null?(l=c=f,u=d):c=c.next=f,a|=h;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;h=s,s=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(c===null&&(u=d),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Wo|=a,t.lanes=a,t.memoizedState=d}}function Qx(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(q(191,i));i.call(r)}}}var gl={},Or=oo(gl),zu=oo(gl),Uu=oo(gl);function To(t){if(t===gl)throw Error(q(174));return t}function Rv(t,e){switch(ze(Uu,e),ze(zu,t),ze(Or,gl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Wp(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Wp(e,t)}He(Or),ze(Or,e)}function cs(){He(Or),He(zu),He(Uu)}function n_(t){To(Uu.current);var e=To(Or.current),n=Wp(e,t.type);e!==n&&(ze(zu,t),ze(Or,n))}function Nv(t){zu.current===t&&(He(Or),He(zu))}var tt=oo(0);function fd(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var kf=[];function Tv(){for(var t=0;t<kf.length;t++)kf[t]._workInProgressVersionPrimary=null;kf.length=0}var Fc=gi.ReactCurrentDispatcher,_f=gi.ReactCurrentBatchConfig,$o=0,ot=null,kt=null,Tt=null,pd=!1,fu=!1,$u=0,gD=0;function $t(){throw Error(q(321))}function Pv(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!pr(t[n],e[n]))return!1;return!0}function Iv(t,e,n,r,i,o){if($o=o,ot=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Fc.current=t===null||t.memoizedState===null?wD:bD,t=n(r,i),fu){o=0;do{if(fu=!1,$u=0,25<=o)throw Error(q(301));o+=1,Tt=kt=null,e.updateQueue=null,Fc.current=kD,t=n(r,i)}while(fu)}if(Fc.current=md,e=kt!==null&&kt.next!==null,$o=0,Tt=kt=ot=null,pd=!1,e)throw Error(q(300));return t}function Dv(){var t=$u!==0;return $u=0,t}function Ar(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tt===null?ot.memoizedState=Tt=t:Tt=Tt.next=t,Tt}function Yn(){if(kt===null){var t=ot.alternate;t=t!==null?t.memoizedState:null}else t=kt.next;var e=Tt===null?ot.memoizedState:Tt.next;if(e!==null)Tt=e,kt=t;else{if(t===null)throw Error(q(310));kt=t,t={memoizedState:kt.memoizedState,baseState:kt.baseState,baseQueue:kt.baseQueue,queue:kt.queue,next:null},Tt===null?ot.memoizedState=Tt=t:Tt=Tt.next=t}return Tt}function Wu(t,e){return typeof e=="function"?e(t):e}function Sf(t){var e=Yn(),n=e.queue;if(n===null)throw Error(q(311));n.lastRenderedReducer=t;var r=kt,i=r.baseQueue,o=n.pending;if(o!==null){if(i!==null){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,n.pending=null}if(i!==null){o=i.next,r=r.baseState;var s=a=null,u=null,l=o;do{var c=l.lane;if(($o&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:t(r,l.action);else{var d={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(s=u=d,a=r):u=u.next=d,ot.lanes|=c,Wo|=c}l=l.next}while(l!==null&&l!==o);u===null?a=r:u.next=s,pr(r,e.memoizedState)||(hn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do o=i.lane,ot.lanes|=o,Wo|=o,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Cf(t){var e=Yn(),n=e.queue;if(n===null)throw Error(q(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,o=e.memoizedState;if(i!==null){n.pending=null;var a=i=i.next;do o=t(o,a.action),a=a.next;while(a!==i);pr(o,e.memoizedState)||(hn=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,r]}function r_(){}function i_(t,e){var n=ot,r=Yn(),i=e(),o=!pr(r.memoizedState,i);if(o&&(r.memoizedState=i,hn=!0),r=r.queue,Mv(s_.bind(null,n,r,t),[t]),r.getSnapshot!==e||o||Tt!==null&&Tt.memoizedState.tag&1){if(n.flags|=2048,Gu(9,a_.bind(null,n,r,i,e),void 0,null),Pt===null)throw Error(q(349));$o&30||o_(n,e,i)}return i}function o_(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ot.updateQueue,e===null?(e={lastEffect:null,stores:null},ot.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function a_(t,e,n,r){e.value=n,e.getSnapshot=r,u_(e)&&l_(t)}function s_(t,e,n){return n(function(){u_(e)&&l_(t)})}function u_(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!pr(t,n)}catch{return!0}}function l_(t){var e=di(t,1);e!==null&&hr(e,t,1,-1)}function Zx(t){var e=Ar();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Wu,lastRenderedState:t},e.queue=t,t=t.dispatch=xD.bind(null,ot,t),[e.memoizedState,t]}function Gu(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=ot.updateQueue,e===null?(e={lastEffect:null,stores:null},ot.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function c_(){return Yn().memoizedState}function Lc(t,e,n,r){var i=Ar();ot.flags|=t,i.memoizedState=Gu(1|e,n,void 0,r===void 0?null:r)}function hh(t,e,n,r){var i=Yn();r=r===void 0?null:r;var o=void 0;if(kt!==null){var a=kt.memoizedState;if(o=a.destroy,r!==null&&Pv(r,a.deps)){i.memoizedState=Gu(e,n,o,r);return}}ot.flags|=t,i.memoizedState=Gu(1|e,n,o,r)}function ew(t,e){return Lc(8390656,8,t,e)}function Mv(t,e){return hh(2048,8,t,e)}function d_(t,e){return hh(4,2,t,e)}function h_(t,e){return hh(4,4,t,e)}function f_(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function p_(t,e,n){return n=n!=null?n.concat([t]):null,hh(4,4,f_.bind(null,e,t),n)}function Ov(){}function m_(t,e){var n=Yn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Pv(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function g_(t,e){var n=Yn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Pv(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function v_(t,e,n){return $o&21?(pr(n,e)||(n=kk(),ot.lanes|=n,Wo|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,hn=!0),t.memoizedState=n)}function vD(t,e){var n=Fe;Fe=n!==0&&4>n?n:4,t(!0);var r=_f.transition;_f.transition={};try{t(!1),e()}finally{Fe=n,_f.transition=r}}function y_(){return Yn().memoizedState}function yD(t,e,n){var r=Gi(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},x_(t))w_(e,n);else if(n=e_(t,e,n,r),n!==null){var i=an();hr(n,t,r,i),b_(n,e,r)}}function xD(t,e,n){var r=Gi(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(x_(t))w_(e,i);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var a=e.lastRenderedState,s=o(a,n);if(i.hasEagerState=!0,i.eagerState=s,pr(s,a)){var u=e.interleaved;u===null?(i.next=i,Ev(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}n=e_(t,e,i,r),n!==null&&(i=an(),hr(n,t,r,i),b_(n,e,r))}}function x_(t){var e=t.alternate;return t===ot||e!==null&&e===ot}function w_(t,e){fu=pd=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function b_(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,hv(t,n)}}var md={readContext:Xn,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useInsertionEffect:$t,useLayoutEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useMutableSource:$t,useSyncExternalStore:$t,useId:$t,unstable_isNewReconciler:!1},wD={readContext:Xn,useCallback:function(t,e){return Ar().memoizedState=[t,e===void 0?null:e],t},useContext:Xn,useEffect:ew,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Lc(4194308,4,f_.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Lc(4194308,4,t,e)},useInsertionEffect:function(t,e){return Lc(4,2,t,e)},useMemo:function(t,e){var n=Ar();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Ar();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=yD.bind(null,ot,t),[r.memoizedState,t]},useRef:function(t){var e=Ar();return t={current:t},e.memoizedState=t},useState:Zx,useDebugValue:Ov,useDeferredValue:function(t){return Ar().memoizedState=t},useTransition:function(){var t=Zx(!1),e=t[0];return t=vD.bind(null,t[1]),Ar().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=ot,i=Ar();if(qe){if(n===void 0)throw Error(q(407));n=n()}else{if(n=e(),Pt===null)throw Error(q(349));$o&30||o_(r,e,n)}i.memoizedState=n;var o={value:n,getSnapshot:e};return i.queue=o,ew(s_.bind(null,r,o,t),[t]),r.flags|=2048,Gu(9,a_.bind(null,r,o,n,e),void 0,null),n},useId:function(){var t=Ar(),e=Pt.identifierPrefix;if(qe){var n=ai,r=oi;n=(r&~(1<<32-dr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=$u++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=gD++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},bD={readContext:Xn,useCallback:m_,useContext:Xn,useEffect:Mv,useImperativeHandle:p_,useInsertionEffect:d_,useLayoutEffect:h_,useMemo:g_,useReducer:Sf,useRef:c_,useState:function(){return Sf(Wu)},useDebugValue:Ov,useDeferredValue:function(t){var e=Yn();return v_(e,kt.memoizedState,t)},useTransition:function(){var t=Sf(Wu)[0],e=Yn().memoizedState;return[t,e]},useMutableSource:r_,useSyncExternalStore:i_,useId:y_,unstable_isNewReconciler:!1},kD={readContext:Xn,useCallback:m_,useContext:Xn,useEffect:Mv,useImperativeHandle:p_,useInsertionEffect:d_,useLayoutEffect:h_,useMemo:g_,useReducer:Cf,useRef:c_,useState:function(){return Cf(Wu)},useDebugValue:Ov,useDeferredValue:function(t){var e=Yn();return kt===null?e.memoizedState=t:v_(e,kt.memoizedState,t)},useTransition:function(){var t=Cf(Wu)[0],e=Yn().memoizedState;return[t,e]},useMutableSource:r_,useSyncExternalStore:i_,useId:y_,unstable_isNewReconciler:!1};function rr(t,e){if(t&&t.defaultProps){e=at({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function dm(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:at({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var fh={isMounted:function(t){return(t=t._reactInternals)?Xo(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=an(),i=Gi(t),o=si(r,i);o.payload=e,n!=null&&(o.callback=n),e=$i(t,o,i),e!==null&&(hr(e,t,i,r),jc(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=an(),i=Gi(t),o=si(r,i);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=$i(t,o,i),e!==null&&(hr(e,t,i,r),jc(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=an(),r=Gi(t),i=si(n,r);i.tag=2,e!=null&&(i.callback=e),e=$i(t,i,r),e!==null&&(hr(e,t,r,n),jc(e,t,r))}};function tw(t,e,n,r,i,o,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,o,a):e.prototype&&e.prototype.isPureReactComponent?!Fu(n,r)||!Fu(i,o):!0}function k_(t,e,n){var r=!1,i=Qi,o=e.contextType;return typeof o=="object"&&o!==null?o=Xn(o):(i=mn(e)?zo:Qt.current,r=e.contextTypes,o=(r=r!=null)?ss(t,i):Qi),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=fh,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function nw(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&fh.enqueueReplaceState(e,e.state,null)}function hm(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Av(t);var o=e.contextType;typeof o=="object"&&o!==null?i.context=Xn(o):(o=mn(e)?zo:Qt.current,i.context=ss(t,o)),i.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(dm(t,e,o,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&fh.enqueueReplaceState(i,i.state,null),hd(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function ds(t,e){try{var n="",r=e;do n+=YP(r),r=r.return;while(r);var i=n}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:i,digest:null}}function Ef(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function fm(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var _D=typeof WeakMap=="function"?WeakMap:Map;function __(t,e,n){n=si(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){vd||(vd=!0,_m=r),fm(t,e)},n}function S_(t,e,n){n=si(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){fm(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){fm(t,e),typeof r!="function"&&(Wi===null?Wi=new Set([this]):Wi.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function rw(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new _D;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=FD.bind(null,t,e,n),e.then(t,t))}function iw(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function ow(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=si(-1,1),e.tag=2,$i(n,e,1))),n.lanes|=1),t)}var SD=gi.ReactCurrentOwner,hn=!1;function en(t,e,n,r){e.child=t===null?Zk(e,null,n,r):ls(e,t.child,n,r)}function aw(t,e,n,r,i){n=n.render;var o=e.ref;return qa(e,i),r=Iv(t,e,n,r,o,i),n=Dv(),t!==null&&!hn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,hi(t,e,i)):(qe&&n&&wv(e),e.flags|=1,en(t,e,r,i),e.child)}function sw(t,e,n,r,i){if(t===null){var o=n.type;return typeof o=="function"&&!$v(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,C_(t,e,o,r,i)):(t=Uc(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&i)){var a=o.memoizedProps;if(n=n.compare,n=n!==null?n:Fu,n(a,r)&&t.ref===e.ref)return hi(t,e,i)}return e.flags|=1,t=Hi(o,r),t.ref=e.ref,t.return=e,e.child=t}function C_(t,e,n,r,i){if(t!==null){var o=t.memoizedProps;if(Fu(o,r)&&t.ref===e.ref)if(hn=!1,e.pendingProps=r=o,(t.lanes&i)!==0)t.flags&131072&&(hn=!0);else return e.lanes=t.lanes,hi(t,e,i)}return pm(t,e,n,r,i)}function E_(t,e,n){var r=e.pendingProps,i=r.children,o=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ze(La,kn),kn|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ze(La,kn),kn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:n,ze(La,kn),kn|=r}else o!==null?(r=o.baseLanes|n,e.memoizedState=null):r=n,ze(La,kn),kn|=r;return en(t,e,i,n),e.child}function A_(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function pm(t,e,n,r,i){var o=mn(n)?zo:Qt.current;return o=ss(e,o),qa(e,i),n=Iv(t,e,n,r,o,i),r=Dv(),t!==null&&!hn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,hi(t,e,i)):(qe&&r&&wv(e),e.flags|=1,en(t,e,n,i),e.child)}function uw(t,e,n,r,i){if(mn(n)){var o=!0;sd(e)}else o=!1;if(qa(e,i),e.stateNode===null)Bc(t,e),k_(e,n,r),hm(e,n,r,i),r=!0;else if(t===null){var a=e.stateNode,s=e.memoizedProps;a.props=s;var u=a.context,l=n.contextType;typeof l=="object"&&l!==null?l=Xn(l):(l=mn(n)?zo:Qt.current,l=ss(e,l));var c=n.getDerivedStateFromProps,d=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==r||u!==l)&&nw(e,a,r,l),Pi=!1;var h=e.memoizedState;a.state=h,hd(e,r,a,i),u=e.memoizedState,s!==r||h!==u||pn.current||Pi?(typeof c=="function"&&(dm(e,n,c,r),u=e.memoizedState),(s=Pi||tw(e,n,s,r,h,u,l))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),a.props=r,a.state=u,a.context=l,r=s):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,t_(t,e),s=e.memoizedProps,l=e.type===e.elementType?s:rr(e.type,s),a.props=l,d=e.pendingProps,h=a.context,u=n.contextType,typeof u=="object"&&u!==null?u=Xn(u):(u=mn(n)?zo:Qt.current,u=ss(e,u));var f=n.getDerivedStateFromProps;(c=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==d||h!==u)&&nw(e,a,r,u),Pi=!1,h=e.memoizedState,a.state=h,hd(e,r,a,i);var m=e.memoizedState;s!==d||h!==m||pn.current||Pi?(typeof f=="function"&&(dm(e,n,f,r),m=e.memoizedState),(l=Pi||tw(e,n,l,r,h,m,u)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,m,u),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,m,u)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),a.props=r,a.state=m,a.context=u,r=l):(typeof a.componentDidUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return mm(t,e,n,r,o,i)}function mm(t,e,n,r,i,o){A_(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return i&&Kx(e,n,!1),hi(t,e,o);r=e.stateNode,SD.current=e;var s=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=ls(e,t.child,null,o),e.child=ls(e,null,s,o)):en(t,e,s,o),e.memoizedState=r.state,i&&Kx(e,n,!0),e.child}function R_(t){var e=t.stateNode;e.pendingContext?Hx(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Hx(t,e.context,!1),Rv(t,e.containerInfo)}function lw(t,e,n,r,i){return us(),kv(i),e.flags|=256,en(t,e,n,r),e.child}var gm={dehydrated:null,treeContext:null,retryLane:0};function vm(t){return{baseLanes:t,cachePool:null,transitions:null}}function N_(t,e,n){var r=e.pendingProps,i=tt.current,o=!1,a=(e.flags&128)!==0,s;if((s=a)||(s=t!==null&&t.memoizedState===null?!1:(i&2)!==0),s?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),ze(tt,i&1),t===null)return lm(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,o?(r=e.mode,o=e.child,a={mode:"hidden",children:a},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=a):o=gh(a,r,0,null),t=Fo(t,r,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=vm(n),e.memoizedState=gm,t):jv(e,a));if(i=t.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return CD(t,e,a,r,s,i,n);if(o){o=r.fallback,a=e.mode,i=t.child,s=i.sibling;var u={mode:"hidden",children:r.children};return!(a&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Hi(i,u),r.subtreeFlags=i.subtreeFlags&14680064),s!==null?o=Hi(s,o):(o=Fo(o,a,n,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,a=t.child.memoizedState,a=a===null?vm(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=t.childLanes&~n,e.memoizedState=gm,r}return o=t.child,t=o.sibling,r=Hi(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function jv(t,e){return e=gh({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Yl(t,e,n,r){return r!==null&&kv(r),ls(e,t.child,null,n),t=jv(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function CD(t,e,n,r,i,o,a){if(n)return e.flags&256?(e.flags&=-257,r=Ef(Error(q(422))),Yl(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=gh({mode:"visible",children:r.children},i,0,null),o=Fo(o,i,a,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&ls(e,t.child,null,a),e.child.memoizedState=vm(a),e.memoizedState=gm,o);if(!(e.mode&1))return Yl(t,e,a,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var s=r.dgst;return r=s,o=Error(q(419)),r=Ef(o,r,void 0),Yl(t,e,a,r)}if(s=(a&t.childLanes)!==0,hn||s){if(r=Pt,r!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|a)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,di(t,i),hr(r,t,i,-1))}return Uv(),r=Ef(Error(q(421))),Yl(t,e,a,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=LD.bind(null,t),i._reactRetry=e,null):(t=o.treeContext,An=Ui(i.nextSibling),Pn=e,qe=!0,sr=null,t!==null&&(Vn[zn++]=oi,Vn[zn++]=ai,Vn[zn++]=Uo,oi=t.id,ai=t.overflow,Uo=e),e=jv(e,r.children),e.flags|=4096,e)}function cw(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),cm(t.return,e,n)}function Af(t,e,n,r,i){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function T_(t,e,n){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(en(t,e,r.children,n),r=tt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&cw(t,n,e);else if(t.tag===19)cw(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ze(tt,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&fd(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Af(e,!1,i,n,o);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&fd(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Af(e,!0,n,null,o);break;case"together":Af(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Bc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function hi(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Wo|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(q(153));if(e.child!==null){for(t=e.child,n=Hi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Hi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function ED(t,e,n){switch(e.tag){case 3:R_(e),us();break;case 5:n_(e);break;case 1:mn(e.type)&&sd(e);break;case 4:Rv(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ze(cd,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ze(tt,tt.current&1),e.flags|=128,null):n&e.child.childLanes?N_(t,e,n):(ze(tt,tt.current&1),t=hi(t,e,n),t!==null?t.sibling:null);ze(tt,tt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return T_(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ze(tt,tt.current),r)break;return null;case 22:case 23:return e.lanes=0,E_(t,e,n)}return hi(t,e,n)}var P_,ym,I_,D_;P_=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ym=function(){};I_=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,To(Or.current);var o=null;switch(n){case"input":i=Vp(t,i),r=Vp(t,r),o=[];break;case"select":i=at({},i,{value:void 0}),r=at({},r,{value:void 0}),o=[];break;case"textarea":i=$p(t,i),r=$p(t,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=od)}Gp(n,r);var a;n=null;for(l in i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var s=i[l];for(a in s)s.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Tu.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var u=r[l];if(s=i!=null?i[l]:void 0,r.hasOwnProperty(l)&&u!==s&&(u!=null||s!=null))if(l==="style")if(s){for(a in s)!s.hasOwnProperty(a)||u&&u.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in u)u.hasOwnProperty(a)&&s[a]!==u[a]&&(n||(n={}),n[a]=u[a])}else n||(o||(o=[]),o.push(l,n)),n=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,s=s?s.__html:void 0,u!=null&&s!==u&&(o=o||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(o=o||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Tu.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&We("scroll",t),o||s===u||(o=[])):(o=o||[]).push(l,u))}n&&(o=o||[]).push("style",n);var l=o;(e.updateQueue=l)&&(e.flags|=4)}};D_=function(t,e,n,r){n!==r&&(e.flags|=4)};function Gs(t,e){if(!qe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Wt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function AD(t,e,n){var r=e.pendingProps;switch(bv(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(e),null;case 1:return mn(e.type)&&ad(),Wt(e),null;case 3:return r=e.stateNode,cs(),He(pn),He(Qt),Tv(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ql(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,sr!==null&&(Em(sr),sr=null))),ym(t,e),Wt(e),null;case 5:Nv(e);var i=To(Uu.current);if(n=e.type,t!==null&&e.stateNode!=null)I_(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(q(166));return Wt(e),null}if(t=To(Or.current),ql(e)){r=e.stateNode,n=e.type;var o=e.memoizedProps;switch(r[Tr]=e,r[Vu]=o,t=(e.mode&1)!==0,n){case"dialog":We("cancel",r),We("close",r);break;case"iframe":case"object":case"embed":We("load",r);break;case"video":case"audio":for(i=0;i<iu.length;i++)We(iu[i],r);break;case"source":We("error",r);break;case"img":case"image":case"link":We("error",r),We("load",r);break;case"details":We("toggle",r);break;case"input":xx(r,o),We("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},We("invalid",r);break;case"textarea":bx(r,o),We("invalid",r)}Gp(n,o),i=null;for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];a==="children"?typeof s=="string"?r.textContent!==s&&(o.suppressHydrationWarning!==!0&&Kl(r.textContent,s,t),i=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(o.suppressHydrationWarning!==!0&&Kl(r.textContent,s,t),i=["children",""+s]):Tu.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&We("scroll",r)}switch(n){case"input":Bl(r),wx(r,o,!0);break;case"textarea":Bl(r),kx(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=od)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=sk(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[Tr]=e,t[Vu]=r,P_(t,e,!1,!1),e.stateNode=t;e:{switch(a=Hp(n,r),n){case"dialog":We("cancel",t),We("close",t),i=r;break;case"iframe":case"object":case"embed":We("load",t),i=r;break;case"video":case"audio":for(i=0;i<iu.length;i++)We(iu[i],t);i=r;break;case"source":We("error",t),i=r;break;case"img":case"image":case"link":We("error",t),We("load",t),i=r;break;case"details":We("toggle",t),i=r;break;case"input":xx(t,r),i=Vp(t,r),We("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=at({},r,{value:void 0}),We("invalid",t);break;case"textarea":bx(t,r),i=$p(t,r),We("invalid",t);break;default:i=r}Gp(n,i),s=i;for(o in s)if(s.hasOwnProperty(o)){var u=s[o];o==="style"?ck(t,u):o==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&uk(t,u)):o==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&Pu(t,u):typeof u=="number"&&Pu(t,""+u):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Tu.hasOwnProperty(o)?u!=null&&o==="onScroll"&&We("scroll",t):u!=null&&av(t,o,u,a))}switch(n){case"input":Bl(t),wx(t,r,!1);break;case"textarea":Bl(t),kx(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ji(r.value));break;case"select":t.multiple=!!r.multiple,o=r.value,o!=null?Wa(t,!!r.multiple,o,!1):r.defaultValue!=null&&Wa(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=od)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Wt(e),null;case 6:if(t&&e.stateNode!=null)D_(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(q(166));if(n=To(Uu.current),To(Or.current),ql(e)){if(r=e.stateNode,n=e.memoizedProps,r[Tr]=e,(o=r.nodeValue!==n)&&(t=Pn,t!==null))switch(t.tag){case 3:Kl(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Kl(r.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Tr]=e,e.stateNode=r}return Wt(e),null;case 13:if(He(tt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(qe&&An!==null&&e.mode&1&&!(e.flags&128))Jk(),us(),e.flags|=98560,o=!1;else if(o=ql(e),r!==null&&r.dehydrated!==null){if(t===null){if(!o)throw Error(q(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(q(317));o[Tr]=e}else us(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Wt(e),o=!1}else sr!==null&&(Em(sr),sr=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||tt.current&1?_t===0&&(_t=3):Uv())),e.updateQueue!==null&&(e.flags|=4),Wt(e),null);case 4:return cs(),ym(t,e),t===null&&Lu(e.stateNode.containerInfo),Wt(e),null;case 10:return Cv(e.type._context),Wt(e),null;case 17:return mn(e.type)&&ad(),Wt(e),null;case 19:if(He(tt),o=e.memoizedState,o===null)return Wt(e),null;if(r=(e.flags&128)!==0,a=o.rendering,a===null)if(r)Gs(o,!1);else{if(_t!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=fd(t),a!==null){for(e.flags|=128,Gs(o,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)o=n,t=r,o.flags&=14680066,a=o.alternate,a===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,t=a.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ze(tt,tt.current&1|2),e.child}t=t.sibling}o.tail!==null&&ft()>hs&&(e.flags|=128,r=!0,Gs(o,!1),e.lanes=4194304)}else{if(!r)if(t=fd(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Gs(o,!0),o.tail===null&&o.tailMode==="hidden"&&!a.alternate&&!qe)return Wt(e),null}else 2*ft()-o.renderingStartTime>hs&&n!==1073741824&&(e.flags|=128,r=!0,Gs(o,!1),e.lanes=4194304);o.isBackwards?(a.sibling=e.child,e.child=a):(n=o.last,n!==null?n.sibling=a:e.child=a,o.last=a)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=ft(),e.sibling=null,n=tt.current,ze(tt,r?n&1|2:n&1),e):(Wt(e),null);case 22:case 23:return zv(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?kn&1073741824&&(Wt(e),e.subtreeFlags&6&&(e.flags|=8192)):Wt(e),null;case 24:return null;case 25:return null}throw Error(q(156,e.tag))}function RD(t,e){switch(bv(e),e.tag){case 1:return mn(e.type)&&ad(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return cs(),He(pn),He(Qt),Tv(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Nv(e),null;case 13:if(He(tt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(q(340));us()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return He(tt),null;case 4:return cs(),null;case 10:return Cv(e.type._context),null;case 22:case 23:return zv(),null;case 24:return null;default:return null}}var Jl=!1,Ht=!1,ND=typeof WeakSet=="function"?WeakSet:Set,Z=null;function Fa(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){dt(t,e,r)}else n.current=null}function xm(t,e,n){try{n()}catch(r){dt(t,e,r)}}var dw=!1;function TD(t,e){if(nm=nd,t=Lk(),xv(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var a=0,s=-1,u=-1,l=0,c=0,d=t,h=null;t:for(;;){for(var f;d!==n||i!==0&&d.nodeType!==3||(s=a+i),d!==o||r!==0&&d.nodeType!==3||(u=a+r),d.nodeType===3&&(a+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===t)break t;if(h===n&&++l===i&&(s=a),h===o&&++c===r&&(u=a),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}n=s===-1||u===-1?null:{start:s,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(rm={focusedElem:t,selectionRange:n},nd=!1,Z=e;Z!==null;)if(e=Z,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Z=t;else for(;Z!==null;){e=Z;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var p=m.memoizedProps,v=m.memoizedState,g=e.stateNode,x=g.getSnapshotBeforeUpdate(e.elementType===e.type?p:rr(e.type,p),v);g.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(q(163))}}catch(b){dt(e,e.return,b)}if(t=e.sibling,t!==null){t.return=e.return,Z=t;break}Z=e.return}return m=dw,dw=!1,m}function pu(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var o=i.destroy;i.destroy=void 0,o!==void 0&&xm(e,n,o)}i=i.next}while(i!==r)}}function ph(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function wm(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function M_(t){var e=t.alternate;e!==null&&(t.alternate=null,M_(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Tr],delete e[Vu],delete e[am],delete e[hD],delete e[fD])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function O_(t){return t.tag===5||t.tag===3||t.tag===4}function hw(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||O_(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function bm(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=od));else if(r!==4&&(t=t.child,t!==null))for(bm(t,e,n),t=t.sibling;t!==null;)bm(t,e,n),t=t.sibling}function km(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(km(t,e,n),t=t.sibling;t!==null;)km(t,e,n),t=t.sibling}var Ot=null,or=!1;function Si(t,e,n){for(n=n.child;n!==null;)j_(t,e,n),n=n.sibling}function j_(t,e,n){if(Mr&&typeof Mr.onCommitFiberUnmount=="function")try{Mr.onCommitFiberUnmount(ah,n)}catch{}switch(n.tag){case 5:Ht||Fa(n,e);case 6:var r=Ot,i=or;Ot=null,Si(t,e,n),Ot=r,or=i,Ot!==null&&(or?(t=Ot,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ot.removeChild(n.stateNode));break;case 18:Ot!==null&&(or?(t=Ot,n=n.stateNode,t.nodeType===8?wf(t.parentNode,n):t.nodeType===1&&wf(t,n),Ou(t)):wf(Ot,n.stateNode));break;case 4:r=Ot,i=or,Ot=n.stateNode.containerInfo,or=!0,Si(t,e,n),Ot=r,or=i;break;case 0:case 11:case 14:case 15:if(!Ht&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,a=o.destroy;o=o.tag,a!==void 0&&(o&2||o&4)&&xm(n,e,a),i=i.next}while(i!==r)}Si(t,e,n);break;case 1:if(!Ht&&(Fa(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){dt(n,e,s)}Si(t,e,n);break;case 21:Si(t,e,n);break;case 22:n.mode&1?(Ht=(r=Ht)||n.memoizedState!==null,Si(t,e,n),Ht=r):Si(t,e,n);break;default:Si(t,e,n)}}function fw(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new ND),e.forEach(function(r){var i=BD.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Zn(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var o=t,a=e,s=a;e:for(;s!==null;){switch(s.tag){case 5:Ot=s.stateNode,or=!1;break e;case 3:Ot=s.stateNode.containerInfo,or=!0;break e;case 4:Ot=s.stateNode.containerInfo,or=!0;break e}s=s.return}if(Ot===null)throw Error(q(160));j_(o,a,i),Ot=null,or=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(l){dt(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)F_(e,t),e=e.sibling}function F_(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Zn(e,t),Cr(t),r&4){try{pu(3,t,t.return),ph(3,t)}catch(p){dt(t,t.return,p)}try{pu(5,t,t.return)}catch(p){dt(t,t.return,p)}}break;case 1:Zn(e,t),Cr(t),r&512&&n!==null&&Fa(n,n.return);break;case 5:if(Zn(e,t),Cr(t),r&512&&n!==null&&Fa(n,n.return),t.flags&32){var i=t.stateNode;try{Pu(i,"")}catch(p){dt(t,t.return,p)}}if(r&4&&(i=t.stateNode,i!=null)){var o=t.memoizedProps,a=n!==null?n.memoizedProps:o,s=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{s==="input"&&o.type==="radio"&&o.name!=null&&ok(i,o),Hp(s,a);var l=Hp(s,o);for(a=0;a<u.length;a+=2){var c=u[a],d=u[a+1];c==="style"?ck(i,d):c==="dangerouslySetInnerHTML"?uk(i,d):c==="children"?Pu(i,d):av(i,c,d,l)}switch(s){case"input":zp(i,o);break;case"textarea":ak(i,o);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var f=o.value;f!=null?Wa(i,!!o.multiple,f,!1):h!==!!o.multiple&&(o.defaultValue!=null?Wa(i,!!o.multiple,o.defaultValue,!0):Wa(i,!!o.multiple,o.multiple?[]:"",!1))}i[Vu]=o}catch(p){dt(t,t.return,p)}}break;case 6:if(Zn(e,t),Cr(t),r&4){if(t.stateNode===null)throw Error(q(162));i=t.stateNode,o=t.memoizedProps;try{i.nodeValue=o}catch(p){dt(t,t.return,p)}}break;case 3:if(Zn(e,t),Cr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ou(e.containerInfo)}catch(p){dt(t,t.return,p)}break;case 4:Zn(e,t),Cr(t);break;case 13:Zn(e,t),Cr(t),i=t.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(Bv=ft())),r&4&&fw(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(Ht=(l=Ht)||c,Zn(e,t),Ht=l):Zn(e,t),Cr(t),r&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!c&&t.mode&1)for(Z=t,c=t.child;c!==null;){for(d=Z=c;Z!==null;){switch(h=Z,f=h.child,h.tag){case 0:case 11:case 14:case 15:pu(4,h,h.return);break;case 1:Fa(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(p){dt(r,n,p)}}break;case 5:Fa(h,h.return);break;case 22:if(h.memoizedState!==null){mw(d);continue}}f!==null?(f.return=h,Z=f):mw(d)}c=c.sibling}e:for(c=null,d=t;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,l?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(s=d.stateNode,u=d.memoizedProps.style,a=u!=null&&u.hasOwnProperty("display")?u.display:null,s.style.display=lk("display",a))}catch(p){dt(t,t.return,p)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(p){dt(t,t.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Zn(e,t),Cr(t),r&4&&fw(t);break;case 21:break;default:Zn(e,t),Cr(t)}}function Cr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(O_(n)){var r=n;break e}n=n.return}throw Error(q(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Pu(i,""),r.flags&=-33);var o=hw(t);km(t,o,i);break;case 3:case 4:var a=r.stateNode.containerInfo,s=hw(t);bm(t,s,a);break;default:throw Error(q(161))}}catch(u){dt(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function PD(t,e,n){Z=t,L_(t)}function L_(t,e,n){for(var r=(t.mode&1)!==0;Z!==null;){var i=Z,o=i.child;if(i.tag===22&&r){var a=i.memoizedState!==null||Jl;if(!a){var s=i.alternate,u=s!==null&&s.memoizedState!==null||Ht;s=Jl;var l=Ht;if(Jl=a,(Ht=u)&&!l)for(Z=i;Z!==null;)a=Z,u=a.child,a.tag===22&&a.memoizedState!==null?gw(i):u!==null?(u.return=a,Z=u):gw(i);for(;o!==null;)Z=o,L_(o),o=o.sibling;Z=i,Jl=s,Ht=l}pw(t)}else i.subtreeFlags&8772&&o!==null?(o.return=i,Z=o):pw(t)}}function pw(t){for(;Z!==null;){var e=Z;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ht||ph(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ht)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:rr(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&Qx(e,o,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Qx(e,a,n)}break;case 5:var s=e.stateNode;if(n===null&&e.flags&4){n=s;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Ou(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(q(163))}Ht||e.flags&512&&wm(e)}catch(h){dt(e,e.return,h)}}if(e===t){Z=null;break}if(n=e.sibling,n!==null){n.return=e.return,Z=n;break}Z=e.return}}function mw(t){for(;Z!==null;){var e=Z;if(e===t){Z=null;break}var n=e.sibling;if(n!==null){n.return=e.return,Z=n;break}Z=e.return}}function gw(t){for(;Z!==null;){var e=Z;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ph(4,e)}catch(u){dt(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){dt(e,i,u)}}var o=e.return;try{wm(e)}catch(u){dt(e,o,u)}break;case 5:var a=e.return;try{wm(e)}catch(u){dt(e,a,u)}}}catch(u){dt(e,e.return,u)}if(e===t){Z=null;break}var s=e.sibling;if(s!==null){s.return=e.return,Z=s;break}Z=e.return}}var ID=Math.ceil,gd=gi.ReactCurrentDispatcher,Fv=gi.ReactCurrentOwner,Kn=gi.ReactCurrentBatchConfig,Ie=0,Pt=null,vt=null,zt=0,kn=0,La=oo(0),_t=0,Hu=null,Wo=0,mh=0,Lv=0,mu=null,ln=null,Bv=0,hs=1/0,ti=null,vd=!1,_m=null,Wi=null,Ql=!1,ji=null,yd=0,gu=0,Sm=null,Vc=-1,zc=0;function an(){return Ie&6?ft():Vc!==-1?Vc:Vc=ft()}function Gi(t){return t.mode&1?Ie&2&&zt!==0?zt&-zt:mD.transition!==null?(zc===0&&(zc=kk()),zc):(t=Fe,t!==0||(t=window.event,t=t===void 0?16:Nk(t.type)),t):1}function hr(t,e,n,r){if(50<gu)throw gu=0,Sm=null,Error(q(185));fl(t,n,r),(!(Ie&2)||t!==Pt)&&(t===Pt&&(!(Ie&2)&&(mh|=n),_t===4&&Di(t,zt)),gn(t,r),n===1&&Ie===0&&!(e.mode&1)&&(hs=ft()+500,dh&&ao()))}function gn(t,e){var n=t.callbackNode;mI(t,e);var r=td(t,t===Pt?zt:0);if(r===0)n!==null&&Cx(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Cx(n),e===1)t.tag===0?pD(vw.bind(null,t)):qk(vw.bind(null,t)),cD(function(){!(Ie&6)&&ao()}),n=null;else{switch(_k(r)){case 1:n=dv;break;case 4:n=wk;break;case 16:n=ed;break;case 536870912:n=bk;break;default:n=ed}n=H_(n,B_.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function B_(t,e){if(Vc=-1,zc=0,Ie&6)throw Error(q(327));var n=t.callbackNode;if(Xa()&&t.callbackNode!==n)return null;var r=td(t,t===Pt?zt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=xd(t,r);else{e=r;var i=Ie;Ie|=2;var o=z_();(Pt!==t||zt!==e)&&(ti=null,hs=ft()+500,jo(t,e));do try{OD();break}catch(s){V_(t,s)}while(!0);Sv(),gd.current=o,Ie=i,vt!==null?e=0:(Pt=null,zt=0,e=_t)}if(e!==0){if(e===2&&(i=Jp(t),i!==0&&(r=i,e=Cm(t,i))),e===1)throw n=Hu,jo(t,0),Di(t,r),gn(t,ft()),n;if(e===6)Di(t,r);else{if(i=t.current.alternate,!(r&30)&&!DD(i)&&(e=xd(t,r),e===2&&(o=Jp(t),o!==0&&(r=o,e=Cm(t,o))),e===1))throw n=Hu,jo(t,0),Di(t,r),gn(t,ft()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(q(345));case 2:xo(t,ln,ti);break;case 3:if(Di(t,r),(r&130023424)===r&&(e=Bv+500-ft(),10<e)){if(td(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){an(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=om(xo.bind(null,t,ln,ti),e);break}xo(t,ln,ti);break;case 4:if(Di(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var a=31-dr(r);o=1<<a,a=e[a],a>i&&(i=a),r&=~o}if(r=i,r=ft()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*ID(r/1960))-r,10<r){t.timeoutHandle=om(xo.bind(null,t,ln,ti),r);break}xo(t,ln,ti);break;case 5:xo(t,ln,ti);break;default:throw Error(q(329))}}}return gn(t,ft()),t.callbackNode===n?B_.bind(null,t):null}function Cm(t,e){var n=mu;return t.current.memoizedState.isDehydrated&&(jo(t,e).flags|=256),t=xd(t,e),t!==2&&(e=ln,ln=n,e!==null&&Em(e)),t}function Em(t){ln===null?ln=t:ln.push.apply(ln,t)}function DD(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!pr(o(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Di(t,e){for(e&=~Lv,e&=~mh,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-dr(e),r=1<<n;t[n]=-1,e&=~r}}function vw(t){if(Ie&6)throw Error(q(327));Xa();var e=td(t,0);if(!(e&1))return gn(t,ft()),null;var n=xd(t,e);if(t.tag!==0&&n===2){var r=Jp(t);r!==0&&(e=r,n=Cm(t,r))}if(n===1)throw n=Hu,jo(t,0),Di(t,e),gn(t,ft()),n;if(n===6)throw Error(q(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,xo(t,ln,ti),gn(t,ft()),null}function Vv(t,e){var n=Ie;Ie|=1;try{return t(e)}finally{Ie=n,Ie===0&&(hs=ft()+500,dh&&ao())}}function Go(t){ji!==null&&ji.tag===0&&!(Ie&6)&&Xa();var e=Ie;Ie|=1;var n=Kn.transition,r=Fe;try{if(Kn.transition=null,Fe=1,t)return t()}finally{Fe=r,Kn.transition=n,Ie=e,!(Ie&6)&&ao()}}function zv(){kn=La.current,He(La)}function jo(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,lD(n)),vt!==null)for(n=vt.return;n!==null;){var r=n;switch(bv(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ad();break;case 3:cs(),He(pn),He(Qt),Tv();break;case 5:Nv(r);break;case 4:cs();break;case 13:He(tt);break;case 19:He(tt);break;case 10:Cv(r.type._context);break;case 22:case 23:zv()}n=n.return}if(Pt=t,vt=t=Hi(t.current,null),zt=kn=e,_t=0,Hu=null,Lv=mh=Wo=0,ln=mu=null,No!==null){for(e=0;e<No.length;e++)if(n=No[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,o=n.pending;if(o!==null){var a=o.next;o.next=i,r.next=a}n.pending=r}No=null}return t}function V_(t,e){do{var n=vt;try{if(Sv(),Fc.current=md,pd){for(var r=ot.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}pd=!1}if($o=0,Tt=kt=ot=null,fu=!1,$u=0,Fv.current=null,n===null||n.return===null){_t=1,Hu=e,vt=null;break}e:{var o=t,a=n.return,s=n,u=e;if(e=zt,s.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=s,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=iw(a);if(f!==null){f.flags&=-257,ow(f,a,s,o,e),f.mode&1&&rw(o,l,e),e=f,u=l;var m=e.updateQueue;if(m===null){var p=new Set;p.add(u),e.updateQueue=p}else m.add(u);break e}else{if(!(e&1)){rw(o,l,e),Uv();break e}u=Error(q(426))}}else if(qe&&s.mode&1){var v=iw(a);if(v!==null){!(v.flags&65536)&&(v.flags|=256),ow(v,a,s,o,e),kv(ds(u,s));break e}}o=u=ds(u,s),_t!==4&&(_t=2),mu===null?mu=[o]:mu.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var g=__(o,u,e);Jx(o,g);break e;case 1:s=u;var x=o.type,w=o.stateNode;if(!(o.flags&128)&&(typeof x.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Wi===null||!Wi.has(w)))){o.flags|=65536,e&=-e,o.lanes|=e;var b=S_(o,s,e);Jx(o,b);break e}}o=o.return}while(o!==null)}$_(n)}catch(k){e=k,vt===n&&n!==null&&(vt=n=n.return);continue}break}while(!0)}function z_(){var t=gd.current;return gd.current=md,t===null?md:t}function Uv(){(_t===0||_t===3||_t===2)&&(_t=4),Pt===null||!(Wo&268435455)&&!(mh&268435455)||Di(Pt,zt)}function xd(t,e){var n=Ie;Ie|=2;var r=z_();(Pt!==t||zt!==e)&&(ti=null,jo(t,e));do try{MD();break}catch(i){V_(t,i)}while(!0);if(Sv(),Ie=n,gd.current=r,vt!==null)throw Error(q(261));return Pt=null,zt=0,_t}function MD(){for(;vt!==null;)U_(vt)}function OD(){for(;vt!==null&&!aI();)U_(vt)}function U_(t){var e=G_(t.alternate,t,kn);t.memoizedProps=t.pendingProps,e===null?$_(t):vt=e,Fv.current=null}function $_(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=RD(n,e),n!==null){n.flags&=32767,vt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{_t=6,vt=null;return}}else if(n=AD(n,e,kn),n!==null){vt=n;return}if(e=e.sibling,e!==null){vt=e;return}vt=e=t}while(e!==null);_t===0&&(_t=5)}function xo(t,e,n){var r=Fe,i=Kn.transition;try{Kn.transition=null,Fe=1,jD(t,e,n,r)}finally{Kn.transition=i,Fe=r}return null}function jD(t,e,n,r){do Xa();while(ji!==null);if(Ie&6)throw Error(q(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(q(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(gI(t,o),t===Pt&&(vt=Pt=null,zt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ql||(Ql=!0,H_(ed,function(){return Xa(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=Kn.transition,Kn.transition=null;var a=Fe;Fe=1;var s=Ie;Ie|=4,Fv.current=null,TD(t,n),F_(n,t),nD(rm),nd=!!nm,rm=nm=null,t.current=n,PD(n),sI(),Ie=s,Fe=a,Kn.transition=o}else t.current=n;if(Ql&&(Ql=!1,ji=t,yd=i),o=t.pendingLanes,o===0&&(Wi=null),cI(n.stateNode),gn(t,ft()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(vd)throw vd=!1,t=_m,_m=null,t;return yd&1&&t.tag!==0&&Xa(),o=t.pendingLanes,o&1?t===Sm?gu++:(gu=0,Sm=t):gu=0,ao(),null}function Xa(){if(ji!==null){var t=_k(yd),e=Kn.transition,n=Fe;try{if(Kn.transition=null,Fe=16>t?16:t,ji===null)var r=!1;else{if(t=ji,ji=null,yd=0,Ie&6)throw Error(q(331));var i=Ie;for(Ie|=4,Z=t.current;Z!==null;){var o=Z,a=o.child;if(Z.flags&16){var s=o.deletions;if(s!==null){for(var u=0;u<s.length;u++){var l=s[u];for(Z=l;Z!==null;){var c=Z;switch(c.tag){case 0:case 11:case 15:pu(8,c,o)}var d=c.child;if(d!==null)d.return=c,Z=d;else for(;Z!==null;){c=Z;var h=c.sibling,f=c.return;if(M_(c),c===l){Z=null;break}if(h!==null){h.return=f,Z=h;break}Z=f}}}var m=o.alternate;if(m!==null){var p=m.child;if(p!==null){m.child=null;do{var v=p.sibling;p.sibling=null,p=v}while(p!==null)}}Z=o}}if(o.subtreeFlags&2064&&a!==null)a.return=o,Z=a;else e:for(;Z!==null;){if(o=Z,o.flags&2048)switch(o.tag){case 0:case 11:case 15:pu(9,o,o.return)}var g=o.sibling;if(g!==null){g.return=o.return,Z=g;break e}Z=o.return}}var x=t.current;for(Z=x;Z!==null;){a=Z;var w=a.child;if(a.subtreeFlags&2064&&w!==null)w.return=a,Z=w;else e:for(a=x;Z!==null;){if(s=Z,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:ph(9,s)}}catch(k){dt(s,s.return,k)}if(s===a){Z=null;break e}var b=s.sibling;if(b!==null){b.return=s.return,Z=b;break e}Z=s.return}}if(Ie=i,ao(),Mr&&typeof Mr.onPostCommitFiberRoot=="function")try{Mr.onPostCommitFiberRoot(ah,t)}catch{}r=!0}return r}finally{Fe=n,Kn.transition=e}}return!1}function yw(t,e,n){e=ds(n,e),e=__(t,e,1),t=$i(t,e,1),e=an(),t!==null&&(fl(t,1,e),gn(t,e))}function dt(t,e,n){if(t.tag===3)yw(t,t,n);else for(;e!==null;){if(e.tag===3){yw(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Wi===null||!Wi.has(r))){t=ds(n,t),t=S_(e,t,1),e=$i(e,t,1),t=an(),e!==null&&(fl(e,1,t),gn(e,t));break}}e=e.return}}function FD(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=an(),t.pingedLanes|=t.suspendedLanes&n,Pt===t&&(zt&n)===n&&(_t===4||_t===3&&(zt&130023424)===zt&&500>ft()-Bv?jo(t,0):Lv|=n),gn(t,e)}function W_(t,e){e===0&&(t.mode&1?(e=Ul,Ul<<=1,!(Ul&130023424)&&(Ul=4194304)):e=1);var n=an();t=di(t,e),t!==null&&(fl(t,e,n),gn(t,n))}function LD(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),W_(t,n)}function BD(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(q(314))}r!==null&&r.delete(e),W_(t,n)}var G_;G_=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||pn.current)hn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return hn=!1,ED(t,e,n);hn=!!(t.flags&131072)}else hn=!1,qe&&e.flags&1048576&&Xk(e,ld,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Bc(t,e),t=e.pendingProps;var i=ss(e,Qt.current);qa(e,n),i=Iv(null,e,r,t,i,n);var o=Dv();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,mn(r)?(o=!0,sd(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Av(e),i.updater=fh,e.stateNode=i,i._reactInternals=e,hm(e,r,t,n),e=mm(null,e,r,!0,o,n)):(e.tag=0,qe&&o&&wv(e),en(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Bc(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=zD(r),t=rr(r,t),i){case 0:e=pm(null,e,r,t,n);break e;case 1:e=uw(null,e,r,t,n);break e;case 11:e=aw(null,e,r,t,n);break e;case 14:e=sw(null,e,r,rr(r.type,t),n);break e}throw Error(q(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:rr(r,i),pm(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:rr(r,i),uw(t,e,r,i,n);case 3:e:{if(R_(e),t===null)throw Error(q(387));r=e.pendingProps,o=e.memoizedState,i=o.element,t_(t,e),hd(e,r,null,n);var a=e.memoizedState;if(r=a.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=ds(Error(q(423)),e),e=lw(t,e,r,n,i);break e}else if(r!==i){i=ds(Error(q(424)),e),e=lw(t,e,r,n,i);break e}else for(An=Ui(e.stateNode.containerInfo.firstChild),Pn=e,qe=!0,sr=null,n=Zk(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(us(),r===i){e=hi(t,e,n);break e}en(t,e,r,n)}e=e.child}return e;case 5:return n_(e),t===null&&lm(e),r=e.type,i=e.pendingProps,o=t!==null?t.memoizedProps:null,a=i.children,im(r,i)?a=null:o!==null&&im(r,o)&&(e.flags|=32),A_(t,e),en(t,e,a,n),e.child;case 6:return t===null&&lm(e),null;case 13:return N_(t,e,n);case 4:return Rv(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=ls(e,null,r,n):en(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:rr(r,i),aw(t,e,r,i,n);case 7:return en(t,e,e.pendingProps,n),e.child;case 8:return en(t,e,e.pendingProps.children,n),e.child;case 12:return en(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,a=i.value,ze(cd,r._currentValue),r._currentValue=a,o!==null)if(pr(o.value,a)){if(o.children===i.children&&!pn.current){e=hi(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var s=o.dependencies;if(s!==null){a=o.child;for(var u=s.firstContext;u!==null;){if(u.context===r){if(o.tag===1){u=si(-1,n&-n),u.tag=2;var l=o.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}o.lanes|=n,u=o.alternate,u!==null&&(u.lanes|=n),cm(o.return,n,e),s.lanes|=n;break}u=u.next}}else if(o.tag===10)a=o.type===e.type?null:o.child;else if(o.tag===18){if(a=o.return,a===null)throw Error(q(341));a.lanes|=n,s=a.alternate,s!==null&&(s.lanes|=n),cm(a,n,e),a=o.sibling}else a=o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===e){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}en(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,qa(e,n),i=Xn(i),r=r(i),e.flags|=1,en(t,e,r,n),e.child;case 14:return r=e.type,i=rr(r,e.pendingProps),i=rr(r.type,i),sw(t,e,r,i,n);case 15:return C_(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:rr(r,i),Bc(t,e),e.tag=1,mn(r)?(t=!0,sd(e)):t=!1,qa(e,n),k_(e,r,i),hm(e,r,i,n),mm(null,e,r,!0,t,n);case 19:return T_(t,e,n);case 22:return E_(t,e,n)}throw Error(q(156,e.tag))};function H_(t,e){return xk(t,e)}function VD(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wn(t,e,n,r){return new VD(t,e,n,r)}function $v(t){return t=t.prototype,!(!t||!t.isReactComponent)}function zD(t){if(typeof t=="function")return $v(t)?1:0;if(t!=null){if(t=t.$$typeof,t===uv)return 11;if(t===lv)return 14}return 2}function Hi(t,e){var n=t.alternate;return n===null?(n=Wn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Uc(t,e,n,r,i,o){var a=2;if(r=t,typeof t=="function")$v(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case Ra:return Fo(n.children,i,o,e);case sv:a=8,i|=8;break;case jp:return t=Wn(12,n,e,i|2),t.elementType=jp,t.lanes=o,t;case Fp:return t=Wn(13,n,e,i),t.elementType=Fp,t.lanes=o,t;case Lp:return t=Wn(19,n,e,i),t.elementType=Lp,t.lanes=o,t;case nk:return gh(n,i,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case ek:a=10;break e;case tk:a=9;break e;case uv:a=11;break e;case lv:a=14;break e;case Ti:a=16,r=null;break e}throw Error(q(130,t==null?t:typeof t,""))}return e=Wn(a,n,e,i),e.elementType=t,e.type=r,e.lanes=o,e}function Fo(t,e,n,r){return t=Wn(7,t,r,e),t.lanes=n,t}function gh(t,e,n,r){return t=Wn(22,t,r,e),t.elementType=nk,t.lanes=n,t.stateNode={isHidden:!1},t}function Rf(t,e,n){return t=Wn(6,t,null,e),t.lanes=n,t}function Nf(t,e,n){return e=Wn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function UD(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=lf(0),this.expirationTimes=lf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lf(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Wv(t,e,n,r,i,o,a,s,u){return t=new UD(t,e,n,s,u),e===1?(e=1,o===!0&&(e|=8)):e=0,o=Wn(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Av(o),t}function $D(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Aa,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function K_(t){if(!t)return Qi;t=t._reactInternals;e:{if(Xo(t)!==t||t.tag!==1)throw Error(q(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(mn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(q(171))}if(t.tag===1){var n=t.type;if(mn(n))return Kk(t,n,e)}return e}function q_(t,e,n,r,i,o,a,s,u){return t=Wv(n,r,!0,t,i,o,a,s,u),t.context=K_(null),n=t.current,r=an(),i=Gi(n),o=si(r,i),o.callback=e??null,$i(n,o,i),t.current.lanes=i,fl(t,i,r),gn(t,r),t}function vh(t,e,n,r){var i=e.current,o=an(),a=Gi(i);return n=K_(n),e.context===null?e.context=n:e.pendingContext=n,e=si(o,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=$i(i,e,a),t!==null&&(hr(t,i,a,o),jc(t,i,a)),a}function wd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function xw(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Gv(t,e){xw(t,e),(t=t.alternate)&&xw(t,e)}function WD(){return null}var X_=typeof reportError=="function"?reportError:function(t){console.error(t)};function Hv(t){this._internalRoot=t}yh.prototype.render=Hv.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(q(409));vh(t,e,null,null)};yh.prototype.unmount=Hv.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Go(function(){vh(null,t,null,null)}),e[ci]=null}};function yh(t){this._internalRoot=t}yh.prototype.unstable_scheduleHydration=function(t){if(t){var e=Ek();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ii.length&&e!==0&&e<Ii[n].priority;n++);Ii.splice(n,0,t),n===0&&Rk(t)}};function Kv(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function xh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function ww(){}function GD(t,e,n,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var l=wd(a);o.call(l)}}var a=q_(e,r,t,0,null,!1,!1,"",ww);return t._reactRootContainer=a,t[ci]=a.current,Lu(t.nodeType===8?t.parentNode:t),Go(),a}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var s=r;r=function(){var l=wd(u);s.call(l)}}var u=Wv(t,0,!1,null,null,!1,!1,"",ww);return t._reactRootContainer=u,t[ci]=u.current,Lu(t.nodeType===8?t.parentNode:t),Go(function(){vh(e,u,n,r)}),u}function wh(t,e,n,r,i){var o=n._reactRootContainer;if(o){var a=o;if(typeof i=="function"){var s=i;i=function(){var u=wd(a);s.call(u)}}vh(e,a,t,i)}else a=GD(n,e,t,i,r);return wd(a)}Sk=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ru(e.pendingLanes);n!==0&&(hv(e,n|1),gn(e,ft()),!(Ie&6)&&(hs=ft()+500,ao()))}break;case 13:Go(function(){var r=di(t,1);if(r!==null){var i=an();hr(r,t,1,i)}}),Gv(t,1)}};fv=function(t){if(t.tag===13){var e=di(t,134217728);if(e!==null){var n=an();hr(e,t,134217728,n)}Gv(t,134217728)}};Ck=function(t){if(t.tag===13){var e=Gi(t),n=di(t,e);if(n!==null){var r=an();hr(n,t,e,r)}Gv(t,e)}};Ek=function(){return Fe};Ak=function(t,e){var n=Fe;try{return Fe=t,e()}finally{Fe=n}};qp=function(t,e,n){switch(e){case"input":if(zp(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=ch(r);if(!i)throw Error(q(90));ik(r),zp(r,i)}}}break;case"textarea":ak(t,n);break;case"select":e=n.value,e!=null&&Wa(t,!!n.multiple,e,!1)}};fk=Vv;pk=Go;var HD={usingClientEntryPoint:!1,Events:[ml,Ia,ch,dk,hk,Vv]},Hs={findFiberByHostInstance:Ro,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},KD={bundleType:Hs.bundleType,version:Hs.version,rendererPackageName:Hs.rendererPackageName,rendererConfig:Hs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:gi.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=vk(t),t===null?null:t.stateNode},findFiberByHostInstance:Hs.findFiberByHostInstance||WD,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zl.isDisabled&&Zl.supportsFiber)try{ah=Zl.inject(KD),Mr=Zl}catch{}}On.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=HD;On.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Kv(e))throw Error(q(200));return $D(t,e,null,n)};On.createRoot=function(t,e){if(!Kv(t))throw Error(q(299));var n=!1,r="",i=X_;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Wv(t,1,!1,null,null,n,!1,r,i),t[ci]=e.current,Lu(t.nodeType===8?t.parentNode:t),new Hv(e)};On.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(q(188)):(t=Object.keys(t).join(","),Error(q(268,t)));return t=vk(e),t=t===null?null:t.stateNode,t};On.flushSync=function(t){return Go(t)};On.hydrate=function(t,e,n){if(!xh(e))throw Error(q(200));return wh(null,t,e,!0,n)};On.hydrateRoot=function(t,e,n){if(!Kv(t))throw Error(q(405));var r=n!=null&&n.hydratedSources||null,i=!1,o="",a=X_;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=q_(e,null,t,1,n??null,i,!1,o,a),t[ci]=e.current,Lu(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new yh(e)};On.render=function(t,e,n){if(!xh(e))throw Error(q(200));return wh(null,t,e,!1,n)};On.unmountComponentAtNode=function(t){if(!xh(t))throw Error(q(40));return t._reactRootContainer?(Go(function(){wh(null,null,t,!1,function(){t._reactRootContainer=null,t[ci]=null})}),!0):!1};On.unstable_batchedUpdates=Vv;On.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!xh(n))throw Error(q(200));if(t==null||t._reactInternals===void 0)throw Error(q(38));return wh(t,e,n,!1,r)};On.version="18.3.1-next-f1338f8080-20240426";function Y_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Y_)}catch(t){console.error(t)}}Y_(),Y2.exports=On;var qv=Y2.exports;const qD=Zg(qv);var bw=qv;Mp.createRoot=bw.createRoot,Mp.hydrateRoot=bw.hydrateRoot;/**
 * react-router v7.9.5
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var kw="popstate";function XD(t={}){function e(r,i){let{pathname:o,search:a,hash:s}=r.location;return Am("",{pathname:o,search:a,hash:s},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:Ku(i)}return JD(e,n,null,t)}function Ye(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function mr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function YD(){return Math.random().toString(36).substring(2,10)}function _w(t,e){return{usr:t.state,key:t.key,idx:e}}function Am(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Ss(e):e,state:n,key:e&&e.key||r||YD()}}function Ku({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Ss(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function JD(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,a=i.history,s="POP",u=null,l=c();l==null&&(l=0,a.replaceState({...a.state,idx:l},""));function c(){return(a.state||{idx:null}).idx}function d(){s="POP";let v=c(),g=v==null?null:v-l;l=v,u&&u({action:s,location:p.location,delta:g})}function h(v,g){s="PUSH";let x=Am(p.location,v,g);l=c()+1;let w=_w(x,l),b=p.createHref(x);try{a.pushState(w,"",b)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;i.location.assign(b)}o&&u&&u({action:s,location:p.location,delta:1})}function f(v,g){s="REPLACE";let x=Am(p.location,v,g);l=c();let w=_w(x,l),b=p.createHref(x);a.replaceState(w,"",b),o&&u&&u({action:s,location:p.location,delta:0})}function m(v){return QD(v)}let p={get action(){return s},get location(){return t(i,a)},listen(v){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(kw,d),u=v,()=>{i.removeEventListener(kw,d),u=null}},createHref(v){return e(i,v)},createURL:m,encodeLocation(v){let g=m(v);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:h,replace:f,go(v){return a.go(v)}};return p}function QD(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Ye(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Ku(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function J_(t,e,n="/"){return ZD(t,e,n,!1)}function ZD(t,e,n,r){let i=typeof e=="string"?Ss(e):e,o=fi(i.pathname||"/",n);if(o==null)return null;let a=Q_(t);eM(a);let s=null;for(let u=0;s==null&&u<a.length;++u){let l=dM(o);s=lM(a[u],l,r)}return s}function Q_(t,e=[],n=[],r="",i=!1){let o=(a,s,u=i,l)=>{let c={relativePath:l===void 0?a.path||"":l,caseSensitive:a.caseSensitive===!0,childrenIndex:s,route:a};if(c.relativePath.startsWith("/")){if(!c.relativePath.startsWith(r)&&u)return;Ye(c.relativePath.startsWith(r),`Absolute route path "${c.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(r.length)}let d=ui([r,c.relativePath]),h=n.concat(c);a.children&&a.children.length>0&&(Ye(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${d}".`),Q_(a.children,e,h,d,u)),!(a.path==null&&!a.index)&&e.push({path:d,score:sM(d,a.index),routesMeta:h})};return t.forEach((a,s)=>{var u;if(a.path===""||!((u=a.path)!=null&&u.includes("?")))o(a,s);else for(let l of Z_(a.path))o(a,s,!0,l)}),e}function Z_(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let a=Z_(r.join("/")),s=[];return s.push(...a.map(u=>u===""?o:[o,u].join("/"))),i&&s.push(...a),s.map(u=>t.startsWith("/")&&u===""?"/":u)}function eM(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:uM(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var tM=/^:[\w-]+$/,nM=3,rM=2,iM=1,oM=10,aM=-2,Sw=t=>t==="*";function sM(t,e){let n=t.split("/"),r=n.length;return n.some(Sw)&&(r+=aM),e&&(r+=rM),n.filter(i=>!Sw(i)).reduce((i,o)=>i+(tM.test(o)?nM:o===""?iM:oM),r)}function uM(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function lM(t,e,n=!1){let{routesMeta:r}=t,i={},o="/",a=[];for(let s=0;s<r.length;++s){let u=r[s],l=s===r.length-1,c=o==="/"?e:e.slice(o.length)||"/",d=bd({path:u.relativePath,caseSensitive:u.caseSensitive,end:l},c),h=u.route;if(!d&&l&&n&&!r[r.length-1].route.index&&(d=bd({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},c)),!d)return null;Object.assign(i,d.params),a.push({params:i,pathname:ui([o,d.pathname]),pathnameBase:mM(ui([o,d.pathnameBase])),route:h}),d.pathnameBase!=="/"&&(o=ui([o,d.pathnameBase]))}return a}function bd(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=cM(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],a=o.replace(/(.)\/+$/,"$1"),s=i.slice(1);return{params:r.reduce((l,{paramName:c,isOptional:d},h)=>{if(c==="*"){let m=s[h]||"";a=o.slice(0,o.length-m.length).replace(/(.)\/+$/,"$1")}const f=s[h];return d&&!f?l[c]=void 0:l[c]=(f||"").replace(/%2F/g,"/"),l},{}),pathname:o,pathnameBase:a,pattern:t}}function cM(t,e=!1,n=!0){mr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,s,u)=>(r.push({paramName:s,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function dM(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return mr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function fi(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function hM(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?Ss(t):t;return{pathname:n?n.startsWith("/")?n:fM(n,e):e,search:gM(r),hash:vM(i)}}function fM(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Tf(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function pM(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Xv(t){let e=pM(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function Yv(t,e,n,r=!1){let i;typeof t=="string"?i=Ss(t):(i={...t},Ye(!i.pathname||!i.pathname.includes("?"),Tf("?","pathname","search",i)),Ye(!i.pathname||!i.pathname.includes("#"),Tf("#","pathname","hash",i)),Ye(!i.search||!i.search.includes("#"),Tf("#","search","hash",i)));let o=t===""||i.pathname==="",a=o?"/":i.pathname,s;if(a==null)s=n;else{let d=e.length-1;if(!r&&a.startsWith("..")){let h=a.split("/");for(;h[0]==="..";)h.shift(),d-=1;i.pathname=h.join("/")}s=d>=0?e[d]:"/"}let u=hM(i,s),l=a&&a!=="/"&&a.endsWith("/"),c=(o||a===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}var ui=t=>t.join("/").replace(/\/\/+/g,"/"),mM=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),gM=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,vM=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function yM(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var eS=["POST","PUT","PATCH","DELETE"];new Set(eS);var xM=["GET",...eS];new Set(xM);var Cs=A.createContext(null);Cs.displayName="DataRouter";var bh=A.createContext(null);bh.displayName="DataRouterState";A.createContext(!1);var tS=A.createContext({isTransitioning:!1});tS.displayName="ViewTransition";var wM=A.createContext(new Map);wM.displayName="Fetchers";var bM=A.createContext(null);bM.displayName="Await";var gr=A.createContext(null);gr.displayName="Navigation";var vl=A.createContext(null);vl.displayName="Location";var vr=A.createContext({outlet:null,matches:[],isDataRoute:!1});vr.displayName="Route";var Jv=A.createContext(null);Jv.displayName="RouteError";function kM(t,{relative:e}={}){Ye(Es(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=A.useContext(gr),{hash:i,pathname:o,search:a}=yl(t,{relative:e}),s=o;return n!=="/"&&(s=o==="/"?n:ui([n,o])),r.createHref({pathname:s,search:a,hash:i})}function Es(){return A.useContext(vl)!=null}function Ur(){return Ye(Es(),"useLocation() may be used only in the context of a <Router> component."),A.useContext(vl).location}var nS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function rS(t){A.useContext(gr).static||A.useLayoutEffect(t)}function $r(){let{isDataRoute:t}=A.useContext(vr);return t?FM():_M()}function _M(){Ye(Es(),"useNavigate() may be used only in the context of a <Router> component.");let t=A.useContext(Cs),{basename:e,navigator:n}=A.useContext(gr),{matches:r}=A.useContext(vr),{pathname:i}=Ur(),o=JSON.stringify(Xv(r)),a=A.useRef(!1);return rS(()=>{a.current=!0}),A.useCallback((u,l={})=>{if(mr(a.current,nS),!a.current)return;if(typeof u=="number"){n.go(u);return}let c=Yv(u,JSON.parse(o),i,l.relative==="path");t==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:ui([e,c.pathname])),(l.replace?n.replace:n.push)(c,l.state,l)},[e,n,o,i,t])}var SM=A.createContext(null);function CM(t){let e=A.useContext(vr).outlet;return A.useMemo(()=>e&&A.createElement(SM.Provider,{value:t},e),[e,t])}function yl(t,{relative:e}={}){let{matches:n}=A.useContext(vr),{pathname:r}=Ur(),i=JSON.stringify(Xv(n));return A.useMemo(()=>Yv(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function EM(t,e){return iS(t,e)}function iS(t,e,n,r,i){var x;Ye(Es(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=A.useContext(gr),{matches:a}=A.useContext(vr),s=a[a.length-1],u=s?s.params:{},l=s?s.pathname:"/",c=s?s.pathnameBase:"/",d=s&&s.route;{let w=d&&d.path||"";oS(l,!d||w.endsWith("*")||w.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${w}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${w}"> to <Route path="${w==="/"?"*":`${w}/*`}">.`)}let h=Ur(),f;if(e){let w=typeof e=="string"?Ss(e):e;Ye(c==="/"||((x=w.pathname)==null?void 0:x.startsWith(c)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${c}" but pathname "${w.pathname}" was given in the \`location\` prop.`),f=w}else f=h;let m=f.pathname||"/",p=m;if(c!=="/"){let w=c.replace(/^\//,"").split("/");p="/"+m.replace(/^\//,"").split("/").slice(w.length).join("/")}let v=J_(t,{pathname:p});mr(d||v!=null,`No routes matched location "${f.pathname}${f.search}${f.hash}" `),mr(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${f.pathname}${f.search}${f.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let g=PM(v&&v.map(w=>Object.assign({},w,{params:Object.assign({},u,w.params),pathname:ui([c,o.encodeLocation?o.encodeLocation(w.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?c:ui([c,o.encodeLocation?o.encodeLocation(w.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathnameBase])})),a,n,r,i);return e&&g?A.createElement(vl.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...f},navigationType:"POP"}},g):g}function AM(){let t=jM(),e=yM(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},a=null;return console.error("Error handled by React Router default ErrorBoundary:",t),a=A.createElement(A.Fragment,null,A.createElement("p",null," Hey developer "),A.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",A.createElement("code",{style:o},"ErrorBoundary")," or"," ",A.createElement("code",{style:o},"errorElement")," prop on your route.")),A.createElement(A.Fragment,null,A.createElement("h2",null,"Unexpected Application Error!"),A.createElement("h3",{style:{fontStyle:"italic"}},e),n?A.createElement("pre",{style:i},n):null,a)}var RM=A.createElement(AM,null),NM=class extends A.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.unstable_onError?this.props.unstable_onError(t,e):console.error("React Router caught the following error during render",t)}render(){return this.state.error!==void 0?A.createElement(vr.Provider,{value:this.props.routeContext},A.createElement(Jv.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function TM({routeContext:t,match:e,children:n}){let r=A.useContext(Cs);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),A.createElement(vr.Provider,{value:t},n)}function PM(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,a=n==null?void 0:n.errors;if(a!=null){let l=o.findIndex(c=>c.route.id&&(a==null?void 0:a[c.route.id])!==void 0);Ye(l>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),o=o.slice(0,Math.min(o.length,l+1))}let s=!1,u=-1;if(n)for(let l=0;l<o.length;l++){let c=o[l];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(u=l),c.route.id){let{loaderData:d,errors:h}=n,f=c.route.loader&&!d.hasOwnProperty(c.route.id)&&(!h||h[c.route.id]===void 0);if(c.route.lazy||f){s=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}return o.reduceRight((l,c,d)=>{let h,f=!1,m=null,p=null;n&&(h=a&&c.route.id?a[c.route.id]:void 0,m=c.route.errorElement||RM,s&&(u<0&&d===0?(oS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),f=!0,p=null):u===d&&(f=!0,p=c.route.hydrateFallbackElement||null)));let v=e.concat(o.slice(0,d+1)),g=()=>{let x;return h?x=m:f?x=p:c.route.Component?x=A.createElement(c.route.Component,null):c.route.element?x=c.route.element:x=l,A.createElement(TM,{match:c,routeContext:{outlet:l,matches:v,isDataRoute:n!=null},children:x})};return n&&(c.route.ErrorBoundary||c.route.errorElement||d===0)?A.createElement(NM,{location:n.location,revalidation:n.revalidation,component:m,error:h,children:g(),routeContext:{outlet:null,matches:v,isDataRoute:!0},unstable_onError:r}):g()},null)}function Qv(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function IM(t){let e=A.useContext(Cs);return Ye(e,Qv(t)),e}function DM(t){let e=A.useContext(bh);return Ye(e,Qv(t)),e}function MM(t){let e=A.useContext(vr);return Ye(e,Qv(t)),e}function Zv(t){let e=MM(t),n=e.matches[e.matches.length-1];return Ye(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function OM(){return Zv("useRouteId")}function jM(){var r;let t=A.useContext(Jv),e=DM("useRouteError"),n=Zv("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function FM(){let{router:t}=IM("useNavigate"),e=Zv("useNavigate"),n=A.useRef(!1);return rS(()=>{n.current=!0}),A.useCallback(async(i,o={})=>{mr(n.current,nS),n.current&&(typeof i=="number"?t.navigate(i):await t.navigate(i,{fromRouteId:e,...o}))},[t,e])}var Cw={};function oS(t,e,n){!e&&!Cw[t]&&(Cw[t]=!0,mr(!1,n))}A.memo(LM);function LM({routes:t,future:e,state:n,unstable_onError:r}){return iS(t,void 0,n,r,e)}function Rm({to:t,replace:e,state:n,relative:r}){Ye(Es(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=A.useContext(gr);mr(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=A.useContext(vr),{pathname:a}=Ur(),s=$r(),u=Yv(t,Xv(o),a,r==="path"),l=JSON.stringify(u);return A.useEffect(()=>{s(JSON.parse(l),{replace:e,state:n,relative:r})},[s,l,r,e,n]),null}function BM(t){return CM(t.context)}function er(t){Ye(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function VM({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:o=!1}){Ye(!Es(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),s=A.useMemo(()=>({basename:a,navigator:i,static:o,future:{}}),[a,i,o]);typeof n=="string"&&(n=Ss(n));let{pathname:u="/",search:l="",hash:c="",state:d=null,key:h="default"}=n,f=A.useMemo(()=>{let m=fi(u,a);return m==null?null:{location:{pathname:m,search:l,hash:c,state:d,key:h},navigationType:r}},[a,u,l,c,d,h,r]);return mr(f!=null,`<Router basename="${a}"> is not able to match the URL "${u}${l}${c}" because it does not start with the basename, so the <Router> won't render anything.`),f==null?null:A.createElement(gr.Provider,{value:s},A.createElement(vl.Provider,{children:e,value:f}))}function zM({children:t,location:e}){return EM(Nm(t),e)}function Nm(t,e=[]){let n=[];return A.Children.forEach(t,(r,i)=>{if(!A.isValidElement(r))return;let o=[...e,i];if(r.type===A.Fragment){n.push.apply(n,Nm(r.props.children,o));return}Ye(r.type===er,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ye(!r.props.index||!r.props.children,"An index route cannot have child routes.");let a={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Nm(r.props.children,o)),n.push(a)}),n}var $c="get",Wc="application/x-www-form-urlencoded";function kh(t){return t!=null&&typeof t.tagName=="string"}function UM(t){return kh(t)&&t.tagName.toLowerCase()==="button"}function $M(t){return kh(t)&&t.tagName.toLowerCase()==="form"}function WM(t){return kh(t)&&t.tagName.toLowerCase()==="input"}function GM(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function HM(t,e){return t.button===0&&(!e||e==="_self")&&!GM(t)}var ec=null;function KM(){if(ec===null)try{new FormData(document.createElement("form"),0),ec=!1}catch{ec=!0}return ec}var qM=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Pf(t){return t!=null&&!qM.has(t)?(mr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Wc}"`),null):t}function XM(t,e){let n,r,i,o,a;if($M(t)){let s=t.getAttribute("action");r=s?fi(s,e):null,n=t.getAttribute("method")||$c,i=Pf(t.getAttribute("enctype"))||Wc,o=new FormData(t)}else if(UM(t)||WM(t)&&(t.type==="submit"||t.type==="image")){let s=t.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=t.getAttribute("formaction")||s.getAttribute("action");if(r=u?fi(u,e):null,n=t.getAttribute("formmethod")||s.getAttribute("method")||$c,i=Pf(t.getAttribute("formenctype"))||Pf(s.getAttribute("enctype"))||Wc,o=new FormData(s,t),!KM()){let{name:l,type:c,value:d}=t;if(c==="image"){let h=l?`${l}.`:"";o.append(`${h}x`,"0"),o.append(`${h}y`,"0")}else l&&o.append(l,d)}}else{if(kh(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=$c,r=null,i=Wc,a=t}return o&&i==="text/plain"&&(a=o,o=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:o,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function ey(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function YM(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&fi(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function JM(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function QM(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function ZM(t,e,n){let r=await Promise.all(t.map(async i=>{let o=e.routes[i.route.id];if(o){let a=await JM(o,n);return a.links?a.links():[]}return[]}));return r3(r.flat(1).filter(QM).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Ew(t,e,n,r,i,o){let a=(u,l)=>n[l]?u.route.id!==n[l].route.id:!0,s=(u,l)=>{var c;return n[l].pathname!==u.pathname||((c=n[l].route.path)==null?void 0:c.endsWith("*"))&&n[l].params["*"]!==u.params["*"]};return o==="assets"?e.filter((u,l)=>a(u,l)||s(u,l)):o==="data"?e.filter((u,l)=>{var d;let c=r.routes[u.route.id];if(!c||!c.hasLoader)return!1;if(a(u,l)||s(u,l))return!0;if(u.route.shouldRevalidate){let h=u.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((d=n[0])==null?void 0:d.params)||{},nextUrl:new URL(t,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function e3(t,e,{includeHydrateFallback:n}={}){return t3(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function t3(t){return[...new Set(t)]}function n3(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function r3(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let o=JSON.stringify(n3(i));return n.has(o)||(n.add(o),r.push({key:o,link:i})),r},[])}function aS(){let t=A.useContext(Cs);return ey(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function i3(){let t=A.useContext(bh);return ey(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var ty=A.createContext(void 0);ty.displayName="FrameworkContext";function sS(){let t=A.useContext(ty);return ey(t,"You must render this element inside a <HydratedRouter> element"),t}function o3(t,e){let n=A.useContext(ty),[r,i]=A.useState(!1),[o,a]=A.useState(!1),{onFocus:s,onBlur:u,onMouseEnter:l,onMouseLeave:c,onTouchStart:d}=e,h=A.useRef(null);A.useEffect(()=>{if(t==="render"&&a(!0),t==="viewport"){let p=g=>{g.forEach(x=>{a(x.isIntersecting)})},v=new IntersectionObserver(p,{threshold:.5});return h.current&&v.observe(h.current),()=>{v.disconnect()}}},[t]),A.useEffect(()=>{if(r){let p=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(p)}}},[r]);let f=()=>{i(!0)},m=()=>{i(!1),a(!1)};return n?t!=="intent"?[o,h,{}]:[o,h,{onFocus:Ks(s,f),onBlur:Ks(u,m),onMouseEnter:Ks(l,f),onMouseLeave:Ks(c,m),onTouchStart:Ks(d,f)}]:[!1,h,{}]}function Ks(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function a3({page:t,...e}){let{router:n}=aS(),r=A.useMemo(()=>J_(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?A.createElement(u3,{page:t,matches:r,...e}):null}function s3(t){let{manifest:e,routeModules:n}=sS(),[r,i]=A.useState([]);return A.useEffect(()=>{let o=!1;return ZM(t,e,n).then(a=>{o||i(a)}),()=>{o=!0}},[t,e,n]),r}function u3({page:t,matches:e,...n}){let r=Ur(),{manifest:i,routeModules:o}=sS(),{basename:a}=aS(),{loaderData:s,matches:u}=i3(),l=A.useMemo(()=>Ew(t,e,u,i,r,"data"),[t,e,u,i,r]),c=A.useMemo(()=>Ew(t,e,u,i,r,"assets"),[t,e,u,i,r]),d=A.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let m=new Set,p=!1;if(e.forEach(g=>{var w;let x=i.routes[g.route.id];!x||!x.hasLoader||(!l.some(b=>b.route.id===g.route.id)&&g.route.id in s&&((w=o[g.route.id])!=null&&w.shouldRevalidate)||x.hasClientLoader?p=!0:m.add(g.route.id))}),m.size===0)return[];let v=YM(t,a,"data");return p&&m.size>0&&v.searchParams.set("_routes",e.filter(g=>m.has(g.route.id)).map(g=>g.route.id).join(",")),[v.pathname+v.search]},[a,s,r,i,l,e,t,o]),h=A.useMemo(()=>e3(c,i),[c,i]),f=s3(c);return A.createElement(A.Fragment,null,d.map(m=>A.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...n})),h.map(m=>A.createElement("link",{key:m,rel:"modulepreload",href:m,...n})),f.map(({key:m,link:p})=>A.createElement("link",{key:m,nonce:n.nonce,...p})))}function l3(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var uS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{uS&&(window.__reactRouterVersion="7.9.5")}catch{}function c3({basename:t,children:e,window:n}){let r=A.useRef();r.current==null&&(r.current=XD({window:n,v5Compat:!0}));let i=r.current,[o,a]=A.useState({action:i.action,location:i.location}),s=A.useCallback(u=>{A.startTransition(()=>a(u))},[a]);return A.useLayoutEffect(()=>i.listen(s),[i,s]),A.createElement(VM,{basename:t,children:e,location:o.location,navigationType:o.action,navigator:i})}var lS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,vu=A.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:o,replace:a,state:s,target:u,to:l,preventScrollReset:c,viewTransition:d,...h},f){let{basename:m}=A.useContext(gr),p=typeof l=="string"&&lS.test(l),v,g=!1;if(typeof l=="string"&&p&&(v=l,uS))try{let E=new URL(window.location.href),R=l.startsWith("//")?new URL(E.protocol+l):new URL(l),D=fi(R.pathname,m);R.origin===E.origin&&D!=null?l=D+R.search+R.hash:g=!0}catch{mr(!1,`<Link to="${l}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let x=kM(l,{relative:i}),[w,b,k]=o3(r,h),_=p3(l,{replace:a,state:s,target:u,preventScrollReset:c,relative:i,viewTransition:d});function S(E){e&&e(E),E.defaultPrevented||_(E)}let C=A.createElement("a",{...h,...k,href:v||x,onClick:g||o?e:S,ref:l3(f,b),target:u,"data-discover":!p&&n==="render"?"true":void 0});return w&&!p?A.createElement(A.Fragment,null,C,A.createElement(a3,{page:x})):C});vu.displayName="Link";var d3=A.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:o,to:a,viewTransition:s,children:u,...l},c){let d=yl(a,{relative:l.relative}),h=Ur(),f=A.useContext(bh),{navigator:m,basename:p}=A.useContext(gr),v=f!=null&&x3(d)&&s===!0,g=m.encodeLocation?m.encodeLocation(d).pathname:d.pathname,x=h.pathname,w=f&&f.navigation&&f.navigation.location?f.navigation.location.pathname:null;n||(x=x.toLowerCase(),w=w?w.toLowerCase():null,g=g.toLowerCase()),w&&p&&(w=fi(w,p)||w);const b=g!=="/"&&g.endsWith("/")?g.length-1:g.length;let k=x===g||!i&&x.startsWith(g)&&x.charAt(b)==="/",_=w!=null&&(w===g||!i&&w.startsWith(g)&&w.charAt(g.length)==="/"),S={isActive:k,isPending:_,isTransitioning:v},C=k?e:void 0,E;typeof r=="function"?E=r(S):E=[r,k?"active":null,_?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let R=typeof o=="function"?o(S):o;return A.createElement(vu,{...l,"aria-current":C,className:E,ref:c,style:R,to:a,viewTransition:s},typeof u=="function"?u(S):u)});d3.displayName="NavLink";var h3=A.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:o,method:a=$c,action:s,onSubmit:u,relative:l,preventScrollReset:c,viewTransition:d,...h},f)=>{let m=v3(),p=y3(s,{relative:l}),v=a.toLowerCase()==="get"?"get":"post",g=typeof s=="string"&&lS.test(s),x=w=>{if(u&&u(w),w.defaultPrevented)return;w.preventDefault();let b=w.nativeEvent.submitter,k=(b==null?void 0:b.getAttribute("formmethod"))||a;m(b||w.currentTarget,{fetcherKey:e,method:k,navigate:n,replace:i,state:o,relative:l,preventScrollReset:c,viewTransition:d})};return A.createElement("form",{ref:f,method:v,action:p,onSubmit:r?u:x,...h,"data-discover":!g&&t==="render"?"true":void 0})});h3.displayName="Form";function f3(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function cS(t){let e=A.useContext(Cs);return Ye(e,f3(t)),e}function p3(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:o,viewTransition:a}={}){let s=$r(),u=Ur(),l=yl(t,{relative:o});return A.useCallback(c=>{if(HM(c,e)){c.preventDefault();let d=n!==void 0?n:Ku(u)===Ku(l);s(t,{replace:d,state:r,preventScrollReset:i,relative:o,viewTransition:a})}},[u,s,l,n,r,e,t,i,o,a])}var m3=0,g3=()=>`__${String(++m3)}__`;function v3(){let{router:t}=cS("useSubmit"),{basename:e}=A.useContext(gr),n=OM();return A.useCallback(async(r,i={})=>{let{action:o,method:a,encType:s,formData:u,body:l}=XM(r,e);if(i.navigate===!1){let c=i.fetcherKey||g3();await t.fetch(c,n,i.action||o,{preventScrollReset:i.preventScrollReset,formData:u,body:l,formMethod:i.method||a,formEncType:i.encType||s,flushSync:i.flushSync})}else await t.navigate(i.action||o,{preventScrollReset:i.preventScrollReset,formData:u,body:l,formMethod:i.method||a,formEncType:i.encType||s,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})},[t,e,n])}function y3(t,{relative:e}={}){let{basename:n}=A.useContext(gr),r=A.useContext(vr);Ye(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...yl(t||".",{relative:e})},a=Ur();if(t==null){o.search=a.search;let s=new URLSearchParams(o.search),u=s.getAll("index");if(u.some(c=>c==="")){s.delete("index"),u.filter(d=>d).forEach(d=>s.append("index",d));let c=s.toString();o.search=c?`?${c}`:""}}return(!t||t===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(o.pathname=o.pathname==="/"?n:ui([n,o.pathname])),Ku(o)}function x3(t,{relative:e}={}){let n=A.useContext(tS);Ye(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=cS("useViewTransitionState"),i=yl(t,{relative:e});if(!n.isTransitioning)return!1;let o=fi(n.currentLocation.pathname,r)||n.currentLocation.pathname,a=fi(n.nextLocation.pathname,r)||n.nextLocation.pathname;return bd(i.pathname,a)!=null||bd(i.pathname,o)!=null}const ny=A.createContext({});function ry(t){const e=A.useRef(null);return e.current===null&&(e.current=t()),e.current}const iy=typeof window<"u",dS=iy?A.useLayoutEffect:A.useEffect,_h=A.createContext(null);function oy(t,e){t.indexOf(e)===-1&&t.push(e)}function ay(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const pi=(t,e,n)=>n>e?e:n<t?t:n;let sy=()=>{};const mi={},hS=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function fS(t){return typeof t=="object"&&t!==null}const pS=t=>/^0[^.\s]+$/u.test(t);function uy(t){let e;return()=>(e===void 0&&(e=t()),e)}const qn=t=>t,w3=(t,e)=>n=>e(t(n)),xl=(...t)=>t.reduce(w3),qu=(t,e,n)=>{const r=e-t;return r===0?1:(n-t)/r};class ly{constructor(){this.subscriptions=[]}add(e){return oy(this.subscriptions,e),()=>ay(this.subscriptions,e)}notify(e,n,r){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,n,r);else for(let o=0;o<i;o++){const a=this.subscriptions[o];a&&a(e,n,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const jr=t=>t*1e3,Gn=t=>t/1e3;function mS(t,e){return e?t*(1e3/e):0}const gS=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,b3=1e-7,k3=12;function _3(t,e,n,r,i){let o,a,s=0;do a=e+(n-e)/2,o=gS(a,r,i)-t,o>0?n=a:e=a;while(Math.abs(o)>b3&&++s<k3);return a}function wl(t,e,n,r){if(t===e&&n===r)return qn;const i=o=>_3(o,0,1,t,n);return o=>o===0||o===1?o:gS(i(o),e,r)}const vS=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,yS=t=>e=>1-t(1-e),xS=wl(.33,1.53,.69,.99),cy=yS(xS),wS=vS(cy),bS=t=>(t*=2)<1?.5*cy(t):.5*(2-Math.pow(2,-10*(t-1))),dy=t=>1-Math.sin(Math.acos(t)),kS=yS(dy),_S=vS(dy),S3=wl(.42,0,1,1),C3=wl(0,0,.58,1),SS=wl(.42,0,.58,1),E3=t=>Array.isArray(t)&&typeof t[0]!="number",CS=t=>Array.isArray(t)&&typeof t[0]=="number",A3={linear:qn,easeIn:S3,easeInOut:SS,easeOut:C3,circIn:dy,circInOut:_S,circOut:kS,backIn:cy,backInOut:wS,backOut:xS,anticipate:bS},R3=t=>typeof t=="string",Aw=t=>{if(CS(t)){sy(t.length===4);const[e,n,r,i]=t;return wl(e,n,r,i)}else if(R3(t))return A3[t];return t},tc=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function N3(t,e){let n=new Set,r=new Set,i=!1,o=!1;const a=new WeakSet;let s={delta:0,timestamp:0,isProcessing:!1};function u(c){a.has(c)&&(l.schedule(c),t()),c(s)}const l={schedule:(c,d=!1,h=!1)=>{const m=h&&i?n:r;return d&&a.add(c),m.has(c)||m.add(c),c},cancel:c=>{r.delete(c),a.delete(c)},process:c=>{if(s=c,i){o=!0;return}i=!0,[n,r]=[r,n],n.forEach(u),n.clear(),i=!1,o&&(o=!1,l.process(c))}};return l}const T3=40;function ES(t,e){let n=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,a=tc.reduce((w,b)=>(w[b]=N3(o),w),{}),{setup:s,read:u,resolveKeyframes:l,preUpdate:c,update:d,preRender:h,render:f,postRender:m}=a,p=()=>{const w=mi.useManualTiming?i.timestamp:performance.now();n=!1,mi.useManualTiming||(i.delta=r?1e3/60:Math.max(Math.min(w-i.timestamp,T3),1)),i.timestamp=w,i.isProcessing=!0,s.process(i),u.process(i),l.process(i),c.process(i),d.process(i),h.process(i),f.process(i),m.process(i),i.isProcessing=!1,n&&e&&(r=!1,t(p))},v=()=>{n=!0,r=!0,i.isProcessing||t(p)};return{schedule:tc.reduce((w,b)=>{const k=a[b];return w[b]=(_,S=!1,C=!1)=>(n||v(),k.schedule(_,S,C)),w},{}),cancel:w=>{for(let b=0;b<tc.length;b++)a[tc[b]].cancel(w)},state:i,steps:a}}const{schedule:Xe,cancel:Zi,state:jt,steps:If}=ES(typeof requestAnimationFrame<"u"?requestAnimationFrame:qn,!0);let Gc;function P3(){Gc=void 0}const fn={now:()=>(Gc===void 0&&fn.set(jt.isProcessing||mi.useManualTiming?jt.timestamp:performance.now()),Gc),set:t=>{Gc=t,queueMicrotask(P3)}},AS=t=>e=>typeof e=="string"&&e.startsWith(t),hy=AS("--"),I3=AS("var(--"),fy=t=>I3(t)?D3.test(t.split("/*")[0].trim()):!1,D3=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,As={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},Xu={...As,transform:t=>pi(0,1,t)},nc={...As,default:1},yu=t=>Math.round(t*1e5)/1e5,py=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function M3(t){return t==null}const O3=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,my=(t,e)=>n=>!!(typeof n=="string"&&O3.test(n)&&n.startsWith(t)||e&&!M3(n)&&Object.prototype.hasOwnProperty.call(n,e)),RS=(t,e,n)=>r=>{if(typeof r!="string")return r;const[i,o,a,s]=r.match(py);return{[t]:parseFloat(i),[e]:parseFloat(o),[n]:parseFloat(a),alpha:s!==void 0?parseFloat(s):1}},j3=t=>pi(0,255,t),Df={...As,transform:t=>Math.round(j3(t))},Po={test:my("rgb","red"),parse:RS("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:r=1})=>"rgba("+Df.transform(t)+", "+Df.transform(e)+", "+Df.transform(n)+", "+yu(Xu.transform(r))+")"};function F3(t){let e="",n="",r="",i="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),r=t.substring(5,7),i=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),r=t.substring(3,4),i=t.substring(4,5),e+=e,n+=n,r+=r,i+=i),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}}const Tm={test:my("#"),parse:F3,transform:Po.transform},bl=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),Ni=bl("deg"),Fr=bl("%"),me=bl("px"),L3=bl("vh"),B3=bl("vw"),Rw={...Fr,parse:t=>Fr.parse(t)/100,transform:t=>Fr.transform(t*100)},Ba={test:my("hsl","hue"),parse:RS("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:r=1})=>"hsla("+Math.round(t)+", "+Fr.transform(yu(e))+", "+Fr.transform(yu(n))+", "+yu(Xu.transform(r))+")"},gt={test:t=>Po.test(t)||Tm.test(t)||Ba.test(t),parse:t=>Po.test(t)?Po.parse(t):Ba.test(t)?Ba.parse(t):Tm.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Po.transform(t):Ba.transform(t),getAnimatableNone:t=>{const e=gt.parse(t);return e.alpha=0,gt.transform(e)}},V3=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function z3(t){var e,n;return isNaN(t)&&typeof t=="string"&&(((e=t.match(py))==null?void 0:e.length)||0)+(((n=t.match(V3))==null?void 0:n.length)||0)>0}const NS="number",TS="color",U3="var",$3="var(",Nw="${}",W3=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Yu(t){const e=t.toString(),n=[],r={color:[],number:[],var:[]},i=[];let o=0;const s=e.replace(W3,u=>(gt.test(u)?(r.color.push(o),i.push(TS),n.push(gt.parse(u))):u.startsWith($3)?(r.var.push(o),i.push(U3),n.push(u)):(r.number.push(o),i.push(NS),n.push(parseFloat(u))),++o,Nw)).split(Nw);return{values:n,split:s,indexes:r,types:i}}function PS(t){return Yu(t).values}function IS(t){const{split:e,types:n}=Yu(t),r=e.length;return i=>{let o="";for(let a=0;a<r;a++)if(o+=e[a],i[a]!==void 0){const s=n[a];s===NS?o+=yu(i[a]):s===TS?o+=gt.transform(i[a]):o+=i[a]}return o}}const G3=t=>typeof t=="number"?0:gt.test(t)?gt.getAnimatableNone(t):t;function H3(t){const e=PS(t);return IS(t)(e.map(G3))}const eo={test:z3,parse:PS,createTransformer:IS,getAnimatableNone:H3};function Mf(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function K3({hue:t,saturation:e,lightness:n,alpha:r}){t/=360,e/=100,n/=100;let i=0,o=0,a=0;if(!e)i=o=a=n;else{const s=n<.5?n*(1+e):n+e-n*e,u=2*n-s;i=Mf(u,s,t+1/3),o=Mf(u,s,t),a=Mf(u,s,t-1/3)}return{red:Math.round(i*255),green:Math.round(o*255),blue:Math.round(a*255),alpha:r}}function kd(t,e){return n=>n>0?e:t}const rt=(t,e,n)=>t+(e-t)*n,Of=(t,e,n)=>{const r=t*t,i=n*(e*e-r)+r;return i<0?0:Math.sqrt(i)},q3=[Tm,Po,Ba],X3=t=>q3.find(e=>e.test(t));function Tw(t){const e=X3(t);if(!e)return!1;let n=e.parse(t);return e===Ba&&(n=K3(n)),n}const Pw=(t,e)=>{const n=Tw(t),r=Tw(e);if(!n||!r)return kd(t,e);const i={...n};return o=>(i.red=Of(n.red,r.red,o),i.green=Of(n.green,r.green,o),i.blue=Of(n.blue,r.blue,o),i.alpha=rt(n.alpha,r.alpha,o),Po.transform(i))},Pm=new Set(["none","hidden"]);function Y3(t,e){return Pm.has(t)?n=>n<=0?t:e:n=>n>=1?e:t}function J3(t,e){return n=>rt(t,e,n)}function gy(t){return typeof t=="number"?J3:typeof t=="string"?fy(t)?kd:gt.test(t)?Pw:eO:Array.isArray(t)?DS:typeof t=="object"?gt.test(t)?Pw:Q3:kd}function DS(t,e){const n=[...t],r=n.length,i=t.map((o,a)=>gy(o)(o,e[a]));return o=>{for(let a=0;a<r;a++)n[a]=i[a](o);return n}}function Q3(t,e){const n={...t,...e},r={};for(const i in n)t[i]!==void 0&&e[i]!==void 0&&(r[i]=gy(t[i])(t[i],e[i]));return i=>{for(const o in r)n[o]=r[o](i);return n}}function Z3(t,e){const n=[],r={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const o=e.types[i],a=t.indexes[o][r[o]],s=t.values[a]??0;n[i]=s,r[o]++}return n}const eO=(t,e)=>{const n=eo.createTransformer(e),r=Yu(t),i=Yu(e);return r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length?Pm.has(t)&&!i.values.length||Pm.has(e)&&!r.values.length?Y3(t,e):xl(DS(Z3(r,i),i.values),n):kd(t,e)};function MS(t,e,n){return typeof t=="number"&&typeof e=="number"&&typeof n=="number"?rt(t,e,n):gy(t)(t,e)}const tO=t=>{const e=({timestamp:n})=>t(n);return{start:(n=!0)=>Xe.update(e,n),stop:()=>Zi(e),now:()=>jt.isProcessing?jt.timestamp:fn.now()}},OS=(t,e,n=10)=>{let r="";const i=Math.max(Math.round(e/n),2);for(let o=0;o<i;o++)r+=Math.round(t(o/(i-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},_d=2e4;function vy(t){let e=0;const n=50;let r=t.next(e);for(;!r.done&&e<_d;)e+=n,r=t.next(e);return e>=_d?1/0:e}function nO(t,e=100,n){const r=n({...t,keyframes:[0,e]}),i=Math.min(vy(r),_d);return{type:"keyframes",ease:o=>r.next(i*o).value/e,duration:Gn(i)}}const rO=5;function jS(t,e,n){const r=Math.max(e-rO,0);return mS(n-t(r),e-r)}const ct={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},jf=.001;function iO({duration:t=ct.duration,bounce:e=ct.bounce,velocity:n=ct.velocity,mass:r=ct.mass}){let i,o,a=1-e;a=pi(ct.minDamping,ct.maxDamping,a),t=pi(ct.minDuration,ct.maxDuration,Gn(t)),a<1?(i=l=>{const c=l*a,d=c*t,h=c-n,f=Im(l,a),m=Math.exp(-d);return jf-h/f*m},o=l=>{const d=l*a*t,h=d*n+n,f=Math.pow(a,2)*Math.pow(l,2)*t,m=Math.exp(-d),p=Im(Math.pow(l,2),a);return(-i(l)+jf>0?-1:1)*((h-f)*m)/p}):(i=l=>{const c=Math.exp(-l*t),d=(l-n)*t+1;return-jf+c*d},o=l=>{const c=Math.exp(-l*t),d=(n-l)*(t*t);return c*d});const s=5/t,u=aO(i,o,s);if(t=jr(t),isNaN(u))return{stiffness:ct.stiffness,damping:ct.damping,duration:t};{const l=Math.pow(u,2)*r;return{stiffness:l,damping:a*2*Math.sqrt(r*l),duration:t}}}const oO=12;function aO(t,e,n){let r=n;for(let i=1;i<oO;i++)r=r-t(r)/e(r);return r}function Im(t,e){return t*Math.sqrt(1-e*e)}const sO=["duration","bounce"],uO=["stiffness","damping","mass"];function Iw(t,e){return e.some(n=>t[n]!==void 0)}function lO(t){let e={velocity:ct.velocity,stiffness:ct.stiffness,damping:ct.damping,mass:ct.mass,isResolvedFromDuration:!1,...t};if(!Iw(t,uO)&&Iw(t,sO))if(t.visualDuration){const n=t.visualDuration,r=2*Math.PI/(n*1.2),i=r*r,o=2*pi(.05,1,1-(t.bounce||0))*Math.sqrt(i);e={...e,mass:ct.mass,stiffness:i,damping:o}}else{const n=iO(t);e={...e,...n,mass:ct.mass},e.isResolvedFromDuration=!0}return e}function Sd(t=ct.visualDuration,e=ct.bounce){const n=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:r,restDelta:i}=n;const o=n.keyframes[0],a=n.keyframes[n.keyframes.length-1],s={done:!1,value:o},{stiffness:u,damping:l,mass:c,duration:d,velocity:h,isResolvedFromDuration:f}=lO({...n,velocity:-Gn(n.velocity||0)}),m=h||0,p=l/(2*Math.sqrt(u*c)),v=a-o,g=Gn(Math.sqrt(u/c)),x=Math.abs(v)<5;r||(r=x?ct.restSpeed.granular:ct.restSpeed.default),i||(i=x?ct.restDelta.granular:ct.restDelta.default);let w;if(p<1){const k=Im(g,p);w=_=>{const S=Math.exp(-p*g*_);return a-S*((m+p*g*v)/k*Math.sin(k*_)+v*Math.cos(k*_))}}else if(p===1)w=k=>a-Math.exp(-g*k)*(v+(m+g*v)*k);else{const k=g*Math.sqrt(p*p-1);w=_=>{const S=Math.exp(-p*g*_),C=Math.min(k*_,300);return a-S*((m+p*g*v)*Math.sinh(C)+k*v*Math.cosh(C))/k}}const b={calculatedDuration:f&&d||null,next:k=>{const _=w(k);if(f)s.done=k>=d;else{let S=k===0?m:0;p<1&&(S=k===0?jr(m):jS(w,k,_));const C=Math.abs(S)<=r,E=Math.abs(a-_)<=i;s.done=C&&E}return s.value=s.done?a:_,s},toString:()=>{const k=Math.min(vy(b),_d),_=OS(S=>b.next(k*S).value,k,30);return k+"ms "+_},toTransition:()=>{}};return b}Sd.applyToOptions=t=>{const e=nO(t,100,Sd);return t.ease=e.ease,t.duration=jr(e.duration),t.type="keyframes",t};function Dm({keyframes:t,velocity:e=0,power:n=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:o=500,modifyTarget:a,min:s,max:u,restDelta:l=.5,restSpeed:c}){const d=t[0],h={done:!1,value:d},f=C=>s!==void 0&&C<s||u!==void 0&&C>u,m=C=>s===void 0?u:u===void 0||Math.abs(s-C)<Math.abs(u-C)?s:u;let p=n*e;const v=d+p,g=a===void 0?v:a(v);g!==v&&(p=g-d);const x=C=>-p*Math.exp(-C/r),w=C=>g+x(C),b=C=>{const E=x(C),R=w(C);h.done=Math.abs(E)<=l,h.value=h.done?g:R};let k,_;const S=C=>{f(h.value)&&(k=C,_=Sd({keyframes:[h.value,m(h.value)],velocity:jS(w,C,h.value),damping:i,stiffness:o,restDelta:l,restSpeed:c}))};return S(0),{calculatedDuration:null,next:C=>{let E=!1;return!_&&k===void 0&&(E=!0,b(C),S(C)),k!==void 0&&C>=k?_.next(C-k):(!E&&b(C),h)}}}function cO(t,e,n){const r=[],i=n||mi.mix||MS,o=t.length-1;for(let a=0;a<o;a++){let s=i(t[a],t[a+1]);if(e){const u=Array.isArray(e)?e[a]||qn:e;s=xl(u,s)}r.push(s)}return r}function dO(t,e,{clamp:n=!0,ease:r,mixer:i}={}){const o=t.length;if(sy(o===e.length),o===1)return()=>e[0];if(o===2&&e[0]===e[1])return()=>e[1];const a=t[0]===t[1];t[0]>t[o-1]&&(t=[...t].reverse(),e=[...e].reverse());const s=cO(e,r,i),u=s.length,l=c=>{if(a&&c<t[0])return e[0];let d=0;if(u>1)for(;d<t.length-2&&!(c<t[d+1]);d++);const h=qu(t[d],t[d+1],c);return s[d](h)};return n?c=>l(pi(t[0],t[o-1],c)):l}function hO(t,e){const n=t[t.length-1];for(let r=1;r<=e;r++){const i=qu(0,e,r);t.push(rt(n,1,i))}}function fO(t){const e=[0];return hO(e,t.length-1),e}function pO(t,e){return t.map(n=>n*e)}function mO(t,e){return t.map(()=>e||SS).splice(0,t.length-1)}function xu({duration:t=300,keyframes:e,times:n,ease:r="easeInOut"}){const i=E3(r)?r.map(Aw):Aw(r),o={done:!1,value:e[0]},a=pO(n&&n.length===e.length?n:fO(e),t),s=dO(a,e,{ease:Array.isArray(i)?i:mO(e,i)});return{calculatedDuration:t,next:u=>(o.value=s(u),o.done=u>=t,o)}}const gO=t=>t!==null;function yy(t,{repeat:e,repeatType:n="loop"},r,i=1){const o=t.filter(gO),s=i<0||e&&n!=="loop"&&e%2===1?0:o.length-1;return!s||r===void 0?o[s]:r}const vO={decay:Dm,inertia:Dm,tween:xu,keyframes:xu,spring:Sd};function FS(t){typeof t.type=="string"&&(t.type=vO[t.type])}class xy{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,n){return this.finished.then(e,n)}}const yO=t=>t/100;class wy extends xy{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var r,i;const{motionValue:n}=this.options;n&&n.updatedAt!==fn.now()&&this.tick(fn.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(i=(r=this.options).onStop)==null||i.call(r))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;FS(e);const{type:n=xu,repeat:r=0,repeatDelay:i=0,repeatType:o,velocity:a=0}=e;let{keyframes:s}=e;const u=n||xu;u!==xu&&typeof s[0]!="number"&&(this.mixKeyframes=xl(yO,MS(s[0],s[1])),s=[0,100]);const l=u({...e,keyframes:s});o==="mirror"&&(this.mirroredGenerator=u({...e,keyframes:[...s].reverse(),velocity:-a})),l.calculatedDuration===null&&(l.calculatedDuration=vy(l));const{calculatedDuration:c}=l;this.calculatedDuration=c,this.resolvedDuration=c+i,this.totalDuration=this.resolvedDuration*(r+1)-i,this.generator=l}updateTime(e){const n=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(e,n=!1){const{generator:r,totalDuration:i,mixKeyframes:o,mirroredGenerator:a,resolvedDuration:s,calculatedDuration:u}=this;if(this.startTime===null)return r.next(0);const{delay:l=0,keyframes:c,repeat:d,repeatType:h,repeatDelay:f,type:m,onUpdate:p,finalKeyframe:v}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),n?this.currentTime=e:this.updateTime(e);const g=this.currentTime-l*(this.playbackSpeed>=0?1:-1),x=this.playbackSpeed>=0?g<0:g>i;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let w=this.currentTime,b=r;if(d){const C=Math.min(this.currentTime,i)/s;let E=Math.floor(C),R=C%1;!R&&C>=1&&(R=1),R===1&&E--,E=Math.min(E,d+1),!!(E%2)&&(h==="reverse"?(R=1-R,f&&(R-=f/s)):h==="mirror"&&(b=a)),w=pi(0,1,R)*s}const k=x?{done:!1,value:c[0]}:b.next(w);o&&(k.value=o(k.value));let{done:_}=k;!x&&u!==null&&(_=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const S=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&_);return S&&m!==Dm&&(k.value=yy(c,this.options,v,this.speed)),p&&p(k.value),S&&this.finish(),k}then(e,n){return this.finished.then(e,n)}get duration(){return Gn(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Gn(e)}get time(){return Gn(this.currentTime)}set time(e){var n;e=jr(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(fn.now());const n=this.playbackSpeed!==e;this.playbackSpeed=e,n&&(this.time=Gn(this.currentTime))}play(){var i,o;if(this.isStopped)return;const{driver:e=tO,startTime:n}=this.options;this.driver||(this.driver=e(a=>this.tick(a))),(o=(i=this.options).onPlay)==null||o.call(i);const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=n??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(fn.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(e=this.options).onComplete)==null||n.call(e)}cancel(){var e,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(e=this.options).onCancel)==null||n.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),e.observe(this)}}function xO(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Io=t=>t*180/Math.PI,Mm=t=>{const e=Io(Math.atan2(t[1],t[0]));return Om(e)},wO={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:Mm,rotateZ:Mm,skewX:t=>Io(Math.atan(t[1])),skewY:t=>Io(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},Om=t=>(t=t%360,t<0&&(t+=360),t),Dw=Mm,Mw=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),Ow=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),bO={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Mw,scaleY:Ow,scale:t=>(Mw(t)+Ow(t))/2,rotateX:t=>Om(Io(Math.atan2(t[6],t[5]))),rotateY:t=>Om(Io(Math.atan2(-t[2],t[0]))),rotateZ:Dw,rotate:Dw,skewX:t=>Io(Math.atan(t[4])),skewY:t=>Io(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function jm(t){return t.includes("scale")?1:0}function Fm(t,e){if(!t||t==="none")return jm(e);const n=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,i;if(n)r=bO,i=n;else{const s=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=wO,i=s}if(!i)return jm(e);const o=r[e],a=i[1].split(",").map(_O);return typeof o=="function"?o(a):a[o]}const kO=(t,e)=>{const{transform:n="none"}=getComputedStyle(t);return Fm(n,e)};function _O(t){return parseFloat(t.trim())}const Rs=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Ns=new Set(Rs),jw=t=>t===As||t===me,SO=new Set(["x","y","z"]),CO=Rs.filter(t=>!SO.has(t));function EO(t){const e=[];return CO.forEach(n=>{const r=t.getValue(n);r!==void 0&&(e.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),e}const Lo={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>Fm(e,"x"),y:(t,{transform:e})=>Fm(e,"y")};Lo.translateX=Lo.x;Lo.translateY=Lo.y;const Bo=new Set;let Lm=!1,Bm=!1,Vm=!1;function LS(){if(Bm){const t=Array.from(Bo).filter(r=>r.needsMeasurement),e=new Set(t.map(r=>r.element)),n=new Map;e.forEach(r=>{const i=EO(r);i.length&&(n.set(r,i),r.render())}),t.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const i=n.get(r);i&&i.forEach(([o,a])=>{var s;(s=r.getValue(o))==null||s.set(a)})}),t.forEach(r=>r.measureEndState()),t.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}Bm=!1,Lm=!1,Bo.forEach(t=>t.complete(Vm)),Bo.clear()}function BS(){Bo.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(Bm=!0)})}function AO(){Vm=!0,BS(),LS(),Vm=!1}class by{constructor(e,n,r,i,o,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=n,this.name=r,this.motionValue=i,this.element=o,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(Bo.add(this),Lm||(Lm=!0,Xe.read(BS),Xe.resolveKeyframes(LS))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:n,element:r,motionValue:i}=this;if(e[0]===null){const o=i==null?void 0:i.get(),a=e[e.length-1];if(o!==void 0)e[0]=o;else if(r&&n){const s=r.readValue(n,a);s!=null&&(e[0]=s)}e[0]===void 0&&(e[0]=a),i&&o===void 0&&i.set(e[0])}xO(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Bo.delete(this)}cancel(){this.state==="scheduled"&&(Bo.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const RO=t=>t.startsWith("--");function NO(t,e,n){RO(e)?t.style.setProperty(e,n):t.style[e]=n}const TO=uy(()=>window.ScrollTimeline!==void 0),PO={};function IO(t,e){const n=uy(t);return()=>PO[e]??n()}const VS=IO(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),ou=([t,e,n,r])=>`cubic-bezier(${t}, ${e}, ${n}, ${r})`,Fw={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ou([0,.65,.55,1]),circOut:ou([.55,0,1,.45]),backIn:ou([.31,.01,.66,-.59]),backOut:ou([.33,1.53,.69,.99])};function zS(t,e){if(t)return typeof t=="function"?VS()?OS(t,e):"ease-out":CS(t)?ou(t):Array.isArray(t)?t.map(n=>zS(n,e)||Fw.easeOut):Fw[t]}function DO(t,e,n,{delay:r=0,duration:i=300,repeat:o=0,repeatType:a="loop",ease:s="easeOut",times:u}={},l=void 0){const c={[e]:n};u&&(c.offset=u);const d=zS(s,i);Array.isArray(d)&&(c.easing=d);const h={delay:r,duration:i,easing:Array.isArray(d)?"linear":d,fill:"both",iterations:o+1,direction:a==="reverse"?"alternate":"normal"};return l&&(h.pseudoElement=l),t.animate(c,h)}function US(t){return typeof t=="function"&&"applyToOptions"in t}function MO({type:t,...e}){return US(t)&&VS()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class OO extends xy{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:n,name:r,keyframes:i,pseudoElement:o,allowFlatten:a=!1,finalKeyframe:s,onComplete:u}=e;this.isPseudoElement=!!o,this.allowFlatten=a,this.options=e,sy(typeof e.type!="string");const l=MO(e);this.animation=DO(n,r,i,l,o),l.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!o){const c=yy(i,this.options,s,this.speed);this.updateMotionValue?this.updateMotionValue(c):NO(n,r,c),this.animation.cancel()}u==null||u(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,n;(n=(e=this.animation).finish)==null||n.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,n;this.isPseudoElement||(n=(e=this.animation).commitStyles)==null||n.call(e)}get duration(){var n,r;const e=((r=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:r.call(n).duration)||0;return Gn(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Gn(e)}get time(){return Gn(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=jr(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:n}){var r;return this.allowFlatten&&((r=this.animation.effect)==null||r.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&TO()?(this.animation.timeline=e,qn):n(this)}}const $S={anticipate:bS,backInOut:wS,circInOut:_S};function jO(t){return t in $S}function FO(t){typeof t.ease=="string"&&jO(t.ease)&&(t.ease=$S[t.ease])}const Lw=10;class LO extends OO{constructor(e){FO(e),FS(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:n,onUpdate:r,onComplete:i,element:o,...a}=this.options;if(!n)return;if(e!==void 0){n.set(e);return}const s=new wy({...a,autoplay:!1}),u=jr(this.finishedTime??this.time);n.setWithVelocity(s.sample(u-Lw).value,s.sample(u).value,Lw),s.stop()}}const Bw=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(eo.test(t)||t==="0")&&!t.startsWith("url("));function BO(t){const e=t[0];if(t.length===1)return!0;for(let n=0;n<t.length;n++)if(t[n]!==e)return!0}function VO(t,e,n,r){const i=t[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const o=t[t.length-1],a=Bw(i,e),s=Bw(o,e);return!a||!s?!1:BO(t)||(n==="spring"||US(n))&&r}function zm(t){t.duration=0,t.type="keyframes"}const zO=new Set(["opacity","clipPath","filter","transform"]),UO=uy(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function $O(t){var c;const{motionValue:e,name:n,repeatDelay:r,repeatType:i,damping:o,type:a}=t;if(!(((c=e==null?void 0:e.owner)==null?void 0:c.current)instanceof HTMLElement))return!1;const{onUpdate:u,transformTemplate:l}=e.owner.getProps();return UO()&&n&&zO.has(n)&&(n!=="transform"||!l)&&!u&&!r&&i!=="mirror"&&o!==0&&a!=="inertia"}const WO=40;class GO extends xy{constructor({autoplay:e=!0,delay:n=0,type:r="keyframes",repeat:i=0,repeatDelay:o=0,repeatType:a="loop",keyframes:s,name:u,motionValue:l,element:c,...d}){var m;super(),this.stop=()=>{var p,v;this._animation&&(this._animation.stop(),(p=this.stopTimeline)==null||p.call(this)),(v=this.keyframeResolver)==null||v.cancel()},this.createdAt=fn.now();const h={autoplay:e,delay:n,type:r,repeat:i,repeatDelay:o,repeatType:a,name:u,motionValue:l,element:c,...d},f=(c==null?void 0:c.KeyframeResolver)||by;this.keyframeResolver=new f(s,(p,v,g)=>this.onKeyframesResolved(p,v,h,!g),u,l,c),(m=this.keyframeResolver)==null||m.scheduleResolve()}onKeyframesResolved(e,n,r,i){this.keyframeResolver=void 0;const{name:o,type:a,velocity:s,delay:u,isHandoff:l,onUpdate:c}=r;this.resolvedAt=fn.now(),VO(e,o,a,s)||((mi.instantAnimations||!u)&&(c==null||c(yy(e,r,n))),e[0]=e[e.length-1],zm(r),r.repeat=0);const h={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>WO?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...r,keyframes:e},f=!l&&$O(h)?new LO({...h,element:h.motionValue.owner.current}):new wy(h);f.finished.then(()=>this.notifyFinished()).catch(qn),this.pendingTimeline&&(this.stopTimeline=f.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=f}get finished(){return this._animation?this.animation.finished:this._finished}then(e,n){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),AO()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const HO=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function KO(t){const e=HO.exec(t);if(!e)return[,];const[,n,r,i]=e;return[`--${n??r}`,i]}function WS(t,e,n=1){const[r,i]=KO(t);if(!r)return;const o=window.getComputedStyle(e).getPropertyValue(r);if(o){const a=o.trim();return hS(a)?parseFloat(a):a}return fy(i)?WS(i,e,n+1):i}function ky(t,e){return(t==null?void 0:t[e])??(t==null?void 0:t.default)??t}const GS=new Set(["width","height","top","left","right","bottom",...Rs]),qO={test:t=>t==="auto",parse:t=>t},HS=t=>e=>e.test(t),KS=[As,me,Fr,Ni,B3,L3,qO],Vw=t=>KS.find(HS(t));function XO(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||pS(t):!0}const YO=new Set(["brightness","contrast","saturate","opacity"]);function JO(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[r]=n.match(py)||[];if(!r)return t;const i=n.replace(r,"");let o=YO.has(e)?1:0;return r!==n&&(o*=100),e+"("+o+i+")"}const QO=/\b([a-z-]*)\(.*?\)/gu,Um={...eo,getAnimatableNone:t=>{const e=t.match(QO);return e?e.map(JO).join(" "):t}},zw={...As,transform:Math.round},ZO={rotate:Ni,rotateX:Ni,rotateY:Ni,rotateZ:Ni,scale:nc,scaleX:nc,scaleY:nc,scaleZ:nc,skew:Ni,skewX:Ni,skewY:Ni,distance:me,translateX:me,translateY:me,translateZ:me,x:me,y:me,z:me,perspective:me,transformPerspective:me,opacity:Xu,originX:Rw,originY:Rw,originZ:me},_y={borderWidth:me,borderTopWidth:me,borderRightWidth:me,borderBottomWidth:me,borderLeftWidth:me,borderRadius:me,radius:me,borderTopLeftRadius:me,borderTopRightRadius:me,borderBottomRightRadius:me,borderBottomLeftRadius:me,width:me,maxWidth:me,height:me,maxHeight:me,top:me,right:me,bottom:me,left:me,padding:me,paddingTop:me,paddingRight:me,paddingBottom:me,paddingLeft:me,margin:me,marginTop:me,marginRight:me,marginBottom:me,marginLeft:me,backgroundPositionX:me,backgroundPositionY:me,...ZO,zIndex:zw,fillOpacity:Xu,strokeOpacity:Xu,numOctaves:zw},e4={..._y,color:gt,backgroundColor:gt,outlineColor:gt,fill:gt,stroke:gt,borderColor:gt,borderTopColor:gt,borderRightColor:gt,borderBottomColor:gt,borderLeftColor:gt,filter:Um,WebkitFilter:Um},qS=t=>e4[t];function XS(t,e){let n=qS(t);return n!==Um&&(n=eo),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const t4=new Set(["auto","none","0"]);function n4(t,e,n){let r=0,i;for(;r<t.length&&!i;){const o=t[r];typeof o=="string"&&!t4.has(o)&&Yu(o).values.length&&(i=t[r]),r++}if(i&&n)for(const o of e)t[o]=XS(n,i)}class r4 extends by{constructor(e,n,r,i,o){super(e,n,r,i,o,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:n,name:r}=this;if(!n||!n.current)return;super.readKeyframes();for(let u=0;u<e.length;u++){let l=e[u];if(typeof l=="string"&&(l=l.trim(),fy(l))){const c=WS(l,n.current);c!==void 0&&(e[u]=c),u===e.length-1&&(this.finalKeyframe=l)}}if(this.resolveNoneKeyframes(),!GS.has(r)||e.length!==2)return;const[i,o]=e,a=Vw(i),s=Vw(o);if(a!==s)if(jw(a)&&jw(s))for(let u=0;u<e.length;u++){const l=e[u];typeof l=="string"&&(e[u]=parseFloat(l))}else Lo[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:n}=this,r=[];for(let i=0;i<e.length;i++)(e[i]===null||XO(e[i]))&&r.push(i);r.length&&n4(e,r,n)}measureInitialState(){const{element:e,unresolvedKeyframes:n,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Lo[r](e.measureViewportBox(),window.getComputedStyle(e.current)),n[0]=this.measuredOrigin;const i=n[n.length-1];i!==void 0&&e.getValue(r,i).jump(i,!1)}measureEndState(){var s;const{element:e,name:n,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const i=e.getValue(n);i&&i.jump(this.measuredOrigin,!1);const o=r.length-1,a=r[o];r[o]=Lo[n](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),(s=this.removedTransforms)!=null&&s.length&&this.removedTransforms.forEach(([u,l])=>{e.getValue(u).set(l)}),this.resolveNoneKeyframes()}}function i4(t,e,n){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let r=document;const i=(n==null?void 0:n[t])??r.querySelectorAll(t);return i?Array.from(i):[]}return Array.from(t)}const YS=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function JS(t){return fS(t)&&"offsetHeight"in t}const Uw=30,o4=t=>!isNaN(parseFloat(t));class a4{constructor(e,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{var o;const i=fn.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&((o=this.events.change)==null||o.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=n.owner}setCurrent(e){this.current=e,this.updatedAt=fn.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=o4(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new ly);const r=this.events[e].add(n);return e==="change"?()=>{r(),Xe.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,n,r){this.set(n),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,n=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=fn.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Uw)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,Uw);return mS(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,n;(e=this.dependents)==null||e.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function fs(t,e){return new a4(t,e)}const{schedule:Sy}=ES(queueMicrotask,!1),nr={x:!1,y:!1};function QS(){return nr.x||nr.y}function s4(t){return t==="x"||t==="y"?nr[t]?null:(nr[t]=!0,()=>{nr[t]=!1}):nr.x||nr.y?null:(nr.x=nr.y=!0,()=>{nr.x=nr.y=!1})}function ZS(t,e){const n=i4(t),r=new AbortController,i={passive:!0,...e,signal:r.signal};return[n,i,()=>r.abort()]}function $w(t){return!(t.pointerType==="touch"||QS())}function u4(t,e,n={}){const[r,i,o]=ZS(t,n),a=s=>{if(!$w(s))return;const{target:u}=s,l=e(u,s);if(typeof l!="function"||!u)return;const c=d=>{$w(d)&&(l(d),u.removeEventListener("pointerleave",c))};u.addEventListener("pointerleave",c,i)};return r.forEach(s=>{s.addEventListener("pointerenter",a,i)}),o}const eC=(t,e)=>e?t===e?!0:eC(t,e.parentElement):!1,Cy=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,l4=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function c4(t){return l4.has(t.tagName)||t.tabIndex!==-1}const Hc=new WeakSet;function Ww(t){return e=>{e.key==="Enter"&&t(e)}}function Ff(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const d4=(t,e)=>{const n=t.currentTarget;if(!n)return;const r=Ww(()=>{if(Hc.has(n))return;Ff(n,"down");const i=Ww(()=>{Ff(n,"up")}),o=()=>Ff(n,"cancel");n.addEventListener("keyup",i,e),n.addEventListener("blur",o,e)});n.addEventListener("keydown",r,e),n.addEventListener("blur",()=>n.removeEventListener("keydown",r),e)};function Gw(t){return Cy(t)&&!QS()}function h4(t,e,n={}){const[r,i,o]=ZS(t,n),a=s=>{const u=s.currentTarget;if(!Gw(s))return;Hc.add(u);const l=e(u,s),c=(f,m)=>{window.removeEventListener("pointerup",d),window.removeEventListener("pointercancel",h),Hc.has(u)&&Hc.delete(u),Gw(f)&&typeof l=="function"&&l(f,{success:m})},d=f=>{c(f,u===window||u===document||n.useGlobalTarget||eC(u,f.target))},h=f=>{c(f,!1)};window.addEventListener("pointerup",d,i),window.addEventListener("pointercancel",h,i)};return r.forEach(s=>{(n.useGlobalTarget?window:s).addEventListener("pointerdown",a,i),JS(s)&&(s.addEventListener("focus",l=>d4(l,i)),!c4(s)&&!s.hasAttribute("tabindex")&&(s.tabIndex=0))}),o}function tC(t){return fS(t)&&"ownerSVGElement"in t}function f4(t){return tC(t)&&t.tagName==="svg"}const Yt=t=>!!(t&&t.getVelocity),p4=[...KS,gt,eo],m4=t=>p4.find(HS(t)),Ey=A.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function Hw(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function g4(...t){return e=>{let n=!1;const r=t.map(i=>{const o=Hw(i,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let i=0;i<r.length;i++){const o=r[i];typeof o=="function"?o():Hw(t[i],null)}}}}function v4(...t){return A.useCallback(g4(...t),t)}class y4 extends A.Component{getSnapshotBeforeUpdate(e){const n=this.props.childRef.current;if(n&&e.isPresent&&!this.props.isPresent){const r=n.offsetParent,i=JS(r)&&r.offsetWidth||0,o=this.props.sizeRef.current;o.height=n.offsetHeight||0,o.width=n.offsetWidth||0,o.top=n.offsetTop,o.left=n.offsetLeft,o.right=i-o.width-o.left}return null}componentDidUpdate(){}render(){return this.props.children}}function x4({children:t,isPresent:e,anchorX:n,root:r}){const i=A.useId(),o=A.useRef(null),a=A.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:s}=A.useContext(Ey),u=v4(o,t==null?void 0:t.ref);return A.useInsertionEffect(()=>{const{width:l,height:c,top:d,left:h,right:f}=a.current;if(e||!o.current||!l||!c)return;const m=n==="left"?`left: ${h}`:`right: ${f}`;o.current.dataset.motionPopId=i;const p=document.createElement("style");s&&(p.nonce=s);const v=r??document.head;return v.appendChild(p),p.sheet&&p.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${c}px !important;
            ${m}px !important;
            top: ${d}px !important;
          }
        `),()=>{v.contains(p)&&v.removeChild(p)}},[e]),y.jsx(y4,{isPresent:e,childRef:o,sizeRef:a,children:A.cloneElement(t,{ref:u})})}const w4=({children:t,initial:e,isPresent:n,onExitComplete:r,custom:i,presenceAffectsLayout:o,mode:a,anchorX:s,root:u})=>{const l=ry(b4),c=A.useId();let d=!0,h=A.useMemo(()=>(d=!1,{id:c,initial:e,isPresent:n,custom:i,onExitComplete:f=>{l.set(f,!0);for(const m of l.values())if(!m)return;r&&r()},register:f=>(l.set(f,!1),()=>l.delete(f))}),[n,l,r]);return o&&d&&(h={...h}),A.useMemo(()=>{l.forEach((f,m)=>l.set(m,!1))},[n]),A.useEffect(()=>{!n&&!l.size&&r&&r()},[n]),a==="popLayout"&&(t=y.jsx(x4,{isPresent:n,anchorX:s,root:u,children:t})),y.jsx(_h.Provider,{value:h,children:t})};function b4(){return new Map}function nC(t=!0){const e=A.useContext(_h);if(e===null)return[!0,null];const{isPresent:n,onExitComplete:r,register:i}=e,o=A.useId();A.useEffect(()=>{if(t)return i(o)},[t]);const a=A.useCallback(()=>t&&r&&r(o),[o,r,t]);return!n&&r?[!1,a]:[!0]}const rc=t=>t.key||"";function Kw(t){const e=[];return A.Children.forEach(t,n=>{A.isValidElement(n)&&e.push(n)}),e}const Ju=({children:t,custom:e,initial:n=!0,onExitComplete:r,presenceAffectsLayout:i=!0,mode:o="sync",propagate:a=!1,anchorX:s="left",root:u})=>{const[l,c]=nC(a),d=A.useMemo(()=>Kw(t),[t]),h=a&&!l?[]:d.map(rc),f=A.useRef(!0),m=A.useRef(d),p=ry(()=>new Map),[v,g]=A.useState(d),[x,w]=A.useState(d);dS(()=>{f.current=!1,m.current=d;for(let _=0;_<x.length;_++){const S=rc(x[_]);h.includes(S)?p.delete(S):p.get(S)!==!0&&p.set(S,!1)}},[x,h.length,h.join("-")]);const b=[];if(d!==v){let _=[...d];for(let S=0;S<x.length;S++){const C=x[S],E=rc(C);h.includes(E)||(_.splice(S,0,C),b.push(C))}return o==="wait"&&b.length&&(_=b),w(Kw(_)),g(d),null}const{forceRender:k}=A.useContext(ny);return y.jsx(y.Fragment,{children:x.map(_=>{const S=rc(_),C=a&&!l?!1:d===x||h.includes(S),E=()=>{if(p.has(S))p.set(S,!0);else return;let R=!0;p.forEach(D=>{D||(R=!1)}),R&&(k==null||k(),w(m.current),a&&(c==null||c()),r&&r())};return y.jsx(w4,{isPresent:C,initial:!f.current||n?void 0:!1,custom:e,presenceAffectsLayout:i,mode:o,root:u,onExitComplete:C?void 0:E,anchorX:s,children:_},S)})})},rC=A.createContext({strict:!1}),qw={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ps={};for(const t in qw)ps[t]={isEnabled:e=>qw[t].some(n=>!!e[n])};function k4(t){for(const e in t)ps[e]={...ps[e],...t[e]}}const _4=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Cd(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||_4.has(t)}let iC=t=>!Cd(t);function S4(t){typeof t=="function"&&(iC=e=>e.startsWith("on")?!Cd(e):t(e))}try{S4(require("@emotion/is-prop-valid").default)}catch{}function C4(t,e,n){const r={};for(const i in t)i==="values"&&typeof t.values=="object"||(iC(i)||n===!0&&Cd(i)||!e&&!Cd(i)||t.draggable&&i.startsWith("onDrag"))&&(r[i]=t[i]);return r}const Sh=A.createContext({});function Ch(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function Qu(t){return typeof t=="string"||Array.isArray(t)}const Ay=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Ry=["initial",...Ay];function Eh(t){return Ch(t.animate)||Ry.some(e=>Qu(t[e]))}function oC(t){return!!(Eh(t)||t.variants)}function E4(t,e){if(Eh(t)){const{initial:n,animate:r}=t;return{initial:n===!1||Qu(n)?n:void 0,animate:Qu(r)?r:void 0}}return t.inherit!==!1?e:{}}function A4(t){const{initial:e,animate:n}=E4(t,A.useContext(Sh));return A.useMemo(()=>({initial:e,animate:n}),[Xw(e),Xw(n)])}function Xw(t){return Array.isArray(t)?t.join(" "):t}const Zu={};function R4(t){for(const e in t)Zu[e]=t[e],hy(e)&&(Zu[e].isCSSVariable=!0)}function aC(t,{layout:e,layoutId:n}){return Ns.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!Zu[t]||t==="opacity")}const N4={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},T4=Rs.length;function P4(t,e,n){let r="",i=!0;for(let o=0;o<T4;o++){const a=Rs[o],s=t[a];if(s===void 0)continue;let u=!0;if(typeof s=="number"?u=s===(a.startsWith("scale")?1:0):u=parseFloat(s)===0,!u||n){const l=YS(s,_y[a]);if(!u){i=!1;const c=N4[a]||a;r+=`${c}(${l}) `}n&&(e[a]=l)}}return r=r.trim(),n?r=n(e,i?"":r):i&&(r="none"),r}function Ny(t,e,n){const{style:r,vars:i,transformOrigin:o}=t;let a=!1,s=!1;for(const u in e){const l=e[u];if(Ns.has(u)){a=!0;continue}else if(hy(u)){i[u]=l;continue}else{const c=YS(l,_y[u]);u.startsWith("origin")?(s=!0,o[u]=c):r[u]=c}}if(e.transform||(a||n?r.transform=P4(e,t.transform,n):r.transform&&(r.transform="none")),s){const{originX:u="50%",originY:l="50%",originZ:c=0}=o;r.transformOrigin=`${u} ${l} ${c}`}}const Ty=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function sC(t,e,n){for(const r in e)!Yt(e[r])&&!aC(r,n)&&(t[r]=e[r])}function I4({transformTemplate:t},e){return A.useMemo(()=>{const n=Ty();return Ny(n,e,t),Object.assign({},n.vars,n.style)},[e])}function D4(t,e){const n=t.style||{},r={};return sC(r,n,t),Object.assign(r,I4(t,e)),r}function M4(t,e){const n={},r=D4(t,e);return t.drag&&t.dragListener!==!1&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(n.tabIndex=0),n.style=r,n}const O4={offset:"stroke-dashoffset",array:"stroke-dasharray"},j4={offset:"strokeDashoffset",array:"strokeDasharray"};function F4(t,e,n=1,r=0,i=!0){t.pathLength=1;const o=i?O4:j4;t[o.offset]=me.transform(-r);const a=me.transform(e),s=me.transform(n);t[o.array]=`${a} ${s}`}function uC(t,{attrX:e,attrY:n,attrScale:r,pathLength:i,pathSpacing:o=1,pathOffset:a=0,...s},u,l,c){if(Ny(t,s,l),u){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:d,style:h}=t;d.transform&&(h.transform=d.transform,delete d.transform),(h.transform||d.transformOrigin)&&(h.transformOrigin=d.transformOrigin??"50% 50%",delete d.transformOrigin),h.transform&&(h.transformBox=(c==null?void 0:c.transformBox)??"fill-box",delete d.transformBox),e!==void 0&&(d.x=e),n!==void 0&&(d.y=n),r!==void 0&&(d.scale=r),i!==void 0&&F4(d,i,o,a,!1)}const lC=()=>({...Ty(),attrs:{}}),cC=t=>typeof t=="string"&&t.toLowerCase()==="svg";function L4(t,e,n,r){const i=A.useMemo(()=>{const o=lC();return uC(o,e,cC(r),t.transformTemplate,t.style),{...o.attrs,style:{...o.style}}},[e]);if(t.style){const o={};sC(o,t.style,t),i.style={...o,...i.style}}return i}const B4=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Py(t){return typeof t!="string"||t.includes("-")?!1:!!(B4.indexOf(t)>-1||/[A-Z]/u.test(t))}function V4(t,e,n,{latestValues:r},i,o=!1){const s=(Py(t)?L4:M4)(e,r,i,t),u=C4(e,typeof t=="string",o),l=t!==A.Fragment?{...u,...s,ref:n}:{},{children:c}=e,d=A.useMemo(()=>Yt(c)?c.get():c,[c]);return A.createElement(t,{...l,children:d})}function Yw(t){const e=[{},{}];return t==null||t.values.forEach((n,r)=>{e[0][r]=n.get(),e[1][r]=n.getVelocity()}),e}function Iy(t,e,n,r){if(typeof e=="function"){const[i,o]=Yw(r);e=e(n!==void 0?n:t.custom,i,o)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[i,o]=Yw(r);e=e(n!==void 0?n:t.custom,i,o)}return e}function Kc(t){return Yt(t)?t.get():t}function z4({scrapeMotionValuesFromProps:t,createRenderState:e},n,r,i){return{latestValues:U4(n,r,i,t),renderState:e()}}function U4(t,e,n,r){const i={},o=r(t,{});for(const h in o)i[h]=Kc(o[h]);let{initial:a,animate:s}=t;const u=Eh(t),l=oC(t);e&&l&&!u&&t.inherit!==!1&&(a===void 0&&(a=e.initial),s===void 0&&(s=e.animate));let c=n?n.initial===!1:!1;c=c||a===!1;const d=c?s:a;if(d&&typeof d!="boolean"&&!Ch(d)){const h=Array.isArray(d)?d:[d];for(let f=0;f<h.length;f++){const m=Iy(t,h[f]);if(m){const{transitionEnd:p,transition:v,...g}=m;for(const x in g){let w=g[x];if(Array.isArray(w)){const b=c?w.length-1:0;w=w[b]}w!==null&&(i[x]=w)}for(const x in p)i[x]=p[x]}}}return i}const dC=t=>(e,n)=>{const r=A.useContext(Sh),i=A.useContext(_h),o=()=>z4(t,e,r,i);return n?o():ry(o)};function Dy(t,e,n){var o;const{style:r}=t,i={};for(const a in r)(Yt(r[a])||e.style&&Yt(e.style[a])||aC(a,t)||((o=n==null?void 0:n.getValue(a))==null?void 0:o.liveStyle)!==void 0)&&(i[a]=r[a]);return i}const $4=dC({scrapeMotionValuesFromProps:Dy,createRenderState:Ty});function hC(t,e,n){const r=Dy(t,e,n);for(const i in t)if(Yt(t[i])||Yt(e[i])){const o=Rs.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;r[o]=t[i]}return r}const W4=dC({scrapeMotionValuesFromProps:hC,createRenderState:lC}),G4=Symbol.for("motionComponentSymbol");function Va(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function H4(t,e,n){return A.useCallback(r=>{r&&t.onMount&&t.onMount(r),e&&(r?e.mount(r):e.unmount()),n&&(typeof n=="function"?n(r):Va(n)&&(n.current=r))},[e])}const My=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),K4="framerAppearId",fC="data-"+My(K4),pC=A.createContext({});function q4(t,e,n,r,i){var p,v;const{visualElement:o}=A.useContext(Sh),a=A.useContext(rC),s=A.useContext(_h),u=A.useContext(Ey).reducedMotion,l=A.useRef(null);r=r||a.renderer,!l.current&&r&&(l.current=r(t,{visualState:e,parent:o,props:n,presenceContext:s,blockInitialAnimation:s?s.initial===!1:!1,reducedMotionConfig:u}));const c=l.current,d=A.useContext(pC);c&&!c.projection&&i&&(c.type==="html"||c.type==="svg")&&X4(l.current,n,i,d);const h=A.useRef(!1);A.useInsertionEffect(()=>{c&&h.current&&c.update(n,s)});const f=n[fC],m=A.useRef(!!f&&!((p=window.MotionHandoffIsComplete)!=null&&p.call(window,f))&&((v=window.MotionHasOptimisedAnimation)==null?void 0:v.call(window,f)));return dS(()=>{c&&(h.current=!0,window.MotionIsMounted=!0,c.updateFeatures(),c.scheduleRenderMicrotask(),m.current&&c.animationState&&c.animationState.animateChanges())}),A.useEffect(()=>{c&&(!m.current&&c.animationState&&c.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{var g;(g=window.MotionHandoffMarkAsComplete)==null||g.call(window,f)}),m.current=!1),c.enteringChildren=void 0)}),c}function X4(t,e,n,r){const{layoutId:i,layout:o,drag:a,dragConstraints:s,layoutScroll:u,layoutRoot:l,layoutCrossfade:c}=e;t.projection=new n(t.latestValues,e["data-framer-portal-id"]?void 0:mC(t.parent)),t.projection.setOptions({layoutId:i,layout:o,alwaysMeasureLayout:!!a||s&&Va(s),visualElement:t,animationType:typeof o=="string"?o:"both",initialPromotionConfig:r,crossfade:c,layoutScroll:u,layoutRoot:l})}function mC(t){if(t)return t.options.allowProjection!==!1?t.projection:mC(t.parent)}function Lf(t,{forwardMotionProps:e=!1}={},n,r){n&&k4(n);const i=Py(t)?W4:$4;function o(s,u){let l;const c={...A.useContext(Ey),...s,layoutId:Y4(s)},{isStatic:d}=c,h=A4(s),f=i(s,d);if(!d&&iy){J4();const m=Q4(c);l=m.MeasureLayout,h.visualElement=q4(t,f,c,r,m.ProjectionNode)}return y.jsxs(Sh.Provider,{value:h,children:[l&&h.visualElement?y.jsx(l,{visualElement:h.visualElement,...c}):null,V4(t,s,H4(f,h.visualElement,u),f,d,e)]})}o.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const a=A.forwardRef(o);return a[G4]=t,a}function Y4({layoutId:t}){const e=A.useContext(ny).id;return e&&t!==void 0?e+"-"+t:t}function J4(t,e){A.useContext(rC).strict}function Q4(t){const{drag:e,layout:n}=ps;if(!e&&!n)return{};const r={...e,...n};return{MeasureLayout:e!=null&&e.isEnabled(t)||n!=null&&n.isEnabled(t)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function Z4(t,e){if(typeof Proxy>"u")return Lf;const n=new Map,r=(o,a)=>Lf(o,a,t,e),i=(o,a)=>r(o,a);return new Proxy(i,{get:(o,a)=>a==="create"?r:(n.has(a)||n.set(a,Lf(a,void 0,t,e)),n.get(a))})}function gC({top:t,left:e,right:n,bottom:r}){return{x:{min:e,max:n},y:{min:t,max:r}}}function ej({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function tj(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),r=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}function Bf(t){return t===void 0||t===1}function $m({scale:t,scaleX:e,scaleY:n}){return!Bf(t)||!Bf(e)||!Bf(n)}function wo(t){return $m(t)||vC(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function vC(t){return Jw(t.x)||Jw(t.y)}function Jw(t){return t&&t!=="0%"}function Ed(t,e,n){const r=t-n,i=e*r;return n+i}function Qw(t,e,n,r,i){return i!==void 0&&(t=Ed(t,i,r)),Ed(t,n,r)+e}function Wm(t,e=0,n=1,r,i){t.min=Qw(t.min,e,n,r,i),t.max=Qw(t.max,e,n,r,i)}function yC(t,{x:e,y:n}){Wm(t.x,e.translate,e.scale,e.originPoint),Wm(t.y,n.translate,n.scale,n.originPoint)}const Zw=.999999999999,eb=1.0000000000001;function nj(t,e,n,r=!1){const i=n.length;if(!i)return;e.x=e.y=1;let o,a;for(let s=0;s<i;s++){o=n[s],a=o.projectionDelta;const{visualElement:u}=o.options;u&&u.props.style&&u.props.style.display==="contents"||(r&&o.options.layoutScroll&&o.scroll&&o!==o.root&&Ua(t,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,yC(t,a)),r&&wo(o.latestValues)&&Ua(t,o.latestValues))}e.x<eb&&e.x>Zw&&(e.x=1),e.y<eb&&e.y>Zw&&(e.y=1)}function za(t,e){t.min=t.min+e,t.max=t.max+e}function tb(t,e,n,r,i=.5){const o=rt(t.min,t.max,i);Wm(t,e,n,o,r)}function Ua(t,e){tb(t.x,e.x,e.scaleX,e.scale,e.originX),tb(t.y,e.y,e.scaleY,e.scale,e.originY)}function xC(t,e){return gC(tj(t.getBoundingClientRect(),e))}function rj(t,e,n){const r=xC(t,n),{scroll:i}=e;return i&&(za(r.x,i.offset.x),za(r.y,i.offset.y)),r}const nb=()=>({translate:0,scale:1,origin:0,originPoint:0}),$a=()=>({x:nb(),y:nb()}),rb=()=>({min:0,max:0}),ht=()=>({x:rb(),y:rb()}),Gm={current:null},wC={current:!1};function ij(){if(wC.current=!0,!!iy)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Gm.current=t.matches;t.addEventListener("change",e),e()}else Gm.current=!1}const oj=new WeakMap;function aj(t,e,n){for(const r in e){const i=e[r],o=n[r];if(Yt(i))t.addValue(r,i);else if(Yt(o))t.addValue(r,fs(i,{owner:t}));else if(o!==i)if(t.hasValue(r)){const a=t.getValue(r);a.liveStyle===!0?a.jump(i):a.hasAnimated||a.set(i)}else{const a=t.getStaticValue(r);t.addValue(r,fs(a!==void 0?a:i,{owner:t}))}}for(const r in n)e[r]===void 0&&t.removeValue(r);return e}const ib=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class sj{scrapeMotionValuesFromProps(e,n,r){return{}}constructor({parent:e,props:n,presenceContext:r,reducedMotionConfig:i,blockInitialAnimation:o,visualState:a},s={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=by,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const h=fn.now();this.renderScheduledAt<h&&(this.renderScheduledAt=h,Xe.render(this.render,!1,!0))};const{latestValues:u,renderState:l}=a;this.latestValues=u,this.baseTarget={...u},this.initialValues=n.initial?{...u}:{},this.renderState=l,this.parent=e,this.props=n,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=s,this.blockInitialAnimation=!!o,this.isControllingVariants=Eh(n),this.isVariantNode=oC(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:c,...d}=this.scrapeMotionValuesFromProps(n,{},this);for(const h in d){const f=d[h];u[h]!==void 0&&Yt(f)&&f.set(u[h])}}mount(e){var n;this.current=e,oj.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,i)=>this.bindToMotionValue(i,r)),wC.current||ij(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Gm.current,(n=this.parent)==null||n.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),Zi(this.notifyUpdate),Zi(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const r=this.features[n];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,n){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=Ns.has(e);r&&this.onBindTransform&&this.onBindTransform();const i=n.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&Xe.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,n)),this.valueSubscriptions.set(e,()=>{i(),o&&o(),n.owner&&n.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in ps){const n=ps[e];if(!n)continue;const{isEnabled:r,Feature:i}=n;if(!this.features[e]&&i&&r(this.props)&&(this.features[e]=new i(this)),this.features[e]){const o=this.features[e];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ht()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let r=0;r<ib.length;r++){const i=ib[r];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const o="on"+i,a=e[o];a&&(this.propEventSubscriptions[i]=this.on(i,a))}this.prevMotionValues=aj(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){const r=this.values.get(e);n!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,n),this.values.set(e,n),this.latestValues[e]=n.get())}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&n!==void 0&&(r=fs(n===null?void 0:n,{owner:this}),this.addValue(e,r)),r}readValue(e,n){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(hS(r)||pS(r))?r=parseFloat(r):!m4(r)&&eo.test(n)&&(r=XS(e,n)),this.setBaseTarget(e,Yt(r)?r.get():r)),Yt(r)?r.get():r}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var o;const{initial:n}=this.props;let r;if(typeof n=="string"||typeof n=="object"){const a=Iy(this.props,n,(o=this.presenceContext)==null?void 0:o.custom);a&&(r=a[e])}if(n&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!Yt(i)?i:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new ly),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}scheduleRenderMicrotask(){Sy.render(this.render)}}class bC extends sj{constructor(){super(...arguments),this.KeyframeResolver=r4}sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:r}){delete n[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Yt(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function kC(t,{style:e,vars:n},r,i){const o=t.style;let a;for(a in e)o[a]=e[a];i==null||i.applyProjectionStyles(o,r);for(a in n)o.setProperty(a,n[a])}function uj(t){return window.getComputedStyle(t)}class lj extends bC{constructor(){super(...arguments),this.type="html",this.renderInstance=kC}readValueFromInstance(e,n){var r;if(Ns.has(n))return(r=this.projection)!=null&&r.isProjecting?jm(n):kO(e,n);{const i=uj(e),o=(hy(n)?i.getPropertyValue(n):i[n])||0;return typeof o=="string"?o.trim():o}}measureInstanceViewportBox(e,{transformPagePoint:n}){return xC(e,n)}build(e,n,r){Ny(e,n,r.transformTemplate)}scrapeMotionValuesFromProps(e,n,r){return Dy(e,n,r)}}const _C=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function cj(t,e,n,r){kC(t,e,void 0,r);for(const i in e.attrs)t.setAttribute(_C.has(i)?i:My(i),e.attrs[i])}class dj extends bC{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ht}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Ns.has(n)){const r=qS(n);return r&&r.default||0}return n=_C.has(n)?n:My(n),e.getAttribute(n)}scrapeMotionValuesFromProps(e,n,r){return hC(e,n,r)}build(e,n,r){uC(e,n,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,n,r,i){cj(e,n,r,i)}mount(e){this.isSVGTag=cC(e.tagName),super.mount(e)}}const hj=(t,e)=>Py(t)?new dj(e):new lj(e,{allowProjection:t!==A.Fragment});function Ya(t,e,n){const r=t.getProps();return Iy(r,e,n!==void 0?n:r.custom,t)}const Hm=t=>Array.isArray(t);function fj(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,fs(n))}function pj(t){return Hm(t)?t[t.length-1]||0:t}function mj(t,e){const n=Ya(t,e);let{transitionEnd:r={},transition:i={},...o}=n||{};o={...o,...r};for(const a in o){const s=pj(o[a]);fj(t,a,s)}}function gj(t){return!!(Yt(t)&&t.add)}function Km(t,e){const n=t.getValue("willChange");if(gj(n))return n.add(e);if(!n&&mi.WillChange){const r=new mi.WillChange("auto");t.addValue("willChange",r),r.add(e)}}function SC(t){return t.props[fC]}const vj=t=>t!==null;function yj(t,{repeat:e,repeatType:n="loop"},r){const i=t.filter(vj),o=e&&n!=="loop"&&e%2===1?0:i.length-1;return i[o]}const xj={type:"spring",stiffness:500,damping:25,restSpeed:10},wj=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),bj={type:"keyframes",duration:.8},kj={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},_j=(t,{keyframes:e})=>e.length>2?bj:Ns.has(t)?t.startsWith("scale")?wj(e[1]):xj:kj;function Sj({when:t,delay:e,delayChildren:n,staggerChildren:r,staggerDirection:i,repeat:o,repeatType:a,repeatDelay:s,from:u,elapsed:l,...c}){return!!Object.keys(c).length}const Oy=(t,e,n,r={},i,o)=>a=>{const s=ky(r,t)||{},u=s.delay||r.delay||0;let{elapsed:l=0}=r;l=l-jr(u);const c={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:e.getVelocity(),...s,delay:-l,onUpdate:h=>{e.set(h),s.onUpdate&&s.onUpdate(h)},onComplete:()=>{a(),s.onComplete&&s.onComplete()},name:t,motionValue:e,element:o?void 0:i};Sj(s)||Object.assign(c,_j(t,c)),c.duration&&(c.duration=jr(c.duration)),c.repeatDelay&&(c.repeatDelay=jr(c.repeatDelay)),c.from!==void 0&&(c.keyframes[0]=c.from);let d=!1;if((c.type===!1||c.duration===0&&!c.repeatDelay)&&(zm(c),c.delay===0&&(d=!0)),(mi.instantAnimations||mi.skipAnimations)&&(d=!0,zm(c),c.delay=0),c.allowFlatten=!s.type&&!s.ease,d&&!o&&e.get()!==void 0){const h=yj(c.keyframes,s);if(h!==void 0){Xe.update(()=>{c.onUpdate(h),c.onComplete()});return}}return s.isSync?new wy(c):new GO(c)};function Cj({protectedKeys:t,needsAnimating:e},n){const r=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,r}function CC(t,e,{delay:n=0,transitionOverride:r,type:i}={}){let{transition:o=t.getDefaultTransition(),transitionEnd:a,...s}=e;r&&(o=r);const u=[],l=i&&t.animationState&&t.animationState.getState()[i];for(const c in s){const d=t.getValue(c,t.latestValues[c]??null),h=s[c];if(h===void 0||l&&Cj(l,c))continue;const f={delay:n,...ky(o||{},c)},m=d.get();if(m!==void 0&&!d.isAnimating&&!Array.isArray(h)&&h===m&&!f.velocity)continue;let p=!1;if(window.MotionHandoffAnimation){const g=SC(t);if(g){const x=window.MotionHandoffAnimation(g,c,Xe);x!==null&&(f.startTime=x,p=!0)}}Km(t,c),d.start(Oy(c,d,h,t.shouldReduceMotion&&GS.has(c)?{type:!1}:f,t,p));const v=d.animation;v&&u.push(v)}return a&&Promise.all(u).then(()=>{Xe.update(()=>{a&&mj(t,a)})}),u}function EC(t,e,n,r=0,i=1){const o=Array.from(t).sort((l,c)=>l.sortNodePosition(c)).indexOf(e),a=t.size,s=(a-1)*r;return typeof n=="function"?n(o,a):i===1?o*r:s-o*r}function qm(t,e,n={}){var u;const r=Ya(t,e,n.type==="exit"?(u=t.presenceContext)==null?void 0:u.custom:void 0);let{transition:i=t.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(i=n.transitionOverride);const o=r?()=>Promise.all(CC(t,r,n)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(l=0)=>{const{delayChildren:c=0,staggerChildren:d,staggerDirection:h}=i;return Ej(t,e,l,c,d,h,n)}:()=>Promise.resolve(),{when:s}=i;if(s){const[l,c]=s==="beforeChildren"?[o,a]:[a,o];return l().then(()=>c())}else return Promise.all([o(),a(n.delay)])}function Ej(t,e,n=0,r=0,i=0,o=1,a){const s=[];for(const u of t.variantChildren)u.notify("AnimationStart",e),s.push(qm(u,e,{...a,delay:n+(typeof r=="function"?0:r)+EC(t.variantChildren,u,r,i,o)}).then(()=>u.notify("AnimationComplete",e)));return Promise.all(s)}function Aj(t,e,n={}){t.notify("AnimationStart",e);let r;if(Array.isArray(e)){const i=e.map(o=>qm(t,o,n));r=Promise.all(i)}else if(typeof e=="string")r=qm(t,e,n);else{const i=typeof e=="function"?Ya(t,e,n.custom):e;r=Promise.all(CC(t,i,n))}return r.then(()=>{t.notify("AnimationComplete",e)})}function AC(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}const Rj=Ry.length;function RC(t){if(!t)return;if(!t.isControllingVariants){const n=t.parent?RC(t.parent)||{}:{};return t.props.initial!==void 0&&(n.initial=t.props.initial),n}const e={};for(let n=0;n<Rj;n++){const r=Ry[n],i=t.props[r];(Qu(i)||i===!1)&&(e[r]=i)}return e}const Nj=[...Ay].reverse(),Tj=Ay.length;function Pj(t){return e=>Promise.all(e.map(({animation:n,options:r})=>Aj(t,n,r)))}function Ij(t){let e=Pj(t),n=ob(),r=!0;const i=u=>(l,c)=>{var h;const d=Ya(t,c,u==="exit"?(h=t.presenceContext)==null?void 0:h.custom:void 0);if(d){const{transition:f,transitionEnd:m,...p}=d;l={...l,...p,...m}}return l};function o(u){e=u(t)}function a(u){const{props:l}=t,c=RC(t.parent)||{},d=[],h=new Set;let f={},m=1/0;for(let v=0;v<Tj;v++){const g=Nj[v],x=n[g],w=l[g]!==void 0?l[g]:c[g],b=Qu(w),k=g===u?x.isActive:null;k===!1&&(m=v);let _=w===c[g]&&w!==l[g]&&b;if(_&&r&&t.manuallyAnimateOnMount&&(_=!1),x.protectedKeys={...f},!x.isActive&&k===null||!w&&!x.prevProp||Ch(w)||typeof w=="boolean")continue;const S=Dj(x.prevProp,w);let C=S||g===u&&x.isActive&&!_&&b||v>m&&b,E=!1;const R=Array.isArray(w)?w:[w];let D=R.reduce(i(g),{});k===!1&&(D={});const{prevResolvedValues:P={}}=x,F={...P,...D},U=L=>{C=!0,h.has(L)&&(E=!0,h.delete(L)),x.needsAnimating[L]=!0;const I=t.getValue(L);I&&(I.liveStyle=!1)};for(const L in F){const I=D[L],j=P[L];if(f.hasOwnProperty(L))continue;let B=!1;Hm(I)&&Hm(j)?B=!AC(I,j):B=I!==j,B?I!=null?U(L):h.add(L):I!==void 0&&h.has(L)?U(L):x.protectedKeys[L]=!0}x.prevProp=w,x.prevResolvedValues=D,x.isActive&&(f={...f,...D}),r&&t.blockInitialAnimation&&(C=!1);const z=_&&S;C&&(!z||E)&&d.push(...R.map(L=>{const I={type:g};if(typeof L=="string"&&r&&!z&&t.manuallyAnimateOnMount&&t.parent){const{parent:j}=t,B=Ya(j,L);if(j.enteringChildren&&B){const{delayChildren:K}=B.transition||{};I.delay=EC(j.enteringChildren,t,K)}}return{animation:L,options:I}}))}if(h.size){const v={};if(typeof l.initial!="boolean"){const g=Ya(t,Array.isArray(l.initial)?l.initial[0]:l.initial);g&&g.transition&&(v.transition=g.transition)}h.forEach(g=>{const x=t.getBaseTarget(g),w=t.getValue(g);w&&(w.liveStyle=!0),v[g]=x??null}),d.push({animation:v})}let p=!!d.length;return r&&(l.initial===!1||l.initial===l.animate)&&!t.manuallyAnimateOnMount&&(p=!1),r=!1,p?e(d):Promise.resolve()}function s(u,l){var d;if(n[u].isActive===l)return Promise.resolve();(d=t.variantChildren)==null||d.forEach(h=>{var f;return(f=h.animationState)==null?void 0:f.setActive(u,l)}),n[u].isActive=l;const c=a(u);for(const h in n)n[h].protectedKeys={};return c}return{animateChanges:a,setActive:s,setAnimateFunction:o,getState:()=>n,reset:()=>{n=ob()}}}function Dj(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!AC(e,t):!1}function fo(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function ob(){return{animate:fo(!0),whileInView:fo(),whileHover:fo(),whileTap:fo(),whileDrag:fo(),whileFocus:fo(),exit:fo()}}class so{constructor(e){this.isMounted=!1,this.node=e}update(){}}class Mj extends so{constructor(e){super(e),e.animationState||(e.animationState=Ij(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Ch(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let Oj=0;class jj extends so{constructor(){super(...arguments),this.id=Oj++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const i=this.node.animationState.setActive("exit",!e);n&&!e&&i.then(()=>{n(this.id)})}mount(){const{register:e,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const Fj={animation:{Feature:Mj},exit:{Feature:jj}};function el(t,e,n,r={passive:!0}){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n)}function kl(t){return{point:{x:t.pageX,y:t.pageY}}}const Lj=t=>e=>Cy(e)&&t(e,kl(e));function wu(t,e,n,r){return el(t,e,Lj(n),r)}const NC=1e-4,Bj=1-NC,Vj=1+NC,TC=.01,zj=0-TC,Uj=0+TC;function rn(t){return t.max-t.min}function $j(t,e,n){return Math.abs(t-e)<=n}function ab(t,e,n,r=.5){t.origin=r,t.originPoint=rt(e.min,e.max,t.origin),t.scale=rn(n)/rn(e),t.translate=rt(n.min,n.max,t.origin)-t.originPoint,(t.scale>=Bj&&t.scale<=Vj||isNaN(t.scale))&&(t.scale=1),(t.translate>=zj&&t.translate<=Uj||isNaN(t.translate))&&(t.translate=0)}function bu(t,e,n,r){ab(t.x,e.x,n.x,r?r.originX:void 0),ab(t.y,e.y,n.y,r?r.originY:void 0)}function sb(t,e,n){t.min=n.min+e.min,t.max=t.min+rn(e)}function Wj(t,e,n){sb(t.x,e.x,n.x),sb(t.y,e.y,n.y)}function ub(t,e,n){t.min=e.min-n.min,t.max=t.min+rn(e)}function ku(t,e,n){ub(t.x,e.x,n.x),ub(t.y,e.y,n.y)}function Bn(t){return[t("x"),t("y")]}const PC=({current:t})=>t?t.ownerDocument.defaultView:null,lb=(t,e)=>Math.abs(t-e);function Gj(t,e){const n=lb(t.x,e.x),r=lb(t.y,e.y);return Math.sqrt(n**2+r**2)}class IC{constructor(e,n,{transformPagePoint:r,contextWindow:i=window,dragSnapToOrigin:o=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=zf(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,m=Gj(h.offset,{x:0,y:0})>=this.distanceThreshold;if(!f&&!m)return;const{point:p}=h,{timestamp:v}=jt;this.history.push({...p,timestamp:v});const{onStart:g,onMove:x}=this.handlers;f||(g&&g(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),x&&x(this.lastMoveEvent,h)},this.handlePointerMove=(h,f)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=Vf(f,this.transformPagePoint),Xe.update(this.updatePoint,!0)},this.handlePointerUp=(h,f)=>{this.end();const{onEnd:m,onSessionEnd:p,resumeAnimation:v}=this.handlers;if(this.dragSnapToOrigin&&v&&v(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=zf(h.type==="pointercancel"?this.lastMoveEventInfo:Vf(f,this.transformPagePoint),this.history);this.startEvent&&m&&m(h,g),p&&p(h,g)},!Cy(e))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=r,this.distanceThreshold=a,this.contextWindow=i||window;const s=kl(e),u=Vf(s,this.transformPagePoint),{point:l}=u,{timestamp:c}=jt;this.history=[{...l,timestamp:c}];const{onSessionStart:d}=n;d&&d(e,zf(u,this.history)),this.removeListeners=xl(wu(this.contextWindow,"pointermove",this.handlePointerMove),wu(this.contextWindow,"pointerup",this.handlePointerUp),wu(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Zi(this.updatePoint)}}function Vf(t,e){return e?{point:e(t.point)}:t}function cb(t,e){return{x:t.x-e.x,y:t.y-e.y}}function zf({point:t},e){return{point:t,delta:cb(t,DC(e)),offset:cb(t,Hj(e)),velocity:Kj(e,.1)}}function Hj(t){return t[0]}function DC(t){return t[t.length-1]}function Kj(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,r=null;const i=DC(t);for(;n>=0&&(r=t[n],!(i.timestamp-r.timestamp>jr(e)));)n--;if(!r)return{x:0,y:0};const o=Gn(i.timestamp-r.timestamp);if(o===0)return{x:0,y:0};const a={x:(i.x-r.x)/o,y:(i.y-r.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function qj(t,{min:e,max:n},r){return e!==void 0&&t<e?t=r?rt(e,t,r.min):Math.max(t,e):n!==void 0&&t>n&&(t=r?rt(n,t,r.max):Math.min(t,n)),t}function db(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function Xj(t,{top:e,left:n,bottom:r,right:i}){return{x:db(t.x,n,i),y:db(t.y,e,r)}}function hb(t,e){let n=e.min-t.min,r=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,r]=[r,n]),{min:n,max:r}}function Yj(t,e){return{x:hb(t.x,e.x),y:hb(t.y,e.y)}}function Jj(t,e){let n=.5;const r=rn(t),i=rn(e);return i>r?n=qu(e.min,e.max-r,t.min):r>i&&(n=qu(t.min,t.max-i,e.min)),pi(0,1,n)}function Qj(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const Xm=.35;function Zj(t=Xm){return t===!1?t=0:t===!0&&(t=Xm),{x:fb(t,"left","right"),y:fb(t,"top","bottom")}}function fb(t,e,n){return{min:pb(t,e),max:pb(t,n)}}function pb(t,e){return typeof t=="number"?t:t[e]||0}const eF=new WeakMap;class tF{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ht(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:n=!1,distanceThreshold:r}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const o=d=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(kl(d).point)},a=(d,h)=>{const{drag:f,dragPropagation:m,onDragStart:p}=this.getProps();if(f&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=s4(f),!this.openDragLock))return;this.latestPointerEvent=d,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Bn(g=>{let x=this.getAxisMotionValue(g).get()||0;if(Fr.test(x)){const{projection:w}=this.visualElement;if(w&&w.layout){const b=w.layout.layoutBox[g];b&&(x=rn(b)*(parseFloat(x)/100))}}this.originPoint[g]=x}),p&&Xe.postRender(()=>p(d,h)),Km(this.visualElement,"transform");const{animationState:v}=this.visualElement;v&&v.setActive("whileDrag",!0)},s=(d,h)=>{this.latestPointerEvent=d,this.latestPanInfo=h;const{dragPropagation:f,dragDirectionLock:m,onDirectionLock:p,onDrag:v}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:g}=h;if(m&&this.currentDirection===null){this.currentDirection=nF(g),this.currentDirection!==null&&p&&p(this.currentDirection);return}this.updateAxis("x",h.point,g),this.updateAxis("y",h.point,g),this.visualElement.render(),v&&v(d,h)},u=(d,h)=>{this.latestPointerEvent=d,this.latestPanInfo=h,this.stop(d,h),this.latestPointerEvent=null,this.latestPanInfo=null},l=()=>Bn(d=>{var h;return this.getAnimationState(d)==="paused"&&((h=this.getAxisMotionValue(d).animation)==null?void 0:h.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new IC(e,{onSessionStart:o,onStart:a,onMove:s,onSessionEnd:u,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,distanceThreshold:r,contextWindow:PC(this.visualElement)})}stop(e,n){const r=e||this.latestPointerEvent,i=n||this.latestPanInfo,o=this.isDragging;if(this.cancel(),!o||!i||!r)return;const{velocity:a}=i;this.startAnimation(a);const{onDragEnd:s}=this.getProps();s&&Xe.postRender(()=>s(r,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,r){const{drag:i}=this.getProps();if(!r||!ic(e,i,this.currentDirection))return;const o=this.getAxisMotionValue(e);let a=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(a=qj(a,this.constraints[e],this.elastic[e])),o.set(a)}resolveConstraints(){var o;const{dragConstraints:e,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(o=this.visualElement.projection)==null?void 0:o.layout,i=this.constraints;e&&Va(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=Xj(r.layoutBox,e):this.constraints=!1,this.elastic=Zj(n),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Bn(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=Qj(r.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Va(e))return!1;const r=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const o=rj(r,i.root,this.visualElement.getTransformPagePoint());let a=Yj(i.layout.layoutBox,o);if(n){const s=n(ej(a));this.hasMutatedConstraints=!!s,s&&(a=gC(s))}return a}startAnimation(e){const{drag:n,dragMomentum:r,dragElastic:i,dragTransition:o,dragSnapToOrigin:a,onDragTransitionEnd:s}=this.getProps(),u=this.constraints||{},l=Bn(c=>{if(!ic(c,n,this.currentDirection))return;let d=u&&u[c]||{};a&&(d={min:0,max:0});const h=i?200:1e6,f=i?40:1e7,m={type:"inertia",velocity:r?e[c]:0,bounceStiffness:h,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...o,...d};return this.startAxisValueAnimation(c,m)});return Promise.all(l).then(s)}startAxisValueAnimation(e,n){const r=this.getAxisMotionValue(e);return Km(this.visualElement,e),r.start(Oy(e,r,0,n,this.visualElement,!1))}stopAnimation(){Bn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Bn(e=>{var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)==null?void 0:n.state}getAxisMotionValue(e){const n=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),i=r[n];return i||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){Bn(n=>{const{drag:r}=this.getProps();if(!ic(n,r,this.currentDirection))return;const{projection:i}=this.visualElement,o=this.getAxisMotionValue(n);if(i&&i.layout){const{min:a,max:s}=i.layout.layoutBox[n];o.set(e[n]-rt(a,s,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:r}=this.visualElement;if(!Va(n)||!r||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Bn(a=>{const s=this.getAxisMotionValue(a);if(s&&this.constraints!==!1){const u=s.get();i[a]=Jj({min:u,max:u},this.constraints[a])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Bn(a=>{if(!ic(a,e,null))return;const s=this.getAxisMotionValue(a),{min:u,max:l}=this.constraints[a];s.set(rt(u,l,i[a]))})}addListeners(){if(!this.visualElement.current)return;eF.set(this.visualElement,this);const e=this.visualElement.current,n=wu(e,"pointerdown",u=>{const{drag:l,dragListener:c=!0}=this.getProps();l&&c&&this.start(u)}),r=()=>{const{dragConstraints:u}=this.getProps();Va(u)&&u.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,o=i.addEventListener("measure",r);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Xe.read(r);const a=el(window,"resize",()=>this.scalePositionWithinConstraints()),s=i.addEventListener("didUpdate",({delta:u,hasLayoutChanged:l})=>{this.isDragging&&l&&(Bn(c=>{const d=this.getAxisMotionValue(c);d&&(this.originPoint[c]+=u[c].translate,d.set(d.get()+u[c].translate))}),this.visualElement.render())});return()=>{a(),n(),o(),s&&s()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:r=!1,dragPropagation:i=!1,dragConstraints:o=!1,dragElastic:a=Xm,dragMomentum:s=!0}=e;return{...e,drag:n,dragDirectionLock:r,dragPropagation:i,dragConstraints:o,dragElastic:a,dragMomentum:s}}}function ic(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function nF(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class rF extends so{constructor(e){super(e),this.removeGroupControls=qn,this.removeListeners=qn,this.controls=new tF(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||qn}unmount(){this.removeGroupControls(),this.removeListeners()}}const mb=t=>(e,n)=>{t&&Xe.postRender(()=>t(e,n))};class iF extends so{constructor(){super(...arguments),this.removePointerDownListener=qn}onPointerDown(e){this.session=new IC(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:PC(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:r,onPanEnd:i}=this.node.getProps();return{onSessionStart:mb(e),onStart:mb(n),onMove:r,onEnd:(o,a)=>{delete this.session,i&&Xe.postRender(()=>i(o,a))}}}mount(){this.removePointerDownListener=wu(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const qc={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function gb(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const qs={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(me.test(t))t=parseFloat(t);else return t;const n=gb(t,e.target.x),r=gb(t,e.target.y);return`${n}% ${r}%`}},oF={correct:(t,{treeScale:e,projectionDelta:n})=>{const r=t,i=eo.parse(t);if(i.length>5)return r;const o=eo.createTransformer(t),a=typeof i[0]!="number"?1:0,s=n.x.scale*e.x,u=n.y.scale*e.y;i[0+a]/=s,i[1+a]/=u;const l=rt(s,u,.5);return typeof i[2+a]=="number"&&(i[2+a]/=l),typeof i[3+a]=="number"&&(i[3+a]/=l),o(i)}};let Uf=!1;class aF extends A.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r,layoutId:i}=this.props,{projection:o}=e;R4(sF),o&&(n.group&&n.group.add(o),r&&r.register&&i&&r.register(o),Uf&&o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),qc.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:r,drag:i,isPresent:o}=this.props,{projection:a}=r;return a&&(a.isPresent=o,Uf=!0,i||e.layoutDependency!==n||n===void 0||e.isPresent!==o?a.willUpdate():this.safeToRemove(),e.isPresent!==o&&(o?a.promote():a.relegate()||Xe.postRender(()=>{const s=a.getStack();(!s||!s.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Sy.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:r}=this.props,{projection:i}=e;Uf=!0,i&&(i.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(i),r&&r.deregister&&r.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function MC(t){const[e,n]=nC(),r=A.useContext(ny);return y.jsx(aF,{...t,layoutGroup:r,switchLayoutGroup:A.useContext(pC),isPresent:e,safeToRemove:n})}const sF={borderRadius:{...qs,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:qs,borderTopRightRadius:qs,borderBottomLeftRadius:qs,borderBottomRightRadius:qs,boxShadow:oF};function uF(t,e,n){const r=Yt(t)?t:fs(t);return r.start(Oy("",r,e,n)),r.animation}const lF=(t,e)=>t.depth-e.depth;class cF{constructor(){this.children=[],this.isDirty=!1}add(e){oy(this.children,e),this.isDirty=!0}remove(e){ay(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(lF),this.isDirty=!1,this.children.forEach(e)}}function dF(t,e){const n=fn.now(),r=({timestamp:i})=>{const o=i-n;o>=e&&(Zi(r),t(o-e))};return Xe.setup(r,!0),()=>Zi(r)}const OC=["TopLeft","TopRight","BottomLeft","BottomRight"],hF=OC.length,vb=t=>typeof t=="string"?parseFloat(t):t,yb=t=>typeof t=="number"||me.test(t);function fF(t,e,n,r,i,o){i?(t.opacity=rt(0,n.opacity??1,pF(r)),t.opacityExit=rt(e.opacity??1,0,mF(r))):o&&(t.opacity=rt(e.opacity??1,n.opacity??1,r));for(let a=0;a<hF;a++){const s=`border${OC[a]}Radius`;let u=xb(e,s),l=xb(n,s);if(u===void 0&&l===void 0)continue;u||(u=0),l||(l=0),u===0||l===0||yb(u)===yb(l)?(t[s]=Math.max(rt(vb(u),vb(l),r),0),(Fr.test(l)||Fr.test(u))&&(t[s]+="%")):t[s]=l}(e.rotate||n.rotate)&&(t.rotate=rt(e.rotate||0,n.rotate||0,r))}function xb(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const pF=jC(0,.5,kS),mF=jC(.5,.95,qn);function jC(t,e,n){return r=>r<t?0:r>e?1:n(qu(t,e,r))}function wb(t,e){t.min=e.min,t.max=e.max}function Ln(t,e){wb(t.x,e.x),wb(t.y,e.y)}function bb(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function kb(t,e,n,r,i){return t-=e,t=Ed(t,1/n,r),i!==void 0&&(t=Ed(t,1/i,r)),t}function gF(t,e=0,n=1,r=.5,i,o=t,a=t){if(Fr.test(e)&&(e=parseFloat(e),e=rt(a.min,a.max,e/100)-a.min),typeof e!="number")return;let s=rt(o.min,o.max,r);t===o&&(s-=e),t.min=kb(t.min,e,n,s,i),t.max=kb(t.max,e,n,s,i)}function _b(t,e,[n,r,i],o,a){gF(t,e[n],e[r],e[i],e.scale,o,a)}const vF=["x","scaleX","originX"],yF=["y","scaleY","originY"];function Sb(t,e,n,r){_b(t.x,e,vF,n?n.x:void 0,r?r.x:void 0),_b(t.y,e,yF,n?n.y:void 0,r?r.y:void 0)}function Cb(t){return t.translate===0&&t.scale===1}function FC(t){return Cb(t.x)&&Cb(t.y)}function Eb(t,e){return t.min===e.min&&t.max===e.max}function xF(t,e){return Eb(t.x,e.x)&&Eb(t.y,e.y)}function Ab(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function LC(t,e){return Ab(t.x,e.x)&&Ab(t.y,e.y)}function Rb(t){return rn(t.x)/rn(t.y)}function Nb(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class wF{constructor(){this.members=[]}add(e){oy(this.members,e),e.scheduleRender()}remove(e){if(ay(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(i=>e===i);if(n===0)return!1;let r;for(let i=n;i>=0;i--){const o=this.members[i];if(o.isPresent!==!1){r=o;break}}return r?(this.promote(r),!0):!1}promote(e,n){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,n&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:r}=e;n.onExitComplete&&n.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function bF(t,e,n){let r="";const i=t.x.translate/e.x,o=t.y.translate/e.y,a=(n==null?void 0:n.z)||0;if((i||o||a)&&(r=`translate3d(${i}px, ${o}px, ${a}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),n){const{transformPerspective:l,rotate:c,rotateX:d,rotateY:h,skewX:f,skewY:m}=n;l&&(r=`perspective(${l}px) ${r}`),c&&(r+=`rotate(${c}deg) `),d&&(r+=`rotateX(${d}deg) `),h&&(r+=`rotateY(${h}deg) `),f&&(r+=`skewX(${f}deg) `),m&&(r+=`skewY(${m}deg) `)}const s=t.x.scale*e.x,u=t.y.scale*e.y;return(s!==1||u!==1)&&(r+=`scale(${s}, ${u})`),r||"none"}const $f=["","X","Y","Z"],kF=1e3;let _F=0;function Wf(t,e,n,r){const{latestValues:i}=e;i[t]&&(n[t]=i[t],e.setStaticValue(t,0),r&&(r[t]=0))}function BC(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const n=SC(e);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:i,layoutId:o}=t.options;window.MotionCancelOptimisedAnimation(n,"transform",Xe,!(i||o))}const{parent:r}=t;r&&!r.hasCheckedOptimisedAppear&&BC(r)}function VC({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(a={},s=e==null?void 0:e()){this.id=_F++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(EF),this.nodes.forEach(TF),this.nodes.forEach(PF),this.nodes.forEach(AF)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let u=0;u<this.path.length;u++)this.path[u].shouldResetTransform=!0;this.root===this&&(this.nodes=new cF)}addEventListener(a,s){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new ly),this.eventHandlers.get(a).add(s)}notifyListeners(a,...s){const u=this.eventHandlers.get(a);u&&u.notify(...s)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=tC(a)&&!f4(a),this.instance=a;const{layoutId:s,layout:u,visualElement:l}=this.options;if(l&&!l.current&&l.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(u||s)&&(this.isLayoutDirty=!0),t){let c,d=0;const h=()=>this.root.updateBlockedByResize=!1;Xe.read(()=>{d=window.innerWidth}),t(a,()=>{const f=window.innerWidth;f!==d&&(d=f,this.root.updateBlockedByResize=!0,c&&c(),c=dF(h,250),qc.hasAnimatedSinceResize&&(qc.hasAnimatedSinceResize=!1,this.nodes.forEach(Ib)))})}s&&this.root.registerSharedNode(s,this),this.options.animate!==!1&&l&&(s||u)&&this.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d,hasRelativeLayoutChanged:h,layout:f})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||l.getDefaultTransition()||jF,{onLayoutAnimationStart:p,onLayoutAnimationComplete:v}=l.getProps(),g=!this.targetLayout||!LC(this.targetLayout,f),x=!d&&h;if(this.options.layoutRoot||this.resumeFrom||x||d&&(g||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const w={...ky(m,"layout"),onPlay:p,onComplete:v};(l.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w),this.setAnimationOrigin(c,x)}else d||Ib(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=f})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Zi(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(IF),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&BC(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let c=0;c<this.path.length;c++){const d=this.path[c];d.shouldResetTransform=!0,d.updateScroll("snapshot"),d.options.layoutRoot&&d.willUpdate(!1)}const{layoutId:s,layout:u}=this.options;if(s===void 0&&!u)return;const l=this.getTransformTemplate();this.prevTransformTemplateValue=l?l(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Tb);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Pb);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(NF),this.nodes.forEach(SF),this.nodes.forEach(CF)):this.nodes.forEach(Pb),this.clearAllSnapshots();const s=fn.now();jt.delta=pi(0,1e3/60,s-jt.timestamp),jt.timestamp=s,jt.isProcessing=!0,If.update.process(jt),If.preRender.process(jt),If.render.process(jt),jt.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Sy.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(RF),this.sharedNodes.forEach(DF)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Xe.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Xe.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!rn(this.snapshot.measuredBox.x)&&!rn(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let u=0;u<this.path.length;u++)this.path[u].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ht(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:s}=this.options;s&&s.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let s=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(s=!1),s&&this.instance){const u=r(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:u,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:u}}}resetTransform(){if(!i)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,s=this.projectionDelta&&!FC(this.projectionDelta),u=this.getTransformTemplate(),l=u?u(this.latestValues,""):void 0,c=l!==this.prevTransformTemplateValue;a&&this.instance&&(s||wo(this.latestValues)||c)&&(i(this.instance,l),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const s=this.measurePageBox();let u=this.removeElementScroll(s);return a&&(u=this.removeTransform(u)),FF(u),{animationId:this.root.animationId,measuredBox:s,layoutBox:u,latestValues:{},source:this.id}}measurePageBox(){var l;const{visualElement:a}=this.options;if(!a)return ht();const s=a.measureViewportBox();if(!(((l=this.scroll)==null?void 0:l.wasRoot)||this.path.some(LF))){const{scroll:c}=this.root;c&&(za(s.x,c.offset.x),za(s.y,c.offset.y))}return s}removeElementScroll(a){var u;const s=ht();if(Ln(s,a),(u=this.scroll)!=null&&u.wasRoot)return s;for(let l=0;l<this.path.length;l++){const c=this.path[l],{scroll:d,options:h}=c;c!==this.root&&d&&h.layoutScroll&&(d.wasRoot&&Ln(s,a),za(s.x,d.offset.x),za(s.y,d.offset.y))}return s}applyTransform(a,s=!1){const u=ht();Ln(u,a);for(let l=0;l<this.path.length;l++){const c=this.path[l];!s&&c.options.layoutScroll&&c.scroll&&c!==c.root&&Ua(u,{x:-c.scroll.offset.x,y:-c.scroll.offset.y}),wo(c.latestValues)&&Ua(u,c.latestValues)}return wo(this.latestValues)&&Ua(u,this.latestValues),u}removeTransform(a){const s=ht();Ln(s,a);for(let u=0;u<this.path.length;u++){const l=this.path[u];if(!l.instance||!wo(l.latestValues))continue;$m(l.latestValues)&&l.updateSnapshot();const c=ht(),d=l.measurePageBox();Ln(c,d),Sb(s,l.latestValues,l.snapshot?l.snapshot.layoutBox:void 0,c)}return wo(this.latestValues)&&Sb(s,this.latestValues),s}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==jt.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var h;const s=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=s.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=s.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=s.isSharedProjectionDirty);const u=!!this.resumingFrom||this!==s;if(!(a||u&&this.isSharedProjectionDirty||this.isProjectionDirty||(h=this.parent)!=null&&h.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:c,layoutId:d}=this.options;if(!(!this.layout||!(c||d))){if(this.resolvedRelativeTargetAt=jt.timestamp,!this.targetDelta&&!this.relativeTarget){const f=this.getClosestProjectingParent();f&&f.layout&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ht(),this.relativeTargetOrigin=ht(),ku(this.relativeTargetOrigin,this.layout.layoutBox,f.layout.layoutBox),Ln(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ht(),this.targetWithTransforms=ht()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Wj(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ln(this.target,this.layout.layoutBox),yC(this.target,this.targetDelta)):Ln(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const f=this.getClosestProjectingParent();f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ht(),this.relativeTargetOrigin=ht(),ku(this.relativeTargetOrigin,this.target,f.target),Ln(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||$m(this.parent.latestValues)||vC(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var m;const a=this.getLead(),s=!!this.resumingFrom||this!==a;let u=!0;if((this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty)&&(u=!1),s&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(u=!1),this.resolvedRelativeTargetAt===jt.timestamp&&(u=!1),u)return;const{layout:l,layoutId:c}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(l||c))return;Ln(this.layoutCorrected,this.layout.layoutBox);const d=this.treeScale.x,h=this.treeScale.y;nj(this.layoutCorrected,this.treeScale,this.path,s),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=ht());const{target:f}=a;if(!f){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(bb(this.prevProjectionDelta.x,this.projectionDelta.x),bb(this.prevProjectionDelta.y,this.projectionDelta.y)),bu(this.projectionDelta,this.layoutCorrected,f,this.latestValues),(this.treeScale.x!==d||this.treeScale.y!==h||!Nb(this.projectionDelta.x,this.prevProjectionDelta.x)||!Nb(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var s;if((s=this.options.visualElement)==null||s.scheduleRender(),a){const u=this.getStack();u&&u.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=$a(),this.projectionDelta=$a(),this.projectionDeltaWithTransform=$a()}setAnimationOrigin(a,s=!1){const u=this.snapshot,l=u?u.latestValues:{},c={...this.latestValues},d=$a();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!s;const h=ht(),f=u?u.source:void 0,m=this.layout?this.layout.source:void 0,p=f!==m,v=this.getStack(),g=!v||v.members.length<=1,x=!!(p&&!g&&this.options.crossfade===!0&&!this.path.some(OF));this.animationProgress=0;let w;this.mixTargetDelta=b=>{const k=b/1e3;Db(d.x,a.x,k),Db(d.y,a.y,k),this.setTargetDelta(d),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ku(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),MF(this.relativeTarget,this.relativeTargetOrigin,h,k),w&&xF(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=ht()),Ln(w,this.relativeTarget)),p&&(this.animationValues=c,fF(c,l,this.latestValues,k,x,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){var s,u,l;this.notifyListeners("animationStart"),(s=this.currentAnimation)==null||s.stop(),(l=(u=this.resumingFrom)==null?void 0:u.currentAnimation)==null||l.stop(),this.pendingAnimation&&(Zi(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Xe.update(()=>{qc.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=fs(0)),this.currentAnimation=uF(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:c=>{this.mixTargetDelta(c),a.onUpdate&&a.onUpdate(c)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(kF),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:s,target:u,layout:l,latestValues:c}=a;if(!(!s||!u||!l)){if(this!==a&&this.layout&&l&&zC(this.options.animationType,this.layout.layoutBox,l.layoutBox)){u=this.target||ht();const d=rn(this.layout.layoutBox.x);u.x.min=a.target.x.min,u.x.max=u.x.min+d;const h=rn(this.layout.layoutBox.y);u.y.min=a.target.y.min,u.y.max=u.y.min+h}Ln(s,u),Ua(s,c),bu(this.projectionDeltaWithTransform,this.layoutCorrected,s,c)}}registerSharedNode(a,s){this.sharedNodes.has(a)||this.sharedNodes.set(a,new wF),this.sharedNodes.get(a).add(s);const l=s.options.initialPromotionConfig;s.promote({transition:l?l.transition:void 0,preserveFollowOpacity:l&&l.shouldPreserveFollowOpacity?l.shouldPreserveFollowOpacity(s):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var s;const{layoutId:a}=this.options;return a?((s=this.getStack())==null?void 0:s.lead)||this:this}getPrevLead(){var s;const{layoutId:a}=this.options;return a?(s=this.getStack())==null?void 0:s.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:s,preserveFollowOpacity:u}={}){const l=this.getStack();l&&l.promote(this,u),a&&(this.projectionDelta=void 0,this.needsReset=!0),s&&this.setOptions({transition:s})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let s=!1;const{latestValues:u}=a;if((u.z||u.rotate||u.rotateX||u.rotateY||u.rotateZ||u.skewX||u.skewY)&&(s=!0),!s)return;const l={};u.z&&Wf("z",a,l,this.animationValues);for(let c=0;c<$f.length;c++)Wf(`rotate${$f[c]}`,a,l,this.animationValues),Wf(`skew${$f[c]}`,a,l,this.animationValues);a.render();for(const c in l)a.setStaticValue(c,l[c]),this.animationValues&&(this.animationValues[c]=l[c]);a.scheduleRender()}applyProjectionStyles(a,s){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const u=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=Kc(s==null?void 0:s.pointerEvents)||"",a.transform=u?u(this.latestValues,""):"none";return}const l=this.getLead();if(!this.projectionDelta||!this.layout||!l.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=Kc(s==null?void 0:s.pointerEvents)||""),this.hasProjected&&!wo(this.latestValues)&&(a.transform=u?u({},""):"none",this.hasProjected=!1);return}a.visibility="";const c=l.animationValues||l.latestValues;this.applyTransformsToTarget();let d=bF(this.projectionDeltaWithTransform,this.treeScale,c);u&&(d=u(c,d)),a.transform=d;const{x:h,y:f}=this.projectionDelta;a.transformOrigin=`${h.origin*100}% ${f.origin*100}% 0`,l.animationValues?a.opacity=l===this?c.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:c.opacityExit:a.opacity=l===this?c.opacity!==void 0?c.opacity:"":c.opacityExit!==void 0?c.opacityExit:0;for(const m in Zu){if(c[m]===void 0)continue;const{correct:p,applyTo:v,isCSSVariable:g}=Zu[m],x=d==="none"?c[m]:p(c[m],l);if(v){const w=v.length;for(let b=0;b<w;b++)a[v[b]]=x}else g?this.options.visualElement.renderState.vars[m]=x:a[m]=x}this.options.layoutId&&(a.pointerEvents=l===this?Kc(s==null?void 0:s.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var s;return(s=a.currentAnimation)==null?void 0:s.stop()}),this.root.nodes.forEach(Tb),this.root.sharedNodes.clear()}}}function SF(t){t.updateLayout()}function CF(t){var n;const e=((n=t.resumeFrom)==null?void 0:n.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:i}=t.layout,{animationType:o}=t.options,a=e.source!==t.layout.source;o==="size"?Bn(d=>{const h=a?e.measuredBox[d]:e.layoutBox[d],f=rn(h);h.min=r[d].min,h.max=h.min+f}):zC(o,e.layoutBox,r)&&Bn(d=>{const h=a?e.measuredBox[d]:e.layoutBox[d],f=rn(r[d]);h.max=h.min+f,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[d].max=t.relativeTarget[d].min+f)});const s=$a();bu(s,r,e.layoutBox);const u=$a();a?bu(u,t.applyTransform(i,!0),e.measuredBox):bu(u,r,e.layoutBox);const l=!FC(s);let c=!1;if(!t.resumeFrom){const d=t.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:h,layout:f}=d;if(h&&f){const m=ht();ku(m,e.layoutBox,h.layoutBox);const p=ht();ku(p,r,f.layoutBox),LC(m,p)||(c=!0),d.options.layoutRoot&&(t.relativeTarget=p,t.relativeTargetOrigin=m,t.relativeParent=d)}}}t.notifyListeners("didUpdate",{layout:r,snapshot:e,delta:u,layoutDelta:s,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(t.isLead()){const{onExitComplete:r}=t.options;r&&r()}t.options.transition=void 0}function EF(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function AF(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function RF(t){t.clearSnapshot()}function Tb(t){t.clearMeasurements()}function Pb(t){t.isLayoutDirty=!1}function NF(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function Ib(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function TF(t){t.resolveTargetDelta()}function PF(t){t.calcProjection()}function IF(t){t.resetSkewAndRotation()}function DF(t){t.removeLeadSnapshot()}function Db(t,e,n){t.translate=rt(e.translate,0,n),t.scale=rt(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function Mb(t,e,n,r){t.min=rt(e.min,n.min,r),t.max=rt(e.max,n.max,r)}function MF(t,e,n,r){Mb(t.x,e.x,n.x,r),Mb(t.y,e.y,n.y,r)}function OF(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const jF={duration:.45,ease:[.4,0,.1,1]},Ob=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),jb=Ob("applewebkit/")&&!Ob("chrome/")?Math.round:qn;function Fb(t){t.min=jb(t.min),t.max=jb(t.max)}function FF(t){Fb(t.x),Fb(t.y)}function zC(t,e,n){return t==="position"||t==="preserve-aspect"&&!$j(Rb(e),Rb(n),.2)}function LF(t){var e;return t!==t.root&&((e=t.scroll)==null?void 0:e.wasRoot)}const BF=VC({attachResizeListener:(t,e)=>el(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Gf={current:void 0},UC=VC({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Gf.current){const t=new BF({});t.mount(window),t.setOptions({layoutScroll:!0}),Gf.current=t}return Gf.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),VF={pan:{Feature:iF},drag:{Feature:rF,ProjectionNode:UC,MeasureLayout:MC}};function Lb(t,e,n){const{props:r}=t;t.animationState&&r.whileHover&&t.animationState.setActive("whileHover",n==="Start");const i="onHover"+n,o=r[i];o&&Xe.postRender(()=>o(e,kl(e)))}class zF extends so{mount(){const{current:e}=this.node;e&&(this.unmount=u4(e,(n,r)=>(Lb(this.node,r,"Start"),i=>Lb(this.node,i,"End"))))}unmount(){}}class UF extends so{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=xl(el(this.node.current,"focus",()=>this.onFocus()),el(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function Bb(t,e,n){const{props:r}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&r.whileTap&&t.animationState.setActive("whileTap",n==="Start");const i="onTap"+(n==="End"?"":n),o=r[i];o&&Xe.postRender(()=>o(e,kl(e)))}class $F extends so{mount(){const{current:e}=this.node;e&&(this.unmount=h4(e,(n,r)=>(Bb(this.node,r,"Start"),(i,{success:o})=>Bb(this.node,i,o?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Ym=new WeakMap,Hf=new WeakMap,WF=t=>{const e=Ym.get(t.target);e&&e(t)},GF=t=>{t.forEach(WF)};function HF({root:t,...e}){const n=t||document;Hf.has(n)||Hf.set(n,{});const r=Hf.get(n),i=JSON.stringify(e);return r[i]||(r[i]=new IntersectionObserver(GF,{root:t,...e})),r[i]}function KF(t,e,n){const r=HF(e);return Ym.set(t,n),r.observe(t),()=>{Ym.delete(t),r.unobserve(t)}}const qF={some:0,all:1};class XF extends so{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:r,amount:i="some",once:o}=e,a={root:n?n.current:void 0,rootMargin:r,threshold:typeof i=="number"?i:qF[i]},s=u=>{const{isIntersecting:l}=u;if(this.isInView===l||(this.isInView=l,o&&!l&&this.hasEnteredView))return;l&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",l);const{onViewportEnter:c,onViewportLeave:d}=this.node.getProps(),h=l?c:d;h&&h(u)};return KF(this.node.current,a,s)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(YF(e,n))&&this.startObserver()}unmount(){}}function YF({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const JF={inView:{Feature:XF},tap:{Feature:$F},focus:{Feature:UF},hover:{Feature:zF}},QF={layout:{ProjectionNode:UC,MeasureLayout:MC}},ZF={...Fj,...JF,...VF,...QF},Le=Z4(ZF,hj);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eL=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),tL=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,r)=>r?r.toUpperCase():n.toLowerCase()),Vb=t=>{const e=tL(t);return e.charAt(0).toUpperCase()+e.slice(1)},$C=(...t)=>t.filter((e,n,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===n).join(" ").trim(),nL=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var rL={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iL=A.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i="",children:o,iconNode:a,...s},u)=>A.createElement("svg",{ref:u,...rL,width:e,height:e,stroke:t,strokeWidth:r?Number(n)*24/Number(e):n,className:$C("lucide",i),...!o&&!nL(s)&&{"aria-hidden":"true"},...s},[...a.map(([l,c])=>A.createElement(l,c)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=(t,e)=>{const n=A.forwardRef(({className:r,...i},o)=>A.createElement(iL,{ref:o,iconNode:e,className:$C(`lucide-${eL(Vb(t))}`,`lucide-${t}`,r),...i}));return n.displayName=Vb(t),n};/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oL=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],aL=we("activity",oL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sL=[["path",{d:"M10 16c.5.3 1.2.5 2 .5s1.5-.2 2-.5",key:"1u7htd"}],["path",{d:"M15 12h.01",key:"1k8ypt"}],["path",{d:"M19.38 6.813A9 9 0 0 1 20.8 10.2a2 2 0 0 1 0 3.6 9 9 0 0 1-17.6 0 2 2 0 0 1 0-3.6A9 9 0 0 1 12 3c2 0 3.5 1.1 3.5 2.5s-.9 2.5-2 2.5c-.8 0-1.5-.4-1.5-1",key:"11xh7x"}],["path",{d:"M9 12h.01",key:"157uk2"}]],uL=we("baby",sL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lL=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],Jm=we("bot",lL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cL=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],dL=we("calendar",cL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hL=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],fL=we("camera",hL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pL=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],au=we("check",pL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mL=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],WC=we("chevron-down",mL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ki=we("circle-alert",gL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vL=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],tl=we("circle-check-big",vL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],_u=we("circle-question-mark",yL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],GC=we("circle-x",xL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wL=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],bL=we("clock",wL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kL=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],_L=we("download",kL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SL=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ad=we("file-text",SL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CL=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],EL=we("flask-conical",CL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],RL=we("globe",AL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NL=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],TL=we("house",NL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],IL=we("info",PL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DL=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],zb=we("loader-circle",DL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ML=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],OL=we("lock",ML);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jL=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],FL=we("mail",jL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LL=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Kf=we("map-pin",LL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BL=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],VL=we("maximize",BL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zL=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],UL=we("mic-off",zL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $L=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],WL=we("mic",$L);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GL=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],HL=we("minimize",GL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KL=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Qm=we("package",KL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qL=[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]],Zm=we("pill",qL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XL=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],YL=we("plus",XL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JL=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],QL=we("rotate-ccw",JL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZL=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],eB=we("send",ZL);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tB=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],nB=we("shield-alert",tB);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rB=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],HC=we("shield-check",rB);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iB=[["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}],["path",{d:"M3.103 6.034h17.794",key:"awc11p"}],["path",{d:"M3.4 5.467a2 2 0 0 0-.4 1.2V20a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6.667a2 2 0 0 0-.4-1.2l-2-2.667A2 2 0 0 0 17 2H7a2 2 0 0 0-1.6.8z",key:"o988cm"}]],KC=we("shopping-bag",iB);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oB=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],qC=we("shopping-cart",oB);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aB=[["path",{d:"M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z",key:"17jzev"}]],sB=we("thermometer",aB);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uB=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],lB=we("trash-2",uB);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cB=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],dB=we("trending-up",cB);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hB=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],XC=we("user",hB);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fB=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Ub=we("volume-2",fB);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pB=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],mB=we("volume-x",pB);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gB=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],vB=we("wrench",gB);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yB=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],jy=we("x",yB);function $b(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Fy(...t){return e=>{let n=!1;const r=t.map(i=>{const o=$b(i,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let i=0;i<r.length;i++){const o=r[i];typeof o=="function"?o():$b(t[i],null)}}}}function Mn(...t){return A.useCallback(Fy(...t),t)}function Rd(t){const e=wB(t),n=A.forwardRef((r,i)=>{const{children:o,...a}=r,s=A.Children.toArray(o),u=s.find(kB);if(u){const l=u.props.children,c=s.map(d=>d===u?A.Children.count(l)>1?A.Children.only(null):A.isValidElement(l)?l.props.children:null:d);return y.jsx(e,{...a,ref:i,children:A.isValidElement(l)?A.cloneElement(l,void 0,c):null})}return y.jsx(e,{...a,ref:i,children:o})});return n.displayName=`${t}.Slot`,n}var xB=Rd("Slot");function wB(t){const e=A.forwardRef((n,r)=>{const{children:i,...o}=n;if(A.isValidElement(i)){const a=SB(i),s=_B(o,i.props);return i.type!==A.Fragment&&(s.ref=r?Fy(r,a):a),A.cloneElement(i,s)}return A.Children.count(i)>1?A.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var bB=Symbol("radix.slottable");function kB(t){return A.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===bB}function _B(t,e){const n={...e};for(const r in e){const i=t[r],o=e[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...s)=>{const u=o(...s);return i(...s),u}:i&&(n[r]=i):r==="style"?n[r]={...i,...o}:r==="className"&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...t,...n}}function SB(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function YC(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=YC(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function JC(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=YC(t))&&(r&&(r+=" "),r+=e);return r}const Wb=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,Gb=JC,Ah=(t,e)=>n=>{var r;if((e==null?void 0:e.variants)==null)return Gb(t,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:i,defaultVariants:o}=e,a=Object.keys(i).map(l=>{const c=n==null?void 0:n[l],d=o==null?void 0:o[l];if(c===null)return null;const h=Wb(c)||Wb(d);return i[l][h]}),s=n&&Object.entries(n).reduce((l,c)=>{let[d,h]=c;return h===void 0||(l[d]=h),l},{}),u=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((l,c)=>{let{class:d,className:h,...f}=c;return Object.entries(f).every(m=>{let[p,v]=m;return Array.isArray(v)?v.includes({...o,...s}[p]):{...o,...s}[p]===v})?[...l,d,h]:l},[]);return Gb(t,a,u,n==null?void 0:n.class,n==null?void 0:n.className)},Ly="-",CB=t=>{const e=AB(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:a=>{const s=a.split(Ly);return s[0]===""&&s.length!==1&&s.shift(),QC(s,e)||EB(a)},getConflictingClassGroupIds:(a,s)=>{const u=n[a]||[];return s&&r[a]?[...u,...r[a]]:u}}},QC=(t,e)=>{var a;if(t.length===0)return e.classGroupId;const n=t[0],r=e.nextPart.get(n),i=r?QC(t.slice(1),r):void 0;if(i)return i;if(e.validators.length===0)return;const o=t.join(Ly);return(a=e.validators.find(({validator:s})=>s(o)))==null?void 0:a.classGroupId},Hb=/^\[(.+)\]$/,EB=t=>{if(Hb.test(t)){const e=Hb.exec(t)[1],n=e==null?void 0:e.substring(0,e.indexOf(":"));if(n)return"arbitrary.."+n}},AB=t=>{const{theme:e,classGroups:n}=t,r={nextPart:new Map,validators:[]};for(const i in n)eg(n[i],r,i,e);return r},eg=(t,e,n,r)=>{t.forEach(i=>{if(typeof i=="string"){const o=i===""?e:Kb(e,i);o.classGroupId=n;return}if(typeof i=="function"){if(RB(i)){eg(i(r),e,n,r);return}e.validators.push({validator:i,classGroupId:n});return}Object.entries(i).forEach(([o,a])=>{eg(a,Kb(e,o),n,r)})})},Kb=(t,e)=>{let n=t;return e.split(Ly).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},RB=t=>t.isThemeGetter,NB=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=new Map,r=new Map;const i=(o,a)=>{n.set(o,a),e++,e>t&&(e=0,r=n,n=new Map)};return{get(o){let a=n.get(o);if(a!==void 0)return a;if((a=r.get(o))!==void 0)return i(o,a),a},set(o,a){n.has(o)?n.set(o,a):i(o,a)}}},tg="!",ng=":",TB=ng.length,PB=t=>{const{prefix:e,experimentalParseClassName:n}=t;let r=i=>{const o=[];let a=0,s=0,u=0,l;for(let m=0;m<i.length;m++){let p=i[m];if(a===0&&s===0){if(p===ng){o.push(i.slice(u,m)),u=m+TB;continue}if(p==="/"){l=m;continue}}p==="["?a++:p==="]"?a--:p==="("?s++:p===")"&&s--}const c=o.length===0?i:i.substring(u),d=IB(c),h=d!==c,f=l&&l>u?l-u:void 0;return{modifiers:o,hasImportantModifier:h,baseClassName:d,maybePostfixModifierPosition:f}};if(e){const i=e+ng,o=r;r=a=>a.startsWith(i)?o(a.substring(i.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:a,maybePostfixModifierPosition:void 0}}if(n){const i=r;r=o=>n({className:o,parseClassName:i})}return r},IB=t=>t.endsWith(tg)?t.substring(0,t.length-1):t.startsWith(tg)?t.substring(1):t,DB=t=>{const e=Object.fromEntries(t.orderSensitiveModifiers.map(r=>[r,!0]));return r=>{if(r.length<=1)return r;const i=[];let o=[];return r.forEach(a=>{a[0]==="["||e[a]?(i.push(...o.sort(),a),o=[]):o.push(a)}),i.push(...o.sort()),i}},MB=t=>({cache:NB(t.cacheSize),parseClassName:PB(t),sortModifiers:DB(t),...CB(t)}),OB=/\s+/,jB=(t,e)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:i,sortModifiers:o}=e,a=[],s=t.trim().split(OB);let u="";for(let l=s.length-1;l>=0;l-=1){const c=s[l],{isExternal:d,modifiers:h,hasImportantModifier:f,baseClassName:m,maybePostfixModifierPosition:p}=n(c);if(d){u=c+(u.length>0?" "+u:u);continue}let v=!!p,g=r(v?m.substring(0,p):m);if(!g){if(!v){u=c+(u.length>0?" "+u:u);continue}if(g=r(m),!g){u=c+(u.length>0?" "+u:u);continue}v=!1}const x=o(h).join(":"),w=f?x+tg:x,b=w+g;if(a.includes(b))continue;a.push(b);const k=i(g,v);for(let _=0;_<k.length;++_){const S=k[_];a.push(w+S)}u=c+(u.length>0?" "+u:u)}return u};function FB(){let t=0,e,n,r="";for(;t<arguments.length;)(e=arguments[t++])&&(n=ZC(e))&&(r&&(r+=" "),r+=n);return r}const ZC=t=>{if(typeof t=="string")return t;let e,n="";for(let r=0;r<t.length;r++)t[r]&&(e=ZC(t[r]))&&(n&&(n+=" "),n+=e);return n};function LB(t,...e){let n,r,i,o=a;function a(u){const l=e.reduce((c,d)=>d(c),t());return n=MB(l),r=n.cache.get,i=n.cache.set,o=s,s(u)}function s(u){const l=r(u);if(l)return l;const c=jB(u,n);return i(u,c),c}return function(){return o(FB.apply(null,arguments))}}const xt=t=>{const e=n=>n[t]||[];return e.isThemeGetter=!0,e},eE=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,tE=/^\((?:(\w[\w-]*):)?(.+)\)$/i,BB=/^\d+\/\d+$/,VB=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,zB=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,UB=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,$B=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,WB=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,la=t=>BB.test(t),Se=t=>!!t&&!Number.isNaN(Number(t)),Ci=t=>!!t&&Number.isInteger(Number(t)),qf=t=>t.endsWith("%")&&Se(t.slice(0,-1)),Jr=t=>VB.test(t),GB=()=>!0,HB=t=>zB.test(t)&&!UB.test(t),nE=()=>!1,KB=t=>$B.test(t),qB=t=>WB.test(t),XB=t=>!ee(t)&&!te(t),YB=t=>Ts(t,oE,nE),ee=t=>eE.test(t),po=t=>Ts(t,aE,HB),Xf=t=>Ts(t,t5,Se),qb=t=>Ts(t,rE,nE),JB=t=>Ts(t,iE,qB),oc=t=>Ts(t,sE,KB),te=t=>tE.test(t),Xs=t=>Ps(t,aE),QB=t=>Ps(t,n5),Xb=t=>Ps(t,rE),ZB=t=>Ps(t,oE),e5=t=>Ps(t,iE),ac=t=>Ps(t,sE,!0),Ts=(t,e,n)=>{const r=eE.exec(t);return r?r[1]?e(r[1]):n(r[2]):!1},Ps=(t,e,n=!1)=>{const r=tE.exec(t);return r?r[1]?e(r[1]):n:!1},rE=t=>t==="position"||t==="percentage",iE=t=>t==="image"||t==="url",oE=t=>t==="length"||t==="size"||t==="bg-size",aE=t=>t==="length",t5=t=>t==="number",n5=t=>t==="family-name",sE=t=>t==="shadow",r5=()=>{const t=xt("color"),e=xt("font"),n=xt("text"),r=xt("font-weight"),i=xt("tracking"),o=xt("leading"),a=xt("breakpoint"),s=xt("container"),u=xt("spacing"),l=xt("radius"),c=xt("shadow"),d=xt("inset-shadow"),h=xt("text-shadow"),f=xt("drop-shadow"),m=xt("blur"),p=xt("perspective"),v=xt("aspect"),g=xt("ease"),x=xt("animate"),w=()=>["auto","avoid","all","avoid-page","page","left","right","column"],b=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],k=()=>[...b(),te,ee],_=()=>["auto","hidden","clip","visible","scroll"],S=()=>["auto","contain","none"],C=()=>[te,ee,u],E=()=>[la,"full","auto",...C()],R=()=>[Ci,"none","subgrid",te,ee],D=()=>["auto",{span:["full",Ci,te,ee]},Ci,te,ee],P=()=>[Ci,"auto",te,ee],F=()=>["auto","min","max","fr",te,ee],U=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],z=()=>["start","end","center","stretch","center-safe","end-safe"],W=()=>["auto",...C()],L=()=>[la,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...C()],I=()=>[t,te,ee],j=()=>[...b(),Xb,qb,{position:[te,ee]}],B=()=>["no-repeat",{repeat:["","x","y","space","round"]}],K=()=>["auto","cover","contain",ZB,YB,{size:[te,ee]}],X=()=>[qf,Xs,po],Y=()=>["","none","full",l,te,ee],ie=()=>["",Se,Xs,po],fe=()=>["solid","dashed","dotted","double"],pe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ce=()=>[Se,qf,Xb,qb],Ce=()=>["","none",m,te,ee],ke=()=>["none",Se,te,ee],Be=()=>["none",Se,te,ee],_e=()=>[Se,te,ee],Te=()=>[la,"full",...C()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Jr],breakpoint:[Jr],color:[GB],container:[Jr],"drop-shadow":[Jr],ease:["in","out","in-out"],font:[XB],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Jr],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Jr],shadow:[Jr],spacing:["px",Se],text:[Jr],"text-shadow":[Jr],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",la,ee,te,v]}],container:["container"],columns:[{columns:[Se,ee,te,s]}],"break-after":[{"break-after":w()}],"break-before":[{"break-before":w()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:k()}],overflow:[{overflow:_()}],"overflow-x":[{"overflow-x":_()}],"overflow-y":[{"overflow-y":_()}],overscroll:[{overscroll:S()}],"overscroll-x":[{"overscroll-x":S()}],"overscroll-y":[{"overscroll-y":S()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:E()}],"inset-x":[{"inset-x":E()}],"inset-y":[{"inset-y":E()}],start:[{start:E()}],end:[{end:E()}],top:[{top:E()}],right:[{right:E()}],bottom:[{bottom:E()}],left:[{left:E()}],visibility:["visible","invisible","collapse"],z:[{z:[Ci,"auto",te,ee]}],basis:[{basis:[la,"full","auto",s,...C()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Se,la,"auto","initial","none",ee]}],grow:[{grow:["",Se,te,ee]}],shrink:[{shrink:["",Se,te,ee]}],order:[{order:[Ci,"first","last","none",te,ee]}],"grid-cols":[{"grid-cols":R()}],"col-start-end":[{col:D()}],"col-start":[{"col-start":P()}],"col-end":[{"col-end":P()}],"grid-rows":[{"grid-rows":R()}],"row-start-end":[{row:D()}],"row-start":[{"row-start":P()}],"row-end":[{"row-end":P()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":F()}],"auto-rows":[{"auto-rows":F()}],gap:[{gap:C()}],"gap-x":[{"gap-x":C()}],"gap-y":[{"gap-y":C()}],"justify-content":[{justify:[...U(),"normal"]}],"justify-items":[{"justify-items":[...z(),"normal"]}],"justify-self":[{"justify-self":["auto",...z()]}],"align-content":[{content:["normal",...U()]}],"align-items":[{items:[...z(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...z(),{baseline:["","last"]}]}],"place-content":[{"place-content":U()}],"place-items":[{"place-items":[...z(),"baseline"]}],"place-self":[{"place-self":["auto",...z()]}],p:[{p:C()}],px:[{px:C()}],py:[{py:C()}],ps:[{ps:C()}],pe:[{pe:C()}],pt:[{pt:C()}],pr:[{pr:C()}],pb:[{pb:C()}],pl:[{pl:C()}],m:[{m:W()}],mx:[{mx:W()}],my:[{my:W()}],ms:[{ms:W()}],me:[{me:W()}],mt:[{mt:W()}],mr:[{mr:W()}],mb:[{mb:W()}],ml:[{ml:W()}],"space-x":[{"space-x":C()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":C()}],"space-y-reverse":["space-y-reverse"],size:[{size:L()}],w:[{w:[s,"screen",...L()]}],"min-w":[{"min-w":[s,"screen","none",...L()]}],"max-w":[{"max-w":[s,"screen","none","prose",{screen:[a]},...L()]}],h:[{h:["screen","lh",...L()]}],"min-h":[{"min-h":["screen","lh","none",...L()]}],"max-h":[{"max-h":["screen","lh",...L()]}],"font-size":[{text:["base",n,Xs,po]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,te,Xf]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",qf,ee]}],"font-family":[{font:[QB,ee,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,te,ee]}],"line-clamp":[{"line-clamp":[Se,"none",te,Xf]}],leading:[{leading:[o,...C()]}],"list-image":[{"list-image":["none",te,ee]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",te,ee]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:I()}],"text-color":[{text:I()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...fe(),"wavy"]}],"text-decoration-thickness":[{decoration:[Se,"from-font","auto",te,po]}],"text-decoration-color":[{decoration:I()}],"underline-offset":[{"underline-offset":[Se,"auto",te,ee]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:C()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",te,ee]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",te,ee]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:j()}],"bg-repeat":[{bg:B()}],"bg-size":[{bg:K()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Ci,te,ee],radial:["",te,ee],conic:[Ci,te,ee]},e5,JB]}],"bg-color":[{bg:I()}],"gradient-from-pos":[{from:X()}],"gradient-via-pos":[{via:X()}],"gradient-to-pos":[{to:X()}],"gradient-from":[{from:I()}],"gradient-via":[{via:I()}],"gradient-to":[{to:I()}],rounded:[{rounded:Y()}],"rounded-s":[{"rounded-s":Y()}],"rounded-e":[{"rounded-e":Y()}],"rounded-t":[{"rounded-t":Y()}],"rounded-r":[{"rounded-r":Y()}],"rounded-b":[{"rounded-b":Y()}],"rounded-l":[{"rounded-l":Y()}],"rounded-ss":[{"rounded-ss":Y()}],"rounded-se":[{"rounded-se":Y()}],"rounded-ee":[{"rounded-ee":Y()}],"rounded-es":[{"rounded-es":Y()}],"rounded-tl":[{"rounded-tl":Y()}],"rounded-tr":[{"rounded-tr":Y()}],"rounded-br":[{"rounded-br":Y()}],"rounded-bl":[{"rounded-bl":Y()}],"border-w":[{border:ie()}],"border-w-x":[{"border-x":ie()}],"border-w-y":[{"border-y":ie()}],"border-w-s":[{"border-s":ie()}],"border-w-e":[{"border-e":ie()}],"border-w-t":[{"border-t":ie()}],"border-w-r":[{"border-r":ie()}],"border-w-b":[{"border-b":ie()}],"border-w-l":[{"border-l":ie()}],"divide-x":[{"divide-x":ie()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":ie()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...fe(),"hidden","none"]}],"divide-style":[{divide:[...fe(),"hidden","none"]}],"border-color":[{border:I()}],"border-color-x":[{"border-x":I()}],"border-color-y":[{"border-y":I()}],"border-color-s":[{"border-s":I()}],"border-color-e":[{"border-e":I()}],"border-color-t":[{"border-t":I()}],"border-color-r":[{"border-r":I()}],"border-color-b":[{"border-b":I()}],"border-color-l":[{"border-l":I()}],"divide-color":[{divide:I()}],"outline-style":[{outline:[...fe(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Se,te,ee]}],"outline-w":[{outline:["",Se,Xs,po]}],"outline-color":[{outline:I()}],shadow:[{shadow:["","none",c,ac,oc]}],"shadow-color":[{shadow:I()}],"inset-shadow":[{"inset-shadow":["none",d,ac,oc]}],"inset-shadow-color":[{"inset-shadow":I()}],"ring-w":[{ring:ie()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:I()}],"ring-offset-w":[{"ring-offset":[Se,po]}],"ring-offset-color":[{"ring-offset":I()}],"inset-ring-w":[{"inset-ring":ie()}],"inset-ring-color":[{"inset-ring":I()}],"text-shadow":[{"text-shadow":["none",h,ac,oc]}],"text-shadow-color":[{"text-shadow":I()}],opacity:[{opacity:[Se,te,ee]}],"mix-blend":[{"mix-blend":[...pe(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":pe()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Se]}],"mask-image-linear-from-pos":[{"mask-linear-from":ce()}],"mask-image-linear-to-pos":[{"mask-linear-to":ce()}],"mask-image-linear-from-color":[{"mask-linear-from":I()}],"mask-image-linear-to-color":[{"mask-linear-to":I()}],"mask-image-t-from-pos":[{"mask-t-from":ce()}],"mask-image-t-to-pos":[{"mask-t-to":ce()}],"mask-image-t-from-color":[{"mask-t-from":I()}],"mask-image-t-to-color":[{"mask-t-to":I()}],"mask-image-r-from-pos":[{"mask-r-from":ce()}],"mask-image-r-to-pos":[{"mask-r-to":ce()}],"mask-image-r-from-color":[{"mask-r-from":I()}],"mask-image-r-to-color":[{"mask-r-to":I()}],"mask-image-b-from-pos":[{"mask-b-from":ce()}],"mask-image-b-to-pos":[{"mask-b-to":ce()}],"mask-image-b-from-color":[{"mask-b-from":I()}],"mask-image-b-to-color":[{"mask-b-to":I()}],"mask-image-l-from-pos":[{"mask-l-from":ce()}],"mask-image-l-to-pos":[{"mask-l-to":ce()}],"mask-image-l-from-color":[{"mask-l-from":I()}],"mask-image-l-to-color":[{"mask-l-to":I()}],"mask-image-x-from-pos":[{"mask-x-from":ce()}],"mask-image-x-to-pos":[{"mask-x-to":ce()}],"mask-image-x-from-color":[{"mask-x-from":I()}],"mask-image-x-to-color":[{"mask-x-to":I()}],"mask-image-y-from-pos":[{"mask-y-from":ce()}],"mask-image-y-to-pos":[{"mask-y-to":ce()}],"mask-image-y-from-color":[{"mask-y-from":I()}],"mask-image-y-to-color":[{"mask-y-to":I()}],"mask-image-radial":[{"mask-radial":[te,ee]}],"mask-image-radial-from-pos":[{"mask-radial-from":ce()}],"mask-image-radial-to-pos":[{"mask-radial-to":ce()}],"mask-image-radial-from-color":[{"mask-radial-from":I()}],"mask-image-radial-to-color":[{"mask-radial-to":I()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":b()}],"mask-image-conic-pos":[{"mask-conic":[Se]}],"mask-image-conic-from-pos":[{"mask-conic-from":ce()}],"mask-image-conic-to-pos":[{"mask-conic-to":ce()}],"mask-image-conic-from-color":[{"mask-conic-from":I()}],"mask-image-conic-to-color":[{"mask-conic-to":I()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:j()}],"mask-repeat":[{mask:B()}],"mask-size":[{mask:K()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",te,ee]}],filter:[{filter:["","none",te,ee]}],blur:[{blur:Ce()}],brightness:[{brightness:[Se,te,ee]}],contrast:[{contrast:[Se,te,ee]}],"drop-shadow":[{"drop-shadow":["","none",f,ac,oc]}],"drop-shadow-color":[{"drop-shadow":I()}],grayscale:[{grayscale:["",Se,te,ee]}],"hue-rotate":[{"hue-rotate":[Se,te,ee]}],invert:[{invert:["",Se,te,ee]}],saturate:[{saturate:[Se,te,ee]}],sepia:[{sepia:["",Se,te,ee]}],"backdrop-filter":[{"backdrop-filter":["","none",te,ee]}],"backdrop-blur":[{"backdrop-blur":Ce()}],"backdrop-brightness":[{"backdrop-brightness":[Se,te,ee]}],"backdrop-contrast":[{"backdrop-contrast":[Se,te,ee]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Se,te,ee]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Se,te,ee]}],"backdrop-invert":[{"backdrop-invert":["",Se,te,ee]}],"backdrop-opacity":[{"backdrop-opacity":[Se,te,ee]}],"backdrop-saturate":[{"backdrop-saturate":[Se,te,ee]}],"backdrop-sepia":[{"backdrop-sepia":["",Se,te,ee]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":C()}],"border-spacing-x":[{"border-spacing-x":C()}],"border-spacing-y":[{"border-spacing-y":C()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",te,ee]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Se,"initial",te,ee]}],ease:[{ease:["linear","initial",g,te,ee]}],delay:[{delay:[Se,te,ee]}],animate:[{animate:["none",x,te,ee]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[p,te,ee]}],"perspective-origin":[{"perspective-origin":k()}],rotate:[{rotate:ke()}],"rotate-x":[{"rotate-x":ke()}],"rotate-y":[{"rotate-y":ke()}],"rotate-z":[{"rotate-z":ke()}],scale:[{scale:Be()}],"scale-x":[{"scale-x":Be()}],"scale-y":[{"scale-y":Be()}],"scale-z":[{"scale-z":Be()}],"scale-3d":["scale-3d"],skew:[{skew:_e()}],"skew-x":[{"skew-x":_e()}],"skew-y":[{"skew-y":_e()}],transform:[{transform:[te,ee,"","none","gpu","cpu"]}],"transform-origin":[{origin:k()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Te()}],"translate-x":[{"translate-x":Te()}],"translate-y":[{"translate-y":Te()}],"translate-z":[{"translate-z":Te()}],"translate-none":["translate-none"],accent:[{accent:I()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:I()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",te,ee]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":C()}],"scroll-mx":[{"scroll-mx":C()}],"scroll-my":[{"scroll-my":C()}],"scroll-ms":[{"scroll-ms":C()}],"scroll-me":[{"scroll-me":C()}],"scroll-mt":[{"scroll-mt":C()}],"scroll-mr":[{"scroll-mr":C()}],"scroll-mb":[{"scroll-mb":C()}],"scroll-ml":[{"scroll-ml":C()}],"scroll-p":[{"scroll-p":C()}],"scroll-px":[{"scroll-px":C()}],"scroll-py":[{"scroll-py":C()}],"scroll-ps":[{"scroll-ps":C()}],"scroll-pe":[{"scroll-pe":C()}],"scroll-pt":[{"scroll-pt":C()}],"scroll-pr":[{"scroll-pr":C()}],"scroll-pb":[{"scroll-pb":C()}],"scroll-pl":[{"scroll-pl":C()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",te,ee]}],fill:[{fill:["none",...I()]}],"stroke-w":[{stroke:[Se,Xs,po,Xf]}],stroke:[{stroke:["none",...I()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},i5=LB(r5);function Ke(...t){return i5(JC(t))}const o5=Ah("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Pe=ve.forwardRef(({className:t,variant:e,size:n,asChild:r=!1,...i},o)=>{const a=r?xB:"button";return y.jsx(a,{className:Ke(o5({variant:e,size:n,className:t})),ref:o,...i})});Pe.displayName="Button";const Yb=t=>{let e;const n=new Set,r=(l,c)=>{const d=typeof l=="function"?l(e):l;if(!Object.is(d,e)){const h=e;e=c??(typeof d!="object"||d===null)?d:Object.assign({},e,d),n.forEach(f=>f(e,h))}},i=()=>e,s={setState:r,getState:i,getInitialState:()=>u,subscribe:l=>(n.add(l),()=>n.delete(l))},u=e=t(r,i,s);return s},a5=t=>t?Yb(t):Yb,s5=t=>t;function u5(t,e=s5){const n=ve.useSyncExternalStore(t.subscribe,ve.useCallback(()=>e(t.getState()),[t,e]),ve.useCallback(()=>e(t.getInitialState()),[t,e]));return ve.useDebugValue(n),n}const l5=t=>{const e=a5(t),n=r=>u5(e,r);return Object.assign(n,e),n},By=t=>l5;function c5(t,e){let n;try{n=t()}catch{return}return{getItem:i=>{var o;const a=u=>u===null?null:JSON.parse(u,void 0),s=(o=n.getItem(i))!=null?o:null;return s instanceof Promise?s.then(a):a(s)},setItem:(i,o)=>n.setItem(i,JSON.stringify(o,void 0)),removeItem:i=>n.removeItem(i)}}const rg=t=>e=>{try{const n=t(e);return n instanceof Promise?n:{then(r){return rg(r)(n)},catch(r){return this}}}catch(n){return{then(r){return this},catch(r){return rg(r)(n)}}}},d5=(t,e)=>(n,r,i)=>{let o={storage:c5(()=>localStorage),partialize:p=>p,version:0,merge:(p,v)=>({...v,...p}),...e},a=!1;const s=new Set,u=new Set;let l=o.storage;if(!l)return t((...p)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),n(...p)},r,i);const c=()=>{const p=o.partialize({...r()});return l.setItem(o.name,{state:p,version:o.version})},d=i.setState;i.setState=(p,v)=>(d(p,v),c());const h=t((...p)=>(n(...p),c()),r,i);i.getInitialState=()=>h;let f;const m=()=>{var p,v;if(!l)return;a=!1,s.forEach(x=>{var w;return x((w=r())!=null?w:h)});const g=((v=o.onRehydrateStorage)==null?void 0:v.call(o,(p=r())!=null?p:h))||void 0;return rg(l.getItem.bind(l))(o.name).then(x=>{if(x)if(typeof x.version=="number"&&x.version!==o.version){if(o.migrate){const w=o.migrate(x.state,x.version);return w instanceof Promise?w.then(b=>[!0,b]):[!0,w]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,x.state];return[!1,void 0]}).then(x=>{var w;const[b,k]=x;if(f=o.merge(k,(w=r())!=null?w:h),n(f,!0),b)return c()}).then(()=>{g==null||g(f,void 0),f=r(),a=!0,u.forEach(x=>x(f))}).catch(x=>{g==null||g(void 0,x)})};return i.persist={setOptions:p=>{o={...o,...p},p.storage&&(l=p.storage)},clearStorage:()=>{l==null||l.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>m(),hasHydrated:()=>a,onHydrate:p=>(s.add(p),()=>{s.delete(p)}),onFinishHydration:p=>(u.add(p),()=>{u.delete(p)})},o.skipHydration||m(),f||h},Vy=d5,uE=By()(Vy((t,e)=>({language:"en",setLanguage:n=>t({language:n}),toggleLanguage:()=>t({language:e().language==="en"?"lv":"en"})}),{name:"language-storage"})),h5={en:{header:{title:"Smart Medicine Vending",home:"Home",aiAssistant:"AI Assistant",ageVerified:"Age Verified",notVerified:"Not Verified"},welcome:{title:"Welcome to Smart Medicine Vending",subtitle:"Your 24/7 AI-powered health assistant. Get personalized medicine recommendations and purchase safely with age verification.",startPurchase:"Start Purchase",adminLogin:"Admin Login",features:"Age verification required for purchase  AI-powered recommendations  Secure payment",disclaimer:" For serious medical conditions, please consult your pharmacist or doctor"},ageVerification:{title:"Age Verification Required",subtitle:"Please verify that you are 18 years or older to purchase medicines",description:"Choose a verification method to confirm you are 18 years or older",passport:"Passport",residencePermit:"Residence Permit",idCard:"ID Card",selectDocument:"Select Document Type",uploadDocument:"Upload Document",verify:"Verify Age",processing:"Processing...",cancel:"Cancel",verificationSuccess:"Age verified successfully!",verificationFailed:"Verification failed. Please try again.",verificationFailedTitle:"Verification Failed",verificationFailedMessage:"We couldn't verify your age. Please try again with a clear, well-lit photo of your ID.",tipsHeader:"Tips for better results:",tipGoodLighting:"Ensure good lighting",tipKeepFlat:"Keep ID flat and in focus",tipTextReadable:"Make sure all text is readable",tipAvoidGlare:"Avoid glare or shadows",tryAgain:"Try Again",takePhoto:"Take Photo",retake:"Retake Photo",faceRecognition:"Face Recognition",capturingFace:"Capturing your face for purchase tracking...",faceDetected:"Face detected successfully!",noFaceDetected:"No face detected. Please look at the camera.",loadingModels:"Loading face recognition models...",scanFace:"Scan Face"},faceConsent:{title:"Face Recognition Consent",purpose:"To continue, this system will temporarily store your facial recognition data solely for the purpose of preventing excessive medication purchases within a 24-hour period. This is a safety measure to ensure responsible use.",whatWeStore:"What we store:",facePhoto:"A photo or encrypted facial representation",timestamp:"Timestamp of purchase attempt",storageDuration:"Storage duration:",duration24h:"Your data will be automatically deleted after 24 hours.",notIdentified:"You will NOT be personally identified. We only track purchase frequency, not your identity.",noThirdParty:"Your data will not be shared with third parties.",confirmationTitle:'By selecting "I Agree", you confirm that:',understandUsage:"You understand how your facial data will be used",consentStorage:"You consent to temporary storage for up to 24 hours",canWithdraw:'You may withdraw at any time by choosing "Cancel"',agree:"I Agree",cancel:"Cancel"},purchaseRestrictions:{welcomeBack:"Welcome back!",returningUser:"We recognized you from your previous visit.",restrictedCategories:"Restricted Categories",categoryBlocked:"You purchased from this category within 24 hours",timeRemaining:"Available in: {time}",categoryAvailable:"Category available for purchase",allCategoriesBlocked:"All categories are currently restricted",comeBackLater:"Please come back after 24 hours from your last purchase",restrictionInfo:"For your safety, you can only purchase from each medicine category once every 24 hours."},aiAssistant:{title:"AI Health Assistant",subtitle:"Describe your symptoms and get personalized medicine recommendations",placeholder:'Type your symptoms here... (e.g., "I have a headache and fever")',send:"Send",thinking:"Thinking...",greeting:"Hello! I'm your AI health assistant. Please describe your symptoms, and I'll recommend appropriate over-the-counter medicines.",initialMessage:`Hello! I'm your AI Health Assistant with complete knowledge of 50 over-the-counter medicines. I can help you find the right medication for your symptoms.

I can assist with:
 Pain relief and fever
 Digestive issues
 Cold, flu, and allergies
 Skin conditions
 Vitamins and supplements

Please describe your symptoms, and I'll recommend appropriate medicines. You can type or use voice input!

Important: For serious or persistent symptoms, please consult a healthcare professional.`,continue:"Continue to Medicine Selection",skip:"Skip AI Assistant",voiceNotSupported:` Speech recognition is not supported in your browser.

Please use:
 Google Chrome
 Microsoft Edge
 Safari`,micPermissionGranted:" Microphone permission granted",micPermissionDenied:" Microphone permission denied:",micAccessDenied:` Microphone access denied.

Please:
1. Click the microphone icon in your browser address bar
2. Allow microphone access
3. Refresh the page and try again`},medicineSelection:{title:"Select Your Medicines",subtitle:"Choose from our available medicines (maximum 5 items)",subtitleGroups:"Choose one medicine from each category (maximum 5 items)",recommended:"AI Recommended",aiRecommended:"AI Recommended for you",group:"Group",price:"Price",inStock:"In Stock",outOfStock:"Out of Stock",viewDetails:"View Details",addToCart:"Add to Cart",removeFromCart:"Remove from Cart",continue:"Continue to Checkout",continueCount:"Continue ({count})",itemsSelected:"item(s) selected",maxItems:"Maximum 5 items",selected:"Selected",selectedGroups:"Selected {count} of 5 groups"},medicineGroups:{1:"Digestive / Oral Care",2:"Dermatology / Antiseptic",3:"Anti-inflammatory / Pain Relief",4:"Cold / Cough / Allergy",5:"Vitamins / Supplements"},checkout:{title:"Review & Checkout",subtitle:"Review your selected medicines and complete your purchase",reviewOrder:"Review Your Order",checkSelected:"Check your selected medicines before proceeding to payment",emptyCart:"Your cart is empty",emptyCartMessage:"Add some medicines to your cart to continue",browseMedicines:"Browse Medicines",groupLabel:"Group {group}",orderSummary:"Order Summary",item:"item",items:"items",subtotal:"Subtotal",tax:"Tax (8%)",vat:"VAT (21%)",total:"Total",paymentMethod:"Payment Method",paypal:"PayPal",proceedToPayment:"Proceed to Payment",proceedToCheckout:"Proceed to Checkout",addMoreItems:"Add More Items",processingPayment:"Processing Payment...",paymentSuccess:"Payment Successful!",paymentFailed:"Payment Failed",thankYou:"Thank you for your purchase!",orderConfirmation:"Your order has been confirmed and will be dispensed shortly.",backToHome:"Back to Home",viewReceipt:"View Receipt",emailValidation:"Please provide a valid email address"},admin:{title:"Admin Dashboard",subtitle:"Manage all vending machines, inventory, and operations",overview:"Overview",locations:"Locations",inventory:"Inventory",purchases:"Purchases",recipes:"Recipes",totalMachines:"Total Machines",stockValue:"Stock Value",active:"active",maintenance:"maintenance",offline:"offline",critical:"Critical",warning:"Warning",allGood:"All Good",viewDetails:"View Details",selectMachine:"Select a vending machine",selectMachineInventory:"Select a vending machine to view its inventory",restock:"Restock to 50",medicine:"Medicine",stock:"Stock",price:"Price",status:"Status",actions:"Actions",good:"Good",lowStock:"Low Stock",transactionId:"Transaction ID",machine:"Machine",date:"Date",items:"Items",total:"Total",completed:"completed",pending:"pending",refunded:"refunded",noTransactions:"No transactions yet",prescriptionManagement:"Prescription Management",managePrescriptions:"Manage and track prescription fulfillments",recipeId:"Recipe ID",patient:"Patient",doctor:"Doctor",medications:"Medications",fulfilled:"fulfilled",cancelled:"cancelled",recipeDetails:"Recipe Details",patientName:"Patient Name",doctorName:"Doctor Name",dosage:"Dosage",frequency:"Frequency",duration:"Duration",fulfilledAt:"Fulfilled at",vendingMachineLocations:"Vending Machine Locations",interactiveMap:"Interactive Map",mapIntegration:"Map integration available with Google Maps or Mapbox API",locationsCount:"{count} locations across Belgium",purchaseHistory:"Purchase History",allTransactions:"All transactions across {count} vending machines",unitsLabel:"units"},adminLogin:{title:"Admin Login",subtitle:"Enter your password to access the admin panel",password:"Password",enterPassword:"Enter admin password",login:"Login",backToHome:"Back to Home",invalidPassword:"Invalid password"},footer:{version:"Smart Medicine Vending",terms:"Terms of Service",privacy:"Privacy Policy",contact:"Contact Support"},medicineDetails:{price:"Price",withVat:"with VAT",availableStock:"Available Stock",unitsInStock:"units in stock",whatIsThis:"What is this medicine?",howToUse:"How to Use",step1Title:"Read the Instructions",step1Description:"Always read the package leaflet before using this medicine.",step2Title:"Follow Dosage",step2Description:"Take as directed. Do not exceed the recommended dose of {strength}.",step3Title:"Store Properly",activeIngredient:"Active Ingredient",substance:"Substance",strength:"Strength",form:"Form",atcCode:"ATC Code",packageInfo:"Package Information",packageSize:"Package Size",manufacturer:"Manufacturer",productId:"Product ID",authorization:"Authorization",expiryBatch:"Expiry & Batch",storageConditions:"Storage Conditions",safetyInfo:"Safety Information",pediatricUse:"Pediatric Use",pediatricApproved:"This medication is approved for use in children.",pediatricNotApproved:"This medication is not approved for children. Consult a healthcare professional.",importantNotice:"Important Notice",importantNoticeText:"Always read the package leaflet carefully before use. If symptoms persist or worsen, consult a healthcare professional. Do not exceed the recommended dose.",faq:"Frequently Asked Questions",faqPregnancy:"Can I take this during pregnancy?",faqPregnancyAnswer:"Consult your healthcare provider before use during pregnancy or breastfeeding.",faqAlcohol:"Can I take this with alcohol?",faqAlcoholAnswer:"Avoid alcohol while taking this medication unless advised otherwise by your doctor.",faqDrowsiness:"Does it cause drowsiness?",faqDrowsinessAnswer:"Check the package leaflet for side effects. Some medications may cause drowsiness.",allInfoDisplayed:" All medicine information is displayed above",viewPackageLeaflet:"View Package Leaflet (PDF)",dispensing:"Dispensing..."},pdfViewer:{packageLeaflet:"Package Leaflet",open:"Open",standardView:"Standard View",alternativeView:"Alternative View",directView:"Direct View",tryAnother:"Try another viewer or download",unableToDisplay:"Unable to Display PDF",viewerError:"The PDF viewer encountered an error. Please try a different viewer or download the PDF.",downloadPdf:"Download PDF",officialLeaflet:"Official package leaflet from Latvia's Medicine Registry (ZVA)",viewerLabel:"Viewer: {type}",viewerControls:"Use the PDF viewer controls below to navigate, zoom, and interact with the document",exitFullscreen:"Exit fullscreen",fullscreen:"Fullscreen",pdfViewerTitle:"PDF Viewer",poweredBy:"PDF Viewer powered by Google Docs"},common:{loading:"Loading...",error:"Error",success:"Success",cancel:"Cancel",confirm:"Confirm",save:"Save",delete:"Delete",edit:"Edit",close:"Close",next:"Next",previous:"Previous",back:"Back",search:"Search",filter:"Filter",sort:"Sort",units:"units"}},lv:{header:{title:"Vied Medikamentu Automts",home:"Skums",aiAssistant:"AI Asistents",ageVerified:"Vecums Verificts",notVerified:"Nav Verificts"},welcome:{title:"Laipni ldzam Viedaj Medikamentu Automt",subtitle:"Jsu 24/7 AI veselbas asistents. Saemiet personaliztus medikamentu ieteikumus un prciet droi ar vecuma verifikciju.",startPurchase:"Skt Pirkumu",adminLogin:"Administratora Pieteikans",features:"Nepiecieama vecuma verifikcija  AI ieteikumi  Droa maksana",disclaimer:" Nopietnos veselbas gadjumos, ldzu, konsultjieties ar rstu vai farmaceitu"},ageVerification:{title:"Nepiecieama Vecuma Verifikcija",subtitle:"Ldzu, apstipriniet, ka esat 18 gadus vecs vai vecks, lai iegdtos medikamentus",description:"Izvlieties verifikcijas metodi, lai apstiprintu, ka esat 18 gadus vecs vai vecks",passport:"Pase",residencePermit:"Uzturans Atauja",idCard:"Personas Apliecba",selectDocument:"Izvlieties Dokumenta Veidu",uploadDocument:"Augupieldt Dokumentu",verify:"Verifict Vecumu",processing:"Apstrd...",cancel:"Atcelt",verificationSuccess:"Vecums veiksmgi verificts!",verificationFailed:"Verifikcija neizdevs. Ldzu, miniet vlreiz.",verificationFailedTitle:"Verifikcija Neizdevs",verificationFailedMessage:"Ms nevarjm verifict jsu vecumu. Ldzu, miniet vlreiz ar skaidru, labi apgaismotu ID fotogrfiju.",tipsHeader:"Padomi labkiem rezulttiem:",tipGoodLighting:"Nodroiniet labu apgaismojumu",tipKeepFlat:"Turiet ID plakanu un fokus",tipTextReadable:"Prliecinieties, ka viss teksts ir salasms",tipAvoidGlare:"Izvairieties no atspdumiem vai nm",tryAgain:"Mint Vlreiz",takePhoto:"Uzemt Foto",retake:"Premt Foto",faceRecognition:"Sejas Atpazana",capturingFace:"Uzemam jsu seju pirkumu izsekoanai...",faceDetected:"Seja veiksmgi noteikta!",noFaceDetected:"Seja nav noteikta. Ldzu, skatieties kamer.",loadingModels:"Ield sejas atpazanas modeus...",scanFace:"Skent Seju"},faceConsent:{title:"Sejas Atpazanas Piekriana",purpose:"Lai turpintu,  sistma slaicgi uzglabs jsu sejas atpazanas datus tikai un viengi, lai novrstu prmrgu medikamentu iegdi 24 stundu laik. Tas ir drobas paskums, lai nodrointu atbildgu lietoanu.",whatWeStore:"Ko ms uzglabjam:",facePhoto:"Fotogrfiju vai ifrtu sejas attlojumu",timestamp:"Pirkuma minjuma laika zmogu",storageDuration:"Uzglabanas ilgums:",duration24h:"Jsu dati tiks automtiski izdzsti pc 24 stundm.",notIdentified:"Js NETIKS persongi identificts. Ms izsekojam tikai pirkumu bieumu, nevis jsu identitti.",noThirdParty:"Jsu dati netiks kopgoti ar treajm personm.",confirmationTitle:'Izvloties "Es piekrtu", js apstipriniet, ka:',understandUsage:"Js saprotat, k tiks izmantoti jsu sejas dati",consentStorage:"Js piekrtat slaicgai uzglabanai ldz 24 stundm",canWithdraw:'Js varat atteikties jebkur laik, izvloties "Atcelt"',agree:"Es Piekrtu",cancel:"Atcelt"},purchaseRestrictions:{welcomeBack:"Laipni ldzam atpaka!",returningUser:"Ms js atpazinm no jsu iepriekj apmekljuma.",restrictedCategories:"Ierobeots Kategorijas",categoryBlocked:"Js iegdjties no s kategorijas pdjo 24 stundu laik",timeRemaining:"Pieejams pc: {time}",categoryAvailable:"Kategorija pieejama pirkumam",allCategoriesBlocked:"Visas kategorijas palaik ir ierobeotas",comeBackLater:"Ldzu, atgriezieties pc 24 stundm no jsu pdj pirkuma",restrictionInfo:"Jsu drobai js varat iegdties no katras medikamentu kategorijas tikai reizi 24 stunds."},aiAssistant:{title:"AI Veselbas Asistents",subtitle:"Aprakstiet savus simptomus un saemiet personaliztus medikamentu ieteikumus",placeholder:'Ierakstiet savus simptomus eit... (piemram, "Man ir galvasspes un drudzis")',send:"Nostt",thinking:"Domju...",greeting:"Sveiki! Es esmu jsu AI veselbas asistents. Ldzu, aprakstiet savus simptomus, un es ieteiku piemrotus bezrecepu medikamentus.",initialMessage:`Sveiki! Es esmu jsu AI Veselbas Asistents ar pilngm zinanm par 50 bezrecepu medikamentiem. Es varu paldzt jums atrast piemrotu medikamentu jsu simptomiem.

Es varu paldzt ar:
 Spju remdanu un drudzi
 Gremoanas problmm
 Saaukstanos, gripu un alerijm
 das problmm
 Vitamniem un uztura bagtintjiem

Ldzu, aprakstiet savus simptomus, un es ieteiku piemrotus medikamentus. Js varat rakstt vai izmantot balss ievadi!

Svargi: Nopietnos vai ilgstoos simptomos, ldzu, konsultjieties ar veselbas aprpes specilistu.`,continue:"Turpint uz Medikamentu Izvli",skip:"Izlaist AI Asistentu",voiceNotSupported:` Runas atpazana netiek atbalstta jsu prlkprogramm.

Ldzu, izmantojiet:
 Google Chrome
 Microsoft Edge
 Safari`,micPermissionGranted:" Mikrofona atauja pieirta",micPermissionDenied:" Mikrofona atauja liegta:",micAccessDenied:` Mikrofona piekuve liegta.

Ldzu:
1. Noklikiniet uz mikrofona ikonas prlka adreses josl
2. Ataujiet mikrofona piekuvi
3. Atjaunojiet lapu un miniet vlreiz`},medicineSelection:{title:"Izvlieties Savus Medikamentus",subtitle:"Izvlieties no msu pieejamajiem medikamentiem (maksimums 5 preces)",subtitleGroups:"Izvlieties vienu medikamentu no katras kategorijas (maksimums 5 preces)",recommended:"AI Ieteikts",aiRecommended:"AI Ieteikts jums",group:"Grupa",price:"Cena",inStock:"Noliktav",outOfStock:"Nav Noliktav",viewDetails:"Skatt Detaas",addToCart:"Pievienot Grozam",removeFromCart:"Noemt no Groza",continue:"Turpint uz Norinanos",continueCount:"Turpint ({count})",itemsSelected:"prece(s) izvlta(s)",maxItems:"Maksimums 5 preces",selected:"Izvlts",selectedGroups:"Izvltas {count} no 5 grupm"},medicineGroups:{1:"Gremoana / Mutes Aprpe",2:"Dermatoloija / Antiseptii",3:"Pretiekaisuma / Spju Remdana",4:"Saaukstans / Klepus / Alerija",5:"Vitamni / Uztura Bagtintji"},checkout:{title:"Prskatt un Norinties",subtitle:"Prskatiet savus izvltos medikamentus un pabeidziet pirkumu",reviewOrder:"Prskatiet Savu Pastjumu",checkSelected:"Prbaudiet savus izvltos medikamentus pirms turpint uz maksanu",emptyCart:"Jsu grozs ir tuks",emptyCartMessage:"Pievienojiet medikamentus grozam, lai turpintu",browseMedicines:"Prlkot Medikamentus",groupLabel:"Grupa {group}",orderSummary:"Pastjuma Kopsavilkums",item:"prece",items:"preces",subtotal:"Starpsumma",tax:"Nodoklis (8%)",vat:"PVN (21%)",total:"Kop",paymentMethod:"Maksanas Metode",paypal:"PayPal",proceedToPayment:"Turpint uz Maksanu",proceedToCheckout:"Turpint uz Norinanos",addMoreItems:"Pievienot Vairk Preu",processingPayment:"Apstrd Maksjumu...",paymentSuccess:"Maksjums Veiksmgs!",paymentFailed:"Maksjums Neizdevs",thankYou:"Paldies par pirkumu!",orderConfirmation:"Jsu pastjums ir apstiprints un drzum tiks izsniegts.",backToHome:"Atpaka uz Skumu",viewReceipt:"Skatt Kvti",emailValidation:"Ldzu, nordiet dergu e-pasta adresi"},admin:{title:"Administratora Panelis",subtitle:"Prvaldt visus automtus, inventru un opercijas",overview:"Prskats",locations:"Atraans vietas",inventory:"Inventrs",purchases:"Pirkumi",recipes:"Receptes",totalMachines:"Kop Automti",stockValue:"Krjumu Vrtba",active:"aktvs",maintenance:"apkope",offline:"bezsaist",critical:"Kritisks",warning:"Brdinjums",allGood:"Viss Krtb",viewDetails:"Skatt Detaas",selectMachine:"Izvlieties automtu",selectMachineInventory:"Izvlieties automtu, lai skattu t inventru",restock:"Papildint ldz 50",medicine:"Medikaments",stock:"Krjums",price:"Cena",status:"Statuss",actions:"Darbbas",good:"Labs",lowStock:"Zems Krjums",transactionId:"Transakcijas ID",machine:"Automts",date:"Datums",items:"Preces",total:"Kop",completed:"pabeigts",pending:"gaida",refunded:"atmaksts",noTransactions:"Nav transakciju",prescriptionManagement:"Recepu Prvaldba",managePrescriptions:"Prvaldt un izsekot recepu izpildi",recipeId:"Receptes ID",patient:"Pacients",doctor:"rsts",medications:"Medikamenti",fulfilled:"izpildts",cancelled:"atcelts",recipeDetails:"Receptes Detaas",patientName:"Pacienta Vrds",doctorName:"rsta Vrds",dosage:"Deva",frequency:"Bieums",duration:"Ilgums",fulfilledAt:"Izpildts",vendingMachineLocations:"Automtu Atraans Vietas",interactiveMap:"Interaktva Karte",mapIntegration:"Kartes integrcija pieejama ar Google Maps vai Mapbox API",locationsCount:"{count} atraans vietas Beij",purchaseHistory:"Pirkumu Vsture",allTransactions:"Visas transakcijas {count} automtos",unitsLabel:"vienbas"},adminLogin:{title:"Administratora Pieteikans",subtitle:"Ievadiet savu paroli, lai piektu administratora panelim",password:"Parole",enterPassword:"Ievadiet administratora paroli",login:"Pieteikties",backToHome:"Atpaka uz Skumu",invalidPassword:"Nederga parole"},footer:{version:"Vied Medikamentu Automts",terms:"Pakalpojuma Noteikumi",privacy:"Privtuma Politika",contact:"Sazinties ar Atbalstu"},medicineDetails:{price:"Cena",withVat:"ar PVN",availableStock:"Pieejamais Krjums",unitsInStock:"vienbas noliktav",whatIsThis:"Kas ir is medikaments?",howToUse:"K Lietot",step1Title:"Izlasiet Instrukcijas",step1Description:"Vienmr izlasiet lietoanas instrukciju pirms  medikamenta lietoanas.",step2Title:"Ievrojiet Devu",step2Description:"Lietojiet saska ar nordjumiem. Neprsniedziet ieteikto devu {strength}.",step3Title:"Uzglabjiet Pareizi",activeIngredient:"Aktv Sastvdaa",substance:"Viela",strength:"Stiprums",form:"Forma",atcCode:"ATC Kods",packageInfo:"Iepakojuma Informcija",packageSize:"Iepakojuma Izmrs",manufacturer:"Raotjs",productId:"Produkta ID",authorization:"Autorizcija",expiryBatch:"Dergums un Partija",storageConditions:"Uzglabanas Nosacjumi",safetyInfo:"Drobas Informcija",pediatricUse:"Lietoana Brniem",pediatricApproved:"is medikaments ir apstiprints lietoanai brniem.",pediatricNotApproved:"is medikaments nav apstiprints brniem. Konsultjieties ar veselbas aprpes specilistu.",importantNotice:"Svargs Paziojums",importantNoticeText:"Vienmr rpgi izlasiet lietoanas instrukciju pirms lietoanas. Ja simptomi saglabjas vai pasliktins, konsultjieties ar veselbas aprpes specilistu. Neprsniedziet ieteikto devu.",faq:"Biei Uzdotie Jautjumi",faqPregnancy:"Vai varu to lietot grtniecbas laik?",faqPregnancyAnswer:"Konsultjieties ar savu veselbas aprpes specilistu pirms lietoanas grtniecbas vai baroanas laik.",faqAlcohol:"Vai varu to lietot ar alkoholu?",faqAlcoholAnswer:"Izvairieties no alkohola, lietojot o medikamentu, ja vien rsts nav nordjis citdi.",faqDrowsiness:"Vai tas izraisa miegainbu?",faqDrowsinessAnswer:"Prbaudiet lietoanas instrukcij blakuspardbas. Dai medikamenti var izraist miegainbu.",allInfoDisplayed:" Visa medikamenta informcija ir redzama augstk",viewPackageLeaflet:"Skatt Lietoanas Instrukciju (PDF)",dispensing:"Izsniedz..."},pdfViewer:{packageLeaflet:"Lietoanas Instrukcija",open:"Atvrt",standardView:"Standarta Skats",alternativeView:"Alternatvais Skats",directView:"Tieais Skats",tryAnother:"Izminiet citu skattju vai lejupieldjiet",unableToDisplay:"Nevar Attlot PDF",viewerError:"PDF skattj rads kda. Ldzu, izminiet citu skattju vai lejupieldjiet PDF.",downloadPdf:"Lejupieldt PDF",officialLeaflet:"Oficil lietoanas instrukcija no Latvijas Zu reistra (ZVA)",viewerLabel:"Skattjs: {type}",viewerControls:"Izmantojiet PDF skattja kontroles zemk, lai navigtu, tuvintu un mijiedarbotos ar dokumentu",exitFullscreen:"Iziet no pilnekrna",fullscreen:"Pilnekrns",pdfViewerTitle:"PDF Skattjs",poweredBy:"PDF skattjs darbints ar Google Docs"},common:{loading:"Ield...",error:"Kda",success:"Veiksmgi",cancel:"Atcelt",confirm:"Apstiprint",save:"Saglabt",delete:"Dzst",edit:"Redit",close:"Aizvrt",next:"Nkamais",previous:"Iepriekjais",back:"Atpaka",search:"Meklt",filter:"Filtrt",sort:"Krtot",units:"vienbas"}}};function Fn(){const t=uE(n=>n.language);return{t:h5[t],language:t}}function f5(){const t=$r(),{t:e}=Fn();return y.jsxs("div",{className:"min-h-[calc(100vh-180px)] flex items-center justify-center px-8 py-12 relative overflow-hidden",children:[y.jsx(Le.div,{animate:{background:["radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%)","radial-gradient(circle at 80% 50%, rgba(22, 163, 74, 0.1) 0%, transparent 50%)","radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%)"]},transition:{duration:10,repeat:1/0,ease:"linear"},className:"absolute inset-0 pointer-events-none"}),y.jsx("div",{className:"container max-w-6xl mx-auto relative z-10",children:y.jsxs(Le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center space-y-12",children:[y.jsxs("div",{className:"space-y-6",children:[y.jsxs(Le.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5,delay:.2},className:"relative w-full max-w-2xl mx-auto h-96",children:[y.jsx("img",{src:"https://c.animaapp.com/mh6qjj17fjzQoj/img/ai_1.png",alt:"Smart vending machine",className:"w-full h-full object-contain drop-shadow-2xl",loading:"eager"}),y.jsx(Le.div,{animate:{scale:[1,1.05,1],opacity:[.3,.6,.3]},transition:{duration:3,repeat:1/0,ease:"easeInOut"},className:"absolute inset-0 bg-gradient-1 opacity-20 rounded-3xl blur-3xl"})]}),y.jsx("h1",{className:"text-5xl md:text-6xl font-heading font-semibold text-foreground",children:e.welcome.title}),y.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:e.welcome.subtitle})]}),y.jsx(Le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"flex flex-col sm:flex-row gap-6 justify-center items-center",children:y.jsxs(Pe,{onClick:()=>t("/verify-age"),className:"h-16 px-12 text-lg rounded-xl bg-primary text-primary-foreground hover:bg-primary/90 transition-all hover:scale-105 shadow-lg",children:[y.jsx(qC,{className:"w-6 h-6 mr-3",strokeWidth:2}),e.welcome.startPurchase]})}),y.jsxs(Le.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.6},className:"pt-8 space-y-4",children:[y.jsx("p",{className:"text-sm text-muted-foreground",children:e.welcome.features}),y.jsx("p",{className:"text-xs text-muted-foreground italic",children:e.welcome.disclaimer})]})]})})]})}var lE={exports:{}};(function(t,e){(function(r,i){t.exports=i(A)})(bP,function(n){return function(r){var i={};function o(a){if(i[a])return i[a].exports;var s=i[a]={i:a,l:!1,exports:{}};return r[a].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=r,o.c=i,o.d=function(a,s,u){o.o(a,s)||Object.defineProperty(a,s,{enumerable:!0,get:u})},o.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},o.t=function(a,s){if(s&1&&(a=o(a)),s&8||s&4&&typeof a=="object"&&a&&a.__esModule)return a;var u=Object.create(null);if(o.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:a}),s&2&&typeof a!="string")for(var l in a)o.d(u,l,(function(c){return a[c]}).bind(null,l));return u},o.n=function(a){var s=a&&a.__esModule?function(){return a.default}:function(){return a};return o.d(s,"a",s),s},o.o=function(a,s){return Object.prototype.hasOwnProperty.call(a,s)},o.p="",o(o.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(r,i,o){o.r(i);var a=o("react"),s=function(){var h=function(f,m){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,v){p.__proto__=v}||function(p,v){for(var g in v)v.hasOwnProperty(g)&&(p[g]=v[g])},h(f,m)};return function(f,m){h(f,m);function p(){this.constructor=f}f.prototype=m===null?Object.create(m):(p.prototype=m.prototype,new p)}}(),u=function(){return u=Object.assign||function(h){for(var f,m=1,p=arguments.length;m<p;m++){f=arguments[m];for(var v in f)Object.prototype.hasOwnProperty.call(f,v)&&(h[v]=f[v])}return h},u.apply(this,arguments)},l=function(h,f){var m={};for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&f.indexOf(p)<0&&(m[p]=h[p]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,p=Object.getOwnPropertySymbols(h);v<p.length;v++)f.indexOf(p[v])<0&&Object.prototype.propertyIsEnumerable.call(h,p[v])&&(m[p[v]]=h[p[v]]);return m};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(f){var m=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return m?new Promise(function(p,v){m.call(navigator,f,p,v)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function c(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var d=function(h){s(f,h);function f(m){var p=h.call(this,m)||this;return p.canvas=null,p.ctx=null,p.requestUserMediaId=0,p.unmounted=!1,p.state={hasUserMedia:!1},p}return f.prototype.componentDidMount=function(){var m=this,p=m.state,v=m.props;if(this.unmounted=!1,!c()){v.onUserMediaError("getUserMedia not supported");return}p.hasUserMedia||this.requestUserMedia(),v.children&&typeof v.children!="function"&&console.warn("children must be a function")},f.prototype.componentDidUpdate=function(m){var p=this.props;if(!c()){p.onUserMediaError("getUserMedia not supported");return}var v=JSON.stringify(m.audioConstraints)!==JSON.stringify(p.audioConstraints),g=JSON.stringify(m.videoConstraints)!==JSON.stringify(p.videoConstraints),x=m.minScreenshotWidth!==p.minScreenshotWidth,w=m.minScreenshotHeight!==p.minScreenshotHeight;(g||x||w)&&(this.canvas=null,this.ctx=null),(v||g)&&(this.stopAndCleanup(),this.requestUserMedia())},f.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},f.stopMediaStream=function(m){m&&(m.getVideoTracks&&m.getAudioTracks?(m.getVideoTracks().map(function(p){m.removeTrack(p),p.stop()}),m.getAudioTracks().map(function(p){m.removeTrack(p),p.stop()})):m.stop())},f.prototype.stopAndCleanup=function(){var m=this.state;m.hasUserMedia&&(f.stopMediaStream(this.stream),m.src&&window.URL.revokeObjectURL(m.src))},f.prototype.getScreenshot=function(m){var p=this,v=p.state,g=p.props;if(!v.hasUserMedia)return null;var x=this.getCanvas(m);return x&&x.toDataURL(g.screenshotFormat,g.screenshotQuality)},f.prototype.getCanvas=function(m){var p=this,v=p.state,g=p.props;if(!this.video||!v.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var x=this.video.videoWidth,w=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var b=x/w;x=g.minScreenshotWidth||this.video.clientWidth,w=x/b,g.minScreenshotHeight&&w<g.minScreenshotHeight&&(w=g.minScreenshotHeight,x=w*b)}this.canvas=document.createElement("canvas"),this.canvas.width=(m==null?void 0:m.width)||x,this.canvas.height=(m==null?void 0:m.height)||w,this.ctx=this.canvas.getContext("2d")}var k=this,_=k.ctx,S=k.canvas;return _&&S&&(S.width=(m==null?void 0:m.width)||S.width,S.height=(m==null?void 0:m.height)||S.height,g.mirrored&&(_.translate(S.width,0),_.scale(-1,1)),_.imageSmoothingEnabled=g.imageSmoothing,_.drawImage(this.video,0,0,(m==null?void 0:m.width)||S.width,(m==null?void 0:m.height)||S.height),g.mirrored&&(_.scale(-1,1),_.translate(-S.width,0))),S},f.prototype.requestUserMedia=function(){var m=this,p=this.props,v=function(w,b){var k={video:typeof b<"u"?b:!0};p.audio&&(k.audio=typeof w<"u"?w:!0),m.requestUserMediaId++;var _=m.requestUserMediaId;navigator.mediaDevices.getUserMedia(k).then(function(S){m.unmounted||_!==m.requestUserMediaId?f.stopMediaStream(S):m.handleUserMedia(null,S)}).catch(function(S){m.handleUserMedia(S)})};if("mediaDevices"in navigator)v(p.audioConstraints,p.videoConstraints);else{var g=function(w){return{optional:[{sourceId:w}]}},x=function(w){var b=w.deviceId;return typeof b=="string"?b:Array.isArray(b)&&b.length>0?b[0]:typeof b=="object"&&b.ideal?b.ideal:null};MediaStreamTrack.getSources(function(w){var b=null,k=null;w.forEach(function(C){C.kind==="audio"?b=C.id:C.kind==="video"&&(k=C.id)});var _=x(p.audioConstraints);_&&(b=_);var S=x(p.videoConstraints);S&&(k=S),v(g(b),g(k))})}},f.prototype.handleUserMedia=function(m,p){var v=this.props;if(m||!p){this.setState({hasUserMedia:!1}),v.onUserMediaError(m);return}this.stream=p;try{this.video&&(this.video.srcObject=p),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(p)})}v.onUserMedia(p)},f.prototype.render=function(){var m=this,p=this,v=p.state,g=p.props,x=g.audio;g.forceScreenshotSourceSize;var w=g.disablePictureInPicture;g.onUserMedia,g.onUserMediaError,g.screenshotFormat,g.screenshotQuality,g.minScreenshotWidth,g.minScreenshotHeight,g.audioConstraints,g.videoConstraints,g.imageSmoothing;var b=g.mirrored,k=g.style,_=k===void 0?{}:k,S=g.children,C=l(g,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),E=b?u(u({},_),{transform:(_.transform||"")+" scaleX(-1)"}):_,R={getScreenshot:this.getScreenshot.bind(this)};return a.createElement(a.Fragment,null,a.createElement("video",u({autoPlay:!0,disablePictureInPicture:w,src:v.src,muted:!x,playsInline:!0,ref:function(D){m.video=D},style:E},C)),S&&S(R))},f.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},f}(a.Component);i.default=d},react:function(r,i){r.exports=n}}).default})})(lE);var p5=lE.exports;const m5=Zg(p5),et=ve.forwardRef(({className:t,...e},n)=>y.jsx("div",{ref:n,className:Ke("rounded-xl border bg-card text-card-foreground shadow",t),...e}));et.displayName="Card";const g5=ve.forwardRef(({className:t,...e},n)=>y.jsx("div",{ref:n,className:Ke("flex flex-col space-y-1.5 p-6",t),...e}));g5.displayName="CardHeader";const v5=ve.forwardRef(({className:t,...e},n)=>y.jsx("div",{ref:n,className:Ke("font-semibold leading-none tracking-tight",t),...e}));v5.displayName="CardTitle";const y5=ve.forwardRef(({className:t,...e},n)=>y.jsx("div",{ref:n,className:Ke("text-sm text-muted-foreground",t),...e}));y5.displayName="CardDescription";const x5=ve.forwardRef(({className:t,...e},n)=>y.jsx("div",{ref:n,className:Ke("p-6 pt-0",t),...e}));x5.displayName="CardContent";const w5=ve.forwardRef(({className:t,...e},n)=>y.jsx("div",{ref:n,className:Ke("flex items-center p-6 pt-0",t),...e}));w5.displayName="CardFooter";const b5=[{id:1,name:"Digestive / Oral Care",description:"Medications for digestive issues, heartburn, constipation, and oral health"},{id:2,name:"Dermatology / Antiseptic",description:"Skin treatments, antifungal, antiviral, and antiseptic products"},{id:3,name:"Anti-inflammatory / Pain Relief",description:"Pain relievers, anti-inflammatory medications, and fever reducers"},{id:4,name:"Cold / Cough / Allergy",description:"Relief from cold symptoms, cough, allergies, and respiratory issues"},{id:5,name:"Children & Special Care",description:"Pediatric medications and specialized formulations for children"}],tn=[{id:"med-001",productId:"01-0463-02",name:"Mezym 10 000 V",shortName:"Mezym",price:3.26,priceWithVat:3.65,group:1,description:"Digestive enzyme supplement containing pancreatin. Helps with pancreatic insufficiency and improves digestion of proteins, fats, and carbohydrates.",activeSubstance:"Pancreatis pulvis",strength:"10 000 U",pharmaceuticalForm:"Gastro-resistant tablet",manufacturer:"Berlin-Chemie AG (Menarini Group), Germany",packageSize:"10 tablets",storageConditions:"Store at temperature up to 30C",atcCode:"A09AA02",isApprovedForKids:!0,stock:30,authorizationNo:"01-0463",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/01-0463/pil"},{id:"med-002",productId:"01-0086-04",name:"Loperamide Stirol 2 mg",shortName:"Loperamide Stirol",price:2.91,priceWithVat:3.26,group:1,description:"Anti-diarrheal medication that slows down gut movement. Effective for acute and chronic diarrhea treatment.",activeSubstance:"Loperamidi hydrochloridum",strength:"2 mg",pharmaceuticalForm:"Hard capsule",manufacturer:"Marifarm d.o.o., Slovenia",packageSize:"12 capsules",storageConditions:"Store at temperature up to 25C",atcCode:"A07DA03",isApprovedForKids:!0,stock:30,authorizationNo:"01-0086",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/01-0086/pil"},{id:"med-003",productId:"00-0690-01",name:"Magnerot 500 mg",shortName:"Magnerot",price:9.19,priceWithVat:10.29,group:1,description:"Magnesium supplement for treating magnesium deficiency. Supports muscle function, reduces cramps, and promotes cardiovascular health.",activeSubstance:"Magnesii orotas",strength:"500 mg",pharmaceuticalForm:"Tablet",manufacturer:"Wrwag Pharma GmbH & Co.KG, Germany",packageSize:"50 tablets",storageConditions:"No special storage conditions required",atcCode:"A12CC09",isApprovedForKids:!0,stock:30,authorizationNo:"00-0690",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/00-0690/pil"},{id:"med-004",productId:"06-0052-01",name:"Elevit Pronatal",shortName:"Elevit Pronatal",price:12.98,priceWithVat:14.54,group:1,description:"Comprehensive prenatal vitamin and mineral supplement. Contains folic acid, iron, calcium, and essential vitamins for pregnancy and breastfeeding.",activeSubstance:"Multivitamin and mineral complex",strength:"Multiple vitamins and minerals",pharmaceuticalForm:"Film-coated tablet",manufacturer:"Dragenopharm Apotheker Puschl GmbH, Germany",packageSize:"30 tablets",storageConditions:"Store at temperature up to 25C, protect from light",atcCode:"A11AA03",isApprovedForKids:!1,stock:30,authorizationNo:"06-0052",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/06-0052/pil"},{id:"med-005",productId:"09-0375-01",name:"Duphalac Fruit 667 mg/ml",shortName:"Duphalac Fruit",price:7.74,priceWithVat:8.67,group:1,description:"Lactulose oral solution for constipation treatment. Works as an osmotic laxative to soften stools. Fruit-flavored for better taste.",activeSubstance:"Lactulosum",strength:"667 mg/ml",pharmaceuticalForm:"Oral solution",manufacturer:"Abbott Biologicals B.V., Netherlands",packageSize:"200 ml bottle",storageConditions:"No special storage conditions required",atcCode:"A06AD11",isApprovedForKids:!0,stock:30,authorizationNo:"09-0375",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/09-0375/pil"},{id:"med-006",productId:"04-0153-01",name:"Faringodol 150 mg",shortName:"Faringodol",price:7.68,priceWithVat:8.6,group:1,description:"Throat lozenges containing choline salicylate. Provides relief from sore throat pain and inflammation.",activeSubstance:"Cholini salicylas",strength:"150 mg",pharmaceuticalForm:"Lozenge",manufacturer:'Przedsiebiorstwo Produkcyjne-Handlowe "EWA" S.A., Poland',packageSize:"16 lozenges",storageConditions:"Store at temperature up to 25C, protect from moisture",atcCode:"A01AD11",isApprovedForKids:!0,stock:30,authorizationNo:"04-0153",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/04-0153/pil"},{id:"med-007",productId:"00-0919-02",name:"Microlax",shortName:"Microlax",price:7.12,priceWithVat:7.97,group:1,description:"Fast-acting rectal solution for constipation relief. Works within 5-20 minutes. Contains sorbitol, sodium citrate, and sodium lauryl sulfoacetate.",activeSubstance:"Sorbitolum, Natrii citras, Natrii laurilsulfoacetas",strength:"625 mg/90 mg/9 mg per ml",pharmaceuticalForm:"Rectal solution",manufacturer:"Delpharm Orleans, France",packageSize:"4 tubes (5 ml each)",storageConditions:"Store at temperature up to 25C, do not freeze",atcCode:"A06AG11",isApprovedForKids:!0,stock:30,authorizationNo:"00-0919",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/00-0919/pil"},{id:"med-008",productId:"04-0341-01",name:"Gasec Gastrocaps 10 mg",shortName:"Gasec Gastrocaps",price:3.73,priceWithVat:4.18,group:1,description:"Omeprazole gastro-resistant capsules for heartburn and acid reflux. Reduces stomach acid production for 24-hour relief.",activeSubstance:"Omeprazolum",strength:"10 mg",pharmaceuticalForm:"Gastro-resistant hard capsule",manufacturer:"Teva Pharma, S.L.U., Spain",packageSize:"14 capsules",storageConditions:"Store at temperature up to 30C, protect from moisture",atcCode:"A02BC01",isApprovedForKids:!1,stock:30,authorizationNo:"04-0341",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/04-0341/pil"},{id:"med-009",productId:"04-0060-04",name:"Lactulose-MIP 65 g/100 ml",shortName:"Lactulose-MIP",price:14.22,priceWithVat:15.93,group:1,description:"Lactulose syrup for treating constipation and hepatic encephalopathy. Gentle osmotic laxative suitable for long-term use.",activeSubstance:"Lactulosum",strength:"65 g/100 ml",pharmaceuticalForm:"Syrup",manufacturer:"Chephasaar Chem.-pharm. Fabrik GmbH, Germany",packageSize:"1000 ml bottle",storageConditions:"Store at temperature up to 25C",atcCode:"A06AD11",isApprovedForKids:!0,stock:30,authorizationNo:"04-0060",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/04-0060/pil"},{id:"med-010",productId:"01-0442-07",name:"Eucarbon herbal",shortName:"Eucarbon herbal",price:7.57,priceWithVat:8.48,group:1,description:"Herbal tablets containing senna leaf, rhubarb root extract, and activated charcoal. Natural laxative for occasional constipation relief.",activeSubstance:"Sennae folii pulvis, Rhei radicis extractum siccum, Carbo ligni pulvis",strength:"Herbal combination",pharmaceuticalForm:"Tablet",manufacturer:"F. Trenka chem.-pharm. Fabrik GmbH, Austria",packageSize:"30 tablets",storageConditions:"Protect from light, store at room temperature",atcCode:"A06AB56",isApprovedForKids:!0,stock:30,authorizationNo:"01-0442",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/01-0442/pil"},{id:"med-011",productId:"02-0350-01",name:"Aciclovir Actavis 5% cream",shortName:"Aciclovir Actavis",price:6.18,priceWithVat:6.92,group:2,description:"Antiviral cream for treating cold sores (herpes labialis). Speeds healing and reduces symptoms when applied at first sign of outbreak.",activeSubstance:"Aciclovirum",strength:"50 mg/g",pharmaceuticalForm:"Cream",manufacturer:"Balkanpharma-Razgrad AD, Bulgaria",packageSize:"5 g tube",storageConditions:"Store at temperature up to 25C",atcCode:"D06BB03",isApprovedForKids:!1,stock:30,authorizationNo:"02-0350",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/02-0350/pil"},{id:"med-012",productId:"05-0095-04",name:"Braunol 75 mg/g",shortName:"Braunol",price:19.89,priceWithVat:22.28,group:2,description:"Povidone-iodine antiseptic solution for skin disinfection. Broad-spectrum antimicrobial for wounds, burns, and pre-operative skin prep.",activeSubstance:"Povidonum iodinatum",strength:"75 mg/g",pharmaceuticalForm:"Cutaneous solution",manufacturer:"B.Braun Melsungen AG, Germany",packageSize:"1000 ml bottle",storageConditions:"No special storage conditions required",atcCode:"D08AG02",isApprovedForKids:!0,stock:30,authorizationNo:"05-0095",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/05-0095/pil"},{id:"med-013",productId:"08-0027-02",name:"Terbinafin-ratiopharm 1% cream",shortName:"Terbinafin-ratiopharm",price:8.47,priceWithVat:9.49,group:2,description:"Antifungal cream for athlete's foot, jock itch, and ringworm. Terbinafine kills fungi and prevents recurrence.",activeSubstance:"Terbinafini hydrochloridum",strength:"10 mg/g",pharmaceuticalForm:"Cream",manufacturer:"Merckle GmbH, Germany",packageSize:"15 g tube",storageConditions:"Store in original package, do not freeze",atcCode:"D01AE15",isApprovedForKids:!0,stock:30,authorizationNo:"08-0027",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/08-0027/pil"},{id:"med-014",productId:"07-0030-03",name:"Ketoconazol-ratiopharm 2% shampoo",shortName:"Ketoconazol-ratiopharm",price:16.54,priceWithVat:18.52,group:2,description:"Antifungal medicated shampoo for dandruff, seborrheic dermatitis, and scalp fungal infections. Controls flaking and itching.",activeSubstance:"Ketoconazolum",strength:"20 mg/ml",pharmaceuticalForm:"Shampoo",manufacturer:"Laboratorios Feltor S.A., Spain",packageSize:"120 ml bottle",storageConditions:"No special storage conditions required",atcCode:"D01AC08",isApprovedForKids:!1,stock:30,authorizationNo:"07-0030",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/07-0030/pil"},{id:"med-015",productId:"00-0566-01",name:"Acic 5% cream",shortName:"Acic",price:6.06,priceWithVat:6.79,group:2,description:"Aciclovir cream for cold sores and herpes simplex infections. Reduces healing time and prevents viral spread.",activeSubstance:"Aciclovirum",strength:"50 mg/g",pharmaceuticalForm:"Cream",manufacturer:"Salutas Pharma GmbH, Germany",packageSize:"2 g tube",storageConditions:"No special storage conditions required",atcCode:"D06BB03",isApprovedForKids:!1,stock:30,authorizationNo:"00-0566",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/00-0566/pil"},{id:"med-016",productId:"06-0240-01",name:"Iodine Valentis 5%",shortName:"Iodine Valentis",price:1.16,priceWithVat:1.3,group:2,description:"Iodine solution for skin disinfection and wound antisepsis. Traditional antiseptic for minor cuts and abrasions.",activeSubstance:"Iodum",strength:"50 mg/ml",pharmaceuticalForm:"Cutaneous solution",manufacturer:"UAB Valentis, Lithuania",packageSize:"10 ml glass bottle",storageConditions:"Store at temperature up to 25C, protect from light",atcCode:"D08AG03",isApprovedForKids:!0,stock:30,authorizationNo:"06-0240",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/06-0240/pil"},{id:"med-017",productId:"05-0367-01",name:"Pretniezes gel 1%",shortName:"Pretniezes",price:6.33,priceWithVat:7.09,group:2,description:"Antihistamine gel for insect bites and stings. Diphenhydramine reduces itching, swelling, and allergic skin reactions.",activeSubstance:"Diphenhydramini hydrochloridum",strength:"10 mg/g",pharmaceuticalForm:"Gel",manufacturer:"LMP, SIA, Latvia",packageSize:"30 g tube",storageConditions:"Store at temperature up to 25C, protect from light and moisture",atcCode:"D04AA32",isApprovedForKids:!0,stock:30,authorizationNo:"05-0367",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/05-0367/pil"},{id:"med-018",productId:"02-0037-01",name:"Fenivir 1% cream",shortName:"Fenivir",price:8.91,priceWithVat:9.98,group:2,description:"Penciclovir cream for cold sores. Fast-acting antiviral that shortens healing time when applied early.",activeSubstance:"Penciclovirum",strength:"10 mg/g",pharmaceuticalForm:"Cream",manufacturer:"Omega Pharma International NV, Belgium",packageSize:"2 g tube",storageConditions:"Store at temperature up to 25C, do not freeze",atcCode:"D06BB06",isApprovedForKids:!0,stock:30,authorizationNo:"02-0037",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/02-0037/pil"},{id:"med-019",productId:"12-0140-01",name:"Onytec 8% nail lacquer",shortName:"Onytec",price:26.74,priceWithVat:29.95,group:2,description:"Antifungal nail lacquer for treating mild to moderate fungal nail infections. Ciclopirox penetrates nail to kill fungi.",activeSubstance:"Ciclopiroxum",strength:"80 mg/g",pharmaceuticalForm:"Medicated nail lacquer",manufacturer:"Almirall Hermal GmbH, Germany",packageSize:"3.3 ml bottle",storageConditions:"Protect from light, do not refrigerate or freeze, keep away from heat and flame (flammable)",atcCode:"D01AE14",isApprovedForKids:!1,stock:30,authorizationNo:"12-0140",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/12-0140/pil"},{id:"med-020",productId:"00-0633-01",name:"Levomekols ointment",shortName:"Levomekols",price:6.56,priceWithVat:7.35,group:2,description:"Combination antibiotic ointment with methyluracil and chloramphenicol. Promotes wound healing and prevents infection.",activeSubstance:"Methyluracilum, Chloramphenicolum",strength:"7.5 mg/40 mg per g",pharmaceuticalForm:"Ointment",manufacturer:"Aniss SIA, Latvia",packageSize:"40 g tube",storageConditions:"Store at temperature up to 25C",atcCode:"D06C",isApprovedForKids:!0,stock:30,authorizationNo:"00-0633",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/00-0633/pil"},{id:"med-021",productId:"01-0246-02",name:"Ibuprofen JNX 400 mg",shortName:"Ibuprofen JNX",price:2.66,priceWithVat:2.98,group:3,description:"Ibuprofen tablets for pain, inflammation, and fever. NSAID effective for headaches, dental pain, muscle aches, and menstrual cramps.",activeSubstance:"Ibuprofenum",strength:"400 mg",pharmaceuticalForm:"Coated tablet",manufacturer:"G.L. Pharma GmbH, Austria",packageSize:"10 tablets",storageConditions:"Store in original package to protect from light",atcCode:"M01AE01",isApprovedForKids:!0,stock:30,authorizationNo:"01-0246",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/01-0246/pil"},{id:"med-022",productId:"08-0205-05",name:"Nurofen Forte Express 400 mg",shortName:"Nurofen Forte Express",price:7.78,priceWithVat:8.71,group:3,description:"Fast-acting ibuprofen for powerful pain relief. Targets pain, reduces inflammation, and lowers fever quickly.",activeSubstance:"Ibuprofenum",strength:"400 mg",pharmaceuticalForm:"Coated tablet",manufacturer:"Elvim, SIA, Latvia",packageSize:"24 tablets",storageConditions:"No special storage conditions required",atcCode:"M01AE01",isApprovedForKids:!0,stock:30,authorizationNo:"08-0205",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/08-0205/pil"},{id:"med-023",productId:"05-0527-01",name:"Ibuprofen-Grindeks 400 mg",shortName:"Ibuprofen-Grindeks",price:1.82,priceWithVat:2.04,group:3,description:"Affordable ibuprofen for pain and inflammation relief. Made in Latvia by Grindeks pharmaceutical company.",activeSubstance:"Ibuprofenum",strength:"400 mg",pharmaceuticalForm:"Film-coated tablet",manufacturer:'AS "Grindeks", Latvia',packageSize:"10 tablets",storageConditions:"Store at temperature up to 25C, protect from light",atcCode:"M01AE01",isApprovedForKids:!0,stock:30,authorizationNo:"05-0527",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/05-0527/pil"},{id:"med-024",productId:"00-0672-01",name:"Paracetamol SanoSwiss 500 mg",shortName:"Paracetamol SanoSwiss",price:3.53,priceWithVat:3.95,group:3,description:"Paracetamol tablets for pain and fever. Gentle on stomach, effective for mild to moderate pain and fever reduction.",activeSubstance:"Paracetamolum",strength:"500 mg",pharmaceuticalForm:"Tablet",manufacturer:"Holsten Pharma GmbH., Germany",packageSize:"20 tablets",storageConditions:"Store at temperature up to 25C",atcCode:"N02BE01",isApprovedForKids:!0,stock:30,authorizationNo:"00-0672",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/00-0672/pil"},{id:"med-025",productId:"06-0043-01",name:"Paracetamol Unifarma 500 mg",shortName:"Paracetamol Unifarma",price:2.66,priceWithVat:2.98,group:3,description:"Latvian-made paracetamol for pain relief and fever reduction. Safe and effective analgesic and antipyretic.",activeSubstance:"Paracetamolum",strength:"500 mg",pharmaceuticalForm:"Tablet",manufacturer:"SIA Unifarma, Latvia",packageSize:"20 tablets",storageConditions:"Store at temperature up to 30C",atcCode:"N02BE01",isApprovedForKids:!0,stock:30,authorizationNo:"06-0043",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/06-0043/pil"},{id:"med-026",productId:"22-0083-03",name:"Paracetamol Zentiva 500 mg",shortName:"Paracetamol Zentiva",price:3.26,priceWithVat:3.65,group:3,description:"Paracetamol tablets for pain and fever reduction. Reliable over-the-counter analgesic and antipyretic.",activeSubstance:"Paracetamolum",strength:"500 mg",pharmaceuticalForm:"Tablet",manufacturer:"Zentiva S.A., Romania",packageSize:"20 tablets",storageConditions:"No special storage conditions required",atcCode:"N02BE01",isApprovedForKids:!0,stock:30,authorizationNo:"22-0083",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/22-0083/pil"},{id:"med-027",productId:"95-0312-01",name:"Aspirin 500 mg",shortName:"Aspirin",price:4.2,priceWithVat:4.7,group:3,description:"Acetylsalicylic acid for pain, fever, and inflammation. Classic NSAID with antiplatelet properties.",activeSubstance:"Acidum acetylsalicylicum",strength:"500 mg",pharmaceuticalForm:"Tablet",manufacturer:"Bayer Bitterfeld GmbH, Germany",packageSize:"20 tablets",storageConditions:"Store at temperature up to 30C",atcCode:"N02BA01",isApprovedForKids:!0,stock:30,authorizationNo:"95-0312",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/95-0312/pil"},{id:"med-028",productId:"95-0312-03",name:"Aspirin 500 mg (100 pack)",shortName:"Aspirin 100",price:12.25,priceWithVat:13.72,group:3,description:"Acetylsalicylic acid for pain, fever, and inflammation. Economy pack with 100 tablets for regular use.",activeSubstance:"Acidum acetylsalicylicum",strength:"500 mg",pharmaceuticalForm:"Tablet",manufacturer:"Bayer Bitterfeld GmbH, Germany",packageSize:"100 tablets",storageConditions:"Store at temperature up to 30C",atcCode:"N02BA01",isApprovedForKids:!0,stock:30,authorizationNo:"95-0312",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/95-0312/pil"},{id:"med-029",productId:"I001174-01",name:"Paracetamol Sopharma 500 mg",shortName:"Paracetamol Sopharma",price:3.27,priceWithVat:3.66,group:3,description:"Bulgarian-made paracetamol for pain relief and fever reduction. Parallel import product.",activeSubstance:"Paracetamolum",strength:"500 mg",pharmaceuticalForm:"Tablet",manufacturer:"Sopharma AD, Bulgaria",packageSize:"20 tablets",storageConditions:"No special storage conditions required",atcCode:"N02BE01",isApprovedForKids:!0,stock:30,authorizationNo:"I001174",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/I001174/pil"},{id:"med-030",productId:"98-0498-01",name:"Aspirin C 400mg/240mg effervescent",shortName:"Aspirin C",price:5.53,priceWithVat:6.19,group:3,description:"Effervescent tablets combining aspirin and vitamin C. Fast-dissolving pain relief with immune support benefits.",activeSubstance:"Acidum acetylsalicylicum, Acidum ascorbicum",strength:"400 mg/240 mg",pharmaceuticalForm:"Effervescent tablet",manufacturer:"Bayer Bitterfeld GmbH, Germany",packageSize:"10 tablets",storageConditions:"Store at temperature up to 25C",atcCode:"N02BA51",isApprovedForKids:!0,stock:30,authorizationNo:"98-0498",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/98-0498/pil"},{id:"med-031",productId:"00-0515-01",name:"ACC 200 mg effervescent tablets",shortName:"ACC",price:6.18,priceWithVat:6.92,group:4,description:"Acetylcysteine effervescent tablets for mucus relief. Thins and loosens chest congestion in respiratory conditions.",activeSubstance:"Acetylcysteinum",strength:"200 mg",pharmaceuticalForm:"Effervescent tablet",manufacturer:"Salutas Pharma GmbH, Germany",packageSize:"20 tablets",storageConditions:"Store at temperature up to 25C, protect from light and moisture",atcCode:"R05CB01",isApprovedForKids:!0,stock:30,authorizationNo:"00-0515",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/00-0515/pil"},{id:"med-032",productId:"02-0348-01",name:"Loratin 10 mg",shortName:"Loratin",price:11.02,priceWithVat:12.34,group:4,description:"Loratadine antihistamine for allergies. Non-drowsy relief from hay fever, hives, and allergic reactions.",activeSubstance:"Loratadinum",strength:"10 mg",pharmaceuticalForm:"Tablet",manufacturer:"Salutas Pharma GmbH, Germany",packageSize:"30 tablets",storageConditions:"No special storage conditions required",atcCode:"R06AX13",isApprovedForKids:!0,stock:30,authorizationNo:"02-0348",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/02-0348/pil"},{id:"med-033",productId:"04-0416-02",name:"Strepsils Intensive 8.75 mg",shortName:"Strepsils Intensive",price:11.12,priceWithVat:12.45,group:4,description:"Flurbiprofen lozenges for severe sore throat pain. Fast-acting anti-inflammatory throat relief that lasts up to 4 hours.",activeSubstance:"Flurbiprofenum",strength:"8.75 mg",pharmaceuticalForm:"Lozenge",manufacturer:"RB NL Brands B.V., Netherlands",packageSize:"24 lozenges",storageConditions:"Store in original package",atcCode:"R02AX01",isApprovedForKids:!0,stock:30,authorizationNo:"04-0416",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/04-0416/pil"},{id:"med-034",productId:"06-0023-01",name:"Olynth HA 0.1% nasal spray",shortName:"Olynth HA",price:6.59,priceWithVat:7.38,group:4,description:"Xylometazoline nasal spray without preservatives. Fast nasal decongestion for colds and allergies, with hyaluronic acid for moisture.",activeSubstance:"Xylometazolini hydrochloridum",strength:"1 mg/ml",pharmaceuticalForm:"Nasal spray solution",manufacturer:"Ursapharm Arzneimittel GmbH, Germany",packageSize:"10 ml bottle",storageConditions:"Store at temperature up to 25C",atcCode:"R01AA07",isApprovedForKids:!0,stock:30,authorizationNo:"06-0023",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/06-0023/pil"},{id:"med-035",productId:"10-0577-03",name:"Cetrix 10 mg",shortName:"Cetrix",price:4.62,priceWithVat:5.17,group:4,description:"Cetirizine antihistamine for allergy relief. Effective for seasonal allergies, pet allergies, and chronic urticaria.",activeSubstance:"Cetirizini dihydrochloridum",strength:"10 mg",pharmaceuticalForm:"Film-coated tablet",manufacturer:"Vitabalans Oy, Finland",packageSize:"7 tablets",storageConditions:"Store at temperature up to 30C",atcCode:"R06AE07",isApprovedForKids:!0,stock:30,authorizationNo:"10-0577",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/10-0577/pil"},{id:"med-036",productId:"03-0294-01",name:"Cetirizin Actavis 10 mg",shortName:"Cetirizin Actavis",price:5.38,priceWithVat:6.03,group:4,description:"Cetirizine allergy tablets for 24-hour relief. Non-drowsy formula for hay fever and year-round allergies.",activeSubstance:"Cetirizini dihydrochloridum",strength:"10 mg",pharmaceuticalForm:"Film-coated tablet",manufacturer:"Teva Pharma, S.L.U., Spain",packageSize:"10 tablets",storageConditions:"Store at temperature up to 25C, protect from moisture",atcCode:"R06AE07",isApprovedForKids:!0,stock:30,authorizationNo:"03-0294",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/03-0294/pil"},{id:"med-037",productId:"05-0159-01",name:"Ambroxol-BCPP 30 mg",shortName:"Ambroxol-BCPP",price:3.03,priceWithVat:3.39,group:4,description:"Ambroxol expectorant tablets for productive cough. Helps clear mucus from airways in bronchitis and respiratory infections.",activeSubstance:"Ambroxoli hydrochloridum",strength:"30 mg",pharmaceuticalForm:"Tablet",manufacturer:"Unifarma, SIA, Latvia",packageSize:"20 tablets",storageConditions:"No special storage conditions required",atcCode:"R05CB06",isApprovedForKids:!0,stock:30,authorizationNo:"05-0159",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/05-0159/pil"},{id:"med-038",productId:"04-0226-01",name:"Loracip 10 mg",shortName:"Loracip",price:2.45,priceWithVat:2.74,group:4,description:"Affordable loratadine for allergy symptoms. Budget-friendly antihistamine for runny nose, sneezing, and itchy eyes.",activeSubstance:"Loratadinum",strength:"10 mg",pharmaceuticalForm:"Tablet",manufacturer:"Unifarma, SIA, Latvia",packageSize:"10 tablets",storageConditions:"No special storage conditions required",atcCode:"R06AX13",isApprovedForKids:!0,stock:30,authorizationNo:"04-0226",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/04-0226/pil"},{id:"med-039",productId:"03-0428-01",name:"Galazolin 0.1% nasal drops",shortName:"Galazolin",price:2.46,priceWithVat:2.76,group:4,description:"Xylometazoline nasal drops for congestion. Provides quick relief from nasal blockage due to colds or allergies.",activeSubstance:"Xylometazolini hydrochloridum",strength:"1 mg/ml",pharmaceuticalForm:"Nasal drops solution",manufacturer:"Warszawskie Zaklady Farmaceutyczne Polfa S.A., Poland",packageSize:"10 ml bottle",storageConditions:"Store at temperature up to 25C, protect from light",atcCode:"R01AA07",isApprovedForKids:!0,stock:30,authorizationNo:"03-0428",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/03-0428/pil"},{id:"med-040",productId:"01-0048-01",name:"Stoptussin 4mg/100mg",shortName:"Stoptussin",price:7.49,priceWithVat:8.39,group:4,description:"Combination cough medicine with butamirate and guaifenesin. Suppresses dry cough while loosening mucus.",activeSubstance:"Butamirati dihydrogenocitras, Guaifenesinum",strength:"4 mg/100 mg",pharmaceuticalForm:"Tablet",manufacturer:"TEVA Czech Industries s.r.o., Czech Republic",packageSize:"20 tablets",storageConditions:"Store at temperature up to 25C, protect from moisture",atcCode:"R05FB02",isApprovedForKids:!0,stock:30,authorizationNo:"01-0048",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/01-0048/pil"},{id:"med-041",productId:"10-0476-03",name:"Nurofen for Children Orange 100ml",shortName:"Nurofen Orange 100ml",price:10.78,priceWithVat:12.07,group:5,description:"Children's ibuprofen oral suspension with orange flavor. Reduces fever and relieves pain in children aged 3 months to 12 years.",activeSubstance:"Ibuprofenum",strength:"200 mg/5 ml",pharmaceuticalForm:"Oral suspension",manufacturer:"Elvim, SIA, Latvia",packageSize:"100 ml bottle",storageConditions:"Store at temperature up to 25C",atcCode:"M01AE01",isApprovedForKids:!0,stock:30,authorizationNo:"10-0476",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/10-0476/pil"},{id:"med-042",productId:"01-0246-04",name:"Ibuprofen JNX 400 mg (100 pack)",shortName:"Ibuprofen JNX 100",price:9.8,priceWithVat:10.98,group:5,description:"Economy pack ibuprofen tablets. Large quantity for regular use or families.",activeSubstance:"Ibuprofenum",strength:"400 mg",pharmaceuticalForm:"Coated tablet",manufacturer:"G.L. Pharma GmbH, Austria",packageSize:"100 tablets",storageConditions:"Store in original package to protect from light",atcCode:"M01AE01",isApprovedForKids:!0,stock:30,authorizationNo:"01-0246",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/01-0246/pil"},{id:"med-043",productId:"10-0477-03",name:"Nurofen for Children Strawberry 100ml",shortName:"Nurofen Strawberry 100ml",price:10.78,priceWithVat:12.07,group:5,description:"Children's ibuprofen suspension with strawberry flavor. Gentle pain and fever relief for kids with pleasant taste.",activeSubstance:"Ibuprofenum",strength:"200 mg/5 ml",pharmaceuticalForm:"Oral suspension",manufacturer:"Elvim, SIA, Latvia",packageSize:"100 ml bottle",storageConditions:"Store at temperature up to 25C",atcCode:"M01AE01",isApprovedForKids:!0,stock:30,authorizationNo:"10-0477",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/10-0477/pil"},{id:"med-044",productId:"22-0033-04",name:"Ibuprofenum US Pharmacia 400 mg",shortName:"Ibuprofenum US",price:2.99,priceWithVat:3.35,group:5,description:"Budget-friendly ibuprofen tablets for pain and fever. Affordable generic medicine for families.",activeSubstance:"Ibuprofenum",strength:"400 mg",pharmaceuticalForm:"Film-coated tablet",manufacturer:"US Pharmacia Sp. z o.o., Poland",packageSize:"12 tablets",storageConditions:"No special storage conditions required",atcCode:"M01AE01",isApprovedForKids:!0,stock:30,authorizationNo:"22-0033",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/22-0033/pil"},{id:"med-045",productId:"I001476-01",name:"Nurofen with orange flavor 100ml",shortName:"Nurofen Orange PI",price:9.85,priceWithVat:11.03,group:5,description:"Parallel import children's ibuprofen with orange flavor. German product with Latvia distribution.",activeSubstance:"Ibuprofenum",strength:"200 mg/5 ml",pharmaceuticalForm:"Oral suspension",manufacturer:"RB NL Brands B.V., Netherlands",packageSize:"100 ml bottle",storageConditions:"Store at temperature up to 25C",atcCode:"M01AE01",isApprovedForKids:!0,stock:30,authorizationNo:"I001476",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/I001476/pil"},{id:"med-046",productId:"10-0476-04",name:"Nurofen for Children Orange 150ml",shortName:"Nurofen Orange 150ml",price:13.54,priceWithVat:15.16,group:5,description:"Larger bottle of children's ibuprofen suspension. Extended supply for families with multiple children.",activeSubstance:"Ibuprofenum",strength:"200 mg/5 ml",pharmaceuticalForm:"Oral suspension",manufacturer:"Elvim, SIA, Latvia",packageSize:"150 ml bottle",storageConditions:"Store at temperature up to 25C",atcCode:"M01AE01",isApprovedForKids:!0,stock:30,authorizationNo:"10-0476",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/10-0476/pil"},{id:"med-047",productId:"13-0110-01",name:"Ibuprofen Inteli 100 mg/5 ml suspension",shortName:"Ibuprofen Inteli",price:6.88,priceWithVat:7.71,group:5,description:"Affordable children's ibuprofen suspension. Budget-friendly pain and fever relief for kids.",activeSubstance:"Ibuprofenum",strength:"20 mg/ml",pharmaceuticalForm:"Oral suspension",manufacturer:"LABORATORIO ALDO-UNION, S.L., Spain",packageSize:"200 ml bottle",storageConditions:"Do not refrigerate or freeze",atcCode:"M01AE01",isApprovedForKids:!0,stock:30,authorizationNo:"13-0110",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/13-0110/pil"},{id:"med-048",productId:"97-0064-01",name:"Paracetamol-ratiopharm 250 mg suppositories",shortName:"Paracetamol suppository 250mg",price:5.74,priceWithVat:6.43,group:5,description:"Paracetamol suppositories for children. Alternative route for fever and pain relief when oral administration is not possible.",activeSubstance:"Paracetamolum",strength:"250 mg",pharmaceuticalForm:"Suppository",manufacturer:"Merckle GmbH, Germany",packageSize:"10 suppositories",storageConditions:"Store at temperature up to 25C",atcCode:"N02BE01",isApprovedForKids:!0,stock:30,authorizationNo:"97-0064",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/97-0064/pil"},{id:"med-049",productId:"97-0063-01",name:"Paracetamol-ratiopharm 125 mg suppositories",shortName:"Paracetamol suppository 125mg",price:4.81,priceWithVat:5.39,group:5,description:"Lower dose paracetamol suppositories for infants and young children. Gentle fever and pain relief.",activeSubstance:"Paracetamolum",strength:"125 mg",pharmaceuticalForm:"Suppository",manufacturer:"Merckle GmbH, Germany",packageSize:"10 suppositories",storageConditions:"Store at temperature up to 25C",atcCode:"N02BE01",isApprovedForKids:!0,stock:30,authorizationNo:"97-0063",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/97-0063/pil"},{id:"med-050",productId:"10-0661-01",name:"Paracetamol Sopharma 500 mg (alt)",shortName:"Paracetamol Sopharma alt",price:3.43,priceWithVat:3.84,group:5,description:"Paracetamol tablets suitable for older children and adults. Nationally registered Bulgarian product.",activeSubstance:"Paracetamolum",strength:"500 mg",pharmaceuticalForm:"Tablet",manufacturer:"Sopharma AD, Bulgaria",packageSize:"20 tablets",storageConditions:"No special storage conditions required",atcCode:"N02BE01",isApprovedForKids:!0,stock:30,authorizationNo:"10-0661",packageLeafletUrl:"https://dati.zva.gov.lv/zalu-registrs/info/10-0661/pil"}],Zr=[{id:"VM-001",name:"Riga Central Station",region:"Riga",city:"Riga",address:"Stacijas laukums 2",latitude:56.9467,longitude:24.1214,status:"active",lastMaintenance:new Date("2025-11-20"),inventory:[]},{id:"VM-002",name:"Origo Shopping Mall",region:"Riga",city:"Riga",address:"Stacijas laukums 2",latitude:56.9485,longitude:24.1198,status:"active",lastMaintenance:new Date("2025-11-19"),inventory:[]},{id:"VM-003",name:"Riga Airport",region:"Riga",city:"Riga",address:"Marupe, Riga LV-1053",latitude:56.9237,longitude:23.9711,status:"active",lastMaintenance:new Date("2025-11-22"),inventory:[]},{id:"VM-004",name:"Galerija Centrs",region:"Riga",city:"Riga",address:"Audju iela 16",latitude:56.9496,longitude:24.1134,status:"active",lastMaintenance:new Date("2025-11-21"),inventory:[]},{id:"VM-005",name:"Riga Plaza",region:"Riga",city:"Riga",address:"Mkusalas iela 71",latitude:56.933,longitude:24.0799,status:"active",lastMaintenance:new Date("2025-11-18"),inventory:[]},{id:"VM-006",name:"Alfa Shopping Centre",region:"Riga",city:"Riga",address:"Brvbas gatve 372",latitude:56.9872,longitude:24.1783,status:"active",lastMaintenance:new Date("2025-11-20"),inventory:[]},{id:"VM-007",name:"Old Town Tourist Center",region:"Riga",city:"Riga",address:"Rtslaukums 6",latitude:56.9488,longitude:24.1052,status:"active",lastMaintenance:new Date("2025-11-19"),inventory:[]},{id:"VM-008",name:"Riga University Hospital",region:"Riga",city:"Riga",address:"Pilsou iela 13",latitude:56.9577,longitude:24.1138,status:"active",lastMaintenance:new Date("2025-11-22"),inventory:[]},{id:"VM-009",name:"Daugavpils Central",region:"Latgale",city:"Daugavpils",address:"Rgas iela 22A",latitude:55.8744,longitude:26.5362,status:"active",lastMaintenance:new Date("2025-11-17"),inventory:[]},{id:"VM-010",name:"Daugavpils Train Station",region:"Latgale",city:"Daugavpils",address:"Stacijas iela 45",latitude:55.8812,longitude:26.5195,status:"active",lastMaintenance:new Date("2025-11-18"),inventory:[]},{id:"VM-011",name:"Liepaja Beach Mall",region:"Kurzeme",city:"Liepaja",address:"Jrmalas iela 12",latitude:56.5148,longitude:21.0221,status:"active",lastMaintenance:new Date("2025-11-20"),inventory:[]},{id:"VM-012",name:"Liepaja Port",region:"Kurzeme",city:"Liepaja",address:"Vec ostmala 33",latitude:56.5046,longitude:21.0109,status:"active",lastMaintenance:new Date("2025-11-19"),inventory:[]},{id:"VM-013",name:"Jelgava Palace Area",region:"Zemgale",city:"Jelgava",address:"Liel iela 2",latitude:56.6509,longitude:23.731,status:"active",lastMaintenance:new Date("2025-11-21"),inventory:[]},{id:"VM-014",name:"Jelgava Bus Station",region:"Zemgale",city:"Jelgava",address:"Pasta iela 47",latitude:56.6467,longitude:23.7226,status:"active",lastMaintenance:new Date("2025-11-20"),inventory:[]},{id:"VM-015",name:"Jurmala Beach Resort",region:"Riga Region",city:"Jurmala",address:"Jomas iela 47/49",latitude:56.9481,longitude:23.6196,status:"active",lastMaintenance:new Date("2025-11-22"),inventory:[]},{id:"VM-016",name:"Jurmala Dzintari",region:"Riga Region",city:"Jurmala",address:"Turaidas iela 1",latitude:56.9735,longitude:23.7703,status:"active",lastMaintenance:new Date("2025-11-18"),inventory:[]},{id:"VM-017",name:"Ventspils Harbor",region:"Kurzeme",city:"Ventspils",address:"Ostasprojects 13",latitude:57.3947,longitude:21.5644,status:"active",lastMaintenance:new Date("2025-11-19"),inventory:[]},{id:"VM-018",name:"Rezekne Shopping Center",region:"Latgale",city:"Rezekne",address:"Atbrvoanas aleja 93",latitude:56.509,longitude:27.333,status:"active",lastMaintenance:new Date("2025-11-20"),inventory:[]},{id:"VM-019",name:"Valmiera Town Center",region:"Vidzeme",city:"Valmiera",address:"Rgas iela 18",latitude:57.5378,longitude:25.426,status:"active",lastMaintenance:new Date("2025-11-17"),inventory:[]},{id:"VM-020",name:"Cesis Castle Area",region:"Vidzeme",city:"Cesis",address:"Pils laukums 9",latitude:57.3119,longitude:25.2706,status:"active",lastMaintenance:new Date("2025-11-21"),inventory:[]},{id:"VM-021",name:"Sigulda Tourist Center",region:"Vidzeme",city:"Sigulda",address:"Auseka iela 6",latitude:57.1544,longitude:24.8537,status:"active",lastMaintenance:new Date("2025-11-19"),inventory:[]},{id:"VM-022",name:"Ogre Train Station",region:"Riga Region",city:"Ogre",address:"Stacijas iela 1",latitude:56.8162,longitude:24.6042,status:"active",lastMaintenance:new Date("2025-11-22"),inventory:[]},{id:"VM-023",name:"Tukums Market Square",region:"Zemgale",city:"Tukums",address:"Talsu iela 2",latitude:56.9674,longitude:23.1556,status:"active",lastMaintenance:new Date("2025-11-20"),inventory:[]},{id:"VM-024",name:"Bauska Shopping Area",region:"Zemgale",city:"Bauska",address:"Uzvaras iela 1",latitude:56.4085,longitude:24.1922,status:"active",lastMaintenance:new Date("2025-11-18"),inventory:[]},{id:"VM-025",name:"Kuldiga Tourist Info",region:"Kurzeme",city:"Kuldiga",address:"Bazncas iela 5",latitude:56.9684,longitude:21.9662,status:"active",lastMaintenance:new Date("2025-11-19"),inventory:[]},{id:"VM-026",name:"Talsi Town Hall",region:"Kurzeme",city:"Talsi",address:"Kareivju iela 7",latitude:57.2447,longitude:22.5881,status:"active",lastMaintenance:new Date("2025-11-21"),inventory:[]},{id:"VM-027",name:"Ludza Border Crossing",region:"Latgale",city:"Ludza",address:"Liel iela 16",latitude:56.5463,longitude:27.7174,status:"active",lastMaintenance:new Date("2025-11-17"),inventory:[]},{id:"VM-028",name:"Kraslava Medical Center",region:"Latgale",city:"Kraslava",address:"Rgas iela 4",latitude:55.8945,longitude:27.1673,status:"active",lastMaintenance:new Date("2025-11-20"),inventory:[]},{id:"VM-029",name:"Madona Central",region:"Vidzeme",city:"Madona",address:"Saieta laukums 1",latitude:56.8539,longitude:26.2172,status:"active",lastMaintenance:new Date("2025-11-18"),inventory:[]},{id:"VM-030",name:"Gulbene Train Museum",region:"Vidzeme",city:"Gulbene",address:"Stacijas iela 1",latitude:57.177,longitude:26.7523,status:"active",lastMaintenance:new Date("2025-11-22"),inventory:[]},{id:"VM-031",name:"Aluksne Lake Area",region:"Vidzeme",city:"Aluksne",address:"Drza iela 3",latitude:57.4236,longitude:27.0467,status:"active",lastMaintenance:new Date("2025-11-19"),inventory:[]},{id:"VM-032",name:"Limbazi Town Center",region:"Vidzeme",city:"Limbazi",address:"Burtnieku iela 4",latitude:57.513,longitude:24.7147,status:"active",lastMaintenance:new Date("2025-11-20"),inventory:[]},{id:"VM-033",name:"Salaspils Medical",region:"Riga Region",city:"Salaspils",address:"Lazdu iela 4",latitude:56.8605,longitude:24.35,status:"active",lastMaintenance:new Date("2025-11-21"),inventory:[]},{id:"VM-034",name:"Olaine Industrial Park",region:"Riga Region",city:"Olaine",address:"Rpniecbas iela 2",latitude:56.7856,longitude:23.9383,status:"active",lastMaintenance:new Date("2025-11-17"),inventory:[]},{id:"VM-035",name:"Saldus Shopping Mall",region:"Kurzeme",city:"Saldus",address:"Striu iela 2a",latitude:56.6639,longitude:22.4908,status:"active",lastMaintenance:new Date("2025-11-22"),inventory:[]},{id:"VM-036",name:"Dobele Market",region:"Zemgale",city:"Dobele",address:"Tirgus laukums 1",latitude:56.6259,longitude:23.283,status:"active",lastMaintenance:new Date("2025-11-18"),inventory:[]},{id:"VM-037",name:"Aizkraukle Riverside",region:"Vidzeme",city:"Aizkraukle",address:"Gaismas iela 35",latitude:56.6044,longitude:25.2553,status:"active",lastMaintenance:new Date("2025-11-19"),inventory:[]},{id:"VM-038",name:"Preili Town Square",region:"Latgale",city:"Preili",address:"Rgas iela 38",latitude:56.2947,longitude:26.7253,status:"active",lastMaintenance:new Date("2025-11-20"),inventory:[]},{id:"VM-039",name:"Livani Cultural Center",region:"Latgale",city:"Livani",address:"Rgas iela 77",latitude:56.3544,longitude:26.1764,status:"active",lastMaintenance:new Date("2025-11-21"),inventory:[]},{id:"VM-040",name:"Balvi Medical Clinic",region:"Latgale",city:"Balvi",address:"Brzpils iela 1a",latitude:57.131,longitude:27.2644,status:"active",lastMaintenance:new Date("2025-11-18"),inventory:[]},{id:"VM-041",name:"Smiltene Castle",region:"Vidzeme",city:"Smiltene",address:"Pils iela 3",latitude:57.4243,longitude:25.9021,status:"active",lastMaintenance:new Date("2025-11-22"),inventory:[]},{id:"VM-042",name:"Valka Border Station",region:"Vidzeme",city:"Valka",address:"Rgas iela 24",latitude:57.7772,longitude:26.0162,status:"active",lastMaintenance:new Date("2025-11-17"),inventory:[]},{id:"VM-043",name:"Auce Community Center",region:"Zemgale",city:"Auce",address:"Jelgavas iela 25",latitude:56.4589,longitude:22.9017,status:"active",lastMaintenance:new Date("2025-11-19"),inventory:[]},{id:"VM-044",name:"Jaunjelgava Port",region:"Zemgale",city:"Jaunjelgava",address:"Pasta iela 2",latitude:56.6108,longitude:25.0861,status:"active",lastMaintenance:new Date("2025-11-20"),inventory:[]},{id:"VM-045",name:"Pavilosta Beach",region:"Kurzeme",city:"Pavilosta",address:"Dzintaru iela 32",latitude:56.8856,longitude:21.1869,status:"maintenance",lastMaintenance:new Date("2025-11-15"),inventory:[]},{id:"VM-046",name:"Aizpute Town Hall",region:"Kurzeme",city:"Aizpute",address:"Skolas iela 2",latitude:56.7219,longitude:21.6006,status:"active",lastMaintenance:new Date("2025-11-21"),inventory:[]},{id:"VM-047",name:"Vilani Shopping",region:"Latgale",city:"Vilani",address:"Rzeknes iela 1A",latitude:56.5526,longitude:26.9262,status:"active",lastMaintenance:new Date("2025-11-18"),inventory:[]},{id:"VM-048",name:"Ape Medical Center",region:"Vidzeme",city:"Ape",address:"Stacijas iela 2",latitude:57.5394,longitude:26.6944,status:"active",lastMaintenance:new Date("2025-11-22"),inventory:[]},{id:"VM-049",name:"Roja Port Area",region:"Kurzeme",city:"Roja",address:"Selgas iela 2",latitude:57.5053,longitude:22.8011,status:"active",lastMaintenance:new Date("2025-11-19"),inventory:[]},{id:"VM-050",name:"Kandava Old Town",region:"Kurzeme",city:"Kandava",address:"Rtslaukums 1",latitude:57.0336,longitude:22.7764,status:"active",lastMaintenance:new Date("2025-11-20"),inventory:[]}],Jb=[{id:"RX-001",patientName:"John Doe",doctorName:"Dr. Smith",date:new Date("2025-11-22"),medications:[{medicineId:"MED-001",medicineName:"Ibuprofen",dosage:"400mg",frequency:"3 times daily",duration:"7 days"}],status:"fulfilled",vendingMachineId:"VM-001",fulfillmentDate:new Date("2025-11-22")},{id:"RX-002",patientName:"Jane Smith",doctorName:"Dr. Johnson",date:new Date("2025-11-21"),medications:[{medicineId:"MED-015",medicineName:"Cetirizine",dosage:"10mg",frequency:"Once daily",duration:"14 days"}],status:"pending"},{id:"RX-003",patientName:"Mike Wilson",doctorName:"Dr. Brown",date:new Date("2025-11-20"),medications:[{medicineId:"MED-008",medicineName:"Paracetamol",dosage:"500mg",frequency:"Every 6 hours",duration:"5 days"}],status:"fulfilled",vendingMachineId:"VM-003",fulfillmentDate:new Date("2025-11-21")}],k5=(t,e)=>{if(t.length!==e.length)return 1/0;let n=0;for(let r=0;r<t.length;r++)n+=Math.pow(t[r]-e[r],2);return Math.sqrt(n)},_5=.65,Yf=24*60*60*1e3,Rh=By()(Vy((t,e)=>({userRecords:[],currentUserFaceDescriptor:null,currentUserId:null,blockedCategories:[],addUserRecord:n=>{const r=`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={id:r,faceDescriptor:n,purchaseHistory:[],lastPurchaseDate:Date.now()};return t(o=>({userRecords:[...o.userRecords,i]})),r},findMatchingUser:n=>{const{userRecords:r}=e();let i=null,o=1/0;for(const a of r){const s=k5(n,a.faceDescriptor);s<_5&&s<o&&(i=a,o=s)}return i},setCurrentUser:(n,r)=>{const i=e().getBlockedCategories(n);t({currentUserId:n,currentUserFaceDescriptor:r,blockedCategories:i})},addPurchaseRecord:(n,r,i)=>{t(a=>({userRecords:a.userRecords.map(s=>s.id===n?{...s,purchaseHistory:[...s.purchaseHistory,{categoryId:r,purchaseDate:Date.now(),medicines:i}],lastPurchaseDate:Date.now()}:s)}));const o=e().getBlockedCategories(n);t({blockedCategories:o})},getBlockedCategories:n=>{const{userRecords:r}=e(),i=r.find(s=>s.id===n);if(!i)return[];const o=Date.now(),a=[];for(const s of i.purchaseHistory)o-s.purchaseDate<Yf&&(a.includes(s.categoryId)||a.push(s.categoryId));return a},checkCategoryAvailable:(n,r)=>!e().getBlockedCategories(n).includes(r),clearCurrentUser:()=>{t({currentUserId:null,currentUserFaceDescriptor:null,blockedCategories:[]})},cleanupExpiredData:()=>{const n=Date.now();t(r=>({userRecords:r.userRecords.map(i=>({...i,purchaseHistory:i.purchaseHistory.filter(o=>n-o.purchaseDate<Yf)})).filter(i=>i.purchaseHistory.length>0||n-i.lastPurchaseDate<Yf)}))}}),{name:"face-recognition-storage"})),yr=By()(Vy((t,e)=>({isAgeVerified:!1,isAdmin:!1,selectedMedicines:[],recommendedMedicines:[],inventory:[],allMachinesInventory:[],transactions:[],verificationMethod:null,vendingMachineId:"VM-001",setAgeVerified:n=>t({isAgeVerified:n}),setAdmin:n=>t({isAdmin:n}),toggleMedicine:n=>t(r=>{var a;const i=tn.find(s=>s.id===n);return i?r.selectedMedicines.includes(n)?{selectedMedicines:r.selectedMedicines.filter(s=>s!==n)}:(((a=r.inventory.find(l=>l.medicineId===n))==null?void 0:a.stock)||0)<=0?r:r.selectedMedicines.find(l=>{const c=tn.find(d=>d.id===l);return(c==null?void 0:c.group)===i.group})?{selectedMedicines:r.selectedMedicines.filter(l=>{const c=tn.find(d=>d.id===l);return(c==null?void 0:c.group)!==i.group}).concat(n)}:r.selectedMedicines.length>=5?r:{selectedMedicines:[...r.selectedMedicines,n]}:r}),addRecommendedMedicines:n=>t(r=>({recommendedMedicines:n,selectedMedicines:[...new Set([...r.selectedMedicines,...n])]})),clearCart:()=>t({selectedMedicines:[],recommendedMedicines:[]}),setVerificationMethod:n=>t({verificationMethod:n}),initializeInventory:()=>{if(e().inventory.length===0){const r=tn.map(i=>({medicineId:i.id,stock:30,lastRestocked:new Date}));t({inventory:r})}},updateStock:(n,r)=>t(i=>({inventory:i.inventory.map(o=>o.medicineId===n?{...o,stock:Math.max(0,o.stock+r)}:o)})),restockProduct:(n,r)=>t(i=>({inventory:i.inventory.map(o=>o.medicineId===n?{...o,stock:r,lastRestocked:new Date}:o)})),addTransaction:n=>{t(o=>({transactions:[n,...o.transactions]}));const{currentUserId:r,addPurchaseRecord:i}=Rh.getState();if(r){const o=new Map;n.medicines.forEach(a=>{const s=tn.find(u=>u.id===a.id);if(s){const u=s.group,l=o.get(u)||[];l.push(a.id),o.set(u,l)}}),o.forEach((a,s)=>{i(r,s,a)})}},getStock:n=>{const r=e().inventory.find(i=>i.medicineId===n);return(r==null?void 0:r.stock)||0},processPurchase:n=>{var o;const r=e(),i=n.reduce((a,s)=>(a[s]=(a[s]||0)+1,a),{});for(const[a,s]of Object.entries(i))if((((o=r.inventory.find(l=>l.medicineId===a))==null?void 0:o.stock)||0)<s)return!1;for(const[a,s]of Object.entries(i))e().updateStock(a,-s);return!0},initializeAllMachinesInventory:()=>{if(e().allMachinesInventory.length===0){const r=Zr.map(i=>({vendingMachineId:i.id,inventory:tn.map(o=>({medicineId:o.id,stock:Math.floor(Math.random()*40),lastRestocked:new Date(Date.now()-Math.random()*10*24*60*60*1e3)}))}));t({allMachinesInventory:r})}},updateMachineStock:(n,r,i)=>t(o=>({allMachinesInventory:o.allMachinesInventory.map(a=>a.vendingMachineId===n?{...a,inventory:a.inventory.map(s=>s.medicineId===r?{...s,stock:Math.max(0,s.stock+i)}:s)}:a)})),restockMachineProduct:(n,r,i)=>t(o=>({allMachinesInventory:o.allMachinesInventory.map(a=>a.vendingMachineId===n?{...a,inventory:a.inventory.map(s=>s.medicineId===r?{...s,stock:i,lastRestocked:new Date}:s)}:a)})),getMachineStock:(n,r)=>{const i=e().allMachinesInventory.find(a=>a.vendingMachineId===n),o=i==null?void 0:i.inventory.find(a=>a.medicineId===r);return(o==null?void 0:o.stock)||0},getMachineInventory:n=>{const r=e().allMachinesInventory.find(i=>i.vendingMachineId===n);return(r==null?void 0:r.inventory)||[]},getAllMachinesTransactions:()=>e().transactions}),{name:"vending-machine-storage",partialize:t=>({inventory:t.inventory,allMachinesInventory:t.allMachinesInventory,transactions:t.transactions,vendingMachineId:t.vendingMachineId})}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var cE=function(t,e){return(cE=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])})(t,e)};function xr(t,e){function n(){this.constructor=t}cE(t,e),t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function ne(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(l){try{u(r.next(l))}catch(c){o(c)}}function s(l){try{u(r.throw(l))}catch(c){o(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(a,s)}u((r=r.apply(t,[])).next())})}function re(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(l){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(c[0]===6&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(d){c=[6,d],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var S5=function(){function t(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(e,n){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+n+"."),this.platformName=e,this.platform=n},t.prototype.registerFlag=function(e,n,r){if(this.flagRegistry[e]={evaluationFn:n,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},t.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},t.prototype.getNumber=function(e){return this.get(e)},t.prototype.getBool=function(e){return this.get(e)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(e,n){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)},t.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},t.prototype.setFlags=function(e){this.flags=Object.assign({},e)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var n,r,i=(n=this.global.location.search,r={},n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return C5(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var a=o.split(":"),s=a[0],u=a[1];e.urlFlags[s]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(s,u)})}},t}();function C5(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function G(){return dE}var dE=null,Nd=new Map,ig=new Map;function hE(t,e){var n=pE(t,e);return Nd.get(n)}function E5(t){return ig.get(t)}function Qb(t){for(var e=Nd.entries(),n=[];;){var r=e.next(),i=r.done,o=r.value;if(i)break;var a=o[0],s=o[1];a.split("_")[0]===t&&n.push(s)}return n}function fE(t){var e=t.kernelName,n=t.backendName,r=pE(e,n);if(Nd.has(r))throw new Error("The kernel '"+e+"' for backend '"+n+"' is already registered");Nd.set(r,t)}function A5(t){var e=t.kernelName;ig.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),ig.set(e,t)}function pE(t,e){return e+"_"+t}function og(t,e,n){return Math.max(t,Math.min(e,n))}function mE(t){return t%2==0?t:t+1}function R5(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function T(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Oe(t,e,n){n===void 0&&(n=""),T(It(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})}function Is(t){T(t!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function ms(t,e,n){if(e===void 0&&(e=[]),n===void 0&&(n=!1),e==null&&(e=[]),Array.isArray(t)||Lr(t)&&!n)for(var r=0;r<t.length;++r)ms(t[r],e,n);else e.push(t);return e}function oe(t){if(t.length===0)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function It(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function pt(t){return t%1==0}function N5(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function ag(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Ja(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function Zb(t,e,n){return e===void 0&&(e=function(r){return 0}),new Promise(function(r,i){var o=0,a=function(){if(t())r();else{o++;var s=e(o);n!=null&&o>=n?i():setTimeout(a,s)}};a()})}function T5(t,e){for(var n=1,r=-1,i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(t[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(t[i]<0)throw Error("Shapes can not be < 0. Found "+t[i]+" at dim "+i);if(r===-1){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(n===0)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var o=t.slice();return o[r]=e/n,o}function Rt(t,e){var n=e.length;return T((t=t==null?e.map(function(r,i){return i}):[].concat(t)).every(function(r){return r>=-n&&r<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t}),T(t.every(function(r){return pt(r)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(r){return r<0?n+r:r})}function So(t,e){for(var n=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||i?null:Rt(e,t).sort(),a=0,s=0;s<t.length;++s){if(o!=null){if(o[a]===s&&t[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+t[s]+"' is not 1");(o[a]==null||o[a]>s)&&t[s]===1&&(n.push(t[s]),r.push(s)),o[a]<=s&&a++}t[s]!==1&&(n.push(t[s]),r.push(s))}return{newShape:n,keptDims:r}}function nl(t,e){var n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else{if(t!=="bool")throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function Td(t,e){var n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else{if(t!=="string")throw new Error("Unknown data type "+t);n=new Array(e)}return n}function P5(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function I5(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function D5(t,e){return e!=="complex64"&&(e!=="float32"||t==="complex64")&&(e!=="int32"||t==="float32"||t==="complex64")&&(e!=="bool"||t!=="bool")}function Lr(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function gE(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error("Unknown dtype "+t)}function M5(t){if(t==null)return 0;var e=0;return t.forEach(function(n){return e+=n.length}),e}function zy(t){return typeof t=="string"||t instanceof String}function O5(t){return typeof t=="boolean"}function j5(t){return typeof t=="number"}function _l(t){return Array.isArray(t)?_l(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":j5(t)?"float32":zy(t)?"string":O5(t)?"bool":"float32"}function sg(t){return!!(t&&t.constructor&&t.call&&t.apply)}function ug(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function Br(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function vE(t,e,n){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=ms(t)),n&&P5(t,e),function(o,a){return o instanceof Float32Array&&a==="float32"||o instanceof Int32Array&&a==="int32"||o instanceof Uint8Array&&a==="bool"}(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){for(var r=new Uint8Array(t.length),i=0;i<r.length;++i)Math.round(t[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function e1(t,e){if(t.length===0)return e[0];var n=t.reduce(function(r,i){return r*i});if(n===0)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function r(i,o,a){var s=new Array;if(o.length===1)for(var u=o[0],l=0;l<u;l++)s[l]=a[i+l];else{u=o[0];var c=o.slice(1),d=c.reduce(function(h,f){return h*f});for(l=0;l<u;l++)s[l]=r(i+l*d,c,a)}return s}(0,t,e)}function yE(t,e){for(var n=Sl(t,e),r=0;r<n.length;r++)n[r]=1;return n}function Sl(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error("Unknown data type "+e)}function Nr(){return G().platform.now()}function xE(t){t.forEach(function(e){T(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function F5(t,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",G().platform.encode(t,e)}function Pd(t,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",G().platform.decode(t,e)}function t1(t,e,n){if(e===0)return 0;if(e===1)return t[0];for(var r=t[t.length-1],i=0;i<t.length-1;++i)r+=n[i]*t[i];return r}function L5(t,e,n){if(e===0)return[];if(e===1)return[t];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(t/n[i]),t-=r[i]*n[i];return r[r.length-1]=t,r}var B5=function(){function t(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new V5)}return t.prototype.profileKernel=function(e,n,r){var i,o=this,a=this.backendTimer.time(function(){i=r()});return i.forEach(function(s){s.data().then(function(u){(function(l,c,d){if(c!=="float32")return!1;for(var h=0;h<l.length;h++){var f=l[h];if(isNaN(f)||!isFinite(f))return console.warn("Found "+f+" in the result of '"+d+"'"),!0}})(u,s.dtype,e),a.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),o.logger.logKernelProfile(e,s,u,l.kernelMs,n,c)})})}),i},t}(),V5=function(){function t(){}return t.prototype.logKernelProfile=function(e,n,r,i,o,a){var s=typeof i=="number"?Ja(i+"ms",9):i.error,u=Ja(e,25),l=n.rank,c=n.size,d=Ja(n.shape.toString(),14),h="";for(var f in o){var m=o[f].shape||n.shape,p=m.length;h+=f+": "+p+"D "+(p>0?m:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+d+"	%c"+c+"	%c"+h+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}(),n1=20,Ys=3,Jf=7;function z5(t,e,n,r){var i=Br(e),o=function(l,c,d,h){var f=oe(c),m=h[h.length-1],p=new Array(m).fill(0),v=c.length,g=d==="complex64"?Qs(l):l;if(v>1)for(var x=0;x<f/m;x++)for(var w=x*m,b=0;b<m;b++)p[b]=Math.max(p[b],Js(g[w+b],0,d).length);return p}(t,e,n,i),a=e.length,s=function l(c,d,h,f,m,p){p===void 0&&(p=!0);var v=h==="complex64"?2:1,g=d[0],x=d.length;if(x===0)return h==="complex64"?[Js(Qs(c)[0],0,h)]:h==="bool"?[wE(c[0])]:[c[0].toString()];if(x===1){if(g>n1){var w=Ys*v,b=Array.from(c.slice(0,w)),k=Array.from(c.slice((g-Ys)*v,g*v));return h==="complex64"&&(b=Qs(b),k=Qs(k)),["["+b.map(function(z,W){return Js(z,m[W],h)}).join(", ")+", ..., "+k.map(function(z,W){return Js(z,m[g-Ys+W],h)}).join(", ")+"]"]}return["["+(h==="complex64"?Qs(c):Array.from(c)).map(function(z,W){return Js(z,m[W],h)}).join(", ")+"]"]}var _=d.slice(1),S=f.slice(1),C=f[0]*v,E=[];if(g>n1){for(var R=0;R<Ys;R++){var D=(P=R*C)+C;E.push.apply(E,l(c.slice(P,D),_,h,S,m,!1))}for(E.push("..."),R=g-Ys;R<g;R++)D=(P=R*C)+C,E.push.apply(E,l(c.slice(P,D),_,h,S,m,R===g-1))}else for(R=0;R<g;R++){var P;D=(P=R*C)+C,E.push.apply(E,l(c.slice(P,D),_,h,S,m,R===g-1))}var F=x===2?",":"";for(E[0]="["+E[0]+F,R=1;R<E.length-1;R++)E[R]=" "+E[R]+F;var U=`,
`;for(R=2;R<x;R++)U+=`
`;return E[E.length-1]=" "+E[E.length-1]+"]"+(p?"":U),E}(t,e,n,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function Js(t,e,n){return Ja(Array.isArray(t)?parseFloat(t[0].toFixed(Jf))+" + "+parseFloat(t[1].toFixed(Jf))+"j":zy(t)?"'"+t+"'":n==="bool"?wE(t):parseFloat(t.toFixed(Jf)).toString(),e)}function wE(t){return t===0?"false":"true"}function Qs(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var rl=function(){function t(e,n,r){var i=this;if(this.dtype=n,this.shape=e.slice(),this.size=oe(e),r!=null){var o=r.length;T(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Td(n,this.size),this.strides=Br(e)}return t.prototype.set=function(e){for(var n=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),T(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+n.rank+")"});var o=this.locToIndex(r);this.values[o]=e},t.prototype.get=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.length===0&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var a=o[i];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},t.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var n=e[e.length-1],r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return n},t.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var n=new Array(this.shape.length),r=0;r<n.length-1;++r)n[r]=Math.floor(e/this.strides[r]),e-=n[r]*this.strides[r];return n[n.length-1]=e,n},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return Pr().makeTensor(this.values,this.shape,this.dtype)},t}(),Pr=null,$=null,bE=null,nt=function(){function t(e,n,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=oe(e),this.strides=Br(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),T(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(e,n){return this.throwIfDisposed(),this.reshape([e,n])},t.prototype.as3D=function(e,n,r){return this.throwIfDisposed(),this.reshape([e,n,r])},t.prototype.as4D=function(e,n,r,i){return this.throwIfDisposed(),this.reshape([e,n,r,i])},t.prototype.as5D=function(e,n,r,i,o){return this.throwIfDisposed(),this.reshape([e,n,r,i,o])},t.prototype.asType=function(e){return this.throwIfDisposed(),$.cast(this,e)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return ne(this,void 0,void 0,function(){var e;return re(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return e=n.sent(),[2,$.buffer(this.shape,this.dtype,e)]}})})},t.prototype.bufferSync=function(){return $.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return ne(this,void 0,void 0,function(){var e;return re(this,function(n){switch(n.label){case 0:return[4,this.data()];case 1:return e=n.sent(),[2,e1(this.shape,e)]}})})},t.prototype.arraySync=function(){return e1(this.shape,this.dataSync())},t.prototype.data=function(){return ne(this,void 0,void 0,function(){var e,n;return re(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=Pr().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:n=r.sent();try{return[2,n.map(function(i){return Pd(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var e=Pr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(n){return Pd(n)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},t.prototype.bytes=function(){return ne(this,void 0,void 0,function(){var e;return re(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),[4,Pr().read(this.dataId)];case 1:return e=n.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(Pr().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(e){return e===void 0&&(e=!1),$.print(this,e)},t.prototype.reshape=function(e){return this.throwIfDisposed(),$.reshape(this,e)},t.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},t.prototype.expandDims=function(e){return e===void 0&&(e=0),$.expandDims(this,e)},t.prototype.cumsum=function(e,n,r){return e===void 0&&(e=0),n===void 0&&(n=!1),r===void 0&&(r=!1),$.cumsum(this,e,n,r)},t.prototype.squeeze=function(e){return this.throwIfDisposed(),$.squeeze(this,e)},t.prototype.clone=function(){return this.throwIfDisposed(),$.clone(this)},t.prototype.oneHot=function(e,n,r){return this.throwIfDisposed(),$.oneHot(this,e,n,r)},t.prototype.toString=function(e){return e===void 0&&(e=!1),z5(this.dataSync(),this.shape,this.dtype,e)},t.prototype.tile=function(e){return this.throwIfDisposed(),$.tile(this,e)},t.prototype.gather=function(e,n){return n===void 0&&(n=0),this.throwIfDisposed(),$.gather(this,e,n)},t.prototype.matMul=function(e,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!1),this.throwIfDisposed(),$.matMul(this,e,n,r)},t.prototype.dot=function(e){return this.throwIfDisposed(),$.dot(this,e)},t.prototype.norm=function(e,n,r){return e===void 0&&(e="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1),this.throwIfDisposed(),$.norm(this,e,n,r)},t.prototype.slice=function(e,n){return this.throwIfDisposed(),$.slice(this,e,n)},t.prototype.reverse=function(e){return this.throwIfDisposed(),$.reverse(this,e)},t.prototype.concat=function(e,n){return n===void 0&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),$.concat([this].concat(e),n)},t.prototype.split=function(e,n){return n===void 0&&(n=0),this.throwIfDisposed(),$.split(this,e,n)},t.prototype.stack=function(e,n){return n===void 0&&(n=0),$.stack([this,e],n)},t.prototype.unstack=function(e){return e===void 0&&(e=0),$.unstack(this,e)},t.prototype.pad=function(e,n){return n===void 0&&(n=0),$.pad(this,e,n)},t.prototype.batchNormalization=function(e,n,r,i,o){return r===void 0&&(r=.001),bE("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,n,o,i,r)},t.prototype.batchNorm=function(e,n,r,i,o){return o===void 0&&(o=.001),this.throwIfDisposed(),$.batchNorm(this,e,n,r,i,o)},t.prototype.all=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),$.all(this,e,n)},t.prototype.any=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),$.any(this,e,n)},t.prototype.logSumExp=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),$.logSumExp(this,e,n)},t.prototype.sum=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),$.sum(this,e,n)},t.prototype.prod=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),$.prod(this,e,n)},t.prototype.mean=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),$.mean(this,e,n)},t.prototype.min=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),$.min(this,e,n)},t.prototype.max=function(e,n){return e===void 0&&(e=null),n===void 0&&(n=!1),this.throwIfDisposed(),$.max(this,e,n)},t.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),$.argMin(this,e)},t.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),$.argMax(this,e)},t.prototype.cast=function(e){return this.throwIfDisposed(),$.cast(this,e)},t.prototype.add=function(e){return this.throwIfDisposed(),$.add(this,e)},t.prototype.addStrict=function(e){return this.throwIfDisposed(),$.addStrict(this,e)},t.prototype.atan2=function(e){return this.throwIfDisposed(),$.atan2(this,e)},t.prototype.sub=function(e){return this.throwIfDisposed(),$.sub(this,e)},t.prototype.subStrict=function(e){return this.throwIfDisposed(),$.subStrict(this,e)},t.prototype.pow=function(e){return this.throwIfDisposed(),$.pow(this,e)},t.prototype.powStrict=function(e){return this.throwIfDisposed(),$.powStrict(this,e)},t.prototype.mul=function(e){return this.throwIfDisposed(),$.mul(this,e)},t.prototype.mulStrict=function(e){return this.throwIfDisposed(),$.mulStrict(this,e)},t.prototype.div=function(e){return this.throwIfDisposed(),$.div(this,e)},t.prototype.divNoNan=function(e){return this.throwIfDisposed(),$.divNoNan(this,e)},t.prototype.floorDiv=function(e){return this.throwIfDisposed(),$.floorDiv(this,e)},t.prototype.divStrict=function(e){return this.throwIfDisposed(),$.divStrict(this,e)},t.prototype.minimum=function(e){return this.throwIfDisposed(),$.minimum(this,e)},t.prototype.minimumStrict=function(e){return this.throwIfDisposed(),$.minimumStrict(this,e)},t.prototype.maximum=function(e){return this.throwIfDisposed(),$.maximum(this,e)},t.prototype.maximumStrict=function(e){return this.throwIfDisposed(),$.maximumStrict(this,e)},t.prototype.mod=function(e){return this.throwIfDisposed(),$.mod(this,e)},t.prototype.modStrict=function(e){return this.throwIfDisposed(),$.modStrict(this,e)},t.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),$.squaredDifferenceStrict(this,e)},t.prototype.transpose=function(e){return this.throwIfDisposed(),$.transpose(this,e)},t.prototype.notEqual=function(e){return this.throwIfDisposed(),$.notEqual(this,e)},t.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),$.notEqualStrict(this,e)},t.prototype.less=function(e){return this.throwIfDisposed(),$.less(this,e)},t.prototype.lessStrict=function(e){return this.throwIfDisposed(),$.lessStrict(this,e)},t.prototype.equal=function(e){return this.throwIfDisposed(),$.equal(this,e)},t.prototype.equalStrict=function(e){return this.throwIfDisposed(),$.equalStrict(this,e)},t.prototype.lessEqual=function(e){return this.throwIfDisposed(),$.lessEqual(this,e)},t.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),$.lessEqualStrict(this,e)},t.prototype.greater=function(e){return this.throwIfDisposed(),$.greater(this,e)},t.prototype.greaterStrict=function(e){return this.throwIfDisposed(),$.greaterStrict(this,e)},t.prototype.greaterEqual=function(e){return this.throwIfDisposed(),$.greaterEqual(this,e)},t.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),$.greaterEqualStrict(this,e)},t.prototype.logicalAnd=function(e){return this.throwIfDisposed(),$.logicalAnd(this,e)},t.prototype.logicalOr=function(e){return this.throwIfDisposed(),$.logicalOr(this,e)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),$.logicalNot(this)},t.prototype.logicalXor=function(e){return this.throwIfDisposed(),$.logicalXor(this,e)},t.prototype.where=function(e,n){return this.throwIfDisposed(),$.where(e,this,n)},t.prototype.neg=function(){return this.throwIfDisposed(),$.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),$.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),$.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),$.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),$.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),$.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),$.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),$.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),$.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),$.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),$.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),$.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),$.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),$.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),$.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),$.abs(this)},t.prototype.clipByValue=function(e,n){return this.throwIfDisposed(),$.clipByValue(this,e,n)},t.prototype.relu=function(){return this.throwIfDisposed(),$.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),$.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),$.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),$.selu(this)},t.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),$.leakyRelu(this,e)},t.prototype.prelu=function(e){return this.throwIfDisposed(),$.prelu(this,e)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),$.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),$.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),$.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),$.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),$.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),$.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),$.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),$.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),$.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),$.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),$.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),$.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),$.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),$.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),$.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),$.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),$.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),$.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),$.round(this)},t.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),$.step(this,e)},t.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),$.softmax(this,e)},t.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),$.logSoftmax(this,e)},t.prototype.resizeBilinear=function(e,n){return n===void 0&&(n=!1),this.throwIfDisposed(),$.image.resizeBilinear(this,e,n)},t.prototype.resizeNearestNeighbor=function(e,n){return n===void 0&&(n=!1),this.throwIfDisposed(),$.image.resizeNearestNeighbor(this,e,n)},t.prototype.conv1d=function(e,n,r,i,o,a){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),$.conv1d(this,e,n,r,i,o,a)},t.prototype.conv2d=function(e,n,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),$.conv2d(this,e,n,r,i,o,a)},t.prototype.conv2dTranspose=function(e,n,r,i,o){return this.throwIfDisposed(),$.conv2dTranspose(this,e,n,r,i,o)},t.prototype.depthwiseConv2D=function(e,n,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),$.depthwiseConv2d(this,e,n,r,i,o,a)},t.prototype.separableConv2d=function(e,n,r,i,o,a){return o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),$.separableConv2d(this,e,n,r,i,o,a)},t.prototype.avgPool=function(e,n,r,i){return this.throwIfDisposed(),$.avgPool(this,e,n,r,i)},t.prototype.maxPool=function(e,n,r,i){return this.throwIfDisposed(),$.maxPool(this,e,n,r,i)},t.prototype.localResponseNormalization=function(e,n,r,i){return e===void 0&&(e=5),n===void 0&&(n=1),r===void 0&&(r=1),i===void 0&&(i=.5),$.localResponseNormalization(this,e,n,r,i)},t.prototype.pool=function(e,n,r,i,o){return this.throwIfDisposed(),$.pool(this,e,n,r,i,o)},t.prototype.variable=function(e,n,r){return e===void 0&&(e=!0),this.throwIfDisposed(),Pr().makeVariable(this,e,n,r)},t.prototype.unsortedSegmentSum=function(e,n){return this.throwIfDisposed(),$.unsortedSegmentSum(this,e,n)},t.prototype.batchToSpaceND=function(e,n){return this.throwIfDisposed(),$.batchToSpaceND(this,e,n)},t.prototype.spaceToBatchND=function(e,n){return this.throwIfDisposed(),$.spaceToBatchND(this,e,n)},t.prototype.topk=function(e,n){return e===void 0&&(e=1),n===void 0&&(n=!0),this.throwIfDisposed(),$.topk(this,e,n)},t.prototype.stridedSlice=function(e,n,r,i,o,a,s,u){return i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),$.stridedSlice(this,e,n,r,i,o,a,s,u)},t.prototype.depthToSpace=function(e,n){return this.throwIfDisposed(),$.depthToSpace(this,e,n)},t.prototype.fft=function(){return this.throwIfDisposed(),$.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),$.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),$.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),$.spectral.irfft(this)},t}();Object.defineProperty(nt,Symbol.hasInstance,{value:function(t){return!!t&&t.dataId!=null&&t.shape!=null&&t.dtype!=null}});var r1,lg,cg,dg,hg,gs=function(t){function e(n,r,i,o){var a=t.call(this,n.shape,n.dtype,n.dataId,o)||this;return a.trainable=r,a.name=i,a}return xr(e,t),e.prototype.assign=function(n){if(n.dtype!==this.dtype)throw new Error("dtype of the new value ("+n.dtype+") and previous value ("+this.dtype+") must match");if(!It(n.shape,this.shape))throw new Error("shape of the new value ("+n.shape+") and previous value ("+this.shape+") must match");Pr().disposeTensor(this),this.dataId=n.dataId,Pr().incRef(this,null)},e.prototype.dispose=function(){Pr().disposeVariable(this),this.isDisposedInternal=!0},e}(nt);Object.defineProperty(gs,Symbol.hasInstance,{value:function(t){return t instanceof nt&&t.assign!=null&&t.assign instanceof Function}}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(r1||(r1={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(lg||(lg={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(cg||(cg={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(dg||(dg={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(hg||(hg={}));var U5={float32:dg,int32:lg,bool:cg,complex64:hg};function Lt(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error("Can not upcast "+t+" with "+e)}return U5[t][e]}function Qf(t){return Lt(t,"int32")}function st(t,e){if(t.dtype===e.dtype)return[t,e];var n=Lt(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function $5(t,e){T(t.dtype===e.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"})}function kE(t){var e=[];return function n(r,i,o){if(r!=null){if(r instanceof nt)return void i.push(r);if(a=r,!(!Array.isArray(a)&&typeof a!="object")){var a,s=r;for(var u in s){var l=s[u];o.has(l)||(o.add(l),n(l,i,o))}}}}(t,e,new Set),e}var Zf,i1=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},t}(),W5=function(){function t(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new i1}return t.prototype.ready=function(){return ne(this,void 0,void 0,function(){var e,n,r;return re(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),n=0,i.label=1;case 1:return n<e.length?(r=e[n],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return n++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),n=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+n+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(n)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},t.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},t.prototype.registerBackend=function(e,n,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:n,priority:r},!0)},t.prototype.setBackend=function(e){return ne(this,void 0,void 0,function(){var n,r,i;return re(this,function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,n=this.initializeBackend(e),r=n.success,n.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new B5(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var e=this;Qb(this.backendName).forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},t.prototype.disposeRegisteredKernels=function(e){var n=this;Qb(e).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(n.registry[e])})},t.prototype.initializeBackend=function(e){var n=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,a=i.then(function(s){return!(o<n.pendingBackendInitId)&&(n.registry[e]=s,n.pendingBackendInit=null,!0)}).catch(function(s){return!(o<n.pendingBackendInitId)&&(n.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(n,r){return e.registryFactory[r].priority-e.registryFactory[n].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),n=0;n<e.length;n++){var r=e[n],i=this.initializeBackend(r),o=i.success,a=i.asyncInit;if(a||o)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(e,n){var r=this.state.tensorInfo.get(n),i=r.backend,o=this.readSync(n);i.disposeData(n),r.backend=e,e.move(n,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(e,n){var r,i=this,o=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=n())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},t.prototype.scopedRun=function(e,n,r){e();try{var i=r();return n(),i}catch(o){throw n(),o}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(e){var n=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[n],function(i){return{x:function(){return i.toFloat()}}},[]),n},t.prototype.runKernel=function(e,n,r,i,o){return this.runKernelFunc(null,n,null,e,r,i,o)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(e,n,r){var i=this.backend.numDataIds(),o=0;r.forEach(function(u){o+=u.dtype==="complex64"?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=i-n-o-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+e+"'")},t.prototype.runKernelFunc=function(e,n,r,i,o,a,s){var u,l=this;a===void 0&&(a=[]),s===void 0&&(s=[]);var c=[],d=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var h,f=function(x){d&&(c=x.map(function(w){return l.keep(l.clone(w))}))},m=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var v,g=hE(i,this.backendName);return h=g!=null?function(){var x=l.backend.numDataIds();v=g.kernelFunc({inputs:n,attrs:o,backend:l.backend});var w=Array.isArray(v)?v:[v];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,x,w);var b=w.map(function(_){var S=_.dataId,C=_.shape,E=_.dtype;return l.makeTensorFromDataId(S,C,E)}),k=b.filter(function(_,S){return s[S]});return f((a||[]).slice().concat(k)),b}:function(){var x=l.backend.numDataIds();v=l.tidy(function(){return e(l.backend,f)});var w=Array.isArray(v)?v:[v];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,x,w),w},this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(i,n,function(){return h()}):h()}),d&&this.addTapeNode(i,n,u,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-m,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(n).map(function(x){return n[x].shape}),outputShapes:u.map(function(x){return x.shape})}),Array.isArray(v)?u:u[0]},t.prototype.makeTensor=function(e,n,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;var o=e;r==="string"&&zy(e[0])&&(o=e.map(function(c){return F5(c)}));var a=i.write(o,n,r),s=new nt(n,r,a,this.nextTensorId());if(this.incRef(s,i),r==="string"){var u=this.state.tensorInfo.get(a),l=M5(o);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},t.prototype.makeTensorFromDataId=function(e,n,r,i){var o=new nt(n,r=r||"float32",e,this.nextTensorId());return this.incRef(o,i),o},t.prototype.makeVariable=function(e,n,r,i){n===void 0&&(n=!0),r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var o=new gs(e,n,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},t.prototype.incRef=function(e,n){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*gE(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof gs||this.track(e)},t.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var n=this.state.tensorInfo.get(e.dataId);n.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=n.bytes),this.state.numDataBuffers--,n.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var n=this.state.registeredVariables[e];this.disposeVariable(n)}},t.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},t.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},t.prototype.profile=function(e){return ne(this,void 0,void 0,function(){var n,r;return re(this,function(i){return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},t.prototype.addTapeNode=function(e,n,r,i,o){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:r,saved:o},u=E5(e);u!=null&&(i=u.gradFunc),i!=null&&(s.gradient=function(l){return l=l.map(function(c,d){if(c==null){var h=r[d],f=Sl(h.size,h.dtype);return a.makeTensor(f,h.shape,h.dtype)}return c}),i(l.length>1?l:l[0],o)}),this.state.activeTape.push(s)},t.prototype.keep=function(e){return e.kept=!0,e},t.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(e){var n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n},t.prototype.endScope=function(e){for(var n=this,r=kE(e),i=new Set(r.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||i.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||n.track(u)})},t.prototype.gradients=function(e,n,r,i){var o=this;if(i===void 0&&(i=!1),T(n.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});T(a instanceof nt,function(){return"The result y returned by f() must be a tensor."});var s=function(u,l,c){for(var d={},h={},f=0;f<l.length;f++)d[l[f].id]=!0;for(f=0;f<u.length;f++){var m=(_=u[f]).inputs;for(var p in m){for(var v=m[p],g=!1,x=0;x<l.length;x++)if(d[v.id]){_.outputs.forEach(function(R){return d[R.id]=!0}),g=!0,h[_.id]=!0;break}if(g)break}}var w={};w[c.id]=!0;var b={};for(f=u.length-1;f>=0;f--)for(m=(_=u[f]).inputs,x=0;x<_.outputs.length;x++)if(w[_.outputs[x].id]){for(var p in m)w[m[p].id]=!0,b[_.id]=!0;break}var k=[];for(f=0;f<u.length;f++){var _;if(h[(_=u[f]).id]&&b[_.id]){var S={};for(var p in _.inputs){var C=_.inputs[p];d[C.id]&&(S[p]=C)}var E=Object.assign({},_);E.inputs=S,E.outputs=_.outputs,k.push(E)}}return k}(this.state.activeTape,n,a);if(!i&&s.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[a.id]=r??(u=a.shape,l=yE(oe(u),"float32"),O.makeTensor(l,u,"float32")),function(h,f,m){for(var p=function(g){var x=f[g],w=[];if(x.outputs.forEach(function(S){var C=h[S.id];C!=null?w.push(C):w.push(null)}),x.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+x.kernelName+".");var b=x.gradient(w),k=function(S){if(!(S in b))throw new Error("Cannot backprop through input "+S+". Available gradients found: "+Object.keys(b)+".");var C=m(function(){return b[S]()});if(C.dtype!=="float32")throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input "+S+" must have 'float32' dtype, but has '"+C.dtype+"'");var E=x.inputs[S];if(!It(C.shape,E.shape))throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input '"+S+"' has shape '"+C.shape+"', which does not match the shape of the input '"+E.shape+"'");if(h[E.id]==null)h[E.id]=C;else{var R=h[E.id];h[E.id]=R.add(C),R.dispose()}};for(var _ in x.inputs)k(_)},v=f.length-1;v>=0;v--)p(v)}(c,s,function(h){return o.tidy(h)});var d=n.map(function(h){return c[h.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(h){for(var f=0,m=h.saved;f<m.length;f++)m[f].dispose()}),o.state.activeTape=null),{value:a,grads:d}})},t.prototype.customGrad=function(e){var n=this;return T(sg(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];T(i.every(function(s){return s instanceof nt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return i.forEach(function(s,u){a[u]=s}),n.runKernelFunc(function(s,u){return T((r=e.apply(void 0,i.concat([u]))).value instanceof nt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),T(sg(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];T(c.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),T(c.every(function(h){return h instanceof nt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return c.forEach(function(h,f){d[f]=function(){return h}}),d})}},t.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},t.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},t.prototype.time=function(e){return ne(this,void 0,void 0,function(){var n,r;return re(this,function(i){switch(i.label){case 0:return n=Nr(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=Nr()-n,[2,r]}})})},t.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new i1,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),O=function(){var t=function(){if(Zf==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else{if(typeof self>"u")throw new Error("Could not find a global object");n=self}Zf=n}return Zf}();if(t._tfengine==null){var e=new S5(t);t._tfengine=new W5(e)}return function(n){dE=n}(t._tfengine.ENV),Pr=function(){return t._tfengine},t._tfengine}();function _E(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Qr=G();Qr.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Qr.registerFlag("IS_BROWSER",function(){return _E()}),Qr.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Qr.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Qr.registerFlag("PROD",function(){return!1}),Qr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Qr.getBool("DEBUG")}),Qr.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Qr.registerFlag("IS_TEST",function(){return!1});var il,Rn,Sn,bo={},ep={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function G5(t,e){bo[t]=e}function Wr(t){t in bo||(bo[t]=function(n){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(n);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete bo[n]},!1),n===1?r.getContext("webgl",ep)||r.getContext("experimental-webgl",ep):r.getContext("webgl2",ep)}(t));var e=bo[t];return e.isContextLost()?(delete bo[t],Wr(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),bo[t])}function Nh(t,e){return[e,t]}function Su(t){var e=oe(t);return ag(Math.ceil(e/4))}function Cl(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Uy(t,e){var n,r,i,o,a,s,u,l,c,d=t;return G().getNumber("WEBGL_VERSION")===2?(n=d.R32F,r=d.R16F,i=d.RGBA16F,o=d.RGBA32F,a=d.RED,s=4,u=1,l=d.HALF_FLOAT,c=d.FLOAT):(n=t.RGBA,r=t.RGBA,i=t.RGBA,o=d.RGBA,a=t.RGBA,s=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null,c=t.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function ae(t,e,n){var r=n();return e&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+X5(i,o))}(t),r}(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(il||(il={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(Rn||(Rn={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Sn||(Sn={}));var H5=596e-10,K5=65504;function q5(t){return!!(G().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||H5<Math.abs(t)&&Math.abs(t)<K5)}function X5(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function sc(t,e,n){return vi(t,e,function(){return t.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function Y5(t,e,n){var r=vi(t,e,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ae(t,e,function(){return t.shaderSource(r,n)}),ae(t,e,function(){return t.compileShader(r)}),t.getShaderParameter(r,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function J5(t,e,n){var r=vi(t,e,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ae(t,e,function(){return t.shaderSource(r,n)}),ae(t,e,function(){return t.compileShader(r)}),t.getShaderParameter(r,t.COMPILE_STATUS)===!1)throw function(i,o){var a=Q5.exec(o);if(a==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var s=+a[1],u=i.split(`
`),l=u.length.toString().length+2,c=u.map(function(v,g){return Ja((g+1).toString(),l)+v}),d=0,h=0;h<c.length;h++)d=Math.max(c[h].length,d);var f=c.slice(0,s-1),m=c.slice(s-1,s),p=c.slice(s);console.log(f.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+Ja(m[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join(`
`))}(n,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var tp,np,Q5=/ERROR: [0-9]+:([0-9]+):/g;function Z5(t,e){return vi(t,e,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function eV(t,e,n){if(ae(t,e,function(){return t.linkProgram(n)}),t.getProgramParameter(n,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function rp(t,e,n){if(ae(t,e,function(){return t.validateProgram(n)}),t.getProgramParameter(n,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function tV(t,e,n){var r=vi(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return ae(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),ae(t,e,function(){return t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function nV(t,e,n){var r=vi(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return ae(t,e,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),ae(t,e,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function rV(t,e){return vi(t,e,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function iV(t,e){var n=G().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+n+"x"+n+"]")+".")}function oV(t,e){return vi(t,e,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function o1(t,e,n,r,i,o,a,s){var u=t.getAttribLocation(n,r);return u!==-1&&(ae(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,i)}),ae(t,e,function(){return t.vertexAttribPointer(u,o,t.FLOAT,!1,a,s)}),ae(t,e,function(){return t.enableVertexAttribArray(u)}),!0)}function aV(t,e,n,r){dV(t,r),ae(t,e,function(){return t.activeTexture(t.TEXTURE0+r)}),ae(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)})}function sV(t,e,n,r){return vi(t,e,function(){return t.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function uV(t,e,n){return t.getUniformLocation(e,n)}function lV(t,e,n,r,i,o){ae(t,e,function(){return aV(t,e,r,o)}),ae(t,e,function(){return t.uniform1i(i,o)})}function ip(t,e,n,r){ae(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),ae(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)})}function a1(t,e,n){ae(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),ae(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function uc(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+cV(t,e))}function cV(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function vi(t,e,n,r){var i=ae(t,e,function(){return n()});if(i==null)throw new Error(r);return i}function dV(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+n+"]")+".")}function Id(t,e){return e===void 0&&(e=2),oe(t.slice(0,t.length-e))}function Dd(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function op(t){var e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Id(t)].concat(Dd(t))),e}function hV(t,e){var n;e===void 0&&(e=!1);var r=G().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(t=t.map(function(l,c){return c>=t.length-2?mE(t[c]):t[c]})).length===1&&(t=[2,t[0]])),t.length!==2){var i=So(t);t=i.newShape}var o=oe(t);if(t.length<=1&&o<=r)return[1,o];if(t.length===2&&t[0]<=r&&t[1]<=r)return t;if(t.length===3&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(t.length===3&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(t.length===4&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(t.length===4&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(e){var a=Id(t),s=2,u=2;return t.length&&(s=(n=Dd(t))[0],u=n[1]),ag(o=a*(s/2)*(u/2)).map(function(l){return 2*l})}return ag(o)}function lc(t){return t%2==0}function cc(t,e){if(It(t=t.slice(-2),e=e.slice(-2))||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r||lc(n)&&lc(r)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&lc(t[0])&&lc(e[0])}function fV(t){if(tp==null){var e=Wr(t);tp=e.getParameter(e.MAX_TEXTURE_SIZE)}return tp}function pV(t){if(np==null){var e=Wr(t);np=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,np)}function mV(t){if(t===0)return 0;var e=Wr(t);return Hn(e,"EXT_disjoint_timer_query_webgl2")&&t===2?2:Hn(e,"EXT_disjoint_timer_query")?1:0}function Hn(t,e){return t.getExtension(e)!=null}function s1(t){try{if(Wr(t)!=null)return!0}catch{return!1}return!1}function gV(t){if(t===0)return!1;var e=Wr(t);if(t===1){if(!Hn(e,"OES_texture_float"))return!1}else if(!Hn(e,"EXT_color_buffer_float"))return!1;return fg(e)}function vV(t){if(t===0)return!1;var e=Wr(t);if(t!==1){if(Hn(e,"EXT_color_buffer_float"))return fg(e);if(Hn(e,"EXT_color_buffer_half_float")){var n=e.getExtension("EXT_color_buffer_half_float");return function(r,i){var o=Uy(r,i),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u}(e,n)}return!1}return!!Hn(e,"OES_texture_float")&&!!Hn(e,"WEBGL_color_buffer_float")&&fg(e)}function fg(t){var e=Uy(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),i}function yV(t){return t===2&&Wr(t).fenceSync!=null}var ge=G();function SE(t){G().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Q(t,e){return O.tidy(t,e)}function vn(t){kE(t).forEach(function(e){return e.dispose()})}function xV(t){return O.keep(t)}function Md(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];G().getBool("IS_TEST")||console.warn.apply(console,t)}function uo(t,e){var n=t;if(Lr(t))return e==="string"?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||Lr(n)&&e!=="string";)r.push(n.length),n=n[0];return Array.isArray(t)&&G().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,a,s){if(s=s||[],!Array.isArray(o)&&!Lr(o))return void T(a.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"});T(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),T(o.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+o.length+" elements"});for(var u=a.slice(1),l=0;l<o.length;++l)i(o[l],u,s.concat(l))}(t,r,[]),r}function u1(t,e,n,r){if(t!=null&&(t!=="numeric"&&t!==e||t==="numeric"&&e==="string"))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function N(t,e,n,r){if(r===void 0&&(r="numeric"),t instanceof nt)return u1(r,t.dtype,e,n),t;var i=_l(t);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),u1(r,i,e,n),t==null||!Lr(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){var o=t==null?"null":t.constructor.name;throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=uo(t,i);Lr(t)||Array.isArray(t)||(t=[t]);var s=i!=="string"?vE(t,i,G().getBool("DEBUG")):ms(t,[],!0);return O.makeTensor(s,a,i)}function Od(t,e,n,r){if(r===void 0&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(i,o){return N(i,e+"["+o+"]",n)},r)}function CE(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function wV(t,e,n){for(var r=t.length+e.length,i=[],o=0,a=0,s=0;s<r;s++)n.indexOf(s)===-1?i.push(t[o++]):i.push(e[a++]);return i}function Gt(t,e){for(var n=[],r=t.length,i=0;i<r;i++)e.indexOf(i)===-1&&n.push(t[i]);return[n,e.map(function(o){return t[o]})]}function yn(t,e){return wV(t,e.map(function(n){return 1}),e)}function _n(t,e,n){T(CE(e,n),function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input."})}function Gr(t,e){if(CE(t,e))return null;for(var n=[],r=0;r<e;++r)t.indexOf(r)===-1&&n.push(r);return t.forEach(function(i){return n.push(i)}),n}function $y(t){return t.map(function(e,n){return[n,e]}).sort(function(e,n){return e[1]-n[1]}).map(function(e){return e[0]})}function Hr(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function bV(t,e){var n=t[0].length;t.forEach(function(i,o){T(i.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+n+")"})}),T(e>=0&&e<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=t[0];t.forEach(function(i,o){for(var a=0;a<n;a++)T(a===e||i[a]===r[a],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function vs(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function M(t){var e=Object.keys(t);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];O.startScope(n);try{var s=r.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),O.endScope(s),s}catch(u){throw O.endScope(null),u}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}ge.registerFlag("HAS_WEBGL",function(){return ge.getNumber("WEBGL_VERSION")>0}),ge.registerFlag("WEBGL_VERSION",function(){return s1(2)?2:s1(1)?1:0}),ge.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return ge.get("WEBGL_VERSION")===2}),ge.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),ge.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),ge.registerFlag("WEBGL_PACK",function(){return ge.getBool("HAS_WEBGL")}),ge.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return ge.getBool("WEBGL_PACK")}),ge.registerFlag("WEBGL_PACK_CLIP",function(){return ge.getBool("WEBGL_PACK")}),ge.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),ge.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return ge.getBool("WEBGL_PACK")}),ge.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return ge.getBool("WEBGL_PACK")}),ge.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return ge.getBool("WEBGL_PACK")}),ge.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return ge.getBool("WEBGL_PACK")}),ge.registerFlag("WEBGL_PACK_REDUCE",function(){return ge.getBool("WEBGL_PACK")}),ge.registerFlag("WEBGL_LAZILY_UNPACK",function(){return ge.getBool("WEBGL_PACK")}),ge.registerFlag("WEBGL_CONV_IM2COL",function(){return ge.getBool("WEBGL_PACK")}),ge.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return fV(ge.getNumber("WEBGL_VERSION"))}),ge.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return pV(ge.getNumber("WEBGL_VERSION"))}),ge.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=ge.getNumber("WEBGL_VERSION");return t===0?0:mV(t)}),ge.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return ge.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),ge.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return gV(ge.getNumber("WEBGL_VERSION"))}),ge.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!ge.getBool("WEBGL_FORCE_F16_TEXTURES")&&ge.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),ge.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return vV(ge.getNumber("WEBGL_VERSION"))}),ge.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return yV(ge.getNumber("WEBGL_VERSION"))}),ge.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return ge.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),bE=SE;var Ft=M({complex_:function(t,e){var n=N(t,"real","complex"),r=N(e,"imag","complex");return Oe(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),O.runKernelFunc(function(i){return i.complex(n,r)},{$real:n,$imag:r})}}),$n=M({real_:function(t){var e=N(t,"input","real");return O.runKernelFunc(function(n){return n.real(e)},{$input:e})}}),Ir=M({imag_:function(t){var e=N(t,"input","imag");return O.runKernelFunc(function(n){return n.imag(e)},{$input:e})}});function Bt(t,e,n){return lo(t,e,uo(t,n),n)}function lo(t,e,n,r){if(r==null&&(r=_l(t)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Lr(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){xE(e);var i=oe(e),o=oe(n);T(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var a=0;a<n.length;++a){var s=n[a],u=a!==n.length-1||s!==oe(e.slice(a));T(n[a]===e[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "})}}return Lr(t)||Array.isArray(t)||(t=[t]),e=e||n,t=r!=="string"?vE(t,r,G().getBool("DEBUG")):ms(t,[],!0),O.makeTensor(t,e,r)}function J(t,e){if((Lr(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Lr(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return lo(t,[],[],e)}function yt(t,e){Is(t);var n=uo(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return lo(t,null,n,e)}function qi(t,e,n){if(Is(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=uo(t,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return lo(t,e,r,n)}function Wy(t,e,n){if(Is(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=uo(t,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return lo(t,e,r,n)}function cn(t,e,n){if(Is(t),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=uo(t,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return lo(t,e,r,n)}function kV(t,e,n){if(Is(t),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=uo(t,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return lo(t,e,r,n)}function _V(t,e,n){if(Is(t),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=uo(t,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return lo(t,e=e||r,r,n)}function SV(t,e,n,r){return e===void 0&&(e=!0),O.makeVariable(t,e,n,r)}function Ds(t,e){if(e===void 0&&(e="float32"),e==="complex64"){var n=Ds(t,"float32"),r=Ge(t,"float32");return Ft(n,r)}var i=yE(oe(t),e);return O.makeTensor(i,t,e)}function Ge(t,e){if(e===void 0&&(e="float32"),e==="complex64"){var n=Ge(t,"float32"),r=Ge(t,"float32");return Ft(n,r)}var i=Sl(oe(t),e);return O.makeTensor(i,t,e)}function Vr(t,e,n){return O.runKernelFunc(function(r){return r.fill(t,e,n)},{})}function CV(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");return O.runKernelFunc(function(r){return r.linspace(t,e,n)},{})}function jd(t,e,n,r){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n===0)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return Ge([0],r);var i=Sl(Math.abs(Math.ceil((e-t)/n)),r);e<t&&n===1&&(n=-1),i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return yt(i,r)}var EE=M({onesLike_:function(t){var e=N(t,"x","onesLike");if(e.dtype==="complex64"){var n=EE($n(e)),r=Ne(Ir(e));return Ft(n,r)}return O.runKernelFunc(function(i){return i.onesLike(e)},{$x:e},function(i,o){return{$x:function(){return Ne(i)}}})}}),Ne=M({zerosLike_:function(t){var e=N(t,"x","zerosLike");return O.runKernelFunc(function(n){return n.zerosLike(e)},{$x:e},function(n,r){return{$x:function(){return Ne(n)}}})}}),St=M({concat_:function(t,e){e===void 0&&(e=0),T(t.length>=1,function(){return"Pass at least one tensor to concat"});var n=Od(t,"tensors","concat");n[0].dtype==="complex64"&&n.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),e=Rt(e,n[0].shape)[0];var r=vs(n.map(function(s){return s.shape}),e);if(oe(r)===0)return Bt([],r);if((n=n.filter(function(s){return s.size>0})).length===1)return n[0];var i=n.map(function(s){return s.shape});bV(i,e);var o=n,a={axis:e};return O.runKernelFunc(function(s){return s.concat(n,e)},o,function(s){var u=i.map(function(l){return l[e]});return Gy(s,u,e).map(function(l){return function(){return l}})},"Concat",a)}}),EV=M({concat1d_:function(t){return St(t,0)}}),AV=M({concat2d_:function(t,e){return St(t,e)}}),RV=M({concat3d_:function(t,e){return St(t,e)}}),NV=M({concat4d_:function(t,e){return St(t,e)}}),Gy=M({split_:function(t,e,n){n===void 0&&(n=0);var r,i=N(t,"x","split");return n=Rt(n,i.shape)[0],typeof e=="number"?(T(i.shape[n]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[n]/e)):(T(i.shape[n]===e.reduce(function(o,a){return o+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),O.runKernelFunc(function(o){return o.split(i,r,n)},{$x:i},function(o){return{$x:function(){return St(o,n)}}})}});function Yo(t,e){return t(e={exports:{}},e.exports),e.exports}var TV=Yo(function(t){(function(e,n,r){function i(s){var u,l=this,c=(u=4022871197,function(d){d=d.toString();for(var h=0;h<d.length;h++){var f=.02519603282416938*(u+=d.charCodeAt(h));f-=u=f>>>0,u=(f*=u)>>>0,u+=4294967296*(f-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var d=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=d-(l.c=0|d)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function o(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var l=new i(s),c=u&&u.state,d=l.next;return d.int32=function(){return 4294967296*l.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,c&&(typeof c=="object"&&o(c,l),d.state=function(){return o(l,{})}),d}n&&n.exports?n.exports=a:this.alea=a})(0,t)}),PV=Yo(function(t){(function(e,n,r){function i(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var d=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^d^d>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var l=new i(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var h=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&o(c,l),d.state=function(){return o(l,{})}),d}n&&n.exports?n.exports=a:this.xor128=a})(0,t)}),IV=Yo(function(t){(function(e,n,r){function i(s){var u=this,l="";u.next=function(){var d=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^d^d<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var h=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&o(c,l),d.state=function(){return o(l,{})}),d}n&&n.exports?n.exports=a:this.xorwow=a})(0,t)}),DV=Yo(function(t){(function(e,n,r){function i(s){var u=this;u.next=function(){var l,c,d=u.x,h=u.i;return l=d[h],c=(l^=l>>>7)^l<<24,c^=(l=d[h+1&7])^l>>>10,c^=(l=d[h+3&7])^l>>>3,c^=(l=d[h+4&7])^l<<7,l=d[h+7&7],c^=(l^=l<<13)^l<<9,d[h]=c,u.i=h+1&7,c},function(l,c){var d,h=[];if(c===(0|c))h[0]=c;else for(c=""+c,d=0;d<c.length;++d)h[7&d]=h[7&d]<<15^c.charCodeAt(d)+h[d+1&7]<<13;for(;h.length<8;)h.push(0);for(d=0;d<8&&h[d]===0;++d);for(d==8?h[7]=-1:h[d],l.x=h,l.i=0,d=256;d>0;--d)l.next()}(u,s)}function o(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var h=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=l.next,d.quick=d,c&&(c.x&&o(c,l),d.state=function(){return o(l,{})}),d}n&&n.exports?n.exports=a:this.xorshift7=a})(0,t)}),MV=Yo(function(t){(function(e,n,r){function i(s){var u=this;u.next=function(){var l,c,d=u.w,h=u.X,f=u.i;return u.w=d=d+1640531527|0,c=h[f+34&127],l=h[f=f+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=h[f]=c^l,u.i=f,c+(d^d>>>16)|0},function(l,c){var d,h,f,m,p,v=[],g=128;for(c===(0|c)?(h=c,c=null):(c+="\0",h=0,g=Math.max(g,c.length)),f=0,m=-32;m<g;++m)c&&(h^=c.charCodeAt((m+32)%c.length)),m===0&&(p=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,m>=0&&(p=p+1640531527|0,f=(d=v[127&m]^=h+p)==0?f+1:0);for(f>=128&&(v[127&(c&&c.length||0)]=-1),f=127,m=512;m>0;--m)h=v[f+34&127],d=v[f=f+1&127],h^=h<<13,d^=d<<17,h^=h>>>15,d^=d>>>12,v[f]=h^d;l.w=p,l.X=v,l.i=f}(u,s)}function o(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var h=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=l.next,d.quick=d,c&&(c.X&&o(c,l),d.state=function(){return o(l,{})}),d}n&&n.exports?n.exports=a:this.xor4096=a})(0,t)}),OV=Yo(function(t){(function(e,n,r){function i(s){var u=this,l="";u.next=function(){var d=u.b,h=u.c,f=u.d,m=u.a;return d=d<<25^d>>>7^h,h=h-f|0,f=f<<24^f>>>8^m,m=m-d|0,u.b=d=d<<20^d>>>12^h,u.c=h=h-f|0,u.d=f<<16^h>>>16^m,u.a=m-d|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var h=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(h===0);return h},d.int32=l.next,d.quick=d,c&&(typeof c=="object"&&o(c,l),d.state=function(){return o(l,{})}),d}n&&n.exports?n.exports=a:this.tychei=a})(0,t)}),ko=Yo(function(t){(function(e,n){var r,i=this,o=256,a=6,s="random",u=n.pow(o,a),l=n.pow(2,52),c=2*l,d=o-1;function h(g,x,w){var b=[],k=p(function C(E,R){var D,P=[],F=typeof E;if(R&&F=="object")for(D in E)try{P.push(C(E[D],R-1))}catch{}return P.length?P:F=="string"?E:E+"\0"}((x=x==1?{entropy:!0}:x||{}).entropy?[g,v(e)]:g??function(){try{var C;return r&&(C=r.randomBytes)?C=C(o):(C=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(C)),v(C)}catch{var E=i.navigator,R=E&&E.plugins;return[+new Date,i,R,i.screen,v(e)]}}(),3),b),_=new f(b),S=function(){for(var C=_.g(a),E=u,R=0;C<l;)C=(C+R)*o,E*=o,R=_.g(1);for(;C>=c;)C/=2,E/=2,R>>>=1;return(C+R)/E};return S.int32=function(){return 0|_.g(4)},S.quick=function(){return _.g(4)/4294967296},S.double=S,p(v(_.S),e),(x.pass||w||function(C,E,R,D){return D&&(D.S&&m(D,_),C.state=function(){return m(_,{})}),R?(n[s]=C,E):C})(S,k,"global"in x?x.global:this==n,x.state)}function f(g){var x,w=g.length,b=this,k=0,_=b.i=b.j=0,S=b.S=[];for(w||(g=[w++]);k<o;)S[k]=k++;for(k=0;k<o;k++)S[k]=S[_=d&_+g[k%w]+(x=S[k])],S[_]=x;(b.g=function(C){for(var E,R=0,D=b.i,P=b.j,F=b.S;C--;)E=F[D=d&D+1],R=R*o+F[d&(F[D]=F[P=d&P+E])+(F[P]=E)];return b.i=D,b.j=P,R})(o)}function m(g,x){return x.i=g.i,x.j=g.j,x.S=g.S.slice(),x}function p(g,x){for(var w,b=g+"",k=0;k<b.length;)x[d&k]=d&(w^=19*x[d&k])+b.charCodeAt(k++);return v(x)}function v(g){return String.fromCharCode.apply(0,g)}if(n["seed"+s]=h,p(n.random(),e),t.exports){t.exports=h;try{r=require("crypto")}catch{}}})([],Math)});ko.alea=TV,ko.xor128=PV,ko.xorwow=IV,ko.xorshift7=DV,ko.xor4096=MV,ko.tychei=OV;var Th=ko.alea,Hy=function(){function t(e,n,r,i,o){this.mean=e,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=Th(a.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var n,r,i=!1;!i;){var o=void 0,a=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);n=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(n)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(n)},t.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},t.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},t}(),jV=function(){function t(e,n,r,i){this.alpha=e,this.beta=1/n,this.dtype=r;var o=i||Math.random();this.randu=Th(o.toString()),this.randn=new Hy(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var e,n,r,i,o,a;;){do i=this.randn.nextValue(),a=1+this.c*i;while(a<=0);if(a*=a*a,n=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-a+Math.log(a)),(o=this.randu())<n||Math.log(o)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},t.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},t}(),FV=function(){function t(e,n,r,i){var o=this;if(e===void 0&&(e=0),n===void 0&&(n=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=n-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+n+" <= 1 and dtype is not float");this.random=Th(i)}return t.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function xe(t,e,n){return e===void 0&&(e="float32"),e=e||"float32",xE(t),new rl(t,e,n)}function LV(t,e){e===void 0&&(e=!1),console.log(t.toString(e))}var AE=M({batchToSpaceND_:function(t,e,n){var r=N(t,"x","batchToSpaceND"),i=e.reduce(function(o,a){return o*a});return T(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),T(n.length===e.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length}),T(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),O.runKernelFunc(function(o){return o.batchToSpaceND(r,e,n)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(e,n)}}})}}),BV=M({broadcastTo_:function(t,e){var n=N(t,"broadcastTo","x"),r=n.shape;if(e.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<n.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+n.rank+".");if(e.length>n.rank){for(var i=n.shape.slice();i.length<e.length;)i.unshift(1);n=n.reshape(i)}for(var o=Array.from(e),a=e.length-1;a>=0;a--)if(n.shape[a]===e[a])o[a]=1;else if(n.shape[a]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var s=o.map(function(u,l){return u>1?l:-1}).filter(function(u){return u>=0});return s.length===0?n.clone():O.runKernelFunc(function(u){return u.tile(n,o)},{input:n},function(u){return{input:function(){return u.sum(s,!0)}}})}}),VV=M({cast_:function(t,e){var n=N(t,"x","cast");if(!I5(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return O.runKernelFunc(function(i){return i.cast(n,e)},{x:n},function(i){return{x:function(){return i.clone()}}},"Cast",r)}}),zV=M({clone_:function(t){var e=N(t,"x","clone",null);return O.runKernelFunc(function(){return O.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(n){return{$x:function(){return n.toFloat()}}})}}),UV=M({cumsum_:function(t,e,n,r){e===void 0&&(e=0),n===void 0&&(n=!1),r===void 0&&(r=!1);var i=N(t,"x","cumsum"),o=Gr([e|=0],i.rank),a=i;o!=null&&(a=i.transpose(o));var s=Hr(1,i.rank)[0],u=O.runKernelFunc(function(l){return l.cumsum(a,s,n,r)},{permutedX:a},function(l){return{permutedX:function(){return l.cumsum(e,n,!r)}}});return o!=null&&(u=u.transpose(o)),u}}),$V=M({depthToSpace_:function(t,e,n){n===void 0&&(n="NHWC");var r=N(t,"x","depthToSpace"),i=n==="NHWC"?r.shape[1]:r.shape[2],o=n==="NHWC"?r.shape[2]:r.shape[3],a=n==="NHWC"?r.shape[3]:r.shape[1];return T(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape}),T(o*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+r.shape}),T(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),O.runKernelFunc(function(s){return s.depthToSpace(r,e,n)},{$x:r})}}),Un=M({expandDims_:function(t,e){e===void 0&&(e=0);var n=N(t,"x","expandDims",null);T(e<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return e<0&&(T(-(n.rank+1)<=e,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),e=n.rank+e+1),r.splice(e,0,1),cr(n,r)}}),RE=M({eye_:function(t,e,n,r){r===void 0&&(r="float32"),e==null&&(e=t);for(var i=xe([t,e],r),o=t<=e?t:e,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(t,e);if(n==null)return s;if(n.length===1)return Qa(Un(s,0),[n[0],1,1]);if(n.length===2)return Qa(Un(Un(s,0),0),[n[0],n[1],1,1]);if(n.length===3)return Qa(Un(Un(Un(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),WV=M({multinomial_:function(t,e,n,r){r===void 0&&(r=!1);var i=N(t,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=a===1?i.as2D(1,-1):i,u=O.runKernelFunc(function(l){return l.multinomial(s,r,e,n)},{logits2D:s});return a===1?u.as1D():u}}),pg=M({oneHot_:function(t,e,n,r){if(n===void 0&&(n=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=N(t,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),O.runKernelFunc(function(a){return a.oneHot(i,e,n,r)},{$indices:i},function(a){return{$indices:function(){return Ge(i.shape,"float32")}}}).reshape(o)}}),Jo=M({pad_:function(t,e,n){n===void 0&&(n=0);var r=N(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:n};return O.runKernelFunc(function(o){return o.pad(r,e,n)},{x:r},function(o){var a=e.map(function(s){return s[0]});return{x:function(){return o.slice(a,r.shape)}}},"PadV2",i)}}),GV=M({pad1d_:function(t,e,n){return n===void 0&&(n=0),T(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Jo(t,[e],n)}}),HV=M({pad2d_:function(t,e,n){return n===void 0&&(n=0),T(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Jo(t,e,n)}}),KV=M({pad3d_:function(t,e,n){return n===void 0&&(n=0),T(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Jo(t,e,n)}}),qV=M({pad4d_:function(t,e,n){return n===void 0&&(n=0),T(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Jo(t,e,n)}}),XV=M({rand_:function(t,e,n){var r=oe(t),i=null;if(n==null||n==="float32")i=new Float32Array(r);else if(n==="int32")i=new Int32Array(r);else{if(n!=="bool")throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return O.makeTensor(i,t,n)}}),YV=M({randomNormal_:function(t,e,n,r,i){if(e===void 0&&(e=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new Hy(e,n,r,!1,i),a=xe(t,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),JV=M({randomGamma_:function(t,e,n,r,i){if(n===void 0&&(n=1),r===void 0&&(r="float32"),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var o=new jV(e,n,r,i),a=xe(t,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),NE=M({randomUniform_:function(t,e,n,r,i){e===void 0&&(e=0),n===void 0&&(n=1),r===void 0&&(r="float32");for(var o=xe(t,r),a=new FV(e,n,null,i),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),cr=M({reshape_:function(t,e){var n=N(t,"x","reshape",null);e=T5(e,n.size),T(n.size===oe(e),function(){return"new shape and old shape must have the same number of elements."});var r={shape:e};return O.runKernelFunc(function(i){return i.reshape(n,e)},{x:n},function(i){return{x:function(){return i.reshape(n.shape)}}},"Reshape",r)}}),TE=M({spaceToBatchND_:function(t,e,n){var r=N(t,"x","spaceToBatchND");return T(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),T(n.length===e.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length}),T(r.shape.reduce(function(i,o,a){return a>0&&a<=e.length?i&&(o+n[a-1][0]+n[a-1][1])%e[a-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()}),O.runKernelFunc(function(i){return i.spaceToBatchND(r,e,n)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(e,n)}}})}}),PE=M({squeeze_:function(t,e){var n=N(t,"x","squeeze");return cr(n,So(n.shape,e).newShape)}}),In=M({stack_:function(t,e){e===void 0&&(e=0);var n=Od(t,"tensors","stack");if(T(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),n.length===1)return n[0].expandDims(e);var r=n[0].rank,i=n[0].shape,o=n[0].dtype;T(e<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(s){Oe(i,s.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(s){T(o===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=n.map(function(s){return s.expandDims(e)});return St(a,e)}}),Qa=M({tile_:function(t,e){var n=N(t,"x","tile",null);T(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."});var r=[n],i={reps:e};return O.runKernelFunc(function(o,a){var s=o.tile(n,e);return a([n]),s},{x:n},function(o,a){var s=a[0];return{x:function(){var u=Ne(s);if(s.rank===1)for(var l=0;l<e[0];++l)u=u.add(o.slice([l*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(l=0;l<e[0];++l)for(var c=0;c<e[1];++c)u=u.add(o.slice([l*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(l=0;l<e[0];++l)for(c=0;c<e[1];++c)for(var d=0;d<e[2];++d)u=u.add(o.slice([l*s.shape[0],c*s.shape[1],d*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(l=0;l<e[0];++l)for(c=0;c<e[1];++c)for(d=0;d<e[2];++d)for(var h=0;h<e[3];++h)u=u.add(o.slice([l*s.shape[0],c*s.shape[1],d*s.shape[2],h*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",i,r)}}),QV=M({truncatedNormal_:function(t,e,n,r,i){if(e===void 0&&(e=0),n===void 0&&(n=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new Hy(e,n,r,!0,i),a=xe(t,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Ct=M({unstack_:function(t,e){e===void 0&&(e=0),e=e||0;var n=N(t,"x","unstack");T(e>=-n.shape.length&&e<n.shape.length,function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),e<0&&(e+=n.shape.length);var r={axis:e};return O.runKernelFunc(function(i){return i.unstack(n,e)},{x:n},function(i){return{x:function(){return In(i,e)}}},"Unpack",r)}}),ZV=function(t,e){return ne(this,void 0,void 0,function(){var n,r,i,o,a,s,u,l,c,d;return re(this,function(h){switch(h.label){case 0:return n=N(t,"x","setdiff1d"),r=N(e,"y","setdiff1d"),T(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),T(n.rank===1,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),T(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return i=h.sent(),[4,r.data()];case 2:for(o=h.sent(),a=new Set(o),s=0,c=0;c<i.length;c++)a.has(i[c])||s++;for(u=new rl([s],n.dtype),l=new rl([s],"int32"),c=0,d=0;c<i.length;c++)a.has(i[c])||(u.values[d]=i[c],l.values[d]=c,d++);return[2,[u.toTensor(),l.toTensor()]]}})})};function Fd(t,e,n,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);for(var o=e.length,a=0;a<o;++a)i=i.concat([t[a+1]/e[a],e[a]]);i=i.concat(t.slice(o+1))}return i}function Ld(t,e,n){n===void 0&&(n=!0);var r=[];if(n){r.push(e);for(var i=e+1;i<t;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],a=[];for(i=1;i<t;++i)i>=2*e+1||i%2==1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r}function Bd(t,e,n,r){r===void 0&&(r=!0);var i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(var o=1;o<t.length;++o)o<=e.length?r?i.push(e[o-1]*t[o]):i.push(t[o]/e[o-1]):i.push(t[o]);return i}function IE(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function DE(t,e,n){for(var r=t.slice(0,1),i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}function ME(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(t.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],i=1,o=0;o<n.length-1;++o)i*=n[o];var a=t.shape,s=n.slice();s.pop();var u=1;for(o=r;o<t.rank;++o)u*=a[o],s.push(a[o]);var l=Br(t.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[s,i,u,l]}var OE=30;function ap(t){return t<=OE?t:ug(t,Math.floor(Math.sqrt(t)))}function ez(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(o+" update.rank < "+i+". ");if(t.length<r+(n.rank-i))throw new Error(o+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+t.length-r)throw new Error(o+" update.rank != "+(i+t.length-r));for(var a=0;a<i;++a)if(n.shape[a]!==e.shape[a])throw new Error(o+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<n.rank-i;++a)if(n.shape[a+i]!==t[a+r])throw new Error(o+" updates.shape["+(a+i)+"] ("+n.shape[a+i]+") != shape["+(a+i)+"] ("+t[a+i]+")")}function tz(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(n.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(t.size===0)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}ez(n,e,t)}function Vd(t,e,n){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,o=n.length,a=1,s=i;s<o;++s)a*=n[s];var u=i<1?1:i;return{sliceRank:i,numUpdates:oe(e.shape)/u,sliceSize:a,strides:Br(n.slice(0,i)).concat([1]),outputSize:oe(n)}}function nz(t,e,n){T(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."}),T(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+")."});for(var r=function(o){T(e[o]+n[o]<=t.shape[o],function(){return"Error in slice"+t.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+n[o])+") would overflow input.shape["+o+"] ("+t.shape[o]+")"})},i=0;i<t.rank;++i)r(i)}function l1(t){for(var e=[],n=0;t>0;)1&t&&e.push(n),t/=2,n++;return e}function Ky(t,e,n){for(var r=[],i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function rz(t,e,n,r,i){var o=e[i],a=n[i]||1;(t&1<<i||o==null)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=og(0,o,s-1)}function iz(t,e,n,r,i){var o=e[i],a=n[i]||1;(t&1<<i||o==null)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=a>0?og(0,o,s):og(-1,o,s-1)}function jE(t,e,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function FE(t,e){for(var n=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function oz(t,e){T(sg(t),function(){return"The f passed in variableGrads(f) must be a function"}),T(e==null||Array.isArray(e)&&e.every(function(c){return c instanceof gs}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=e!=null;if(!n)for(var r in e=[],O.registeredVariables)e.push(O.registeredVariables[r]);var i=n?e.filter(function(c){return!c.trainable}):null,o=e.length;T((e=e.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var a=O.gradients(t,e,null,!0),s=a.value,u=a.grads;T(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),T(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return e.forEach(function(c,d){u[d]!=null&&(l[c.name]=u[d])}),i!=null&&i.forEach(function(c){return l[c.name]=null}),{value:s,grads:l}}function Ph(t){return O.customGrad(t)}var yi=M({softmax_:function(t,e){e===void 0&&(e=-1);var n=N(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return O.runKernelFunc(function(r,i){var o=r.softmax(n,e);return i([o]),o},{logits:n},function(r,i){var o=i[0],a=r.mul(o);return{logits:function(){return a.sub(a.sum([e],!0).mul(o))}}},"Softmax",{dim:e},[],[!0])}}),az=M({logSoftmax_:function(t,e){e===void 0&&(e=-1);var n=N(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return Ph(function(r,i){var o=r.max(e,!0),a=r.sub(o),s=a.toFloat().sub(a.exp().sum(e,!0).log());return i([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}})(n)}}),LE=function(){function t(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},t.prototype.set=function(e,n){this.dataIdsCount++,this.data.set(e,n)},t.prototype.has=function(e){return this.data.has(e)},t.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),BE=function(){function t(){}return t.prototype.time=function(e){return V("time")},t.prototype.read=function(e){return V("read")},t.prototype.readSync=function(e){return V("readSync")},t.prototype.numDataIds=function(){return V("numDataIds")},t.prototype.disposeData=function(e){return V("disposeData")},t.prototype.write=function(e,n,r){return V("write")},t.prototype.move=function(e,n,r,i){return V("move")},t.prototype.memory=function(){return V("memory")},t.prototype.floatPrecision=function(){return V("floatPrecision")},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.batchMatMul=function(e,n,r,i){return V("batchMatMul")},t.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,V("fusedBatchMatMul")},t.prototype.slice=function(e,n,r){return V("slice")},t.prototype.stridedSlice=function(e,n,r,i){return V("stridedSlice")},t.prototype.unstack=function(e,n){return V("unstack")},t.prototype.reverse=function(e,n){return V("reverse")},t.prototype.concat=function(e,n){return V("concat")},t.prototype.neg=function(e){return V("neg")},t.prototype.add=function(e,n){return V("add")},t.prototype.addN=function(e){return V("addN")},t.prototype.subtract=function(e,n){return V("subtract")},t.prototype.multiply=function(e,n){return V("multiply")},t.prototype.realDivide=function(e,n){return V("realDivide")},t.prototype.floorDiv=function(e,n){return V("floorDiv")},t.prototype.sum=function(e,n){return V("sum")},t.prototype.prod=function(e,n){return V("prod")},t.prototype.unsortedSegmentSum=function(e,n,r){return V("unsortedSegmentSum")},t.prototype.argMin=function(e,n){return V("argMin")},t.prototype.argMax=function(e,n){return V("argMax")},t.prototype.equal=function(e,n){return V("equal")},t.prototype.notEqual=function(e,n){return V("notEqual")},t.prototype.less=function(e,n){return V("less")},t.prototype.lessEqual=function(e,n){return V("lessEqual")},t.prototype.greater=function(e,n){return V("greater")},t.prototype.greaterEqual=function(e,n){return V("greaterEqual")},t.prototype.logicalNot=function(e){return V("logicalNot")},t.prototype.logicalAnd=function(e,n){return V("logicalAnd")},t.prototype.logicalOr=function(e,n){return V("logicalOr")},t.prototype.where=function(e){return V("where")},t.prototype.select=function(e,n,r){return V("select")},t.prototype.topk=function(e,n,r){return V("topk")},t.prototype.min=function(e,n){return V("min")},t.prototype.minimum=function(e,n){return V("minimum")},t.prototype.mod=function(e,n){return V("mod")},t.prototype.max=function(e,n){return V("max")},t.prototype.maximum=function(e,n){return V("maximum")},t.prototype.all=function(e,n){return V("all")},t.prototype.any=function(e,n){return V("any")},t.prototype.squaredDifference=function(e,n){return V("squaredDifference")},t.prototype.ceil=function(e){return V("ceil")},t.prototype.floor=function(e){return V("floor")},t.prototype.round=function(e){return V("round")},t.prototype.sign=function(e){return V("sign")},t.prototype.isNaN=function(e){return V("isNaN")},t.prototype.isInf=function(e){return V("isInf")},t.prototype.isFinite=function(e){return V("isFinite")},t.prototype.pow=function(e,n){return V("pow")},t.prototype.exp=function(e){return V("exp")},t.prototype.expm1=function(e){return V("expm1")},t.prototype.softmax=function(e,n){return V("softmax")},t.prototype.log=function(e){return V("log")},t.prototype.log1p=function(e){return V("log1p")},t.prototype.sqrt=function(e){return V("sqrt")},t.prototype.rsqrt=function(e){return V("rsqrt")},t.prototype.square=function(e){return V("square")},t.prototype.reciprocal=function(e){return V("reciprocal")},t.prototype.relu=function(e){return V("relu")},t.prototype.relu6=function(e){return V("relu6")},t.prototype.prelu=function(e,n){return V("prelu")},t.prototype.elu=function(e){return V("elu")},t.prototype.eluDer=function(e,n){return V("eluDer")},t.prototype.selu=function(e){return V("selu")},t.prototype.int=function(e){return V("int")},t.prototype.clip=function(e,n,r){return V("clip")},t.prototype.abs=function(e){return V("abs")},t.prototype.complexAbs=function(e){return V("complexAbs")},t.prototype.sigmoid=function(e){return V("sigmoid")},t.prototype.softplus=function(e){return V("softplus")},t.prototype.sin=function(e){return V("sin")},t.prototype.cos=function(e){return V("cos")},t.prototype.tan=function(e){return V("tan")},t.prototype.asin=function(e){return V("asin")},t.prototype.acos=function(e){return V("acos")},t.prototype.atan=function(e){return V("atan")},t.prototype.atan2=function(e,n){return V("atan2")},t.prototype.sinh=function(e){return V("sinh")},t.prototype.cosh=function(e){return V("cosh")},t.prototype.tanh=function(e){return V("tanh")},t.prototype.asinh=function(e){return V("asinh")},t.prototype.acosh=function(e){return V("acosh")},t.prototype.atanh=function(e){return V("atanh")},t.prototype.erf=function(e){return V("erf")},t.prototype.step=function(e,n){return V("step")},t.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,V("fusedConv2d")},t.prototype.conv2d=function(e,n,r){return V("conv2d")},t.prototype.conv2dDerInput=function(e,n,r){return V("conv2dDerInput")},t.prototype.conv2dDerFilter=function(e,n,r){return V("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,V("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(e,n,r){return V("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(e,n,r){return V("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(e,n,r){return V("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(e,n,r){return V("conv3d")},t.prototype.conv3dDerInput=function(e,n,r){return V("conv3dDerInput")},t.prototype.conv3dDerFilter=function(e,n,r){return V("conv3dDerFilter")},t.prototype.maxPool=function(e,n){return V("maxPool")},t.prototype.maxPoolBackprop=function(e,n,r,i){return V("maxPoolBackprop")},t.prototype.avgPool=function(e,n){return V("avgPool")},t.prototype.avgPoolBackprop=function(e,n,r){return V("avgPoolBackprop")},t.prototype.avgPool3d=function(e,n){return V("avgPool3d")},t.prototype.avgPool3dBackprop=function(e,n,r){return V("avgPool3dBackprop")},t.prototype.maxPool3d=function(e,n){return V("maxPool3d")},t.prototype.maxPool3dBackprop=function(e,n,r,i){return V("maxPool3dBackprop")},t.prototype.reshape=function(e,n){return V("reshape")},t.prototype.cast=function(e,n){return V("cast")},t.prototype.tile=function(e,n){return V("tile")},t.prototype.pad=function(e,n,r){return V("pad")},t.prototype.transpose=function(e,n){return V("transpose")},t.prototype.gather=function(e,n,r){return V("gather")},t.prototype.gatherND=function(e,n){return V("gatherND")},t.prototype.scatterND=function(e,n,r){return V("scatterND")},t.prototype.batchToSpaceND=function(e,n,r){return V("batchToSpaceND")},t.prototype.spaceToBatchND=function(e,n,r){return V("spaceToBatchND")},t.prototype.resizeBilinear=function(e,n,r,i){return V("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(e,n,r){return V("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(e,n,r,i){return V("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(e,n,r){return V("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(e,n,r,i,o,a){return V("batchNormalization")},t.prototype.localResponseNormalization4D=function(e,n,r,i,o){return V("localResponseNormalization4D")},t.prototype.LRNGrad=function(e,n,r,i,o,a,s){return V("LRNGrad")},t.prototype.multinomial=function(e,n,r,i){return V("multinomial")},t.prototype.oneHot=function(e,n,r,i){return V("oneHot")},t.prototype.cumsum=function(e,n,r,i){return V("cumsum")},t.prototype.nonMaxSuppression=function(e,n,r,i,o){return V("nonMaxSuppression")},t.prototype.fft=function(e){return V("fft")},t.prototype.ifft=function(e){return V("ifft")},t.prototype.complex=function(e,n){return V("complex")},t.prototype.real=function(e){return V("real")},t.prototype.imag=function(e){return V("imag")},t.prototype.cropAndResize=function(e,n,r,i,o,a){return V("cropAndResize")},t.prototype.depthToSpace=function(e,n,r){return V("depthToSpace")},t.prototype.split=function(e,n,r){return V("split")},t.prototype.sparseToDense=function(e,n,r,i){return V("sparseToDense")},t.prototype.diag=function(e){return V("diag")},t.prototype.fill=function(e,n,r){return V("fill")},t.prototype.onesLike=function(e){return V("onesLike")},t.prototype.zerosLike=function(e){return V("zerosLike")},t.prototype.linspace=function(e,n,r){return V("linspace")},t.prototype.dispose=function(){return V("dispose")},t}();function V(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Fi(t,e){for(var n=t.length,r=[],i=0;i<n;i++){var o=n-1-i,a=t[o]||1;(e[e.length-1-i]||1)>1&&a===1&&r.unshift(o)}return r}function Et(t,e){for(var n=[],r=0;r<e.length;r++){var i=t[t.length-r-1],o=e.length-r-1,a=e[o];(i==null||i===1&&a>1)&&n.unshift(o)}return n}function Ae(t,e){for(var n=[],r=Math.max(t.length,e.length),i=0;i<r;i++){var o=t[t.length-i-1];o==null&&(o=1);var a=e[e.length-i-1];if(a==null&&(a=1),o===1)n.unshift(a);else if(a===1)n.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(o)}}return n}function ol(t,e,n,r,i,o,a){a===void 0&&(a="channelsLast");var s,u=$d(e),l=u[0],c=u[1];if(a==="channelsLast")s=[l,c,t[3],t[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[l,c,t[1],t[1]]}return Qo(t,s,n,r,i,o,!1,a)}function zd(t,e,n,r,i,o,a){a===void 0&&(a="NDHWC");var s,u,l=mg(e),c=l[0],d=l[1],h=l[2];if(a==="NDHWC")u="channelsLast",s=[c,d,h,t[4],t[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[c,d,h,t[1],t[1]]}return Ud(t,s,n,r,i,!1,u,o)}function Qo(t,e,n,r,i,o,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],h=u[3];if(s==="channelsLast")l=t[0],c=t[1],d=t[2],h=t[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=t[0],h=t[1],c=t[2],d=t[3]}var f,m=e[0],p=e[1],v=e[3],g=$d(n),x=g[0],w=g[1],b=$d(r),k=b[0],_=b[1],S=Za(m,k),C=Za(p,_),E=function(U,z,W,L,I,j,B,K){var X,Y,ie;if(typeof U=="number"){X={top:U,bottom:U,left:U,right:U,type:U===0?"VALID":"NUMBER"};var fe=function(_e,Te,De,ut,Je){ut==null&&(ut=VE(_e,Te,De));var Qe=_e[0],kr=_e[1],_r=Cu((Qe-Te+2*ut)/De+1,Je);T(pt(_r),function(){return"The output # of rows ("+_r+") must be an integer. Change the stride and/or zero pad parameters"});var wn=Cu((kr-Te+2*ut)/De+1,Je);return T(pt(wn),function(){return"The output # of columns ("+wn+") must be an integer. Change the stride and/or zero pad parameters"}),[_r,wn]}([z,W],j,L,U,K);Y=fe[0],ie=fe[1]}else if(U==="same"){Y=Math.ceil(z/L),ie=Math.ceil(W/I);var pe=Math.max(0,(Y-1)*L+j-z),ce=Math.max(0,(ie-1)*I+B-W),Ce=Math.floor(pe/2),ke=pe-Ce,Be=Math.floor(ce/2);X={top:Ce,bottom:ke,left:Be,right:ce-Be,type:"SAME"}}else{if(U!=="valid")throw Error("Unknown padding parameter: "+U);X={top:0,bottom:0,left:0,right:0,type:"VALID"},Y=Math.ceil((z-j+1)/L),ie=Math.ceil((W-B+1)/I)}return{padInfo:X,outHeight:Y,outWidth:ie}}(i,c,d,x,w,S,C,o),R=E.padInfo,D=E.outHeight,P=E.outWidth,F=a?v*h:v;return s==="channelsFirst"?f=[l,F,D,P]:s==="channelsLast"&&(f=[l,D,P,F]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:d,inChannels:h,outHeight:D,outWidth:P,outChannels:F,padInfo:R,strideHeight:x,strideWidth:w,filterHeight:m,filterWidth:p,effectiveFilterHeight:S,effectiveFilterWidth:C,dilationHeight:k,dilationWidth:_,inShape:t,outShape:f,filterShape:e}}function Ud(t,e,n,r,i,o,a,s){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],d=u[2],h=u[3],f=u[4];if(a==="channelsLast")l=t[0],c=t[1],d=t[2],h=t[3],f=t[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);l=t[0],f=t[1],c=t[2],d=t[3],h=t[4]}var m,p=e[0],v=e[1],g=e[2],x=e[4],w=mg(n),b=w[0],k=w[1],_=w[2],S=mg(r),C=S[0],E=S[1],R=S[2],D=Za(p,C),P=Za(v,E),F=Za(g,R),U=function(B,K,X,Y,ie,fe,pe,ce,Ce,ke,Be){var _e,Te,De,ut;if(typeof B=="number"){_e={top:B,bottom:B,left:B,right:B,front:B,back:B,type:B===0?"VALID":"NUMBER"};var Je=function(oa,Yr,Qh,aa,Sr,Zh){Sr==null&&(Sr=VE(oa,Yr,aa));var mP=oa[0],gP=oa[1],vP=oa[2],ef=Cu((mP-Yr+2*Sr)/aa+1,Zh);T(pt(ef),function(){return"The output # of depths ("+ef+") must be an integer. Change the stride and/or zero pad parameters"});var tf=Cu((gP-Yr+2*Sr)/aa+1,Zh);T(pt(tf),function(){return"The output # of rows ("+tf+") must be an integer. Change the stride and/or zero pad parameters"});var nf=Cu((vP-Yr+2*Sr)/aa+1,Zh);return T(pt(nf),function(){return"The output # of columns ("+nf+") must be an integer. Change the stride and/or zero pad parameters"}),[ef,tf,nf,Qh]}([K,X,Y,1],ce,1,ie,B,Be);Te=Je[0],De=Je[1],ut=Je[2]}else if(B==="same"){Te=Math.ceil(K/ie),De=Math.ceil(X/fe),ut=Math.ceil(Y/pe);var Qe=(Te-1)*ie+ce-K,kr=(De-1)*fe+Ce-X,_r=(ut-1)*pe+ke-Y,wn=Math.floor(Qe/2),ia=Qe-wn,qr=Math.floor(kr/2),_i=kr-qr,Xr=Math.floor(_r/2);_e={top:qr,bottom:_i,left:Xr,right:_r-Xr,front:wn,back:ia,type:"SAME"}}else{if(B!=="valid")throw Error("Unknown padding parameter: "+B);_e={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Te=Math.ceil((K-ce+1)/ie),De=Math.ceil((X-Ce+1)/fe),ut=Math.ceil((Y-ke+1)/pe)}return{padInfo:_e,outDepth:Te,outHeight:De,outWidth:ut}}(i,c,d,h,b,k,_,D,P,F,s),z=U.padInfo,W=U.outDepth,L=U.outHeight,I=U.outWidth,j=o?x*f:x;return a==="channelsFirst"?m=[l,j,W,L,I]:a==="channelsLast"&&(m=[l,W,L,I,j]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:d,inWidth:h,inChannels:f,outDepth:W,outHeight:L,outWidth:I,outChannels:j,padInfo:z,strideDepth:b,strideHeight:k,strideWidth:_,filterDepth:p,filterHeight:v,filterWidth:g,effectiveFilterDepth:D,effectiveFilterHeight:P,effectiveFilterWidth:F,dilationDepth:C,dilationHeight:E,dilationWidth:R,inShape:t,outShape:m,filterShape:e}}function VE(t,e,n,r){r===void 0&&(r=1);var i=Za(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function $d(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function mg(t){return typeof t=="number"?[t,t,t]:t}function Za(t,e){return e<=1?t:t+(t-1)*(e-1)}function Cu(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function ys(t){var e=$d(t),n=e[0],r=e[1],i=e[2];return n===1&&r===1&&i===1}function xn(t,e){return ys(t)||ys(e)}function qy(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function zE(t,e,n){if(e==="complex64"){if(t.dtype==="complex64")return t.clone();var r=Ge(t.shape),i=t.toFloat(),o=n.complex(i,r);return r.dispose(),i.dispose(),o}if(!D5(t.dtype,e))return O.makeTensorFromDataId(t.dataId,t.shape,e);if(t.dtype==="complex64"){var a=n.real(t);return o=a.cast(e),a.dispose(),o}if(e==="int32")return n.int(t);if(e==="bool"){var s=J(0,t.dtype);return o=n.notEqual(t,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+e)}function gg(t,e){return O.makeTensorFromDataId(t.dataId,e,t.dtype)}function UE(t,e,n){var r=(e-t)/(n-1),i=Sl(n,"float32");i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return yt(i,"float32")}function vg(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function c1(t,e){return{real:t[2*e],imag:t[2*e+1]}}function sz(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function uz(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function lz(t,e,n){var r=function(o,a,s){return function(u,l,c){for(var d=0,h=u.length,f=0,m=!1;d<h;){var p=c(l,u[f=d+(h-d>>>1)]);p>0?d=f+1:(h=f,m=!p)}return m?d:-d-1}(o,a,s||cz)}(t,e,n),i=r<0?-(r+1):r;t.splice(i,0,e)}function cz(t,e){return t>e?1:t<e?-1:0}function Xy(t,e,n,r,i){return $E(t,e,n,r,i,0).selectedIndices}function Yy(t,e,n,r,i,o){var a=$E(t,e,n,r,i,o);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function $E(t,e,n,r,i,o,a,s){s===void 0&&(s=!1);for(var u=Array.from(e).map(function(b,k){return{score:b,boxIndex:k,suppressBeginIndex:0}}).filter(function(b){return b.score>i}).sort(d1),l=o>0?-.5/o:0,c=[],d=[];c.length<n&&u.length>0;){var h=u.pop(),f=h.score,m=h.boxIndex,p=h.suppressBeginIndex;if(f<i)break;for(var v=!1,g=c.length-1;g>=p;--g){var x=dz(t,m,c[g]);if(x>=r){v=!0;break}if(h.score=h.score*hz(r,l,x),h.score<=i)break}h.suppressBeginIndex=c.length,v||(h.score===f?(c.push(m),d.push(h.score)):h.score>i&&lz(u,h,d1))}var w=c.length;return s&&(c.fill(0,w),d.fill(0,w)),{selectedIndices:yt(c,"int32"),selectedScores:yt(d,"float32"),numValidOutputs:J(w,"int32")}}function dz(t,e,n){var r=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),f=(s-o)*(u-a),m=(d-l)*(h-c);if(f<=0||m<=0)return 0;var p=Math.max(o,l),v=Math.max(a,c),g=Math.min(s,d),x=Math.min(u,h),w=Math.max(g-p,0)*Math.max(x-v,0);return w/(f+m-w)}function hz(t,e,n){var r=Math.exp(e*n*n);return n<=t?r:0}function d1(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}function WE(t,e,n){var r=new Array(t.rank).fill(0),i=t.shape.slice();return e.map(function(o){i[n]=o;var a=t.slice(r,i);return r[n]+=o,a})}function GE(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var i=xe(n,t.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),a=new Array(t.rank),s=0;s<a.length;s++)a[s]=o[s]%t.shape[s];var u=t.locToIndex(a);i.values[r]=t.values[u]}return i.toTensor()}function HE(t,e,n,r,i){for(var o=e[e.length-1],a=[t.length/o,o],s=a[0],u=a[1],l=nl(n,s*r),c=nl("int32",s*r),d=0;d<s;d++){for(var h=d*u,f=t.subarray(h,h+u),m=[],p=0;p<f.length;p++)m.push({value:f[p],index:p});m.sort(function(b,k){return k.value-b.value});var v=d*r,g=l.subarray(v,v+r),x=c.subarray(v,v+r);for(p=0;p<r;p++)g[p]=m[p].value,x[p]=m[p].index}var w=e.slice();return w[w.length-1]=r,[Bt(l,w,n),Bt(c,w,"int32")]}function Jy(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var i=xe(t,"int32"),o=xe([n.length,t.length],"int32");for(r=0;r<n.length;r++){var a=i.indexToLoc(n[r]),s=r*t.length;o.values.set(a,s)}return o.toTensor()}var fz=function(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(function(i,o){return"T"+o});var n=[];this.variableNames.forEach(function(i){n.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},pz=function(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(function(i,o){return"T"+o});var n=[];this.variableNames.forEach(function(i){n.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},mz=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,i=t.batchSize,o=t.inSize,a=Math.ceil(o/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s=e==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function KE(t,e){return["x","y","z","w","u","v"].slice(0,e).map(function(n){return t+"."+n})}function dn(t,e){return e===1?[t]:KE(t,e)}function qt(){var t,e,n,r,i,o,a,s,u,l;return G().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",r="in",i="texture",o="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",r="varying",i="texture2D",o="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function Do(t,e,n){n===void 0&&(n="index");var r=Br(e);return r.map(function(i,o){return"int "+t[o]+" = "+n+" / "+i+"; "+(o===r.length-1?"int "+t[o+1]+" = "+n+" - "+t[o]+" * "+i:"index -= "+t[o]+" * "+i)+";"}).join("")}function Qy(t){var e=Br(t).map(function(n){return n.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var qE=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function gz(t,e,n,r){var i=[];t.forEach(function(f){var m=oe(f.shapeInfo.logicalShape);f.shapeInfo.isUniform?i.push("uniform float "+f.name+(m>1?"["+m+"]":"")+";"):(i.push("uniform sampler2D "+f.name+";"),i.push("uniform int offset"+f.name+";"))});var o,a,s=i.join(`
`),u=t.map(function(f){return function(m,p,v){v===void 0&&(v=!1);var g="";g+=v?XE(m):xa(m);var x=m.shapeInfo.logicalShape,w=p.logicalShape;return x.length<=w.length&&(g+=v?function(b,k){var _,S=b.name,C=S.charAt(0).toUpperCase()+S.slice(1),E="get"+C+"AtOutCoords",R=b.shapeInfo.logicalShape.length,D=k.logicalShape.length,P=Fi(b.shapeInfo.logicalShape,k.logicalShape),F=Ue(D),U=D-R,z=["x","y","z","w","u","v"];_=R===0?"":D<2&&P.length>=1?"coords = 0;":P.map(function(X){return"coords."+z[X+U]+" = 0;"}).join(`
`);var W="";W=D<2&&R>0?"coords":b.shapeInfo.logicalShape.map(function(X,Y){return"coords."+z[Y+U]}).join(", ");var L="return outputValue;",I=oe(b.shapeInfo.logicalShape)===1,j=oe(k.logicalShape)===1;if(R!==1||I||j){if(I&&!j)L=D===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(P.length){var B=R-2,K=R-1;P.indexOf(B)>-1&&P.indexOf(K)>-1?L="return vec4(outputValue.x);":P.indexOf(B)>-1?L="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":P.indexOf(K)>-1&&(L="return vec4(outputValue.xx, outputValue.zz);")}}else L=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+E+`() {
      `+F+` coords = getOutputCoords();
      `+_+`
      vec4 outputValue = get`+C+"("+W+`);
      `+L+`
    }
  `}(m,p):function(b,k){var _=b.name,S=_.charAt(0).toUpperCase()+_.slice(1),C="get"+S+"AtOutCoords",E=k.texShape,R=b.shapeInfo.texShape,D=b.shapeInfo.logicalShape.length,P=k.logicalShape.length;if(!b.shapeInfo.isUniform&&D===P&&b.shapeInfo.flatOffset==null&&It(R,E))return`
      float `+C+`() {
        return sampleTexture(`+_+`, resultUV);
      }
    `;var F,U=Ue(P),z=Fi(b.shapeInfo.logicalShape,k.logicalShape),W=P-D,L=["x","y","z","w","u","v"];F=D===0?"":P<2&&z.length>=1?"coords = 0;":z.map(function(j){return"coords."+L[j+W]+" = 0;"}).join(`
`);var I="";return I=P<2&&D>0?"coords":b.shapeInfo.logicalShape.map(function(j,B){return"coords."+L[B+W]}).join(", "),`
    float `+C+`() {
      `+U+` coords = getOutputCoords();
      `+F+`
      return get`+S+"("+I+`);
    }
  `}(m,p)),g}(f,e,r)}).join(`
`),l=e.texShape,c=qt(),d=function(f){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+f.texture2D+`(textureSampler, uv).r;
    }
  `}(c),h=function(f){return f.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+f.varyingFs+` vec2 resultUV;
    `+f.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+f.defineSpecialNaN+`
    `+f.defineSpecialInf+`
    `+f.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+vz+`
    `+yz+`
    `+xz+`
  `}(c);return e.isPacked?(o=function(f,m){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(b,k){var _=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];return _[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+_[1]+`.0);
      }
    `:_[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+_[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      return 2 * (resTexRC.x * `+_[1]+` + resTexRC.y);
    }
  `}(0,m);case 2:return function(b,k){var _=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];if(It(b,k))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+_[0]+", "+_[1]+`));
      }
    `;var S=Math.ceil(b[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));

      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec2(r, c);
    }
  `}(f,m);case 3:return p=f,v=m,g=[Math.ceil(v[0]/2),Math.ceil(v[1]/2)],x=Math.ceil(p[2]/2),w=x*Math.ceil(p[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      int b = index / `+w+`;
      index -= b * `+w+`;

      int r = 2 * (index / `+x+`);
      int c = imod(index, `+x+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(b,k){for(var _=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)],S=Math.ceil(b[b.length-1]/2),C=S*Math.ceil(b[b.length-2]/2),E=C,R="",D="b, r, c",P=2;P<b.length-1;P++)E*=b[b.length-P-1],R=`
      int b`+P+" = index / "+E+`;
      index -= b`+P+" * "+E+`;
    `+R,D="b"+P+", "+D;return`
    ivec`+b.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+R+`

      int b = index / `+C+`;
      index -= b * `+C+`;

      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec`+b.length+"("+D+`);
    }
  `}(f,m)}var p,v,g,x,w}(e.logicalShape,l),a=function(f){return`
    void setOutput(vec4 val) {
      `+f.output+` = val;
    }
  `}(c)):(o=function(f,m){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(g,x){return x[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+x[1]+`.0);
      }
    `:x[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+x[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      return resTexRC.x * `+x[1]+` + resTexRC.y;
    }
  `}(0,m);case 2:return function(g,x){return It(g,x)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+x[0]+", "+x[1]+`));
      }
    `:g[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:g[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      int r = index / `+g[1]+`;
      int c = index - r * `+g[1]+`;
      return ivec2(r, c);
    }
  `}(f,m);case 3:return p=m,v=Do(["r","c","d"],f),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+p[0]+", "+p[1]+`));
      int index = resTexRC.x * `+p[1]+` + resTexRC.y;
      `+v+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(g,x){var w=Do(["r","c","d","d2"],g);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+w+`
      return ivec4(r, c, d, d2);
    }
  `}(f,m);case 5:return function(g,x){var w=Do(["r","c","d","d2","d3"],g);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+x[0]+`,
                             `+x[1]+`));

      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+w+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(f,m);case 6:return function(g,x){var w=Do(["r","c","d","d2","d3","d4"],g);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+w+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(f,m);default:throw new Error(f.length+"-D output sampling is not yet supported")}var p,v}(e.logicalShape,l),a=function(f){return`
    void setOutput(float val) {
      `+f.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(h+=wz),[h,d,a,s,o,u,n].join(`
`)}function xa(t){var e=t.shapeInfo.logicalShape;switch(e.length){case 0:return function(n){var r=n.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=n.shapeInfo.texShape,a=o[0],s=o[1];if(a===1&&s===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=n.shapeInfo.texShape,l=u[0],c=u[1],d=mo(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+d+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(t);case 1:return function(n){var r=n.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(n.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+ca(n)+`
      }
    `;var o=n.shapeInfo.texShape,a=o[0],s=o[1];if(s===1&&a===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=mo(r);return s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(t);case 2:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n.shapeInfo.texShape;if(a!=null&&It(r,a)){var s=a[0],u=a[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var l=So(r),c=l.newShape,d=l.keptDims,h=c;if(h.length<r.length){var f=wa(n,h);return`
      `+xa(f)+`
      float `+o+`(int row, int col) {
        return `+o+"("+ba(["row","col"],d)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+ca(n)+`
      }
    `;var m=a[0],p=a[1],v=mo(i);return p===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+m+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:m===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+p+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+v+`;
    vec2 uv = uvFromFlat(`+m+", "+p+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(t);case 3:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[1]*r[2],s=r[2],u=So(r),l=u.newShape,c=u.keptDims,d=l;if(d.length<r.length){var h=wa(n,d);return`
        `+xa(h)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+ba(["row","col","depth"],c)+`);
        }
      `}if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+ca(n)+`
      }
    `;var f=n.shapeInfo.texShape,m=f[0],p=f[1],v=n.shapeInfo.flatOffset;if(p===a&&v==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+p+".0, "+m+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(p===s&&v==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+p+".0, "+m+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var g=mo(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+g+`;
        vec2 uv = uvFromFlat(`+m+", "+p+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(t);case 4:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,l=So(r),c=l.newShape,d=l.keptDims;if(c.length<r.length){var h=wa(n,c);return`
      `+xa(h)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+ba(["row","col","depth","depth2"],d)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+ca(n)+`
      }
    `;var f=n.shapeInfo.flatOffset,m=n.shapeInfo.texShape,p=m[0],v=m[1];if(v===u&&f==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+p+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(v===a&&f==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+p+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var g=mo(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+p+", "+v+", index + "+g+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(t);case 5:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,l=r[1]*u,c=So(r),d=c.newShape,h=c.keptDims;if(d.length<r.length){var f=wa(n,d);return`
      `+xa(f)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+ba(["row","col","depth","depth2","depth3"],h)+`);
      }
    `}if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+ca(n)+`
      }
    `;var m=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,v=p[0],g=p[1];if(g===l&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(g===a&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var x=mo(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+x+`;
      vec2 uv = uvFromFlat(`+v+", "+g+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(t);case 6:return function(n){var r=n.shapeInfo.logicalShape,i=n.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=So(r),s=a.newShape,u=a.keptDims;if(s.length<r.length){var l=wa(n,s);return`
      `+xa(l)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+ba(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],d=r[4]*c,h=r[3]*d,f=r[2]*h,m=r[1]*f;if(n.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+m+", "+f+", "+h+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+ca(n)+`
      }
    `;var p=n.shapeInfo.flatOffset,v=n.shapeInfo.texShape,g=v[0],x=v[1];if(x===m&&p==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+f+", "+h+", "+d+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(x===c&&p==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var w=mo(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+m+" + col * "+f+" + depth * "+h+` +
          depth2 * `+d+" + depth3 * "+c+" + depth4 + "+w+`;
      vec2 uv = uvFromFlat(`+g+", "+x+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(t);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function XE(t){var e,n,r;switch(t.shapeInfo.logicalShape.length){case 0:return e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=qt(),`
    vec4 `+n+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(i){var o=i.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),s=i.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=qt();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+o+`, uv);
    }
  `}(t);case 2:return function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=u[0],c=u[1],d=qt();if(u!=null&&It(o,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+d.texture2D+"("+a+`, uv);
      }
    `;var h=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],f=Math.ceil(o[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+f+", "+h[0]+", "+h[1]+`, row, col);
      return `+d.texture2D+"("+a+`, uv);
    }
  `}(t);case 3:return function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var c=o.slice(1),d=wa(i,c);return`
        `+XE(d)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+ba(["b","row","col"],[1,2])+`);
        }
      `}var h=l[0],f=l[1],m=Math.ceil(o[2]/2),p=m*Math.ceil(o[1]/2),v=qt();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+h+", "+f+", "+p+", "+m+`, b, row, col);
      return `+v.texture2D+"("+a+`, uv);
    }
  `}(t);default:return function(i){for(var o=i.shapeInfo.logicalShape,a=o.length,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=i.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],d=c[0],h=c[1],f=Math.ceil(o[a-1]/2),m=f*Math.ceil(o[a-2]/2),p="int b, int row, int col",v="b * "+m+" + (row / 2) * "+f+" + (col / 2)",g=2;g<a-1;g++)p="int b"+g+", "+p,m*=o[a-g-1],v="b"+g+" * "+m+" + "+v;var x=qt();return`
    vec4 `+u+"("+p+`) {
      int index = `+v+`;
      int texR = index / `+h+`;
      int texC = index - texR * `+h+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+h+", "+d+`);
      return `+x.texture2D+"("+s+`, uv);
    }
  `}(t)}}var vz=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,yz=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,xz=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,wz=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function mo(t){return"offset"+t}function ca(t){var e=t.name,n=oe(t.shapeInfo.logicalShape);return n<2?"return "+e+";":`
    for (int i = 0; i < `+n+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Ue(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function wa(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function ba(t,e){return e.map(function(n){return t[n]}).join(", ")}var bz=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,T(t.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var i=t[t.length-1],o=Math.ceil(i/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,l=u.length,c=Ue(l),d=dn("coords",l);if(o===1){var h=Ue(s=l+1);a=`
        `+h+" sourceLocR = "+h+"("+d.join()+`, 0);
        ++`+d[l-1]+`;
        `+h+" sourceLocG = "+h+"("+d.join()+`, 0);
        ++`+d[l-2]+`;
        `+h+" sourceLocA = "+h+"("+d.join()+`, 0);
        --`+d[l-1]+`;
        `+h+" sourceLocB = "+h+"("+d.join()+`, 0);
        --`+d[l-2]+";"}else s=l,a=`
        `+c+` sourceLocR = coords;
        ++`+d[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+d[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+d[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+d[l-2]+";";var f=["x","y","z","w","u","v"].slice(0,s),m="."+f[s-1],p=f.map(function(C){return"int "+C}),v=dn("sourceLocR",s-1).concat("inIdx.r"),g=dn("sourceLocG",s-1).concat("inIdx.g"),x=dn("sourceLocB",s-1).concat("inIdx.b"),w=dn("sourceLocA",s-1).concat("inIdx.a"),b=n==="max"?"greaterThan":"lessThan",k=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+w.join()+")));",_=`vec4(
            getAChannel(`+v.join()+`),
            hasNextCol ? getAChannel(`+g.join()+`) : 0.,
            hasNextRow ? getAChannel(`+x.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+w.join()+") : 0.)",S=r?"":`
      float getBestIndicesAChannel(`+p.join()+`) {
        return getChannel(getBestIndicesA(`+f.join()+`),
                                          vec2(`+f.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+p.join()+`) {
        return getChannel(getA(`+f.join()+`),
                               vec2(`+f.slice(-2).join()+`));
      }
      `+S+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+d[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+d[l-2]+" < "+(u[l-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+m+", sourceLocG"+m+`,
          sourceLocB`+m+", sourceLocA"+m+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+_+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+k+`
          vec4 candidate = `+_+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+b+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},kz=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=s-1-t.padInfo.top,c=u-1-t.padInfo.left,d=1/(e*n);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},_z=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,d=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=c-1-t.padInfo.front,m=d-1-t.padInfo.top,p=h-1-t.padInfo.left,v=1/(e*n*r);this.userCode=`
      const ivec3 pads = ivec3(`+f+", "+m+", "+p+`);
      const float avgMultiplier = float(`+v+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+t.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+h+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Sz=function(t,e,n,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Ae(t,e),Ae(t,n);var a="0.0";r!=null&&(Ae(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";i!=null&&(Ae(t,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},Cz=function(t,e,n,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ae(t,e),Ae(t,n);var a="vec4(0.0)";r!=null&&(Ae(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";i!=null&&(Ae(t,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},Ez="return areal * breal - aimag * bimag;",Az="return areal * bimag + aimag * breal;",h1=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ae(e,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+t+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},sp="return a + b;",up="return a - b;",f1="return a * b;",YE="return (a < 0.) ? b * a : a;",lt=function(t,e,n){this.variableNames=["A","B"],this.outputShape=Ae(e,n),this.userCode=`
      float binaryOperation(float a, float b) {
        `+t+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},JE=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,ei=function(t,e,n,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ae(e,n);var i=this.outputShape.length,o="";if(r)if(i===0||oe(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+Ue(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=dn("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+a[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+a[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+t+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},Rz=function(){function t(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return t.prototype.getCustomSetupFunc=function(e,n){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,n)}},t}(),Nz=function(){function t(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return t.prototype.getCustomSetupFunc=function(e,n){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,n)}},t}(),Tz=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},Pz=function(t){this.outputShape=[],this.outputShape=vs(t,1),this.variableNames=t.map(function(s,u){return"T"+u});var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++){var i=e[n-1];r.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+i+"));")}var o=e.length,a=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},Iz=function(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=vs(t,e);var n=this.outputShape,r=n.length,i=Ue(r),o=dn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(v,g){return"T"+g});var s=new Array(t.length-1);s[0]=t[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][e];var l=a[e],c=a.slice(-2),d=a.join(),h="if ("+l+" < "+s[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+c.join()+`));
        }`;for(u=1;u<s.length;u++){var f=s[u-1];h+=`
        if (`+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+dc(a,l,f)+`),
            vec2(`+dc(c,l,f)+`));
        }`}var m=s.length,p=s[s.length-1];h+=`
        return getChannel(
          getT`+m+"("+dc(a,l,p)+`),
          vec2(`+dc(c,l,p)+"));",this.userCode=`
      float getValue(`+a.map(function(v){return"int "+v})+`) {
        `+h+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[r-1]+" = "+o[r-1]+` + 1;
        if (`+o[r-1]+" < "+n[r-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[r-2]+" = "+o[r-2]+` + 1;
        if (`+o[r-2]+" < "+n[r-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[r-1]+" = "+o[r-1]+` - 1;
        if (`+o[r-2]+" < "+n[r-2]+` &&
            `+o[r-1]+" < "+n[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function dc(t,e,n){var r=t.indexOf(e);return t.map(function(i,o){return o===r?i+" - "+n:i}).join()}var Dz=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+t.batchSize+`; b++) {
          for (int yR = 0; yR < `+t.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+t.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+i+`;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Mz=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dataFormat==="channelsLast",a=e-1-t.padInfo.top,s=n-1-t.padInfo.left,u=o?1:2,l=o?2:3,c=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            for (int d2 = 0; d2 < `+t.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},Oz=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,a=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+t.batchSize+`; b++) {
          for (int yF = 0; yF < `+t.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+t.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+t.outHeight+`; yR++) {
              int xR = wR + yR * `+n+" - "+o+`;

              if (xR < 0 || xR >= `+t.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+t.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+t.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},jz=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=e-1-t.padInfo.front,u=n-1-t.padInfo.top,l=r-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+t.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+n+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+n+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+t.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Fz=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+t.batchSize+`; b++) {
          for (int yR = 0; yR < `+t.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+t.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+i+`;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},Lz=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},p1=function(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.padInfo.top,o=t.padInfo.left,a=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,l=t.dilationWidth,c=t.filterHeight,d=t.filterWidth,h=4*Math.floor(t.inChannels/4),f=t.inChannels%4,m=t.dataFormat==="channelsLast",p=m?1:2,v=m?2:3,g=m?3:1,x="",w="";n&&(x=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,w="result = activation(result);");var b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+g+`];

        ivec2 xRCCorner =
            ivec2(coords[`+p+"], coords["+v+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+t.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+t.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+h+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+m+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(f===1)+`) {

              if (`+m+`) {
                dotProd +=
                    getX(batch, xR, xC, `+h+`) *
                    getW(wR, wC, `+h+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+h+`, xR, xC) *
                    getW(wR, wC, `+h+`, d2);
              }

            } else if (`+(f===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2)
              );

              if (`+m+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+h+`),
                  getX(batch, xR, xC, `+h+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+h+`, xR, xC),
                  getX(batch, `+h+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(f===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+h+`, d2),
                getW(wR, wC, `+h+` + 1, d2),
                getW(wR, wC, `+h+` + 2, d2)
              );

              if (`+m+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+h+`),
                  getX(batch, xR, xC, `+h+` + 1),
                  getX(batch, xR, xC, `+h+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+h+`, xR, xC),
                  getX(batch, `+h+` + 1, xR, xC),
                  getX(batch, `+h+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+b+`
        `+w+`
        setOutput(result);
      }
    `},Bz=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.filterDepth,d=t.filterHeight,h=t.filterWidth,f=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+e+", "+n+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+t.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+f+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(m===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+f+`) *
                  getW(wF, wR, wC, `+f+`, d2);
              } else if (`+(m===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(m===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1),
                  getX(batch, xF, xR, xC, `+f+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2),
                  getW(wF, wR, wC, `+f+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},m1=function(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.inHeight,o=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,d=t.dilationWidth,h=t.filterHeight,f=t.filterWidth,m=t.outChannels/t.inChannels,p="",v="";n&&(p=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`
          float activation(float x) {
            `+n+`
          }
        `,v="result = activation(result);");var g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+p+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+m+`;
        int q = d2 - d1 * `+m+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+h+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+f+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+g+`
        `+v+`
        setOutput(result);
      }
    `},g1=function(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var i=t.inHeight,o=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,d=t.dilationWidth,h=t.filterHeight,f=t.filterWidth,m=f,p="int xR; int xC; int xCOffset;",v=0;v<h;v++)for(var g=0;g<f;g++)p+=`
          vec4 xTexelR`+v+"C"+2*g+` = vec4(0.);
          vec4 wR`+v+"C"+g+` = vec4(0.);
          vec4 xR`+v+"C"+g+" = vec4(0.);";for(v=0;v<h;v++)for(var x=0;x<m;x++){if(p+=`
          xR = xRCorner + `+v*c+`;
          xC = xCCorner + `+(g=2*x)*d+`;
        `,l===1){if(g<f&&(p+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+v+"C"+g+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+v+"C"+g+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+v+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+v+"C"+g+" = vec4(previous.zw, xTexelR"+v+"C"+g+`.xy);
                } else {
                  xR`+v+"C"+g+" = vec4(0, 0, xTexelR"+v+"C"+g+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+v+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+v+"C"+g+` = vec4(0.);
                }

                xR`+v+"C"+g+" = xTexelR"+v+"C"+g+`;
              `,g+1<f)){var w=s%2==0?mE(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(p+=`
                  xCOffset = xC + `+s%2+" + "+w+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+v+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(p+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+v+"C"+g+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+v+"C"+g+` = vec4(0.);
                    }
                  `),p+=`
                  xR`+v+"C"+(g+1)+` = vec4(
                    xTexelR`+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+`.xy);
                `):p+=`
                  xCOffset = xC + `+w+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+v+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+v+"C"+(g+1)+" = xTexelR"+v+"C"+(g+2)+`;
                `}}else g<f&&(p+=`
              if(xR >= 0 && xR < `+i+`) {
            `,s%2==1?(p+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+v+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+v+"C"+g+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+v+"C"+(g+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+v+"C"+(g+2)+` = vec4(0.);
                }

                xR`+v+"C"+g+` = vec4(
                  xTexelR`+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+`.zw);
              `,g+1<f&&(p+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+v+"C"+(g+1)+" = vec4(xTexelR"+v+"C"+(g+2)+`.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+v+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+v+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+v+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+v+"C"+(g+2)+` = vec4(0.);
                }

                xR`+v+"C"+g+` = vec4(
                  xTexelR`+v+"C"+g+".xy, xTexelR"+v+"C"+(g+2)+`.xy);
              `,g+1<f&&(p+=`
                  xR`+v+"C"+(g+1)+` = vec4(
                    xTexelR`+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+`.zw);
                `)),p+="}");g<f&&(p+=`
            vec4 wTexelR`+v+"C"+g+" = getW("+v+", "+g+`, d1, q);
            wR`+v+"C"+g+" = vec4(wTexelR"+v+"C"+g+".xz, wTexelR"+v+"C"+g+`.xz);
          `,g+1<f&&(p+=`
              vec4 wTexelR`+v+"C"+(g+1)+" = getW("+v+", "+(g+1)+`, d1, q);
              wR`+v+"C"+(g+1)+` =
                vec4(wTexelR`+v+"C"+(g+1)+".xz, wTexelR"+v+"C"+(g+1)+".xz);"))}for(v=0;v<h;v++)for(g=0;g<f;g++)p+="dotProd += xR"+v+"C"+g+" * wR"+v+"C"+g+";";var b="",k="";n&&(b=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:`vec4 activation(vec4 x) {
          `+n+`
        }`,k="result = activation(result);");var _=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+p+`

        vec4 result = dotProd;
        `+_+`
        `+k+`
        setOutput(result);
      }
    `},Vz=function(t,e,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=t[0],a=t[1],s=t[2],u=t[3],l=e[0],c=n[0],d=n[1];this.outputShape=[l,c,d,u];var h=r==="bilinear"?1:0,f=[a-1+".0",s-1+".0"],m=f[0],p=f[1],v=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+m+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+m],g=v[0],x=v[1],w=v[2],b=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+p+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+p],k=b[0],_=b[1],S=b[2];this.userCode=`
      const float height_ratio = float(`+g+`);
      const float width_ratio = float(`+k+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+x+`;
        float width_scale = `+_+`;

        float in_y = `+w+`;
        if( in_y < 0.0 || in_y > `+m+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+S+`;
        if( in_x < 0.0 || in_x > `+p+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+h+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},zz=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=t[t.length-1],o=n?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(n?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Ue(r)+` coords = getOutputCoords();
        int end = `+v1(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+v1(r,"coords")+` = idx;
          val += getX(`+function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function v1(t,e){if(t===1)return""+e;if(t===2)return e+".y";if(t===3)return e+".z";if(t===4)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var Uz=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=il.DENSE;var e=Su(t),n=qt();this.outputShape=t,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Do(["r","c","d"],t)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+n.output+` = result;
      }
    `},$z=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=il.DENSE;var e=Su(t),n=qt();this.outputShape=t,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Do(["r","c","d"],t)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+n.output+` = result;
      }
    `},Wz=function(){function t(e,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+n+`;
      int offset_h = imod(h, `+n+`);
      int in_w = w / `+n+`;
      int offset_w = imod(w, `+n+`);
      int offset_d = (offset_h * `+n+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return t.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),Gz=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},Hz=function(t){this.variableNames=["A"],this.outTexUsage=Rn.DOWNLOAD;var e=qt();this.outputShape=t,this.userCode=`
      `+qE+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},Kz=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Rn.DOWNLOAD;var e=qt();this.outputShape=t,this.userCode=`
      `+qE+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},qz=function(t,e,n){n===void 0&&(n=!1),this.variableNames=["A"];var r=qt(),i=e[0],o=e[1];this.outputShape=t;var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+Qy(t)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},Xz=function(t,e,n){n===void 0&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=qt(),i=e[0],o=e[1];this.outputShape=t;var a="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;a+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+t[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+t[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Qy(t)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+r.output+" = "+s+`;
      }
    `},Yz="return real * expR - imag * expI;",Jz="return real * expI + imag * expR;",y1=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=n?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+t+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},Qz=function(){function t(e,n){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return t.prototype.getCustomSetupFunc=function(e){var n=this;return function(r,i){n.valueLoc==null&&(n.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(n.valueLoc,e)}},t}(),Zz=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var i=Ue(this.rank),o=function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],d=0;d<a.length;d++)d===s?c.push("int(getIndices("+l[d]+"))"):c.push(""+l[d]);return c.join()}(t,n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},eU=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=Ue(e.length),i=Ue(n.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function tU(t,e){var n=qt();return Y5(t,e,n.version+`
    precision highp float;
    `+n.attribute+` vec3 clipSpacePos;
    `+n.attribute+` vec2 uv;
    `+n.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function nU(t,e){return tV(t,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function rU(t,e){return nV(t,e,new Uint16Array([0,1,2,2,1,3]))}function El(t,e,n,r,i,o,a){iV(n,r);var s=rV(t,e),u=t.TEXTURE_2D;return ae(t,e,function(){return t.bindTexture(u,s)}),ae(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),ae(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),ae(t,e,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),ae(t,e,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),ae(t,e,function(){return t.texImage2D(u,0,i,n,r,0,o,a,null)}),ae(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)}),s}function iU(t,e,n,r,i){var o=Nh(n,r);return El(t,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,t.FLOAT)}function oU(t,e,n,r,i){var o=Nh(n,r);return El(t,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function aU(t,e,n,r,i){var o=Nh(n,r);return El(t,e,o[0],o[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function sU(t,e,n,r,i){var o=Cl(n,r);return El(t,e,o[0],o[1],i.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function uU(t,e,n,r,i){var o=Cl(n,r);return El(t,e,o[0],o[1],i.internalFormatPackedHalfFloat,t.RGBA,i.textureTypeHalfFloat)}function lU(t,e,n,r){return ae(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),o1(t,e,n,"clipSpacePos",r,3,20,0)&&o1(t,e,n,"uv",r,2,20,12)}function cU(t,e,n,r,i,o,a){var s,u,l;ae(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),o instanceof Uint8Array?(s=new Uint8Array(r*i*4),u=t.UNSIGNED_BYTE,l=t.RGBA):(s=new Float32Array(r*i*4),u=t.FLOAT,l=a.internalFormatPackedFloat),s.set(o),ae(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,l,r,i,0,t.RGBA,u,s)}),ae(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function dU(t,e,n,r){ae(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),r.data instanceof Uint8Array?ae(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):ae(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),ae(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function hU(t,e,n,r,i){var o=t.createBuffer();ae(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,o)});var a=16*n*r;return ae(t,e,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)}),ae(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)}),ae(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),o}function fU(t,e,n){var r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function pU(t,e,n,r,i){var o=Nh(n,r),a=o[0],s=o[1],u=new Uint8Array(n*r*4);return ae(t,e,function(){return t.readPixels(0,0,a,s,i.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function mU(t,e,n,r,i,o,a,s){var u=t,l=new Float32Array(function(c,d){var h=Cl(c,d);return h[0]*h[1]*4}(o,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function gU(t,e,n,r){var i=new Float32Array(n*r*4);return ae(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,i)}),i}var vU=function(){function t(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=G().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,G5(n,e)):this.gl=Wr(n);var r="WEBGL_color_buffer_float";if(G().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=sc(this.gl,this.debug,"OES_texture_float"),Hn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=sc(this.gl,this.debug,"OES_texture_half_float");else if(G().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Hn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=sc(this.gl,this.debug,"EXT_color_buffer_half_float");else if(G().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Hn(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Hn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=nU(this.gl,this.debug),this.indexBuffer=rU(this.gl,this.debug),this.framebuffer=oV(this.gl,this.debug),this.textureConfig=Uy(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return G().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var n=this.gl;ae(n,this.debug,function(){return n.finish()}),ae(n,this.debug,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),ae(n,this.debug,function(){return n.deleteFramebuffer(e.framebuffer)}),ae(n,this.debug,function(){return n.bindBuffer(n.ARRAY_BUFFER,null)}),ae(n,this.debug,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)}),ae(n,this.debug,function(){return n.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(e,n){return this.throwIfDisposed(),iU(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(e,n){return this.throwIfDisposed(),oU(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(e,n){return this.throwIfDisposed(),aU(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(e,n){this.throwIfDisposed(),dU(this.gl,this.debug,e,n)},t.prototype.uploadDenseMatrixToTexture=function(e,n,r,i){this.throwIfDisposed(),cU(this.gl,this.debug,e,n,r,i,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(e,n){return this.throwIfDisposed(),uU(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(e,n){return this.throwIfDisposed(),sU(this.gl,this.debug,e,n,this.textureConfig)},t.prototype.deleteMatrixTexture=function(e){var n=this;this.throwIfDisposed(),this.outputTexture===e&&(a1(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ae(this.gl,this.debug,function(){return n.gl.deleteTexture(e)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,n,r){var i=this;return this.downloadMatrixDriver(e,function(){return pU(i.gl,i.debug,n,r,i.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(e,n,r,i,o,a){return mU(this.gl,e,0,0,0,o,a,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(e,n){return fU(this.gl,e,n)},t.prototype.createBufferFromTexture=function(e,n,r){this.bindTextureToFrameBuffer(e);var i=hU(this.gl,this.debug,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},t.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},t.prototype.createFence=function(e){var n,r,i=this;if(G().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var s=o.clientWaitSync(a,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},n=a}else G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(n,G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:n,isFencePassed:r}},t.prototype.downloadMatrixFromPackedTexture=function(e,n,r){var i=this;return this.downloadMatrixDriver(e,function(){return gU(i.gl,i.debug,n,r)})},t.prototype.createProgram=function(e){this.throwIfDisposed();var n=this.gl,r=J5(n,this.debug,e),i=tU(n,this.debug),o=Z5(n,this.debug);return ae(n,this.debug,function(){return n.attachShader(o,i)}),ae(n,this.debug,function(){return n.attachShader(o,r)}),eV(n,this.debug,o),this.debug&&rp(n,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=lU(n,this.debug,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(e){var n=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&ae(this.gl,this.debug,function(){return n.gl.deleteProgram(e)})},t.prototype.setProgram=function(e){var n=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&rp(this.gl,this.debug,this.program),ae(this.gl,this.debug,function(){return n.gl.useProgram(e)})},t.prototype.getUniformLocation=function(e,n,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?sV(this.gl,this.debug,e,n):uV(this.gl,e,n)},t.prototype.getAttributeLocation=function(e,n){var r=this;return this.throwIfDisposed(),ae(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,n)})},t.prototype.getUniformLocationNoThrow=function(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)},t.prototype.setInputMatrixTexture=function(e,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),lV(this.gl,this.debug,this.program,e,n,r)},t.prototype.setOutputMatrixTexture=function(e,n,r){this.setOutputMatrixTextureDriver(e,r,n)},t.prototype.setOutputPackedMatrixTexture=function(e,n,r){this.throwIfDisposed();var i=Cl(n,r),o=i[0],a=i[1];this.setOutputMatrixTextureDriver(e,o,a)},t.prototype.setOutputMatrixWriteRegion=function(e,n,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,n)},t.prototype.setOutputPackedMatrixWriteRegion=function(e,n,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){this.program!=null&&rp(this.gl,this.debug,this.program),uc(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),ae(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),ae(this.gl,this.debug,function(){return e.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=sc(this.gl,this.debug,G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,n=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(n.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(e){return ne(this,void 0,void 0,function(){var n=this;return re(this,function(r){switch(r.label){case 0:return[4,Zb(function(){return n.disposed||n.isQueryAvailable(e,G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(e,n){if(n===0)return null;if(n===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(e,n){if(n===0)return!0;if(n===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(e){var n=this;return new Promise(function(r){n.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},t.prototype.pollItems=function(){for(var e=function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),n=0;n<=e;++n)(0,this.itemsToPoll[n].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},t.prototype.addItemToPoll=function(e,n){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1||Zb(function(){return r.pollItems(),r.itemsToPoll.length===0})},t.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),ip(this.gl,this.debug,e,this.framebuffer),this.debug&&uc(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(ip(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&uc(this.gl)):a1(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(e,n){this.bindTextureToFrameBuffer(e);var r=n();return this.unbindTextureToFrameBuffer(),r},t.prototype.setOutputMatrixTextureDriver=function(e,n,r){this.throwIfDisposed();var i=this.gl;ip(i,this.debug,e,this.framebuffer),this.debug&&uc(i),this.outputTexture=e,ae(i,this.debug,function(){return i.viewport(0,0,n,r)}),ae(i,this.debug,function(){return i.scissor(0,0,n,r)})},t.prototype.setOutputMatrixWriteRegionDriver=function(e,n,r,i){var o=this;this.throwIfDisposed(),ae(this.gl,this.debug,function(){return o.gl.scissor(e,n,r,i)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},t}();function x1(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(n,r){var i=n.logicalShape,o=e[r],a=o.shape;if(!It(i,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+a+" must match");if(!n.isUniform||!o.isUniform){var s=n.texShape,u=o.isUniform?null:o.texData.texShape;if(!It(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var yU=function(t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r=n.filterWidth,i=n.inChannels,o=n.strideWidth,a=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,d=n.dataFormat,h=s.left,f=s.top,m=i*r,p=qt(),v=d==="channelsLast",g=v?0:1,x=v?1:2,w="",b=0;b<=1;b++)for(var k=0;k<=1;k++)w+=`
          blockIndex = rc.y + `+k+`;
          pos = rc.x + `+b+`;

          if(blockIndex < `+t[1]+" && pos < "+t[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+f+`;
            d0 = offsetY + `+c+" * (pos / "+m+`);

            if(d0 < `+e[g]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+h+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+m+".) / "+i+`.));

              if(d1 < `+e[x]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+v+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*b+k)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*b+k)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+w+`

        `+p.output+` = result;
      }
    `},xU=function(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[];var o,a=e,s=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},wU=function(t,e,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+n+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},bU=function(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,a=e,s=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},kU=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,a=i-1-t.padInfo.top,s=o-1-t.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+n+`.0;

            if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},_U=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterDepth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=s-1-t.padInfo.front,d=u-1-t.padInfo.top,h=l-1-t.padInfo.left,f=s*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+d+", "+h+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+t.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+n+`.0;

            if (dyR < 0.0 || dyR >= `+t.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+t.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+f+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},lp=function(t,e,n,r,i,o,a){n===void 0&&(n=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=n?t[1]:t[2],u=Math.ceil(s/2),l=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",d=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",m="";o&&(f=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,m="result = activation(result);");var p=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+f+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+h[0]+`);
          result += (`+d[1]+" * "+h[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+p+`

        `+m+`

        setOutput(result);
      }
    `},SU=function(){function t(e,n,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(n-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(n-1)+`));
      }
    `}return t.prototype.getCustomSetupFunc=function(e){var n=this;return function(r,i){n.seedLoc==null&&(n.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(n.seedLoc,e)}},t}(),CU=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+n+`),
                      float(index == coords.y)));
      }
    `},EU=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var e=t.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var n=dn("rc",e),r=Ue(e),i=function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",d=s-2;d<s;d++)c+=l[d]+" >= "+u[d],d<s-1&&(c+="||");return c}(e,t,n),o=function(s,u,l,c){if(s===1)return"";var d=c.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(e,t[t.length-1],t[t.length-2],n),a=function(s,u){var l=s.length,c=function(d,h){for(var f=[],m=0;m<=1;m++)for(var p=0;p<=1;p++){for(var v=(m===0?"r":"rp1")+", "+(p===0?"c":"cp1"),g=2;g<d;g++)v=h[h.length-1-g]+","+v;f.push(v)}return f}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(t,n);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},AU=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map(function(u,l){return u[0]+t[l]+u[1]});var r=t.length,i=Ue(r),o=e.map(function(u){return u[0]}).join(","),a=e.map(function(u,l){return u[0]+t[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+n+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+n+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},RU=function(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(v,g){return v[0]+t[g]+v[1]});for(var r=t.length,i=Ue(r),o=e.map(function(v){return v[0]}).join(","),a=e.map(function(v,g){return v[0]+t[g]}).join(","),s=dn("rc",r),u=dn("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",d=[i+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],h=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",m=0,p=r===1?2:4;m<p;m++)f+=`
        `+d[m]+`
        if (`+h+`) {
          result[`+m+"] = float("+n+`);
        } else {
          `+i+` source = rc - start;
          result[`+m+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;f+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+f+`
        setOutput(result);
      }
    `},cp=function(t,e,n){if(this.variableNames=["x"],e==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,d=t.padInfo.left;this.outputShape=t.outShape;var h=e==="avg",f="0.0";if(h||(f="-1.0 / 1e-20"),n)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+o+`);
        const ivec2 pads = ivec2(`+c+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+t.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var m=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(m="avgValue / count");var p=4*Math.floor(r/4),v=r%4,g=`
      if (`+h+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+c+", "+d+`);
      const float initializationValue = `+f+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+t.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+f+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+t.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+g+`
          }

          int xC = xCCorner + `+p+`;
          if (`+(v===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(v===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(v===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+g+`
          }
        }
        setOutput(`+m+`);
      }
    `}},dp=function(t,e,n){if(this.variableNames=["x"],e==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,l=t.dilationWidth,c=t.effectiveFilterDepth,d=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,m=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;var v=e==="avg",g="0.0";if(v||(g="-1.0 / 1e-20"),n)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+o+", "+a+`);
        const ivec3 pads = ivec3(`+f+", "+m+", "+p+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+c+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+t.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+t.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+h+`;
                  wC += `+l+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+t.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+h+` +
                      wR * `+h+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var x=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(x="avgValue / count");var w=4*Math.floor(r/4),b=r%4,k=`
      if (`+v+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+f+", "+m+", "+p+`);
      const float initializationValue = `+g+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+t.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+g+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+t.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+t.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+w+`; wC += 4) {
              int xC = xCCorner + wC * `+l+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+l+`, ch)
              );

              `+k+`
            }

            int xC = xCCorner + `+w+`;
            if (`+(b===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+k+`
            } else if (`+(b===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                initializationValue,
                initializationValue
              );

              `+k+`
            } else if (`+(b===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                initializationValue
              );

              `+k+`
            }
          }
          setOutput(`+x+`);
        }
      }
    `}},NU=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=Math.ceil(i/n);this.outputShape=[r,o];var a="0.0",s="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",s="min"):e==="max"&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,d=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,h="vec4";e==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,h="bvec4"):e==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,h="bvec4");var f="";i%n>0&&(f=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(c===2)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(c===3)+`) {
          `+h+" values = "+h+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+u+`);
      }
    `},TU=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Do(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+Qy(t)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+t[1]+`;
        int cols = `+t[2]+`;

        `+n+`

        setOutput(result);
      }
    `},PU=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=t.shape,s=a[1],u=a[2],l=[n&&s>1?i-1:i,n&&u>1?o-1:o],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],d=l[0]/c[0],h=l[1]/c[1],f=1/d,m=1/h,p=2*Math.ceil(f)+2,v=2*Math.ceil(m)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+h+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+m+`);

        const int winHeight = int(`+p+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},IU=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],a=t[2],s=t[3];this.outputShape=[i,e,n,s];var u=[r&&e>1?o-1:o,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},DU=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=t[0],o=t[1],a=t[2],s=t[3];this.outputShape=[i,e,n,s];var u=[r&&e>1?o-1:o,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(n-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},MU=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=t.shape,s=a[1],u=a[2],l=[n&&s>1?i-1:i,n&&u>1?o-1:o],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],d=l[0]/c[0],h=l[1]/c[1],f=1/d,m=1/h,p=2*Math.ceil(f)+2,v=2*Math.ceil(m)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+h+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+m+`);

        const int winHeight = int(`+p+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+n+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+n+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},OU=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],a=t[2],s=t[3];this.outputShape=[i,e,n,s];var u=[r&&e>1?o-1:o,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},jU=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,n!==1){var r=t.map(function(o,a){return function(s){return e.indexOf(s)!==-1&&t[s]!==1?t[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(a)}).join(","),i=Ue(n);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+t[0]+` - coord - 1));
        }
      `},FU=function(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=t;var r=dn("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],o=r[n-2]+" + 1 < "+this.outputShape[n-2],a=Ue(n);function s(u){var l=t.map(function(c,d){return function(h,f){return e.indexOf(h)!==-1&&t[h]!==1?t[h]+" - "+f[h]+" - 1":""+f[h]}(d,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=n===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+t[0]+` - rc - 1),
            `+t[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+t[0]+` - (rc  + 1) - 1),
                `+t[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(r.slice())+`;
          if(`+i+`){
            result.g = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",s(u)}(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(u){return u[n-2]="("+u[n-2]+" + 1)",s(u)}(r.slice())+`;
            if(`+i+`) {
              result.a = `+function(u){return u[n-1]="("+u[n-1]+" + 1)",u[n-2]="("+u[n-2]+" + 1)",s(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},w1=function(t,e,n,r,i,o,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=Ue(i.length),u=Ue(o.length),l="";n===1?l="i":n===2&&(l="i, j");var c="getIndices("+l+")",d="";r===1?d="i":r===2&&(d="i, coords[1]");var h="getUpdates("+d+")",f=e>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+t+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+f+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+h+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},LU=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=t.numSegments,a=o*Math.ceil(i/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";i%n>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+n+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},BU=function(t,e,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+o[u]),u<t&&a.push(""+o[u]);r=a.join(),i=s.join()}var l=Ue(n);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},VU=function(){function t(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var n,r=Ue(this.rank),i="uniform int start["+this.rank+"];",o=function(a){if(a===1)return"sourceLoc";if(a<=6)return hp.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);n=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map(function(a,s){return"sourceLoc."+hp[s]+" = start["+s+"] + coords."+hp[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+n+`
        setOutput(getSource(`+o+`));
      }
    `}return t.prototype.getCustomSetupFunc=function(e){var n=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(i,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,e)}},t}(),hp=["x","y","z","w","u","v"],zU=function(){function t(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var n=Ue(this.rank),r=dn("coords",this.rank),i=dn("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",a="getChannel(getSource("+i.join()+"), "+o+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+a+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+n+"("+e.map(function(c,d){return"start["+d+"]"}).join()+");":e.map(function(c,d){return i[d]+" = "+r[d]+" + start["+d+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+n+` coords = getOutputCoords();
        `+n+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return t.prototype.getCustomSetupFunc=function(e){var n=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){n.startLoc==null&&(n.startLoc=r.getUniformLocationNoThrow(i,"start"),n.startLoc==null)||r.gl.uniform1iv(n.startLoc,e)}},t}(),UU=function(t,e,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=Ue(n.length),o=Ue(n.length),a="";if(r===1)a="coords * strides + begin";else{var s=0;a=n.map(function(u,l){return s++,n.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(s-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+t+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},$U=function(){function t(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(e,n,r){var i,o=b1(n,r),a=k1(e,o,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),o===Sn.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Sn.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Sn.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Sn.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Sn.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),i},t.prototype.releaseTexture=function(e,n,r,i){if(this.freeTextures!=null){var o=k1(n,b1(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],s=a.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},t.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var n in this.freeTextures)this.freeTextures[n].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var n in this.usedTextures)this.usedTextures[n].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function b1(t,e){if(t===Rn.UPLOAD)return Sn.PACKED_2X2_FLOAT32;if(t===Rn.RENDER||t==null)return function(n){return G().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Sn.PACKED_2X2_FLOAT32:Sn.UNPACKED_FLOAT32:n?Sn.PACKED_2X2_FLOAT16:Sn.UNPACKED_FLOAT16}(e);if(t===Rn.DOWNLOAD||t===Rn.PIXELS)return Sn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function k1(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var WU=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var i=Ue(this.rank),o=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<a.length;c++)l.push("imod("+u[c]+", "+a[c]+")");return l.join()}(t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},GU=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var i=Ue(this.rank),o=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<a.length;c++)l[a[c]]=u[c];return l.join()}(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},HU=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Ue(this.rank),o=KE("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=o[r];var s="vec2("+a.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+n[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+n[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `},Zy=1.7580993408473768,e0=1.0507009873554805,be=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},wr="if (isnan(x)) return x;",KU="return x;",_1="return abs(x);",QE=wr+`
  return (x < 0.0) ? 0.0 : x;
`,ZE=wr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,eA="return (x >= 0.0) ? x : (exp(x) - 1.0);",qU=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Zy+`;
  float scale = `+e0+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,S1="return -x;",C1="return ceil(x);",E1="return floor(x);",A1="return exp(x);",R1="return exp(x) - 1.0;",XU=wr+`
  return sin(x);
`,YU=wr+`
  return cos(x);
`,JU=wr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,QU=wr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,ZU=wr+`
  return atan(x);
`,e6=wr+"return log(x + sqrt(x * x + 1.0));",t6=wr+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,n6=wr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,hc="return x;",r6="return x;",tA=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,nA=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,rA=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Zs=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},i6=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var e=t.length,n=dn("rc",e),r=Ue(e),i=function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l}(e,n),o=n.slice(-2),a=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},fc={};function pc(t,e){if(e===void 0&&(e=!1),t==="linear")return e?r6:KU;if(t==="relu")return e?tA:QE;if(t==="elu")return e?rA:eA;if(t==="relu6")return e?nA:ZE;if(t==="prelu")return e?JE:YE;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var o6=600,a6=function(t){function e(n){var r,i=t.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!G().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(n==null){var o=Wr(G().getNumber("WEBGL_VERSION"));i.binaryCache=((r=G().getNumber("WEBGL_VERSION"))in fc||(fc[r]={}),fc[r]),i.gpgpu=new vU(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=n,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=n.gl.canvas;return i.textureManager=new $U(i.gpgpu),i.numMBBeforeWarning=G().global.screen==null?1024:G().global.screen.height*G().global.screen.width*window.devicePixelRatio*o6/1024/1024,i.texData=new LE(i,O),i}return xr(e,t),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(n,r,i){if(G().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64"&&n!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:n,usage:Rn.UPLOAD}),o},e.prototype.move=function(n,r,i,o){if(G().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(n,{shape:i,dtype:o,values:r,usage:Rn.UPLOAD})},e.prototype.readSync=function(n){var r=this.texData.get(n),i=r.values,o=r.dtype,a=r.complexTensors,s=r.slice,u=r.shape,l=r.isPacked;if(s!=null){var c=void 0;c=l?new Zs(u,hc):new be(u,hc);var d=this.runWebGLProgram(c,[{dataId:n,shape:u,dtype:o}],o),h=this.readSync(d.dataId);return this.disposeData(d.dataId),h}if(i!=null)return this.convertAndCacheOnCPU(n);if(o==="string")return i;var f,m,p=this.activeTimers!=null;return p&&(f=Nr()),o==="complex64"?m=vg(a.real.dataSync(),a.imag.dataSync()):m=this.getValuesFromTexture(n),p&&(this.downloadWaitMs+=Nr()-f),this.convertAndCacheOnCPU(n,m)},e.prototype.read=function(n){return ne(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,d,h,f,m,p,v,g,x,w,b,k,_,S,C;return re(this,function(E){switch(E.label){case 0:if(this.pendingRead.has(n))return r=this.pendingRead.get(n),[2,new Promise(function(R){return r.push(R)})];if(i=this.texData.get(n),o=i.values,a=i.shape,s=i.slice,u=i.dtype,l=i.complexTensors,c=i.isPacked,s!=null)return d=void 0,d=c?new Zs(a,hc):new be(a,hc),h=this.runWebGLProgram(d,[{dataId:n,shape:a,dtype:u}],u),f=this.read(h.dataId),this.disposeData(h.dataId),[2,f];if(o!=null)return[2,this.convertAndCacheOnCPU(n)];if(!G().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&G().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return m=null,u!=="complex64"&&G().get("WEBGL_BUFFER_SUPPORTED")&&(p=this.decode(n),v=this.texData.get(p.dataId),m=(C=this.gpgpu).createBufferFromTexture.apply(C,[v.texture].concat(Su(a)))),this.pendingRead.set(n,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:E.sent(),E.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return x=E.sent(),w=x[0],b=x[1],g=vg(w,b),[3,5];case 4:m==null?g=this.getValuesFromTexture(n):(k=oe(a),g=this.gpgpu.downloadFloat32MatrixFromBuffer(m,k)),E.label=5;case 5:return p!=null&&this.disposeData(p.dataId),_=this.convertAndCacheOnCPU(n,g),S=this.pendingRead.get(n),this.pendingRead.delete(n),S.forEach(function(R){return R(_)}),this.pendingDisposal.has(n)&&(this.pendingDisposal.delete(n),this.disposeData(n),this.pendingDeletes--),[2,_]}})})},e.prototype.checkNumericalProblems=function(n){if(n!=null)for(var r=0;r<n.length;r++){var i=n[r];if(!q5(i))throw G().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(n){var r,i=this.texData.get(n),o=i.shape,a=i.dtype,s=i.isPacked,u=oe(o);if(G().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(n),c=this.texData.get(l.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(Su(o))).subarray(0,u);return this.disposeData(l.dataId),d}var h=G().getBool("WEBGL_PACK")&&s===!0,f=h?op(o):o,m=h?new Kz(f):new Hz(f),p=this.runWebGLProgram(m,[{shape:f,dtype:a,dataId:n}],"float32"),v=this.texData.get(p.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeData(p.dataId),g},e.prototype.time=function(n){return ne(this,void 0,void 0,function(){var r,i,o,a,s,u,l;return re(this,function(c){switch(c.label){case 0:return r=this.activeTimers,i=[],o=!1,this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,n(),a=ms(this.activeTimers.map(function(d){return d.query})).filter(function(d){return d!=null}),s=ms(this.activeTimers.map(function(d){return d.name})).filter(function(d){return d!=null}),this.activeTimers=r,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return l=c.sent(),u.kernelMs=R5(l),u.getExtraProfileInfo=function(){return l.map(function(d,h){return{name:s[h],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Nr(),endMs:null}},e.prototype.endTimer=function(n){return G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),n):(n.endMs=Nr(),n)},e.prototype.getQueryTime=function(n){return ne(this,void 0,void 0,function(){var r;return re(this,function(i){return G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(n)]:[2,(r=n).endMs-r.startMs]})})},e.prototype.disposeData=function(n){if(!this.pendingDisposal.has(n)){if(this.pendingRead.has(n))return this.pendingDisposal.add(n),void this.pendingDeletes++;if(this.texData.has(n)){this.releaseGPUData(n);var r=this.texData.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(n)}}},e.prototype.releaseGPUData=function(n){var r=this.texData.get(n),i=r.texture,o=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||n,d=this.dataRefCount.get(c);d>1?this.dataRefCount.set(c,d-1):(this.dataRefCount.delete(c),i!=null&&(this.numBytesInGPU-=this.computeBytes(a,o),this.textureManager.releaseTexture(i,a,s,u)));var h=this.texData.get(n);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(n){return this.uploadToGPU(n),this.texData.get(n).texture},e.prototype.getDataInfo=function(n){return this.texData.get(n)},e.prototype.getCPUBackend=function(){return G().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=O.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(n,r){var i=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&n.every(function(o){return i.texData.get(o.dataId).texture==null&&o.size<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(n,r){var i=this.makeOutput(n.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:O.keep(n.clone()),imag:O.keep(r.clone())},i},e.prototype.real=function(n){return this.texData.get(n.dataId).complexTensors.real.clone()},e.prototype.imag=function(n){return this.texData.get(n.dataId).complexTensors.imag.clone()},e.prototype.slice=function(n,r,i){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.slice(n,r,i);if(oe(i)===0)return Bt([],i,n.dtype);var o=this.texData.get(n.dataId).isPacked,a=jE(n.shape,r,i);if(o||!a){var s=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zU(i):new VU(i),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[n],null,u)}return this.uploadToGPU(n.dataId),this.shallowSlice(n,r,i)},e.prototype.shallowSlice=function(n,r,i){var o=this.texData.get(n.dataId),a=this.makeOutput(i,n.dtype),s=this.texData.get(a.dataId);Object.assign(s,o),s.shape=i,s.dtype=n.dtype;var u=FE(r,n.strides);o.slice&&(u+=o.slice.flatOffset),s.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||n.dataId};var l=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,l+1),a},e.prototype.stridedSlice=function(n,r,i,o){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.stridedSlice(n,r,i,o);var a=Ky(r,i,o);if(a.some(function(u){return u===0}))return Bt([],a);var s=new UU(r,o,a);return this.compileAndRun(s,[n])},e.prototype.reverse=function(n,r){var i=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new FU(n.shape,r):new jU(n.shape,r);return this.compileAndRun(i,[n])},e.prototype.concat=function(n,r){if(n[0].dtype==="complex64"){var i=n.map(function(f){return $n(f)}),o=n.map(function(f){return Ir(f)});return Ft(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(n))return this.cpuBackend.concat(n,r);if(n.length===1)return n[0];if(n.length>G().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(n.length/2),s=this.concat(n.slice(0,a),r),u=this.concat(n.slice(a),r);return this.concat([s,u],r)}if(G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&n[0].rank>1){var l=new Iz(n.map(function(f){return f.shape}),r);return this.compileAndRun(l,n)}var c=vs(n.map(function(f){return f.shape}),r),d=n.map(function(f){return f.as2D(-1,oe(f.shape.slice(r)))}),h=new Pz(d.map(function(f){return f.shape}));return this.compileAndRun(h,d).reshape(c)},e.prototype.neg=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.neg(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,S1,n.dtype);var r=new be(n.shape,S1);return this.compileAndRun(r,[n])},e.prototype.batchMatMul=function(n,r,i,o){var a=i?n.shape[2]:n.shape[1],s=o?r.shape[1]:r.shape[2],u=i?n.shape[1]:n.shape[2],l=n.shape[0];if((a===1||s===1)&&u>1e3){i&&(n=n.transpose([0,2,1])),o&&(r=r.transpose([0,2,1]));var c=s===1?n:n.as3D(l,u,1),d=s===1?2:1,h=s===1?r.as3D(l,1,u):r;return this.multiply(c,h).sum(d,!0)}var f=Lt(n.dtype,r.dtype),m=new lp(n.shape,[l,a,s],i,o);return this.compileAndRun(m,[n,r],f)},e.prototype.fusedBatchMatMul=function(n){var r=n.a,i=n.b,o=n.transposeA,a=n.transposeB,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=o?r.shape[2]:r.shape[1],d=a?i.shape[1]:i.shape[2],h=r.shape[0],f=Lt(r.dtype,i.dtype),m=s!=null,p=l!=null,v=u?pc(u,!0):null,g=new lp(r.shape,[h,c,d],o,a,m,v,p),x=[r,i];return s&&x.push(s),l&&x.push(l),this.compileAndRun(g,x,f)},e.prototype.multiply=function(n,r){if(n.dtype==="complex64"){var i=this.texData.get(n.dataId),o=this.texData.get(r.dataId),a=new h1(Ez,n.shape,r.shape),s=new h1(Az,n.shape,r.shape),u=[this.makeComplexComponentTensorInfo(n,i.complexTensors.real),this.makeComplexComponentTensorInfo(n,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],l=this.compileAndRun(a,u),c=this.compileAndRun(s,u),d=this.complex(l,c);return l.dispose(),c.dispose(),d}if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.multiply(n,r);if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,f1,n.dtype);var h=new lt(f1,n.shape,r.shape);return this.compileAndRun(h,[n,r],n.dtype)},e.prototype.batchNormalization=function(n,r,i,o,a,s){var u=[n,r,i],l=null;s!=null&&(l=s.shape,u.push(s));var c=null;if(a!=null&&(c=a.shape,u.push(a)),G().getBool("WEBGL_PACK_NORMALIZATION")){var d=new Cz(n.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(d,u)}var h=new Sz(n.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(h,u)},e.prototype.localResponseNormalization4D=function(n,r,i,o,a){var s=G().getBool("WEBGL_PACK_NORMALIZATION")?new bU(n.shape,r,i,o,a):new xU(n.shape,r,i,o,a);return this.compileAndRun(s,[n])},e.prototype.LRNGrad=function(n,r,i,o,a,s,u){var l=new wU(r.shape,o,a,s,u);return this.compileAndRun(l,[r,i,n])},e.prototype.tile=function(n,r){if(n.dtype==="string"){var i=this.readSync(n.dataId).map(function(a){return Pd(a)});return GE(xe(n.shape,n.dtype,i),r)}var o=new WU(n.shape,r);return this.compileAndRun(o,[n])},e.prototype.pad=function(n,r,i){var o=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RU(n.shape,r,i):new AU(n.shape,r,i);return this.compileAndRun(o,[n])},e.prototype.transpose=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.transpose(n,r);var i=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new HU(n.shape,r):new GU(n.shape,r);return this.compileAndRun(i,[n])},e.prototype.gather=function(n,r,i){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.gather(n,r,i);var o=new Zz(n.shape,r.size,i);return this.compileAndRun(o,[n,r])},e.prototype.batchToSpaceND=function(n,r,i){T(n.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(d,h){return d*h}),a=Fd(n.shape,r,o),s=Ld(a.length,r.length),u=Bd(n.shape,r,o),l=IE(i,r.length),c=DE(u,i,r.length);return n.reshape(a).transpose(s).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(n,r,i){T(n.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(h,f){return h*f}),a=[[0,0]];a.push.apply(a,i);for(var s=1+r.length;s<n.shape.length;++s)a.push([0,0]);var u=n.pad(a),l=Fd(u.shape,r,o,!1),c=Ld(l.length,r.length,!1),d=Bd(u.shape,r,o,!1);return u.reshape(l).transpose(c).reshape(d)},e.prototype.reduce=function(n,r,i){var o=n.shape[0],a=n.shape[1],s=ap(a),u=new NU({windowSize:s,inSize:a,batchSize:o},r),l=this.compileAndRun(u,[n],i);return l.shape[1]===1?l:this.reduce(l,r,i)},e.prototype.argReduce=function(n,r,i){i===void 0&&(i=null);var o=n.shape[0],a=n.shape[1];i!=null&&(o=i.shape[0],a=i.shape[1]);var s=ap(a),u=new mz({windowSize:s,inSize:a,batchSize:o},r,i==null),l=[n];i!=null&&l.push(i);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(n,r,c)},e.prototype.argReducePacked=function(n,r,i){i===void 0&&(i=null);var o=i!=null?i.shape:n.shape,a=ap(o[o.length-1]),s=new bz(o,a,r,i==null),u=i==null?[n]:[n,i],l=this.compileAndRun(s,u,"int32");return l.rank===n.rank?this.argReducePacked(n,r,l):l},e.prototype.sum=function(n,r){_n("sum",r,n.rank);var i=Gt(n.shape,r),o=i[0],a=oe(i[1]),s=n.as2D(-1,a),u=Qf(n.dtype);return this.reduce(s,"sum",u).reshape(o)},e.prototype.prod=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.prod(n,r);var i=Gt(n.shape,r),o=i[0],a=oe(i[1]),s=n.as2D(-1,a),u=Qf(n.dtype);return this.reduce(s,"prod",u).reshape(o)},e.prototype.unsortedSegmentSum=function(n,r,i){var o=0,a=Gr([o],n.rank),s=n;a!=null&&(s=n.transpose(a),o=Hr(1,n.rank)[0]);var u=function(f,m,p){for(var v=[],g=f.length,x=0;x<g;x++)x!==m?v.push(f[x]):v.push(p);return v}(s.shape,o,i),l=oe([s.shape[o]]),c=s.as2D(-1,l),d=Qf(n.dtype),h=this.segOpCompute(c,"unsortedSegmentSum",r,d,i).reshape(u);return a!=null&&(h=h.transpose($y(a))),h},e.prototype.segOpCompute=function(n,r,i,o,a){var s=n.shape[0],u=n.shape[1],l=function(h,f){var m,p=!1;for(h<=OE?(m=h,p=!0):m=ug(h,Math.floor(Math.sqrt(h)));!p;)m>f||m===h?p=!0:m=ug(h,m+1);return m}(u,a),c=new LU({windowSize:l,inSize:u,batchSize:s,numSegments:a}),d=this.compileAndRun(c,[n,i],o);return d.shape[1]===a?d:(i=jd(0,a).tile([u/l]),this.segOpCompute(d,r,i,o,a))},e.prototype.argMinMaxReduce=function(n,r,i){var o=[r];if(_n("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,n.rank),!G().getBool("WEBGL_PACK_REDUCE")||n.rank<=2){var a=Gt(n.shape,o),s=a[0],u=oe(a[1]),l=n.as2D(-1,u);return this.argReduce(l,i).reshape(s)}return this.argReducePacked(n,i)},e.prototype.argMin=function(n,r){return this.argMinMaxReduce(n,r,"min")},e.prototype.argMax=function(n,r){return this.argMinMaxReduce(n,r,"max")},e.prototype.cumsum=function(n,r,i,o){if(r!==n.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(n.rank-1)+" but got axis="+r);var a=new zz(n.shape,i,o);return this.compileAndRun(a,[n])},e.prototype.equal=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(equal(a, b));
`,"bool");var i=new lt("return float(a == b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.notEqual=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(notEqual(a, b));
`,"bool");var i=new lt("return float(a != b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.less=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.less(n,r);if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThan(a, b));
`,"bool");var i=new lt("return float(a < b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.lessEqual=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new lt("return float(a <= b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.greater=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.greater(n,r);if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new lt("return float(a > b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.greaterEqual=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new lt("return float(a >= b);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.logicalNot=function(n){var r=new be(n.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[n])},e.prototype.logicalAnd=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new lt("return float(a >= 1.0 && b >= 1.0);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.logicalOr=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new lt("return float(a >= 1.0 || b >= 1.0);",n.shape,r.shape);return this.compileAndRun(i,[n,r],"bool")},e.prototype.select=function(n,r,i){var o=new BU(n.rank,r.shape,r.rank);return this.compileAndRun(o,[n,r,i],Lt(r.dtype,i.dtype))},e.prototype.where=function(n){Md("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=n.dataSync();return Jy(n.shape,r)},e.prototype.topk=function(n,r,i){return HE(n.dataSync(),n.shape,n.dtype,r)},e.prototype.min=function(n,r){_n("min",r,n.rank);var i=Gt(n.shape,r),o=i[0],a=oe(i[1]),s=n.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(o)},e.prototype.minimum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.minimum(n,r);var i=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ei(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new lt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.mod=function(n,r){var i=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ei(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new lt(`if (b == 0.0) return NAN;
  return mod(a, b);`,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.max=function(n,r){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.max(n,r);_n("max",r,n.rank);var i=Gt(n.shape,r),o=i[0],a=oe(i[1]),s=n.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(o)},e.prototype.maximum=function(n,r){if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.maximum(n,r);var i=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ei(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new lt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.all=function(n,r){_n("all",r,n.rank);var i=Gt(n.shape,r),o=i[0],a=oe(i[1]),s=n.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(o)},e.prototype.any=function(n,r){_n("any",r,n.rank);var i=Gt(n.shape,r),o=i[0],a=oe(i[1]),s=n.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(o)},e.prototype.realDivide=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new lt(`
if (a == b) {
  return 1.0;
};
return a / b;`,n.shape,r.shape);return this.compileAndRun(i,[n,r],"float32")},e.prototype.floorDiv=function(n,r){if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new lt(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,n.shape,r.shape);return this.compileAndRun(i,[n,r],"int32")},e.prototype.add=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,sp);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.add(n,r);var i=Lt(n.dtype,r.dtype);if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,sp,i);var o=new lt(sp,n.shape,r.shape);return this.compileAndRun(o,[n,r],i)},e.prototype.packedUnaryOp=function(n,r,i){var o=new Zs(n.shape,r);return this.compileAndRun(o,[n],i)},e.prototype.packedBinaryOp=function(n,r,i,o,a){a===void 0&&(a=!1);var s=new ei(i,n.shape,r.shape,a);return this.compileAndRun(s,[n,r],o)},e.prototype.complexSeparableBinaryOp=function(n,r,i){var o=this,a=this.texData.get(n.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(h){var f=h[0],m=h[1],p=o.makeComplexComponentTensorInfo(n,f),v=o.makeComplexComponentTensorInfo(r,m),g=new lt(i,n.shape,r.shape);return o.compileAndRun(g,[p,v],Lt(f.dtype,m.dtype))}),l=u[0],c=u[1],d=this.complex(l,c);return l.dispose(),c.dispose(),d},e.prototype.makeComplexComponentTensorInfo=function(n,r){return{dataId:r.dataId,dtype:r.dtype,shape:n.shape}},e.prototype.addN=function(n){if(n.length===1)return n[0];if(n.length>G().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(n.length/2),i=this.addN(n.slice(0,r)),o=this.addN(n.slice(r));return this.addN([i,o])}var a=n.map(function(l){return l.dtype}).reduce(function(l,c){return Lt(l,c)}),s=n.map(function(l){return l.shape}),u=G().getBool("WEBGL_PACK")?new pz(n[0].shape,s):new fz(n[0].shape,s);return this.compileAndRun(u,n,a)},e.prototype.subtract=function(n,r){if(n.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(n,r,up);if(this.shouldExecuteOnCPU([n,r]))return this.cpuBackend.subtract(n,r);var i=Lt(n.dtype,r.dtype);if(G().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(n,r,up,n.dtype);var o=new lt(up,n.shape,r.shape);return this.compileAndRun(o,[n,r],i)},e.prototype.pow=function(n,r){var i=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ei(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new lt(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,n.shape,r.shape),o=Lt(n.dtype,r.dtype);return this.compileAndRun(i,[n,r],o)},e.prototype.ceil=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.ceil(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,C1,n.dtype);var r=new be(n.shape,C1);return this.compileAndRun(r,[n])},e.prototype.floor=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.floor(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,E1,n.dtype);var r=new be(n.shape,E1);return this.compileAndRun(r,[n])},e.prototype.sign=function(n){var r=new be(n.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[n])},e.prototype.isNaN=function(n){var r=new be(n.shape,"return float(isnan(x));");return this.compileAndRun(r,[n],"bool")},e.prototype.isInf=function(n){var r=new be(n.shape,"return float(isinf(x));");return this.compileAndRun(r,[n],"bool")},e.prototype.isFinite=function(n){var r=new be(n.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[n],"bool")},e.prototype.round=function(n){var r=new be(n.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[n])},e.prototype.exp=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.exp(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,A1,n.dtype);var r=new be(n.shape,A1);return this.compileAndRun(r,[n])},e.prototype.expm1=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.expm1(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,R1,n.dtype);var r=new be(n.shape,R1);return this.compileAndRun(r,[n])},e.prototype.softmax=function(n,r){var i=Rt([r],n.shape),o=this.max(n,i),a=yn(o.shape,i),s=this.subtract(n,o.reshape(a)),u=this.exp(s),l=this.sum(u,i).reshape(a);return this.realDivide(u,l)},e.prototype.log=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.log(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,n.dtype);var r=new be(n.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[n])},e.prototype.log1p=function(n){var r=new be(n.shape,"return log(1.0 + x);");return this.compileAndRun(r,[n])},e.prototype.sqrt=function(n){var r=new be(n.shape,"return sqrt(x);");return this.compileAndRun(r,[n])},e.prototype.rsqrt=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.rsqrt(n);var r=new be(n.shape,"return inversesqrt(x);");return this.compileAndRun(r,[n])},e.prototype.reciprocal=function(n){var r=new be(n.shape,"return 1.0 / x;");return this.compileAndRun(r,[n])},e.prototype.relu=function(n){var r;return r=G().getBool("WEBGL_PACK")?new Zs(n.shape,tA):new be(n.shape,QE),this.compileAndRun(r,[n])},e.prototype.relu6=function(n){var r;return r=G().getBool("WEBGL_PACK")?new Zs(n.shape,nA):new be(n.shape,ZE),this.compileAndRun(r,[n])},e.prototype.prelu=function(n,r){var i=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ei(JE,n.shape,r.shape):new lt(YE,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.elu=function(n){if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,rA,n.dtype);var r=new be(n.shape,eA);return this.compileAndRun(r,[n])},e.prototype.eluDer=function(n,r){var i=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ei(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,n.shape,r.shape):new lt("return (b >= 1.0) ? a : a * (b + 1.0);",n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.selu=function(n){var r=new be(n.shape,qU);return this.compileAndRun(r,[n])},e.prototype.int=function(n){var r=new be(n.shape,"return float(int(x));");return this.compileAndRun(r,[n],"int32")},e.prototype.clip=function(n,r,i){var o,a=(o=G().getBool("WEBGL_PACK_CLIP")?new Nz(n.shape):new Rz(n.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[n],null,a)},e.prototype.abs=function(n){if(this.shouldExecuteOnCPU([n]))return this.cpuBackend.abs(n);if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(n,_1,n.dtype);var r=new be(n.shape,_1);return this.compileAndRun(r,[n])},e.prototype.complexAbs=function(n){var r=this.texData.get(n.dataId),i=new Tz(n.shape),o=[this.makeComplexComponentTensorInfo(n,r.complexTensors.real),this.makeComplexComponentTensorInfo(n,r.complexTensors.imag)];return this.compileAndRun(i,o)},e.prototype.sigmoid=function(n){var r=new be(n.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[n])},e.prototype.softplus=function(n){var r=new be(n.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[n])},e.prototype.sin=function(n){var r=new be(n.shape,XU);return this.compileAndRun(r,[n])},e.prototype.cos=function(n){var r=new be(n.shape,YU);return this.compileAndRun(r,[n])},e.prototype.tan=function(n){var r=new be(n.shape,"return tan(x);");return this.compileAndRun(r,[n])},e.prototype.asin=function(n){var r=new be(n.shape,JU);return this.compileAndRun(r,[n])},e.prototype.acos=function(n){var r=new be(n.shape,QU);return this.compileAndRun(r,[n])},e.prototype.atan=function(n){var r=new be(n.shape,ZU);return this.compileAndRun(r,[n])},e.prototype.atan2=function(n,r){var i=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ei(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,n.shape,r.shape):new lt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,n.shape,r.shape);return this.compileAndRun(i,[n,r])},e.prototype.sinh=function(n){var r=new be(n.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},e.prototype.cosh=function(n){var r=new be(n.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[n])},e.prototype.tanh=function(n){var r=new be(n.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[n])},e.prototype.asinh=function(n){var r=new be(n.shape,e6);return this.compileAndRun(r,[n])},e.prototype.acosh=function(n){var r=new be(n.shape,t6);return this.compileAndRun(r,[n])},e.prototype.atanh=function(n){var r=new be(n.shape,n6);return this.compileAndRun(r,[n])},e.prototype.erf=function(n){var r=new be(n.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[n])},e.prototype.step=function(n,r){var i=new be(n.shape,function(o){return o===void 0&&(o=0),wr+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `}(r));return this.compileAndRun(i,[n])},e.prototype.conv2dByMatMul=function(n,r,i,o,a,s){var u=n.shape,l=this.texData.get(n.dataId),c=i.inChannels,d=u[0]*u[1]*u[2],h=i.outChannels,f=i.dataFormat==="channelsLast",m=(d===1||h===1)&&c>1e3,p=u[2]%2!=0&&!!l.isPacked;if(m||!G().getBool("WEBGL_LAZILY_UNPACK")||!G().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!p){var v=f?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],g=this.reshape(n,[1,v,i.inChannels]),x=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b:x,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),i.outShape)}var w=f?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),b={dataId:n.dataId,shape:[1,w,i.inChannels],dtype:n.dtype},k=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,T(cc(l.shape,b.shape),function(){return"packed reshape "+l.shape+" to "+b.shape+" isn't free"});var _=this.reshape(r,[1,i.inChannels,i.outChannels]),S=this.fusedBatchMatMul({a:b,b:_,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),C=this.texData.get(S.dataId);return T(C.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=k,C.shape=i.outShape,O.makeTensorFromDataId(S.dataId,i.outShape,S.dtype)},e.prototype.conv2dWithIm2Row=function(n,r,i,o,a,s){var u=i.filterWidth,l=i.filterHeight,c=i.inChannels,d=i.outWidth,h=i.outHeight,f=i.dataFormat==="channelsLast",m=u*l*c,p=h*d,v=[m,p],g=n.squeeze([0]),x=r.reshape([1,m,-1]),w=new yU(v,g.shape,i),b=this.compileAndRun(w,[g]).reshape([1,v[0],v[1]]),k=o!=null,_=s!=null,S=a?pc(a,!0):null,C=new lp(b.shape,[1,p,i.outChannels],!0,!1,k,S,_),E=[b,x];o&&E.push(o),_&&E.push(s);var R=this.compileAndRun(C,E);return f?R.reshape([1,h,d,i.outChannels]):R.reshape([1,i.outChannels,h,d])},e.prototype.fusedConv2d=function(n){var r=n.input,i=n.filter,o=n.convInfo,a=n.bias,s=n.activation,u=n.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(r,i,o,a,s,u);if(G().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,i,o,a,s,u);var l=a!=null,c=u!=null,d=s?pc(s,!1):null,h=new p1(o,l,d,c),f=[r,i];return a&&f.push(a),u&&f.push(u),this.compileAndRun(h,f)},e.prototype.conv2d=function(n,r,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(n,r,i);if(G().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,r,i);var o=new p1(i);return this.compileAndRun(o,[n,r])},e.prototype.conv2dDerInput=function(n,r,i){var o=new Mz(i);return this.compileAndRun(o,[n,r])},e.prototype.conv2dDerFilter=function(n,r,i){var o=new Dz(i);return this.compileAndRun(o,[n,r])},e.prototype.fusedDepthwiseConv2D=function(n){var r,i=n.input,o=n.filter,a=n.convInfo,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=G().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,d=u?pc(u,c):null,h=[i,o],f=s!=null,m=l!=null;return f&&h.push(s),m&&h.push(l),c?(r=new g1(a,f,d,m),this.compileAndRun(r,h)):(r=new m1(a,f,d,m),this.compileAndRun(r,h))},e.prototype.depthwiseConv2D=function(n,r,i){var o;return G().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new g1(i),this.compileAndRun(o,[n,r])):(o=new m1(i),this.compileAndRun(o,[n,r]))},e.prototype.depthwiseConv2DDerInput=function(n,r,i){var o=new Lz(i);return this.compileAndRun(o,[n,r])},e.prototype.depthwiseConv2DDerFilter=function(n,r,i){var o=new Fz(i);return this.compileAndRun(o,[n,r])},e.prototype.conv3d=function(n,r,i){var o=new Bz(i);return this.compileAndRun(o,[n,r])},e.prototype.conv3dDerInput=function(n,r,i){var o=new jz(i);return this.compileAndRun(o,[n,r])},e.prototype.conv3dDerFilter=function(n,r,i){var o=new Oz(i);return this.compileAndRun(o,[n,r])},e.prototype.maxPool=function(n,r){var i=new cp(r,"max",!1);return this.compileAndRun(i,[n])},e.prototype.avgPool=function(n,r){var i=new cp(r,"avg",!1);return this.compileAndRun(i,[n],"float32")},e.prototype.maxPoolBackprop=function(n,r,i,o){var a=new cp(o,"max",!0),s=this.compileAndRun(a,[r]),u=new kU(o),l=this.compileAndRun(u,[n,s],r.dtype);return s.dispose(),l},e.prototype.avgPoolBackprop=function(n,r,i){var o=new kz(i);return this.compileAndRun(o,[n],r.dtype)},e.prototype.cast=function(n,r){return zE(n,r,this)},e.prototype.unstack=function(n,r){for(var i=n.shape[r],o=new Array(n.rank-1),a=0,s=0;s<n.rank;s++)s!==r&&(o[a++]=n.shape[s]);var u=new Array(n.rank).fill(0),l=n.shape.slice();l[r]=1;var c=new Array(i);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(n,u,l).reshape(o);return c},e.prototype.avgPool3d=function(n,r){var i=new dp(r,"avg",!1);return this.compileAndRun(i,[n],"float32")},e.prototype.avgPool3dBackprop=function(n,r,i){var o=new _z(i);return this.compileAndRun(o,[n],r.dtype)},e.prototype.maxPool3d=function(n,r){var i=new dp(r,"max",!1);return this.compileAndRun(i,[n],"float32")},e.prototype.maxPool3dBackprop=function(n,r,i,o){var a=new dp(o,"max",!0),s=this.compileAndRun(a,[r]),u=new _U(o),l=this.compileAndRun(u,[n,s],r.dtype);return s.dispose(),l},e.prototype.reshape=function(n,r){var i=this.texData.get(n.dataId);if(i.isPacked&&!cc(n.shape,r)&&(i.texture===null||!cc(i.shape,r))){var o=this.packedReshape(n,r);return O.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return gg(n,r)},e.prototype.resizeBilinear=function(n,r,i,o){var a=G().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new DU(n.shape,r,i,o):new IU(n.shape,r,i,o);return this.compileAndRun(a,[n],"float32")},e.prototype.resizeBilinearBackprop=function(n,r,i){var o=new PU(n,r,i);return this.compileAndRun(o,[n])},e.prototype.resizeNearestNeighbor=function(n,r,i,o){var a=new OU(n.shape,r,i,o);return this.compileAndRun(a,[n])},e.prototype.resizeNearestNeighborBackprop=function(n,r,i){var o=new MU(n,r,i);return this.compileAndRun(o,[n])},e.prototype.multinomial=function(n,r,i,o){var a=r?n:yi(n),s=a.shape[0],u=a.shape[1],l=new SU(s,u,i),c=l.getCustomSetupFunc(o);return this.compileAndRun(l,[a],"int32",c)},e.prototype.oneHot=function(n,r,i,o){var a=new CU(n.size,r,i,o);return this.compileAndRun(a,[n])},e.prototype.diag=function(n){var r=new Gz(n.size);return this.compileAndRun(r,[n])},e.prototype.nonMaxSuppression=function(n,r,i,o,a){return Md("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Xy(n.dataSync(),r.dataSync(),i,o,a)},e.prototype.cropAndResize=function(n,r,i,o,a,s){var u=new Vz(n.shape,r.shape,o,a,s);return this.compileAndRun(u,[n,r,i],"float32")},e.prototype.depthToSpace=function(n,r,i){T(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var o=n.shape[0],a=i==="NHWC"?n.shape[1]:n.shape[2],s=i==="NHWC"?n.shape[2]:n.shape[3],u=i==="NHWC"?n.shape[3]:n.shape[1],l=a*r,c=s*r,d=u/(r*r),h=new Wz(i==="NHWC"?[o,l,c,d]:[o,d,l,c],r,i);return this.compileAndRun(h,[n])},e.prototype.split=function(n,r,i){return WE(n,r,i)},e.prototype.scatterND=function(n,r,i){var o=Vd(0,n,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,d=[c/u,u],h=n.reshape([s,a]),f=r.reshape([s,u]);if(c===0)return gg(Bt([]),i);var m=J(0),p=new w1(s,a,h.rank,f.rank,l,d);return this.compileAndRun(p,[f,h,m]).reshape(i)},e.prototype.sparseToDense=function(n,r,i,o){var a=Vd(0,n,i),s=a.sliceRank,u=a.numUpdates,l=a.strides,c=a.outputSize,d=new w1(u,s,n.rank,r.rank,l,[c,1]);return this.compileAndRun(d,[r,n,o]).reshape(i)},e.prototype.fft=function(n){return this.fftImpl(n,!1)},e.prototype.ifft=function(n){return this.fftImpl(n,!0)},e.prototype.fftImpl=function(n,r){var i=this.texData.get(n.dataId),o=new y1(Yz,n.shape,r),a=new y1(Jz,n.shape,r),s=[this.makeComplexComponentTensorInfo(n,i.complexTensors.real),this.makeComplexComponentTensorInfo(n,i.complexTensors.imag)],u=this.compileAndRun(o,s),l=this.compileAndRun(a,s),c=this.complex(u,l).as2D(n.shape[0],n.shape[1]);return u.dispose(),l.dispose(),c},e.prototype.gatherND=function(n,r){var i=r.shape,o=i[i.length-1],a=ME(n,r),s=a[0],u=a[1],l=a[2],c=a[3],d=r.reshape([u,o]),h=n.reshape([n.size/l,l]),f=new eU(o,c,[u,l]);return this.compileAndRun(f,[h,d]).reshape(s)},e.prototype.fill=function(n,r,i){if((i=i||_l(r))==="string"){var o=Td(i,oe(n));return o.fill(r),O.makeTensor(o,n,i,this)}var a=new Qz(n,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],i,s)},e.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(n.shape,1,n.dtype)},e.prototype.zerosLike=function(n){return this.fill(n.shape,n.dtype==="string"?"":0,n.dtype)},e.prototype.linspace=function(n,r,i){return UE(n,r,i)},e.prototype.makeTensorInfo=function(n,r){var i=this.write(null,n,r);return this.texData.get(i).usage=null,{dataId:i,shape:n,dtype:r}},e.prototype.makeOutput=function(n,r){var i=this.makeTensorInfo(n,r).dataId;return O.makeTensorFromDataId(i,n,r,this)},e.prototype.unpackTensor=function(n){var r=new i6(n.shape);return this.runWebGLProgram(r,[n],n.dtype)},e.prototype.packTensor=function(n){var r=new EU(n.shape);return this.runWebGLProgram(r,[n],n.dtype,null,!0)},e.prototype.packedReshape=function(n,r){var i=[Id(n.shape)].concat(Dd(n.shape)),o={dtype:n.dtype,shape:i,dataId:n.dataId},a=[Id(r)].concat(Dd(r)),s=new TU(a,i),u=this.runWebGLProgram(s,[o],n.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},e.prototype.decode=function(n){var r,i=this.texData.get(n),o=i.isPacked,a=i.shape,s=i.dtype,u=op(a);return r=o?new $z(u):new Uz(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:n}],s,null,!0).dataId}},e.prototype.runWebGLProgram=function(n,r,i,o,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(n.outputShape,i),l=this.texData.get(u.dataId);if(n.packedOutput&&(l.isPacked=!0),n.outPackingScheme===il.DENSE){var c=Su(n.outputShape);l.texShape=c.map(function(w){return 2*w})}if(n.outTexUsage!=null&&(l.usage=n.outTexUsage),oe(u.shape)===0)return l.values=nl(u.dtype,0),u;var d=[],h=r.map(function(w){if(w.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var b=s.texData.get(w.dataId);if(b.texture==null){if(!n.packedInputs&&oe(w.shape)<=G().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:w.shape,texData:null,isUniform:!0,uniformValues:b.values};n.packedInputs&&(b.isPacked=!0,b.shape=w.shape)}else if(!!b.isPacked!=!!n.packedInputs)w=b.isPacked?s.unpackTensor(w):s.packTensor(w),d.push(w),b=s.texData.get(w.dataId);else if(b.isPacked&&!cc(b.shape,w.shape)){var k=w,_=w.shape;w.shape=b.shape,w=s.packedReshape(w,_),d.push(w),b=s.texData.get(w.dataId),k.shape=_}return s.uploadToGPU(w.dataId),{shape:w.shape,texData:b,isUniform:!1}});this.uploadToGPU(u.dataId);var f,m={shape:u.shape,texData:l,isUniform:!1},p=function(w,b,k){var _="";b.concat(k).forEach(function(E){var R=E.texData!=null&&E.texData.slice!=null&&E.texData.slice.flatOffset>0,D=E.isUniform?"uniform":E.texData.texShape;_+=E.shape+"_"+D+"_"+R});var S=w.userCode,C=w.constructor.name;return C+="_"+_+"_"+S}(n,h,m),v=this.getAndSaveBinary(p,function(){return function(w,b,k,_){var S=b.userCode,C=k.map(function(I,j){var B={logicalShape:I.shape,texShape:I.isUniform?null:I.texData.texShape,isUniform:I.isUniform,isPacked:!I.isUniform&&I.texData.isPacked,flatOffset:null};return I.texData!=null&&I.texData.slice!=null&&I.texData.slice.flatOffset>0&&(B.flatOffset=I.texData.slice.flatOffset),{name:b.variableNames[j],shapeInfo:B}}),E=C.map(function(I){return I.shapeInfo}),R={logicalShape:_.shape,texShape:_.texData.texShape,isUniform:!1,isPacked:_.texData.isPacked,flatOffset:null},D=gz(C,R,S,b.packedInputs),P=w.createProgram(D),F=null,U=w.getUniformLocation(P,"NAN",!1);G().getNumber("WEBGL_VERSION")===1&&(F=w.getUniformLocation(P,"INFINITY",!1));for(var z={},W=0;W<b.variableNames.length;W++){var L=b.variableNames[W];z[L]=w.getUniformLocation(P,L,!1),z["offset"+L]=w.getUniformLocation(P,"offset"+L,!1)}return{program:b,source:D,webGLProgram:P,uniformLocations:z,inShapeInfos:E,outShapeInfo:R,infLoc:F,nanLoc:U}}(s.gpgpu,n,h,m)}),g=this.activeTimers!=null;if(g&&(f=this.startTimer()),function(w,b,k,_,S){x1(b.inShapeInfos,k),x1([b.outShapeInfo],[_]);var C=_.texData.texture,E=_.texData.texShape;_.texData.isPacked?w.setOutputPackedMatrixTexture(C,E[0],E[1]):w.setOutputMatrixTexture(C,E[0],E[1]),w.setProgram(b.webGLProgram),G().getNumber("WEBGL_VERSION")===1&&b.infLoc!==null&&w.gl.uniform1f(b.infLoc,1/0),b.nanLoc!==null&&w.gl.uniform1f(b.nanLoc,NaN),k.forEach(function(R,D){var P=b.program.variableNames[D],F=b.uniformLocations[P],U=b.uniformLocations["offset"+P];if(F!=null)if(R.isUniform)if(oe(R.shape)<2)w.gl.uniform1f(F,R.uniformValues[0]);else{var z=R.uniformValues;z instanceof Float32Array||(z=new Float32Array(z)),w.gl.uniform1fv(F,z)}else R.texData.slice!=null&&U!=null&&w.gl.uniform1i(U,R.texData.slice.flatOffset),w.setInputMatrixTexture(R.texData.texture,F,D)}),S!=null&&S(w,b.webGLProgram),w.executeProgram()}(this.gpgpu,v,h,m,o),d.forEach(function(w){return s.disposeData(w.dataId)}),g&&(f=this.endTimer(f),this.activeTimers.push({name:n.constructor.name,query:this.getQueryTime(f)})),!G().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&a===!1){var x=this.unpackTensor(u);return this.disposeData(u.dataId),x}return u},e.prototype.compileAndRun=function(n,r,i,o,a){a===void 0&&(a=!1),i=i||r[0].dtype;var s=this.runWebGLProgram(n,r,i,o,a);return O.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},e.prototype.getAndSaveBinary=function(n,r){return n in this.binaryCache||(this.binaryCache[n]=r()),this.binaryCache[n]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var n=this;this.disposed||(G().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){n.gpgpu.deleteProgram(n.binaryCache[r].webGLProgram),delete n.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var n=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Q(function(){if(!G().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=G().getBool("DEBUG");G().set("DEBUG",!1);var i=n.abs(J(1e-8)).dataSync()[0];if(G().set("DEBUG",r),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(n){var r,i=this.texData.get(n),o=i.shape,a=i.dtype,s=i.values,u=i.texture,l=i.usage,c=i.isPacked;if(u==null){var d,h=this.activeTimers!=null;h&&(d=Nr());var f=i.texShape;if(f==null&&(f=hV(o,c),i.texShape=f),s!=null){var m=op(o),p=void 0,v=f[1],g=f[0],x=s instanceof Uint8Array;c?(v=(r=Cl(f[0],f[1]))[0],g=r[1],p=new Xz(m,[g,v],x)):p=new qz(m,[g,v],x);var w=this.makeTensorInfo([g,v],a);this.texData.get(w.dataId).usage=x?Rn.PIXELS:Rn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),v,g,s);var b=this.runWebGLProgram(p,[w],a,null,!0),k=this.texData.get(b.dataId);i.texture=k.texture,i.texShape=k.texShape,i.isPacked=k.isPacked,i.usage=k.usage,this.disposeData(w.dataId),this.texData.delete(b.dataId),i.values=null,h&&(this.uploadWaitMs+=Nr()-d)}else{var _=this.acquireTexture(f,l,a,c);i.texture=_}}},e.prototype.convertAndCacheOnCPU=function(n,r){var i=this.texData.get(n),o=i.dtype;return this.releaseGPUData(n),r!=null&&(i.values=function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),l=0;l<u.length;++l)u[l]=Math.round(a[l]);return u}throw new Error("Unknown dtype "+s)}(r,o)),i.values},e.prototype.acquireTexture=function(n,r,i,o){if(this.numBytesInGPU+=this.computeBytes(n,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(n,r,o)},e.prototype.computeBytes=function(n,r){return n[0]*n[1]*gE(r)},e}(BE);_E()&&O.registerBackend("webgl",function(){return new a6},2);var s6=M({square_:function(t){var e=N(t,"x","square"),n=[e];return O.runKernelFunc(function(r,i){return i([e]),r.square(e)},{x:e},null,"Square",{},n,[])}}),al="SquaredDifference",iA=M({squaredDifference_:function(t,e){var n,r=N(t,"a","squaredDifference"),i=N(e,"b","squaredDifference");n=st(r,i),r=n[0],i=n[1],Ae(r.shape,i.shape);var o={a:r,b:i},a=[r,i];return O.runKernelFunc(function(s,u){var l=s.squaredDifference(r,i);return u([r,i]),l},o,function(s,u){var l=u[0],c=u[1],d=J(2);return{a:function(){return s.mul(l.sub(c).mul(d))},b:function(){return s.mul(c.sub(l).mul(d))}}},al,{},a,[])}}),u6=M({abs_:function(t){var e=N(t,"x","abs");return e.dtype==="complex64"?O.runKernelFunc(function(n){return n.complexAbs(e)},{$x:e}):O.runKernelFunc(function(n,r){var i=n.abs(e);return r([e]),i},{x:e},function(n,r){var i=r[0];return{x:function(){return n.mul(i.toFloat().step(-1))}}},"Abs")}}),l6=M({acos_:function(t){var e=N(t,"x","acos");return O.runKernelFunc(function(n,r){var i=n.acos(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.divStrict(J(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),c6=M({acosh_:function(t){var e=N(t,"x","acosh");return O.runKernelFunc(function(n,r){var i=n.acosh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),d6=M({asin_:function(t){var e=N(t,"x","asin");return O.runKernelFunc(function(n,r){var i=n.asin(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.divStrict(J(1).sub(i.toFloat().square()).sqrt())}}})}}),h6=M({asinh_:function(t){var e=N(t,"x","asinh");return O.runKernelFunc(function(n,r){var i=n.asinh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.divStrict(J(1).add(i.toFloat().square()).sqrt())}}})}}),f6=M({atan_:function(t){var e=N(t,"x","atan");return O.runKernelFunc(function(n,r){var i=n.atan(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.toFloat().square().add(1))}}})}}),p6=M({atanh_:function(t){var e=N(t,"x","atanh");return O.runKernelFunc(function(n,r){var i=n.atanh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(J(1).sub(i.toFloat().square()))}}})}}),m6=M({ceil_:function(t){var e=N(t,"x","ceil");return O.runKernelFunc(function(n){return n.ceil(e)},{$x:e},function(n){return{$x:function(){return Ne(n)}}})}}),t0=M({clipByValue_:function(t,e,n){var r=N(t,"x","clipByValue");T(e<=n,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."});var i=[r],o={min:e,max:n};return O.runKernelFunc(function(a,s){var u=a.clip(r,e,n);return s([r]),u},{x:r},function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(e).logicalAnd(u.lessEqual(n)),Ne(a))}}},"ClipByValue",o,i)}}),g6=M({cos_:function(t){var e=N(t,"x","cos"),n=[e];return O.runKernelFunc(function(r,i){var o=r.cos(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}},"Cos",{},n)}}),v6=M({cosh_:function(t){var e=N(t,"x","cosh");return O.runKernelFunc(function(n,r){var i=n.cosh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(n)}}})}}),y6=M({erf_:function(t){var e=N(t,"x","erf");return T(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),O.runKernelFunc(function(n,r){var i=n.erf(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),yg=M({exp_:function(t){var e=N(t,"x","exp");return O.runKernelFunc(function(n,r){var i=n.exp(e);return r([i]),i},{x:e},function(n,r){return{x:function(){return n.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),x6=M({expm1_:function(t){var e=N(t,"x","expm1");return O.runKernelFunc(function(n,r){var i=n.expm1(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.mul(i.exp())}}})}}),w6=M({floor_:function(t){var e=N(t,"x","floor");return O.runKernelFunc(function(n){return n.floor(e)},{$x:e},function(n){return{$x:function(){return Ne(n)}}})}}),b6=M({log_:function(t){var e=N(t,"x","log"),n=[e];return O.runKernelFunc(function(r,i){var o=r.log(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}},"Log",{},n)}}),k6=M({log1p_:function(t){var e=N(t,"x","log1p");return O.runKernelFunc(function(n,r){var i=n.log1p(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.add(1))}}})}}),_6=M({logSigmoid_:function(t){var e=N(t,"x","logSigmoid");return O.runKernelFunc(function(n,r){var i=n.softplus(e.neg()).neg();return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.mul(i.neg().sigmoid())}}})}}),Wd=M({neg_:function(t){var e=N(t,"x","neg"),n=[e];return O.runKernelFunc(function(r){return r.neg(e)},{x:e},function(r){return{x:function(){return r.neg()}}},"Neg",{},n)}}),S6=M({reciprocal_:function(t){var e=N(t,"x","reciprocal");return O.runKernelFunc(function(n,r){var i=n.reciprocal(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.square().neg())}}})}}),C6=M({round_:function(t){var e=N(t,"x","round");return O.runKernelFunc(function(n){return n.round(e)},{$x:e},function(n){return{$x:function(){return Ne(n)}}})}}),oA=M({rsqrt_:function(t){var e=N(t,"x","rsqrt"),n=[e];return O.runKernelFunc(function(r,i){var o=r.rsqrt(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),aA=M({sigmoid_:function(t){var e=N(t,"x","sigmoid");return O.runKernelFunc(function(n,r){var i=n.sigmoid(e);return r([i]),i},{x:e},function(n,r){var i=r[0];return{x:function(){return n.mul(i.mul(J(1).sub(i)))}}},"Sigmoid")}}),E6=M({sign_:function(t){var e=N(t,"x","sign");return O.runKernelFunc(function(n){return n.sign(e)},{$x:e},function(n){return{$x:function(){return Ne(n)}}})}}),A6=M({isNaN_:function(t){var e=N(t,"x","isNaN");return O.runKernelFunc(function(n){return n.isNaN(e)},{$x:e},function(n){return{$x:function(){return Ne(n)}}})}}),R6=M({isInf_:function(t){var e=N(t,"x","isInf");return O.runKernelFunc(function(n){return n.isInf(e)},{$x:e},function(n){return{$x:function(){return Ne(n)}}})}}),N6=M({isFinite_:function(t){var e=N(t,"x","isFinite");return O.runKernelFunc(function(n){return n.isFinite(e)},{$x:e},function(n){return{$x:function(){return Ne(n)}}})}}),T6=M({sin_:function(t){var e=N(t,"x","sin"),n=[e];return O.runKernelFunc(function(r,i){var o=r.sin(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}},"Sin",{},n)}}),P6=M({sinh_:function(t){var e=N(t,"x","sinh");return O.runKernelFunc(function(n,r){var i=n.sinh(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(n)}}})}}),I6=M({softplus_:function(t){var e=N(t,"x","softplus");return O.runKernelFunc(function(n,r){var i=n.softplus(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.mul(i.sigmoid())}}})}}),D6=M({sqrt_:function(t){var e=N(t,"x","sqrt");return O.runKernelFunc(function(n,r){var i=n.sqrt(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.toFloat().sqrt().mul(2))}}})}}),M6=M({step_:function(t,e){e===void 0&&(e=0);var n=N(t,"x","step");return O.runKernelFunc(function(r){return r.step(n,e)},{$x:n},function(r){return{$x:function(){return Ne(r)}}})}}),O6=M({tan_:function(t){var e=N(t,"x","tan");return O.runKernelFunc(function(n,r){var i=n.tan(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return n.div(i.cos().square())}}})}}),j6=M({tanh_:function(t){var e=N(t,"x","tanh");return O.runKernelFunc(function(n,r){var i=n.tanh(e);return r([i]),i},{x:e},function(n,r){var i=r[0];return{x:function(){return J(1).sub(i.square()).mulStrict(n)}}},"Tanh",{},null,[!0])}});function sA(t,e,n,r,i,o){var a,s,u=N(t,"x","batchNorm"),l=N(e,"mean","batchNorm"),c=N(n,"variance","batchNorm");return i!=null&&(a=N(i,"scale","batchNorm")),r!=null&&(s=N(r,"offset","batchNorm")),T(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),T(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),T(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),a!=null&&T(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&T(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Al(u,l,c,s,a,o)}function uA(t,e,n,r,i,o){var a,s,u=N(t,"x","batchNorm"),l=N(e,"mean","batchNorm"),c=N(n,"variance","batchNorm");return i!=null&&(a=N(i,"scale","batchNorm")),r!=null&&(s=N(r,"offset","batchNorm")),T(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),T(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),T(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),a!=null&&T(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&T(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Al(u,l,c,s,a,o)}function lA(t,e,n,r,i,o){var a,s,u=N(t,"x","batchNorm"),l=N(e,"mean","batchNorm"),c=N(n,"variance","batchNorm");return i!=null&&(a=N(i,"scale","batchNorm")),r!=null&&(s=N(r,"offset","batchNorm")),T(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),T(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),T(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),a!=null&&T(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&T(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Al(u,l,c,s,a,o)}function Al(t,e,n,r,i,o){o==null&&(o=.001);var a,s,u,l=N(t,"x","batchNorm"),c=N(e,"mean","batchNorm"),d=N(n,"variance","batchNorm");i!=null&&(a=N(i,"scale","batchNorm")),r!=null&&(s=N(r,"offset","batchNorm")),T(c.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),T(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),T(a==null||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var h=[l,c,d,a];return O.runKernelFunc(function(f,m){var p=f.batchNormalization(u,mc(c),mc(d),o,mc(a),mc(s));return m([l,c,d,a]),p},{x:l,mean:c,variance:d,scale:a,offset:s},function(f,m){var p=m,v=p[0],g=p[1],x=p[2],w=p[3],b=w??J(1),k=Et(g.shape,u.shape),_=[];if(g.rank===1){for(var S=0;S<u.shape.length-1;++S)_.push(u.shape[S]);_.push(1)}var C=v.sub(g),E=f.mul(b),R=oA(x.add(J(o))),D=R.mul(R).mul(R).mul(J(-.5));return{x:function(){return g.rank===1?f.mul(Qa(R.as4D(1,1,1,g.shape[0]),_)).mul(b).reshape(v.shape):f.mul(R).mul(b).reshape(v.shape)},mean:function(){var P=R.mul(J(-1)).mul(E);return g.rank===1&&(P=P.sum(k)),P.reshape(g.shape)},variance:function(){var P=D.mul(C).mul(E);return g.rank===1&&(P=P.sum(k)),P.reshape(g.shape)},scale:function(){var P=C.mul(R),F=f.mul(P);return g.rank===1&&(F=F.sum(k)),F.reshape(g.shape)},offset:function(){var P=f;return g.rank===1&&(P=P.sum(k)),P.reshape(g.shape)}}},"BatchNormalization",{varianceEpsilon:o},h).reshape(l.shape)}function mc(t){return t==null?null:t.rank===0?t.as1D():t.rank===1?t:t.rank===2?t.as4D(1,1,t.shape[0],t.shape[1]):t.rank===3?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function Ih(){SE("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var F6=M({batchNormalization2d_:function(t,e,n,r,i,o){return r===void 0&&(r=.001),Ih(),sA(t,e,n,o,i,r)}}),L6=M({batchNormalization3d_:function(t,e,n,r,i,o){return r===void 0&&(r=.001),Ih(),uA(t,e,n,o,i,r)}}),B6=M({batchNormalization4d_:function(t,e,n,r,i,o){return r===void 0&&(r=.001),Ih(),lA(t,e,n,o,i,r)}}),V6=M({batchNormalization_:function(t,e,n,r,i,o){return r===void 0&&(r=.001),Ih(),Al(t,e,n,o,i,r)}}),cA=M({batchNorm_:Al}),z6=M({batchNorm2d_:sA}),U6=M({batchNorm3d_:uA}),$6=M({batchNorm4d_:lA}),Dh=M({logicalAnd_:function(t,e){var n=N(t,"a","logicalAnd","bool"),r=N(e,"b","logicalAnd","bool");return Ae(n.shape,r.shape),O.runKernelFunc(function(i){return i.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),W6=M({logicalNot_:function(t){var e=N(t,"x","logicalNot","bool");return O.runKernelFunc(function(n){return n.logicalNot(e)},{$x:e})}}),dA=M({logicalOr_:function(t,e){var n=N(t,"a","logicalOr","bool"),r=N(e,"b","logicalOr","bool");return Ae(n.shape,r.shape),O.runKernelFunc(function(i){return i.logicalOr(n,r)},{$a:n,$b:r})}}),G6=M({logicalXor_:function(t,e){var n=N(t,"a","logicalXor","bool"),r=N(e,"b","logicalXor","bool");return Ae(n.shape,r.shape),dA(t,e).logicalAnd(Dh(t,e).logicalNot())}}),Ho=M({where_:function(t,e,n){var r=N(e,"a","where"),i=N(n,"b","where"),o=N(t,"condition","where","bool");return Oe(r.shape,i.shape,"Error in where: "),o.rank===1?T(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Oe(o.shape,i.shape,"Error in where: "),O.runKernelFunc(function(a,s){var u=a.select(o,r,i);return s([o]),u},{$condition:o,$a:r,$b:i},function(a,s){var u=s[0];return{$condition:function(){return Ne(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),hA=function(t){return ne(this,void 0,void 0,function(){var e,n,r;return re(this,function(i){switch(i.label){case 0:return[4,(e=N(t,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=Jy(e.shape,n),t!==e&&e.dispose(),[2,r]}})})},Ee=M({add_:function(t,e){var n,r=N(t,"a","add"),i=N(e,"b","add");n=st(r,i),r=n[0],i=n[1];var o=Ae(r.shape,i.shape);return O.runKernelFunc(function(a){return a.add(r,i)},{a:r,b:i},function(a){return{a:function(){var s=a,u=Et(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=Et(i.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(i.shape)}}},"Add")}}),H6=M({addN_:function(t){T(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),T(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(i,o){return N(i,"tensors"+o,"addN")}),n=e[0];e.forEach(function(i){if(i.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!It(i.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return O.runKernelFunc(function(i){return i.addN(e)},r,function(i){var o={};return e.forEach(function(a,s){o[s]=function(){return i.clone()}}),o},"AddN")}}),K6=M({addStrict_:function(t,e){var n=N(t,"a","addStrict"),r=N(e,"b","addStrict");return Oe(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),q6=M({atan2_:function(t,e){var n,r=N(t,"a","atan2"),i=N(e,"b","atan2");n=st(r,i),r=n[0],i=n[1];var o=Ae(r.shape,i.shape);return O.runKernelFunc(function(a,s){var u=a.atan2(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=Ee(u.square(),l.square()),d=a.mul(l.div(c)),h=Et(u.shape,o);return h.length>0&&(d=d.sum(h)),d.reshape(u.shape)},$b:function(){var c=Ee(u.square(),l.square()),d=Wd(a.mul(u.div(c))),h=Et(l.shape,o);return h.length>0&&(d=d.sum(h)),d.reshape(l.shape)}}})}}),ur=M({div_:function(t,e){var n,r=N(t,"a","div"),i=N(e,"b","div");if(n=st(r,i),r=n[0],i=n[1],r.dtype==="int32"&&i.dtype==="int32")return fA(r,i);var o=Ae(r.shape,i.shape);return O.runKernelFunc(function(a,s){var u=a.realDivide(r,i);return s([r,i]),u},{a:r,b:i},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),d=Et(u.shape,o);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),d=Et(l.shape,o);d.length>0&&(c=c.sum(d).reshape(l.shape));var h=l.square();return c.div(h.toFloat()).neg()}}},"Div")}}),X6=M({divNoNan_:function(t,e){var n,r=N(t,"a","div"),i=N(e,"b","div");r=(n=st(r,i))[0],i=n[1];var o=ur(r,i),a=Ne(o),s=i.equal(a);return Ho(s,a,o)}}),Y6=M({divStrict_:function(t,e){var n=N(t,"a","div"),r=N(e,"b","div");return Oe(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),fA=M({floorDiv_:function(t,e){var n,r=N(t,"a","floorDiv"),i=N(e,"b","floorDiv");n=st(r,i),r=n[0],i=n[1];var o=Ae(r.shape,i.shape);return O.runKernelFunc(function(a,s){var u=a.floorDiv(r,i);return s([r,i]),u},{a:r,b:i},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),d=Et(u.shape,o);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),d=Et(l.shape,o);d.length>0&&(c=c.sum(d).reshape(l.shape));var h=l.square();return c.div(h.toFloat()).neg()}}},"FloorDiv")}}),n0=M({maximum_:function(t,e){var n,r=N(t,"a","maximum"),i=N(e,"b","maximum");return n=st(r,i),r=n[0],i=n[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),Ae(r.shape,i.shape),O.runKernelFunc(function(o,a){var s=o.maximum(r,i);return a([r,i]),s},{a:r,b:i},function(o,a){var s=a[0],u=a[1];return{a:function(){return o.mul(s.greaterEqual(u).toFloat())},b:function(){return o.mul(s.less(u).toFloat())}}},"Maximum")}}),J6=M({maximumStrict_:function(t,e){var n=N(t,"a","maximumStrict"),r=N(e,"b","maximumStrict");return Oe(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),pA=M({minimum_:function(t,e){var n,r=N(t,"a","minimum"),i=N(e,"b","minimum");return n=st(r,i),r=n[0],i=n[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),Ae(r.shape,i.shape),O.runKernelFunc(function(o,a){var s=o.minimum(r,i);return a([r,i]),s},{a:r,b:i},function(o,a){var s=a[0],u=a[1];return{a:function(){return o.mul(s.lessEqual(u).toFloat())},b:function(){return o.mul(s.greater(u).toFloat())}}},"Minimum")}}),Q6=M({minimumStrict_:function(t,e){var n=N(t,"a","minimumStrict"),r=N(e,"b","minimumStrict");return Oe(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Z6=M({mod_:function(t,e){var n,r=N(t,"a","mod"),i=N(e,"b","mod");n=st(r,i),r=n[0],i=n[1];var o=Ae(r.shape,i.shape);return O.runKernelFunc(function(a,s){var u=a.mod(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=Et(u.shape,o);return c.length>0?a.sum(c).reshape(u.shape):a},$b:function(){var c=a.mul(u.div(l).floor().neg()),d=Et(l.shape,o);return d.length>0?c.sum(d).reshape(l.shape):c}}})}}),e$=M({modStrict_:function(t,e){var n=N(t,"a","modStrict"),r=N(e,"b","modStrict");return Oe(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Jt=M({mul_:function(t,e){var n,r=N(t,"a","mul"),i=N(e,"b","mul");n=st(r,i),r=n[0],i=n[1];var o=Ae(r.shape,i.shape);return O.runKernelFunc(function(a,s){var u=a.multiply(r,i);return s([r,i]),u},{a:r,b:i},function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.mul(l.toFloat()),d=Et(u.shape,o);return d.length>0?c.sum(d).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),d=Et(l.shape,o);return d.length>0?c.sum(d).reshape(l.shape):c}}},"Mul")}}),t$=M({mulStrict_:function(t,e){var n=N(t,"a","mul"),r=N(e,"b","mul");return Oe(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Gd=M({pow_:function(t,e){var n,r=N(t,"base","pow"),i=N(e,"exp","pow");n=st(r,i),r=n[0],i=n[1];var o=Ae(r.shape,i.shape),a=[r,i];return O.runKernelFunc(function(s,u){var l=s.pow(r,i);return u([r,i,l]),l},{a:r,b:i},function(s,u){var l=u[0],c=u[1],d=u[2];return{a:function(){var h=c.toFloat(),f=s.mul(h.mul(l.pow(h.sub(J(1))))),m=Et(l.shape,o);return m.length>0&&(f=f.sum(m)),f.reshape(l.shape)},b:function(){var h=l.greater(0),f=l.log().where(h,Ne(l)),m=s.mul(d.mul(f)),p=Et(c.shape,o);return p.length>0&&(m=m.sum(p)),m.reshape(c.shape)}}},"Pow",{},a,[!0])}}),n$=M({powStrict_:function(t,e){return Oe(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),r$=M({squaredDifferenceStrict_:function(t,e){var n=N(t,"a","squaredDifferenceStrict"),r=N(e,"b","squaredDifferenceStrict");return Oe(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),At=M({sub_:function(t,e){var n,r=N(t,"a","sub"),i=N(e,"b","sub");n=st(r,i),r=n[0],i=n[1];var o=Ae(r.shape,i.shape);return O.runKernelFunc(function(a){return a.subtract(r,i)},{a:r,b:i},function(a){return{a:function(){var s=a,u=Et(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=Et(i.shape,o);return u.length>0&&(s=s.sum(u)),s.neg().reshape(i.shape)}}},"Sub")}}),i$=M({subStrict_:function(t,e){var n=N(t,"a","subStrict"),r=N(e,"b","subStrict");return Oe(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),mA=M({equal_:function(t,e){var n,r=N(t,"a","equal"),i=N(e,"b","equal");return n=st(r,i),r=n[0],i=n[1],Ae(r.shape,i.shape),O.runKernelFunc(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),o$=M({equalStrict_:function(t,e){var n=N(t,"a","equalStrict"),r=N(e,"b","equalStrict");return Oe(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),a$=M({greater_:function(t,e){var n,r=N(t,"a","greater"),i=N(e,"b","greater");return n=st(r,i),r=n[0],i=n[1],Ae(r.shape,i.shape),O.runKernelFunc(function(o){return o.greater(r,i)},{a:r,b:i},null,"Greater")}}),gA=M({greaterEqual_:function(t,e){var n,r=N(t,"a","greaterEqual"),i=N(e,"b","greaterEqual");return n=st(r,i),r=n[0],i=n[1],Ae(r.shape,i.shape),O.runKernelFunc(function(o,a){var s=o.greaterEqual(r,i);return a([r,i]),s},{a:r,b:i},function(o,a){var s=a[0],u=a[1];return{a:function(){return Ne(s)},b:function(){return Ne(u)}}},"GreaterEqual")}}),s$=M({greaterEqualStrict_:function(t,e){var n=N(t,"a","greaterEqualStrict"),r=N(e,"b","greaterEqualStrict");return Oe(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),u$=M({greaterStrict_:function(t,e){var n=N(t,"a","greaterStrict"),r=N(e,"b","greaterStrict");return Oe(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),l$=M({less_:function(t,e){var n,r=N(t,"a","less"),i=N(e,"b","less");return n=st(r,i),r=n[0],i=n[1],Ae(r.shape,i.shape),O.runKernelFunc(function(o){return o.less(r,i)},{a:r,b:i},null,"Less")}}),c$=M({lessEqual_:function(t,e){var n,r=N(t,"a","lessEqual"),i=N(e,"b","lessEqual");return n=st(r,i),r=n[0],i=n[1],Ae(r.shape,i.shape),O.runKernelFunc(function(o,a){var s=o.lessEqual(r,i);return a([r,i]),s},{a:r,b:i},null,"LessEqual")}}),d$=M({lessEqualStrict_:function(t,e){var n=N(t,"a","lessEqualStrict"),r=N(e,"b","lessEqualStrict");return Oe(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),h$=M({lessStrict_:function(t,e){var n=N(t,"a","lessStrict"),r=N(e,"b","lessStrict");return Oe(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),f$=M({notEqual_:function(t,e){var n,r=N(t,"a","notEqual"),i=N(e,"b","notEqual");return n=st(r,i),r=n[0],i=n[1],Ae(r.shape,i.shape),O.runKernelFunc(function(o){return o.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),p$=M({notEqualStrict_:function(t,e){var n=N(t,"a","notEqualStrict"),r=N(e,"b","notEqualStrict");return Oe(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function N1(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function T1(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var r0=M({gather_:function(t,e,n){n===void 0&&(n=0);var r=N(t,"x","gather"),i=N(e,"indices","gather","int32");n=Rt(n,r.shape)[0];var o=function(a,s,u){for(var l=a.shape[u],c=[],d=1,h=1,f=0;f<u;f++)c.push(a.shape[f]),d*=a.shape[f];for(f=0;f<s.rank;f++)c.push(s.shape[f]);for(f=u+1;f<a.rank;f++)c.push(a.shape[f]),h*=a.shape[f];return{batchSize:d,sliceSize:h,dimSize:l,outputShape:c}}(r,i,n);return O.runKernelFunc(function(a,s){var u=a.gather(r,i.flatten(),n);return s([i]),u},{x:r,indices:i},function(a,s){var u=s[0];return{x:function(){var l=r.shape,c=u.size,d=l.slice(0,n),h=d.length,f=l.slice(n,l.length).slice(1),m=f.length,p=N1(0,h),v=N1(h+1,h+1+m),g=T1([d,[c],f]),x=a.reshape(g),w=u.reshape([c]),b=T1([[h],p,v]),k=x.transpose(b),_=vA(k,w,r.shape[n]),S=$y(b);return _=_.transpose(S)},indices:function(){return u}}},"Gather",{axis:n}).reshape(o.outputShape)}}),vA=M({unsortedSegmentSum_:function(t,e,n){var r=N(t,"x","unsortedSegmentSum"),i=N(e,"segmentIds","unsortedSegmentSum","int32");return T(pt(n),function(){return"numSegments must be of dtype int"}),O.runKernelFunc(function(o,a){var s=o.unsortedSegmentSum(r,i,n);return a([i]),s},{$x:r},function(o,a){var s=a[0];return{$x:function(){return function(u,l){for(var c=n0(l,Ne(l)),d=r0(u,c),h=gA(l,J(0,"int32")),f=d.rank-h.rank,m=0;m<f;++m)h=Un(h,m+1);h=Dh(h,Ds(d.shape,"bool"));var p=Ne(d);return Ho(h,d,p)}(o,s)}}})}}),m$=function(t,e,n){return ne(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,d,h,f,m,p;return re(this,function(v){switch(v.label){case 0:for(r=N(t,"tensor","boolMask"),i=N(e,"mask","boolMask","bool"),o=n??0,a=i.rank,s=r.shape,T(a>0,function(){return"mask cannot be scalar"}),Oe(s.slice(o,o+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=o;l<o+a;l++)u*=s[l];return c=s.slice(0,o).concat([u],s.slice(o+a)),d=r.reshape(c),h=i.reshape([-1]),[4,hA(h)];case 1:return f=v.sent(),m=f.squeeze([1]),p=r0(d,m,o),t!==r&&r.dispose(),e!==i&&i.dispose(),m.dispose(),d.dispose(),h.dispose(),f.dispose(),[2,p]}})})};function yA(t,e,n,r,i,o,a){o===void 0&&(o="NHWC"),T(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var s=t,u=e,l=!1;e.rank===3&&(l=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,t[0],t[1],t[2]]),T(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),T(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),T(n.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var c=o==="NHWC"?s[3]:s[1],d=o==="NHWC"?u.shape[3]:u.shape[1];T(c===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+n.shape[2]+"."}),T(d===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+n.shape[3]+"."}),a!=null&&T(pt(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var h=qy(o),f=Qo(s,n.shape,r,1,i,a,!1,h),m=O.runKernelFunc(function(p,v){var g=p.conv2dDerInput(u,n,f);return v([n,u]),g},{dy4D:u,filter:n},function(p,v){var g=v[0],x=v[1];return{dy4D:function(){return Jn(p,g,r,i,o,1,a)},filter:function(){return i0(p,x,g.shape,r,i,o,a)}}});return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function fp(t){var e=function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o}(t),n=e[0],r=e[1],i=e[2];return n===1&&r===1&&i===1}function xA(t,e,n,r,i){T(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var o=t,a=e,s=!1;e.rank===4&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,t[0],t[1],t[2],t[3]]);var u=o[4],l=a.shape[4];T(o.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),T(a.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),T(n.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),T(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),T(l===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+n.shape[4]+"."});var c=Ud(o,n.shape,r,1,i),d=O.runKernelFunc(function(h){return h.conv3dDerInput(a,n,c)},{dy5D:a});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var g$=M({conv1d_:function(t,e,n,r,i,o,a){i===void 0&&(i="NWC"),o===void 0&&(o=1);var s=N(t,"x","conv1d"),u=N(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),T(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),T(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&T(pt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),T(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),T(xn(n,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+o+"'"}),T(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var d=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),h=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),f=Jn(h,d,[1,n],r,"NHWC",[1,o],a);return c?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),Jn=M({conv2d_:function(t,e,n,r,i,o,a){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var s=N(t,"x","conv2d"),u=N(e,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),T(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&T(pt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=i==="NHWC"?l.shape[3]:l.shape[1];T(d===u.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+u.shape[2]+"."}),T(xn(n,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"});var h=qy(i),f=Qo(l.shape,u.shape,n,o,r,a,!1,h),m=[u,l],p=O.runKernelFunc(function(v,g){var x=v.conv2d(l,u,f);return g([u,l]),x},{x:l,filter:u},function(v,g){var x=g,w=x[0],b=x[1];return T(ys(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return wA(b.shape,v,w,n,r,i)},filter:function(){return i0(b,v,w.shape,n,r,i)}}},"Conv2D",f,m);return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),v$=M({conv3d_:function(t,e,n,r,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var a=N(t,"x","conv3d"),s=N(e,"filter","conv3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),T(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),T(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),T(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),T(function(h,f){return fp(h)||fp(f)}(n,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),T(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var c=Ud(u.shape,s.shape,n,o,r),d=O.runKernelFunc(function(h,f){var m=h.conv3d(u,s,c);return f([u,s]),m},{x:u,$filter:s},function(h,f){T(fp(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var m=f[0],p=f[1];return{x:function(){return xA(m.shape,h,p,n,r)},$filter:function(){return function(v,g,x,w,b){var k=v;v.rank===4&&(k=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3]));var _=g;_.rank===4&&(_=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3])),T(k.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+k.shape+"."}),T(_.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+_.shape+"."}),T(x.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+x+"."}),T(k.shape[4]===x[3],function(){return"Error in conv3dDerFilter: depth of input "+k.shape[4]+") must match input depth in filter ("+x[3]+"."}),T(_.shape[4]===x[4],function(){return"Error in conv3dDerFilter: depth of dy ("+_.shape[4]+") must match output depth for filter ("+x[4]+")."});var S=Ud(k.shape,x,w,1,b);return O.runKernelFunc(function(C){return C.conv3dDerFilter(k,_,S)},{x5D:k,dy5D:_})}(m,h,p.shape,n,r)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),i0=M({conv2dDerFilter_:function(t,e,n,r,i,o,a){o===void 0&&(o="NHWC");var s=t;t.rank===3&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=e;u.rank===3&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),T(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),T(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),T(n.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var l=o==="NHWC"?s.shape[3]:s.shape[1],c=o==="NHWC"?u.shape[3]:u.shape[1];T(l===n[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+n[2]+"."}),T(c===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+n[3]+")."}),a!=null&&T(pt(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var d=qy(o),h=Qo(s.shape,n,r,1,i,a,!1,d);return O.runKernelFunc(function(f){return f.conv2dDerFilter(s,u,h)},{x4D:s,dy4D:u})}}),wA=M({conv2dDerInput_:yA}),Mh=M({depthwiseConv2d_:function(t,e,n,r,i,o,a){o===void 0&&(o=[1,1]);var s=N(t,"x","depthwiseConv2d"),u=N(e,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),T(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),T(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),T(xn(n,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),a!=null&&T(pt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=Qo(l.shape,u.shape,n,o,r,a,!0),h=[l,u],f=O.runKernelFunc(function(m,p){var v=m.depthwiseConv2D(l,u,d);return p([l,u]),v},{x:l,filter:u},function(m,p){T(ys(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var v=p[0],g=p[1];return{x:function(){return bA(v.shape,m,g,d)},filter:function(){return kA(v,m,g.shape,d)}}},"DepthwiseConv2dNative",d,h);return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),bA=M({depthwiseConv2dDerInput_:function(t,e,n,r){var i=e,o=!1;e.rank===3&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=O.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(i,n,r)},{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),kA=M({depthwiseConv2dDerFilter_:function(t,e,n,r){var i=t;t.rank===3&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=e;return o.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),O.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),o0=M({separableConv2d_:function(t,e,n,r,i,o,a){o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC");var s=N(t,"x","separableConv2d"),u=N(e,"depthwiseFilter","separableConv2d"),l=N(n,"pointwiseFilter","separableConv2d"),c=s,d=!1;if(s.rank===3&&(d=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");T(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),T(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),T(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),T(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),T(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var h=u.shape[2],f=u.shape[3];T(l.shape[2]===h*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+h*f+", but got "+l.shape[2]+"."});var m=Mh(c,u,r,i,a,o),p=Jn(m,l,1,"valid",a);return d?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),y$=M({conv2dTranspose_:function(t,e,n,r,i,o){return yA(n,N(t,"x","conv2dTranspose"),N(e,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),x$=M({conv3dTranspose_:function(t,e,n,r,i){return xA(n,N(t,"x","conv3dTranspose"),N(e,"filter","conv3dTranspose"),r,i)}}),Oh=M({matMul_:function(t,e,n,r){var i;n===void 0&&(n=!1),r===void 0&&(r=!1);var o=N(t,"a","matMul"),a=N(e,"b","matMul");i=st(o,a),o=i[0],a=i[1];var s=n?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=n?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?a.shape[a.rank-2]:a.shape[a.rank-1],d=o.shape.slice(0,-2),h=a.shape.slice(0,-2),f=oe(d),m=oe(h);T(o.rank>=2&&a.rank>=2&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),T(It(d,h),function(){return"Error in matMul: outer dimensions ("+d+") and ("+h+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),T(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var p=o.shape.slice(0,-2).concat([l,c]),v=n?o.as3D(f,s,l):o.as3D(f,l,s),g=r?a.as3D(m,c,u):a.as3D(m,u,c),x={transposeA:n,transposeB:r};return O.runKernelFunc(function(w,b){var k=w.batchMatMul(v,g,n,r);return b([v,g]),k},{a:v,b:g},function(w,b){var k=b,_=k[0],S=k[1];return n||r?!n&&r?{a:function(){return w.matMul(S,!1,!1)},b:function(){return w.matMul(_,!0,!1)}}:n&&!r?{a:function(){return S.matMul(w,!1,!0)},b:function(){return _.matMul(w,!1,!1)}}:{a:function(){return S.matMul(w,!0,!0)},b:function(){return w.matMul(_,!0,!0)}}:{a:function(){return w.matMul(S,!1,!0)},b:function(){return _.matMul(w,!0,!1)}}},"BatchMatMul",x).reshape(p)}}),w$=M({dot_:function(t,e){var n=N(t,"t1","dot"),r=N(e,"t2","dot");T(!(n.rank!==1&&n.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var i=n.rank===1?n.size:n.shape[1],o=r.rank===1?r.size:r.shape[0];return T(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),n.rank===1&&r.rank===1?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():n.rank===1&&r.rank===2?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():n.rank===2&&r.rank===1?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),b$=M({outerProduct_:function(t,e){var n=N(t,"v1","outerProduct"),r=N(e,"v2","outerProduct");return T(n.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Rl=M({reverse_:function(t,e){var n=N(t,"x","reverse");if(n.rank===0)return n.clone();var r=Rt(e,n.shape);return O.runKernelFunc(function(i){return i.reverse(n,r)},{$x:n},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(n)}}),k$=M({reverse1d_:function(t){var e=N(t,"x","reverse");return T(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Rl(e,0)}}),_$=M({reverse2d_:function(t,e){var n=N(t,"x","reverse");return T(n.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Rl(n,e)}}),S$=M({reverse3d_:function(t,e){var n=N(t,"x","reverse");return T(n.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Rl(n,e)}}),C$=M({reverse4d_:function(t,e){var n=N(t,"x","reverse");return T(n.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Rl(n,e)}});function _A(t,e,n,r,i,o){var a=N(t,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),T(xn(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),o!=null&&T(pt(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=ol(s.shape,e,n,r,i,o);if(l.filterWidth===1&&l.filterHeight===1&&It(l.inShape,l.outShape))return a.clone();var c=[s],d=O.runKernelFunc(function(h,f){var m=h.maxPool(s,l);return f([s,m]),m},{x:s},function(h,f){var m=f[0],p=f[1];return{x:function(){return function(v,g,x,w,b,k,_,S){var C=N(v,"dy","maxPoolBackprop"),E=N(g,"input","maxPoolBackprop"),R=N(x,"output","maxPoolBackprop");T(E.rank===C.rank,function(){return"Rank of input ("+E.rank+") does not match rank of dy ("+C.rank+")"}),T(xn(b,k),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+k+"'"}),T(C.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+C.rank+"."}),T(E.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+E.rank+"."});var D=ol(E.shape,w,b,k,_,S);return O.runKernelFunc(function(P){return P.maxPoolBackprop(C,E,R,D)},{$dy:C,$input:E})}(h,m,p,e,n,r,i)}}},"MaxPool",l,c);return u?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function SA(t,e,n,r,i,o){var a=N(t,"x","avgPool","float32");T(xn(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),o!=null&&T(pt(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=ol(s.shape,e,n,r,i,o);if(l.filterWidth===1&&l.filterHeight===1&&It(l.inShape,l.outShape))return a.clone();var c=O.runKernelFunc(function(d){return d.avgPool(s,l)},{x:s},function(d){return{x:function(){return function(h,f,m,p,v,g){var x=N(h,"dy","avgPoolBackprop"),w=N(f,"input","avgPoolBackprop");T(w.rank===x.rank,function(){return"Rank of input ("+w.rank+") does not match rank of dy ("+x.rank+")"}),T(xn(p,v),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+p+" and dilations '"+v+"'"});var b=w,k=x,_=!1;w.rank===3&&(_=!0,b=w.as4D(1,w.shape[0],w.shape[1],w.shape[2]),k=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),T(k.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."}),T(b.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+b.rank+"."});var S=ol(b.shape,m,p,v,g),C=O.runKernelFunc(function(E){return E.avgPoolBackprop(k,b,S)},{dy4D:k,input4D:b});return _?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}(d,s,e,n,r,i)}}},"AvgPool",l);return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Nt=M({maxPool_:function(t,e,n,r,i){return _A(t,e,n,1,r,i)}}),Nl=M({avgPool_:function(t,e,n,r,i){return SA(t,e,n,1,r,i)}}),E$=M({pool_:function(t,e,n,r,i,o){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");var a=N(t,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(xn(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var l,c=ol(s.shape,e,o,i,r),d=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(b,k){var _=b.map(function(E,R){return E+(E-1)*(k[R]-1)}).map(function(E){return E-1}),S=_.map(function(E){return Math.floor(E/2)}),C=_.map(function(E,R){return E-S[R]});return _.map(function(E,R){return[S[R],C[R]]})}([c.filterHeight,c.filterWidth],d):[[0,0],[0,0]];var h=d[0]===1&&d[1]===1,f=function(b,k,_){var S=_.map(function(U){return U[0]}),C=_.map(function(U){return U[1]}),E=b.concat(S,C),R=k.map(function(U,z){return(U-E[z]%U)%U}),D=C.map(function(U,z){return U+R[z]}),P=k.map(function(U,z){return[S[z],D[z]]}),F=k.map(function(U,z){return[0,R[z]]});return[P,F]}([c.inHeight,c.inWidth],d,l),m=f[0],p=f[1],v=h?r:"valid",g=h?s:TE(s,d,m),x=(n==="avg"?function(){return SA(g,e,o,1,v)}:function(){return _A(g,e,o,1,v)})(),w=h?x:AE(x,d,p);return u?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),A$=M({maxPool3d_:function(t,e,n,r,i,o,a){o===void 0&&(o="NDHWC");var s=N(t,"x","maxPool3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),T(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),T(o==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),T(xn(n,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),i!=null&&T(pt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=zd(u.shape,e,n,a,r,i,o),d=O.runKernelFunc(function(h,f){var m=h.maxPool3d(u,c);return f([u,m]),m},{x:u},function(h,f){var m=f[0],p=f[1];return{x:function(){return function(v,g,x,w,b,k,_,S){var C=N(v,"dy","maxPool3dBackprop"),E=N(g,"input","maxPool3dBackprop"),R=N(x,"output","maxPool3dBackprop"),D=C,P=E,F=R,U=!1;E.rank===4&&(U=!0,D=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3]),P=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),F=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3])),T(D.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+D.rank+"."}),T(P.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+P.rank+"."}),T(F.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+F.rank+"."}),k==null&&(k=[1,1,1]),T(xn(b,k),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+k+"'"}),S!=null&&T(pt(_),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+_+"."});var z=zd(P.shape,w,b,k,_,S),W=O.runKernelFunc(function(L){return L.maxPool3dBackprop(D,P,F,z)},{dy5D:D,input5D:P});return U?W.as4D(W.shape[1],W.shape[2],W.shape[3],W.shape[4]):W}(h,m,p,e,n,a,r,i)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),R$=M({avgPool3d_:function(t,e,n,r,i,o,a){o===void 0&&(o="NDHWC");var s=N(t,"x","avgPool3d","float32"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),T(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),T(o==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),T(xn(n,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),i!=null&&T(pt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=zd(u.shape,e,n,a,r,i,o),d=O.runKernelFunc(function(h){return h.avgPool3d(u,c)},{x:u},function(h){return{x:function(){return function(f,m,p,v,g,x,w){var b=N(f,"dy","avgPool3dBackprop"),k=N(m,"input","avgPool3dBackprop"),_=b,S=k,C=!1;k.rank===4&&(C=!0,_=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]),S=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3])),T(_.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+_.rank+"."}),T(S.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+S.rank+"."}),g==null&&(g=[1,1,1]),T(xn(v,g),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+g+"'"}),w!=null&&T(pt(x),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+w+" but got pad "+x+"."});var E=zd(S.shape,p,v,g,x,w),R=O.runKernelFunc(function(D){return D.avgPool3dBackprop(_,S,E)},{dy5D:_,input5D:S});return C?R.as4D(R.shape[1],R.shape[2],R.shape[3],R.shape[4]):R}(h,u,e,n,a,r,i)}}});return d=d.cast(u.dtype),l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),zr=M({slice_:function(t,e,n){var r,i,o=N(t,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach(function(u){T(u!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=n==null?new Array(o.rank).fill(-1):typeof n=="number"?[n].concat(new Array(o.rank-1).fill(-1)):n.length<o.rank?n.concat(new Array(o.rank-n.length).fill(-1)):n).map(function(u,l){return u>=0?u:(T(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),o.shape[l]-r[l])}),nz(o,r,i);var a=o.shape,s={begin:r,size:i};return O.runKernelFunc(function(u){return u.slice(o,r,i)},{x:o},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],a[c]-r[c]-i[c]]);return{x:function(){return u.pad(l)}}},"Slice",s)}}),N$=M({slice1d_:function(t,e,n){var r=N(t,"x","slice1d");return T(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),zr(r,[e],[n])}}),T$=M({slice2d_:function(t,e,n){var r=N(t,"x","slice2d");return T(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),zr(r,e,n)}}),CA=M({slice3d_:function(t,e,n){var r=N(t,"x","slice3d");return T(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),zr(r,e,n)}}),P$=M({slice4d_:function(t,e,n){var r=N(t,"x","slice4d");return T(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),zr(r,e,n)}});function EA(t,e,n,r,i){return e.rank<n.rank&&(e=e.reshape(yn(e.shape,r))),t.rank<n.rank&&(t=t.reshape(yn(t.shape,r))),{x:function(){var o=t.mul(n.equal(e).cast(t.dtype));return i==null?o:o.transpose(i)}}}var I$=M({all_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=N(t,"x","all","bool"),i=Rt(e,r.shape),o=i,a=Gr(o,r.rank);a!=null&&(r=r.transpose(a),o=Hr(o.length,r.rank));var s=O.runKernelFunc(function(l){return l.all(r,o)},{$x:r});if(n){var u=yn(s.shape,i);return s.reshape(u)}return s}}),D$=M({any_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=N(t,"x","any","bool"),i=Rt(e,r.shape),o=i,a=Gr(o,r.rank);a!=null&&(r=r.transpose(a),o=Hr(o.length,r.rank));var s=O.runKernelFunc(function(l){return l.any(r,o)},{$x:r});if(n){var u=yn(s.shape,i);return s.reshape(u)}return s}}),M$=M({argMax_:function(t,e){e===void 0&&(e=0);var n=N(t,"x","argMax");e==null&&(e=0);var r=Rt(e,n.shape),i=Gr(r,n.rank);i!=null&&(n=n.transpose(i),r=Hr(r.length,n.rank));var o={axis:r[0]},a=[n];return O.runKernelFunc(function(s,u){var l=s.argMax(n,r[0]);return u([n]),l},{x:n},function(s,u){var l=u[0];return{x:function(){return Ne(l)}}},"ArgMax",o,a)}}),O$=M({argMin_:function(t,e){e===void 0&&(e=0);var n=N(t,"x","argMin");e==null&&(e=0);var r=Rt(e,n.shape),i=Gr(r,n.rank);return i!=null&&(n=n.transpose(i),r=Hr(r.length,n.rank)),O.runKernelFunc(function(o,a){var s=o.argMin(n,r[0]);return a([n]),s},{$x:n},function(o,a){var s=a[0];return{$x:function(){return Ne(s)}}})}}),j$=M({logSumExp_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=N(t,"x","logSumExp"),i=Rt(e,r.shape),o=r.max(i,!0),a=r.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(n){var u=yn(s.shape,i);return s.reshape(u)}return s}}),jh=M({max_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=N(t,"x","max"),i=r,o=Rt(e,r.shape),a=o,s=Gr(a,r.rank);s!=null&&(r=r.transpose(s),a=Hr(a.length,r.rank));var u=[r],l=O.runKernelFunc(function(d,h){var f=d.max(r,a);return h([i,f]),f},{x:r},function(d,h){return EA(d,h[1],h[0],o,s)},"Max",{axes:a},u,[!0]);if(n){var c=yn(l.shape,o);l=l.reshape(c)}return l}}),F$=M({mean_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=N(t,"x","mean"),i=Rt(e,r.shape),o=oe(Gt(r.shape,i)[1]);return Ph(function(a){var s=J(o);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(e,n),gradFunc:function(u){var l=a.shape.slice();return i.forEach(function(c){l[c]=1}),u.reshape(l).mul(Ds(a.shape,"float32")).div(o)}}})(r)}}),L$=M({min_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=N(t,"x","min"),i=r,o=Rt(e,r.shape),a=o,s=Gr(a,r.rank);s!=null&&(r=r.transpose(s),a=Hr(a.length,r.rank));var u=[r],l=O.runKernelFunc(function(d,h){var f=d.min(r,a);return h([i,f]),f},{x:r},function(d,h){return EA(d,h[1],h[0],o,s)},"Min",{axes:a},u,[!0]);if(n){var c=yn(l.shape,o);l=l.reshape(c)}return l}}),B$=M({moments_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=Rt(e,(t=N(t,"x","moments")).shape),i=t.mean(r,n),o=i.shape;n||(o=yn(i.shape,r));var a=t.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(r,n)}}}),AA=M({sum_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=N(t,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=Rt(e,r.shape);return Ph(function(o){var a=Gr(i,o.rank),s=i,u=o;a!=null&&(u=o.transpose(a),s=Hr(s.length,o.rank));var l=function(f){var m=o.shape.slice();return i.forEach(function(p){m[p]=1}),f.reshape(m).mul(Ds(o.shape,"float32"))},c={axes:s},d=O.runKernelFunc(function(f){return f.sum(u,s)},{x:u},function(f){return{x:function(){return l(f)}}},"Sum",c);if(n){var h=yn(d.shape,i);d=d.reshape(h)}return{value:d,gradFunc:l}})(r)}}),V$=M({prod_:function(t,e,n){e===void 0&&(e=null),n===void 0&&(n=!1);var r=N(t,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=Rt(e,r.shape),o=Gr(i,r.rank),a=i,s=r;o!=null&&(s=r.transpose(o),a=Hr(a.length,r.rank));var u=O.runKernelFunc(function(c){return c.prod(s,a)},{permutedX:s});if(n){var l=yn(u.shape,i);u=u.reshape(l)}return u}}),RA=M({elu_:function(t){var e=N(t,"x","elu");return O.runKernelFunc(function(n,r){var i=n.elu(e);return r([i]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){return O.runKernelFunc(function(o){return o.eluDer(n,i)},{dy:n,y:i})}}})}}),z$=M({leakyRelu_:function(t,e){e===void 0&&(e=.2);var n=N(t,"x","leakyRelu");return n0(J(e).mul(n),n)}}),NA=M({prelu_:function(t,e){var n=N(t,"x","prelu"),r=N(e,"alpha","prelu");return O.runKernelFunc(function(i,o){var a=i.prelu(n,r);return o([n,r]),a},{x:n,alpha:r},function(i,o){var a=o[0],s=o[1],u=a.greater(0);return{x:function(){return Ho(u,i,i.mul(s))},alpha:function(){var l=Ho(u,Ne(i),i.mul(a)),c=Et(s.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}},"Prelu")}}),it=M({relu_:function(t){var e=N(t,"x","relu");return e.dtype==="bool"?e.toInt():O.runKernelFunc(function(n,r){var i=n.relu(e);return r([e]),i},{x:e},function(n,r){var i=r[0];return{x:function(){return n.mulStrict(i.step().toFloat())}}},"Relu")}}),TA=M({relu6_:function(t){var e=N(t,"x","relu6");return e.dtype==="bool"?e.toInt():O.runKernelFunc(function(n,r){var i=n.relu6(e);return r([e]),i},{x:e},function(n,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return n.mulStrict(o.toFloat())}}},"Relu6")}}),U$=M({selu_:function(t){var e=N(t,"x","selu");return O.runKernelFunc(function(n,r){var i=n.selu(e);return r([e]),i},{$x:e},function(n,r){var i=r[0];return{$x:function(){var o=i.greater(J(0)),a=J(Zy),s=J(e0),u=n.mul(s),l=n.mul(a).mul(i.toFloat().exp());return Ho(o,u,l)}}})}}),to=M({transpose_:function(t,e){var n=N(t,"x","transpose");if(e==null&&(e=n.shape.map(function(i,o){return o}).reverse()),T(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."}),e.forEach(function(i){T(i>=0&&i<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e})}),n.rank<=1)return n.clone();var r={perm:e};return O.runKernelFunc(function(i){return i.transpose(n,e)},{x:n},function(i){var o=$y(e);return{x:function(){return i.transpose(o)}}},"Transpose",r)}}),$$=M({localResponseNormalization_:function(t,e,n,r,i){e===void 0&&(e=5),n===void 0&&(n=1),r===void 0&&(r=1),i===void 0&&(i=.5);var o=N(t,"x","localResponseNormalization");T(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),T(pt(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=o,s=!1;o.rank===3&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=O.runKernelFunc(function(l,c){var d=l.localResponseNormalization4D(a,e,n,r,i);return c([a,d]),d},{x4D:a},function(l,c){var d=c[0],h=c[1];return{x4D:function(){return O.runKernelFunc(function(f){return f.LRNGrad(l,d,h,e,n,r,i)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),PA=M({norm_:function(t,e,n,r){e===void 0&&(e="euclidean"),n===void 0&&(n=null),r===void 0&&(r=!1);var i=function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(J(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(t=N(t,"x","norm"),e,n),o=i.shape;if(r){var a=Rt(n,t.shape);o=yn(i.shape,a)}return i.reshape(o)}}),W$=M({basicLSTMCell_:function(t,e,n,r,i,o){var a=N(t,"forgetBias","basicLSTMCell"),s=N(e,"lstmKernel","basicLSTMCell"),u=N(n,"lstmBias","basicLSTMCell"),l=N(r,"data","basicLSTMCell"),c=N(i,"c","basicLSTMCell"),d=N(o,"h","basicLSTMCell"),h=l.concat(d,1).matMul(s).add(u),f=h.shape[0],m=h.shape[1]/4,p=[f,m],v=h.slice([0,0],p),g=h.slice([0,m],p),x=h.slice([0,2*m],p),w=h.slice([0,3*m],p),b=v.sigmoid().mulStrict(g.tanh()).addStrict(c.mulStrict(a.add(x).sigmoid())),k=b.tanh().mulStrict(w.sigmoid());return[b,k]}}),G$=M({multiRNNCell_:function(t,e,n,r){for(var i=N(e,"data","multiRNNCell"),o=Od(n,"c","multiRNNCell"),a=Od(r,"h","multiRNNCell"),s=i,u=[],l=0;l<t.length;l++){var c=t[l](s,o[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var d=[],h=[];for(l=0;l<u.length;l+=2)d.push(u[l]),h.push(u[l+1]);return[d,h]}}),H$=M({movingAverage_:function(t,e,n,r,i){i===void 0&&(i=!0);var o=N(t,"v","movingAverage"),a=N(e,"x","movingAverage"),s=N(n,"decay","movingAverage");$5(o,a),T(It(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=J(1),l=u.sub(s),c=a.sub(o).mul(l);if(i){T(r!=null,function(){return"When using zeroDebias: true, step is required."});var d=N(r,"step","movingAverage");c=c.div(u.sub(Gd(s,d)))}return o.add(c)}}),K$=M({stridedSlice_:function(t,e,n,r,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(e.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var l=N(t,"x","stridedSlice"),c=l1(s),d=l.shape.slice();c.forEach(function(v){e[v]=0,n[v]=1,d.splice(v,0,1)}),l=l.reshape(d);for(var h=0;h<l.rank;h++)e[h]=rz(i,e,r,l.shape,h),n[h]=iz(o,n,r,l.shape,h),r[h]=r[h]||1;var f=l1(u);f.forEach(function(v){n[v]=e[v]+1,r[v]=1});var m=Ky(e,n,r),p=m.filter(function(v,g){return f.indexOf(g)===-1});return r.every(function(v){return v===1})?zr(l,e,m).reshape(p):O.runKernelFunc(function(v){return v.stridedSlice(l,e,n,r)},{$x:l}).reshape(p)}}),q$=M({topk_:function(t,e,n){e===void 0&&(e=1),n===void 0&&(n=!0);var r=N(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=O.runKernelFunc(function(a){return a.topk(r,e,n)},{$x:r});return{values:o[0],indices:o[1]}}}),X$=M({scatterND_:function(t,e,n){var r=N(t,"indices","scatterND","int32"),i=N(e,"updates","scatterND");return tz(i,r,n),O.runKernelFunc(function(o){return o.scatterND(r,i,n)},{indices:r,updates:i},null,"ScatterNd",{shape:n})}}),a0=M({fft_:function(t){T(t.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return O.runKernelFunc(function(i){return i.fft(r)},{input:t}).reshape(t.shape)}}),Hd=M({ifft_:function(t){T(t.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return O.runKernelFunc(function(i){return i.ifft(r)},{input:t}).reshape(t.shape)}}),s0=M({rfft_:function(t,e){T(t.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+t.dtype});var n,r=t.shape[t.shape.length-1],i=t.size/r;if(e!=null&&e<r){var o=t.shape.map(function(g){return 0}),a=t.shape.map(function(g){return g});a[t.shape.length-1]=e,n=t.slice(o,a),r=e}else if(e!=null&&e>r){var s=t.shape.map(function(g){return g});s[t.shape.length-1]=e-r,n=t.concat(Ge(s),t.shape.length-1),r=e}else n=t;var u=n.zerosLike(),l=Ft(n,u).as2D(i,r),c=a0(l),d=Math.floor(r/2)+1,h=$n(c),f=Ir(c),m=h.split([d,r-d],h.shape.length-1),p=f.split([d,r-d],f.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=d,Ft(m[0],p[0]).reshape(v)}}),IA=M({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),i=Hd(r);return $n(i)}var o=[n,2*(e-1)],a=$n(t).as2D(n,e),s=Ir(t).as2D(n,e),u=a.slice([0,1],[n,e-2]).reverse(1),l=s.slice([0,1],[n,e-2]).reverse(1).mul(J(-1)),c=a.concat(u,1),d=s.concat(l,1);return r=Ft(c,d).as2D(o[0],o[1]),i=Hd(r),$n(i)}}),Y$=Object.freeze({fft:a0,ifft:Hd,rfft:s0,irfft:IA}),J$=M({sparseToDense_:function(t,e,n,r){r===void 0&&(r=0);var i=N(t,"sparseIndices","sparseToDense","int32"),o=N(e,"sparseValues","sparseToDense"),a=N(r,"defaultValue","sparseToDense",o.dtype);return function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var d=s.rank>0?s.shape[0]:1,h=s.rank>1?s.shape[1]:1;if(l.length!==h)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+h+".");var f=u.size;if(u.rank!==0&&(u.rank!==1||f!==d))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+d+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,n,a),O.runKernelFunc(function(s){return s.sparseToDense(i,o,n,a)},{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),Q$=M({gatherND_:function(t,e){var n=N(e,"indices","gatherND","int32"),r=N(t,"x","gatherND");return O.runKernelFunc(function(i){return i.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),Z$=M({diag_:function(t){var e=N(t,"x","diag").flatten(),n=t.shape.concat(t.shape);return O.runKernelFunc(function(r){return r.diag(e)},{$x:e}).reshape(n)}}),eW=M({dropout_:function(t,e,n,r){var i=N(t,"x","dropout");if(T(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),T(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return t instanceof nt?i.clone():i;var o=function(u,l){if(l==null)return u.shape.slice();if(It(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],d=0;d<u.shape.length;d++)l[d]==null&&u.shape[d]!=null?c.push(u.shape[d]):c.push(l[d]);return c}return l}(i,n),a=1-e,s=NE(o,0,1,"float32",r).add(a).floor().div(a);return i.mul(s)}});function DA(t,e,n){for(var r=1-t%2,i=new Float32Array(t),o=0;o<t;++o){var a=2*Math.PI*o/(t+r-1);i[o]=e-n*Math.cos(a)}return yt(i,"float32")}var u0=M({hannWindow_:function(t){return DA(t,.5,.5)}}),MA=M({hammingWindow_:function(t){return DA(t,.54,.46)}}),l0=M({frame_:function(t,e,n,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var o=0,a=[];o+e<=t.size;)a.push(zr(t,o,e)),o+=n;if(r)for(;o<t.size;){var s=o+e-t.size,u=St([zr(t,o,e-s),Vr([s],i)]);a.push(u),o+=n}return a.length===0?qi([],[0,e]):St(a).as2D(a.length,e)}}),OA=M({stft_:function(t,e,n,r,i){var o;i===void 0&&(i=u0),r==null&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var a=l0(t,e,n),s=Jt(a,i(e)),u=[],l=0;l<a.shape[0];l++)u.push(s0(s.slice([l,0],[1,e]),r));return St(u)}}),tW=Object.freeze({hannWindow:u0,hammingWindow:MA,frame:l0,stft:OA}),Xt,nW=function(t,e,n){return n===void 0&&(n=1),ne(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,d,h,f,m,p,v;return re(this,function(g){switch(g.label){case 0:return r=N(t,"predictions","inTopK"),i=N(e,"targets","inTopK"),T(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),T(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),Oe(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],T(n>0&&n<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+n}),[4,r.data()];case 1:return a=g.sent(),[4,i.data()];case 2:for(s=g.sent(),u=[a.length/o,o],c=u[1],d=nl("bool",l=u[0]),h=0;h<l;h++){for(f=h*c,m=a.subarray(f,f+c),p=[],v=0;v<m.length;v++)p.push({value:m[v],index:v});for(p.sort(function(x,w){return w.value-x.value}),d[h]=0,v=0;v<n;v++)if(p[v].index===s[h]){d[h]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),[2,Bt(d,i.shape,"bool")]}})})};(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Xt||(Xt={}));var rW=M({absoluteDifference_:function(t,e,n,r){r===void 0&&(r=Xt.SUM_BY_NONZERO_WEIGHTS);var i=N(t,"labels","absoluteDifference"),o=N(e,"predictions","absoluteDifference"),a=null;n!=null&&(a=N(n,"weights","absoluteDifference")),Oe(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return xi(s,a,r)}}),xi=M({computeWeightedLoss_:function(t,e,n){n===void 0&&(n=Xt.SUM_BY_NONZERO_WEIGHTS);var r=N(t,"losses","computeWeightedLoss"),i=null;e!=null&&(i=N(e,"weights","computeWeightedLoss"));var o=i==null?r:r.mul(i);if(n===Xt.NONE)return o;if(n===Xt.SUM)return o.sum();if(n===Xt.MEAN){if(i==null)return o.mean();var a=r.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(J(a)):s}if(n===Xt.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(J(r.size));var u=i.mul(Ds(r.shape)).notEqual(J(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+n)}}),iW=M({cosineDistance_:function(t,e,n,r,i){i===void 0&&(i=Xt.SUM_BY_NONZERO_WEIGHTS);var o=N(t,"labels","cosineDistance"),a=N(e,"predictions","cosineDistance"),s=null;r!=null&&(s=N(r,"weights","cosineDistance")),Oe(o.shape,a.shape,"Error in cosineDistance: ");var u=J(1).sub(o.mul(a).sum(n,!0));return xi(u,s,i)}}),oW=M({hingeLoss_:function(t,e,n,r){r===void 0&&(r=Xt.SUM_BY_NONZERO_WEIGHTS);var i=N(t,"labels","hingeLoss"),o=N(e,"predictions","hingeLoss"),a=null;n!=null&&(a=N(n,"weights","hingeLoss")),Oe(i.shape,o.shape,"Error in hingeLoss: ");var s=J(1);i=J(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return xi(u,a,r)}}),aW=M({huberLoss_:function(t,e,n,r,i){r===void 0&&(r=1),i===void 0&&(i=Xt.SUM_BY_NONZERO_WEIGHTS);var o=N(t,"labels","huberLoss"),a=N(e,"predictions","huberLoss"),s=null;n!=null&&(s=N(n,"weights","huberLoss")),Oe(o.shape,a.shape,"Error in huberLoss: ");var u=J(r),l=a.sub(o).abs(),c=pA(l,u),d=l.sub(c),h=J(.5).mul(c.square()).add(u.mul(d));return xi(h,s,i)}}),sW=M({logLoss_:function(t,e,n,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=Xt.SUM_BY_NONZERO_WEIGHTS);var o=N(t,"labels","logLoss"),a=N(e,"predictions","logLoss"),s=null;n!=null&&(s=N(n,"weights","logLoss")),Oe(o.shape,a.shape,"Error in logLoss: ");var u=J(1),l=J(r),c=o.mul(a.add(l).log()).neg().sub(u.sub(o).mul(u.sub(a).add(l).log()));return xi(c,s,i)}}),uW=M({meanSquaredError_:function(t,e,n,r){r===void 0&&(r=Xt.SUM_BY_NONZERO_WEIGHTS);var i=N(t,"labels","meanSquaredError"),o=N(e,"predictions","meanSquaredError"),a=null;n!=null&&(a=N(n,"weights","meanSquaredError")),Oe(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return xi(s,a,r)}}),lW=M({sigmoidCrossEntropy_:function(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=Xt.SUM_BY_NONZERO_WEIGHTS);var o=N(t,"multiClassLabels","sigmoidCrossEntropy"),a=N(e,"logits","sigmoidCrossEntropy"),s=null;if(n!=null&&(s=N(n,"weights","sigmoidCrossEntropy")),Oe(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=J(r),l=J(1),c=J(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var d=function(h,f){var m=N(h,"labels","sigmoidCrossEntropyWithLogits"),p=N(f,"logits","sigmoidCrossEntropyWithLogits");Oe(m.shape,p.shape,"Error in sigmoidCrossEntropyWithLogits: ");var v=p.relu(),g=p.mul(m),x=p.abs().neg().exp().log1p();return v.sub(g).add(x)}(o,a);return xi(d,s,i)}}),cW=M({softmaxCrossEntropy_:function(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=Xt.SUM_BY_NONZERO_WEIGHTS);var o=N(t,"onehotLabels","softmaxCrossEntropy"),a=N(e,"logits","softmaxCrossEntropy"),s=null;if(n!=null&&(s=N(n,"weights","softmaxCrossEntropy")),Oe(o.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=J(r),l=J(1),c=J(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var d=function(h,f,m){if(m===void 0&&(m=-1),m===-1&&(m=f.rank-1),m!==f.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+f.rank+" and dim was "+m);return Ph(function(p,v,g){var x=v.logSumExp([m],!0),w=v.toFloat().sub(x);return g([p,w]),{value:w.mul(p).neg().sum([m]),gradFunc:function(b,k){var _=k[0],S=k[1],C=yn(b.shape,[m]);return[b.reshape(C).mul(_.toFloat().sub(S.exp())),b.reshape(C).mul(S.exp().sub(_.toFloat()))]}}})(h,f)}(o,a);return xi(d,s,i)}}),dW=Object.freeze({get Reduction(){return Xt},absoluteDifference:rW,computeWeightedLoss:xi,cosineDistance:iW,hingeLoss:oW,huberLoss:aW,logLoss:sW,meanSquaredError:uW,sigmoidCrossEntropy:lW,softmaxCrossEntropy:cW});function P1(t,e){return e===void 0&&(e=!1),O.tidy(function(){if(t.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],i=RE(n),o=t.clone(),a=qi([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,l=function(d){var h,f=o,m=s,p=i;h=O.tidy(function(){var v=o.slice([d,d],[n-d,1]),g=v.norm(),x=o.slice([d,d],[1,1]),w=qi([[-1]]).where(x.greater(0),qi([[1]])),b=x.sub(w.mul(g)),k=v.div(b);s=k.shape[0]===1?a.clone():a.concat(k.slice([1,0],[k.shape[0]-1,k.shape[1]]),0);var _=w.matMul(b).div(g).neg(),S=o.slice([d,0],[n-d,r]),C=_.mul(s);if(d===0)o=S.sub(C.matMul(s.transpose().matMul(S)));else{var E=S.sub(C.matMul(s.transpose().matMul(S)));o=o.slice([0,0],[d,r]).concat(E,0)}var R=i.slice([0,d],[n,i.shape[1]-d]);if(d===0)i=R.sub(R.matMul(s).matMul(C.transpose()));else{var D=R.sub(R.matMul(s).matMul(C.transpose()));i=i.slice([0,0],[n,d]).concat(D,1)}return[s,o,i]}),s=h[0],o=h[1],i=h[2],vn([f,m,p])},c=0;c<u;++c)l(c);return!e&&n>r&&(i=i.slice([0,0],[n,r]),o=o.slice([0,0],[r,r])),[i,o]})}var hW=M({bandPart_:function(t,e,n){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=N(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),a=o[0],s=o[1];if(!(e<=a))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+a+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");e<0&&(e=a),n<0&&(n=s);var u=jd(0,a,1,"int32").reshape([-1,1]),l=jd(0,s,1,"int32"),c=At(u,l),d=Dh(c.lessEqual(J(+e,"int32")),c.greaterEqual(J(-n,"int32"))),h=Ge([a,s],r.dtype);return In(Ct(r.reshape([-1,a,s])).map(function(f){return Ho(d,f,h)})).reshape(i)}}),fW=M({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,T(t!=null&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=t[0].shape[0],r=function(u){T(t[u].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[u].shape[0]+" vs. "+n+")"})},i=1;i<t.length;++i)r(i)}else e=!0,t=Gy(t,t.shape[0],0).map(function(u){return PE(u,[0])});T(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var o=[],a=t,s=function(u){o.push(O.tidy(function(){var l=a[u];if(u>0)for(var c=0;c<u;++c){var d=AA(o[c].mulStrict(l)).mul(o[c]);l=l.sub(d)}return l.div(PA(l,"euclidean"))}))};for(i=0;i<t.length;++i)s(i);return e?In(o,0):o}}),pW=M({qr_:function(t,e){if(e===void 0&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(t.rank===2)return P1(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce(function(a,s){return a*s}),r=Ct(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],o=[];return r.forEach(function(a){var s=P1(a,e),u=s[0],l=s[1];i.push(u),o.push(l)}),[In(i,0).reshape(t.shape),In(o,0).reshape(t.shape)]}}),mW=Object.freeze({bandPart:hW,gramSchmidt:fW,qr:pW});function Fh(t,e,n,r,i,o){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);var a=t.shape[0];return n=Math.min(n,a),T(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),T(t.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),T(t.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),T(e.rank===1,function(){return"scores must be a 1D tensor"}),T(e.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]}),T(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var gW=M({resizeBilinear_:function(t,e,n){n===void 0&&(n=!1);var r=N(t,"images","resizeBilinear");T(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),T(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=O.runKernelFunc(function(l,c){return c([i]),l.resizeBilinear(i,a,s,n)},{x:i},function(l,c){return{x:function(){return O.runKernelFunc(function(d){return d.resizeBilinearBackprop(l,c[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:a,newWidth:s});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),vW=M({resizeNearestNeighbor_:function(t,e,n){n===void 0&&(n=!1);var r=N(t,"images","resizeNearestNeighbor");T(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),T(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),T(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=O.runKernelFunc(function(l,c){return c([i]),l.resizeNearestNeighbor(i,a,s,n)},{batchImages:i},function(l,c){return{batchImages:function(){return O.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(l,c[0],n)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),yW=M({nonMaxSuppression_:function(t,e,n,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=N(t,"boxes","nonMaxSuppression"),a=N(e,"scores","nonMaxSuppression"),s=Fh(o,a,n,r,i);n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return O.runKernelFunc(function(l){return l.nonMaxSuppression(o,a,n,r,i)},{boxes:o,scores:a},null,"NonMaxSuppressionV3",u)}}),xW=function(t,e,n,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),ne(this,void 0,void 0,function(){var o,a,s,u,l,c,d;return re(this,function(h){switch(h.label){case 0:return o=N(t,"boxes","nonMaxSuppressionAsync"),a=N(e,"scores","nonMaxSuppressionAsync"),s=Fh(o,a,n,r,i),n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([o.data(),a.data()])];case 1:return u=h.sent(),l=u[0],c=u[1],d=Xy(l,c,n,r,i),o!==t&&o.dispose(),a!==e&&a.dispose(),[2,d]}})})},wW=M({nonMaxSuppressionWithScore_:function(t,e,n,r,i,o){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var a=N(t,"boxes","nonMaxSuppression"),s=N(e,"scores","nonMaxSuppression"),u=Fh(a,s,n,r,i,o),l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},c=O.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),bW=function(t,e,n,r,i,o){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),ne(this,void 0,void 0,function(){var a,s,u,l,c,d,h;return re(this,function(f){switch(f.label){case 0:return a=N(t,"boxes","nonMaxSuppressionAsync"),s=N(e,"scores","nonMaxSuppressionAsync"),u=Fh(a,s,n,r,i,o),n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return l=f.sent(),c=l[0],d=l[1],h=Yy(c,d,n,r,i,o),a!==t&&a.dispose(),s!==e&&s.dispose(),[2,h]}})})},kW=M({cropAndResize_:function(t,e,n,r,i,o){var a=N(t,"image","cropAndResize"),s=N(e,"boxes","cropAndResize","float32"),u=N(n,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=s.shape[0];return T(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),T(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),T(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),T(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),T(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),T(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),O.runKernelFunc(function(c,d){return c.cropAndResize(a,s,u,r,i,o)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),c0=Object.freeze({resizeBilinear:gW,resizeNearestNeighbor:vW,nonMaxSuppression:yW,nonMaxSuppressionAsync:xW,nonMaxSuppressionWithScore:wW,nonMaxSuppressionWithScoreAsync:bW,cropAndResize:kW}),d0=function(t,e){return!(t>0)||e==="linear"},h0=function(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return t.mul(e.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},f0=function(t,e){var n=e,r=Et(t.shape,e.shape);return r.length>0&&(n=n.sum(r)),n.reshape(t.shape)},p0=function(t,e,n){if(e==="linear")return t;if(e==="relu")return it(t);if(e==="elu")return RA(t);if(e==="relu6")return TA(t);if(e==="prelu")return NA(t,n);throw new Error("Unknown fused activation "+e+".")},_W=M({fusedMatMul_:function(t){var e,n=t.a,r=t.b,i=t.transposeA,o=i!==void 0&&i,a=t.transposeB,s=a!==void 0&&a,u=t.bias,l=t.activation,c=l===void 0?"linear":l,d=t.preluActivationWeights;if(d0(O.state.gradientDepth,c)===!1){var h=Oh(n,r,o,s);return u!=null&&(h=Ee(h,u)),p0(h,c,d)}var f=N(n,"a","fused matMul"),m=N(r,"b","fused matMul");e=st(f,m),f=e[0],m=e[1];var p=o?f.shape[f.rank-2]:f.shape[f.rank-1],v=s?m.shape[m.rank-1]:m.shape[m.rank-2],g=o?f.shape[f.rank-1]:f.shape[f.rank-2],x=s?m.shape[m.rank-2]:m.shape[m.rank-1],w=f.shape.slice(0,-2),b=m.shape.slice(0,-2),k=oe(w),_=oe(b);T(f.rank>=2&&m.rank>=2&&f.rank===m.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+m.rank+"."}),T(It(w,b),function(){return"Error in fused matMul: outer dimensions ("+w+") and ("+b+") of Tensors with shapes "+f.shape+" and "+m.shape+" must match."}),T(p===v,function(){return"Error in fused matMul: inner shapes ("+p+") and ("+v+") of Tensors with shapes "+f.shape+" and "+m.shape+" and transposeA="+o+" and transposeB="+s+" must match."});var S,C,E=f.shape.slice(0,-2).concat([g,x]),R=o?f.as3D(k,p,g):f.as3D(k,g,p),D=s?m.as3D(_,x,v):m.as3D(_,v,x);u!=null&&Ae(E,(S=st(S=N(u,"bias","fused matMul"),f)[0]).shape),d!=null&&(C=N(d,"prelu weights","fused matMul"));var P={a:R,b:D};u!=null&&(P.bias=S),d!=null&&(P.preluActivationWeights=C);var F=[R,D];return O.runKernelFunc(function(U,z){var W=U.fusedBatchMatMul({a:R,b:D,transposeA:o,transposeB:s,bias:S,activation:c,preluActivationWeights:C});return z([R,D,W]),W},P,function(U,z){var W=z[0],L=z[1],I=z[2],j=h0(U,I,c),B={};return u!=null&&(B={bias:function(){return f0(S,j)}}),Object.assign(o||s?!o&&s?{a:function(){return j.matMul(L,!1,!1)},b:function(){return j.matMul(W,!0,!1)}}:o&&!s?{a:function(){return L.matMul(j,!1,!0)},b:function(){return W.matMul(j,!1,!1)}}:{a:function(){return L.matMul(j,!0,!0)},b:function(){return j.matMul(W,!0,!0)}}:{a:function(){return j.matMul(L,!1,!0)},b:function(){return W.matMul(j,!0,!1)}},B)},"_FusedMatMul",{transposeA:o,transposeB:s,activation:c},F,[!0]).reshape(E)}}),SW=M({fusedConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,i=t.pad,o=t.dataFormat,a=o===void 0?"NHWC":o,s=t.dilations,u=s===void 0?[1,1]:s,l=t.dimRoundingMode,c=t.bias,d=t.activation,h=d===void 0?"linear":d,f=t.preluActivationWeights;if(h=h||"linear",d0(O.state.gradientDepth,h)===!1){var m=Jn(e,n,r,i,a,u,l);return c!=null&&(m=Ee(m,c)),p0(m,h,f)}var p=N(e,"x","conv2d"),v=N(n,"filter","conv2d"),g=p,x=!1;p.rank===3&&(x=!0,g=p.as4D(1,p.shape[0],p.shape[1],p.shape[2])),T(g.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),T(v.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."}),l!=null&&T(pt(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+i+"."}),T(g.shape[3]===v.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+v.shape[2]+"."}),T(xn(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),T(a==="NHWC",function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var w,b,k=Qo(g.shape,v.shape,r,u,i,l);c!=null&&(w=st(w=N(c,"bias","fused conv2d"),p)[0],Ae(k.outShape,w.shape)),f!=null&&(b=N(f,"prelu weights","fused conv2d"));var _={x:g,filter:v};c!=null&&(_.bias=w),f!=null&&(_.preluActivationWeights=b);var S=[v,g],C=O.runKernelFunc(function(E,R){var D=E.fusedConv2d({input:g,filter:v,convInfo:k,bias:w,activation:h,preluActivationWeights:b});return R([v,g,D]),D},_,function(E,R){var D=R,P=D[0],F=D[1],U=D[2],z=h0(E,U,h);T(ys(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var W={};return c!=null&&(W={bias:function(){return f0(w,z)}}),Object.assign({x:function(){return wA(F.shape,z,P,r,i)},filter:function(){return i0(F,z,P.shape,r,i)}},W)},"FusedConv2D",{convInfo:k,activation:h},S,[!0]);return x?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),CW=M({fusedDepthwiseConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,i=t.pad,o=t.dataFormat,a=o===void 0?"NHWC":o,s=t.dilations,u=s===void 0?[1,1]:s,l=t.dimRoundingMode,c=t.bias,d=t.activation,h=d===void 0?"linear":d,f=t.preluActivationWeights;if(d0(O.state.gradientDepth,h)===!1){var m=Mh(e,n,r,i,a,u,l);return c!=null&&(m=Ee(m,c)),p0(m,h,f)}var p=N(e,"x","depthwiseConv2d"),v=N(n,"filter","depthwiseConv2d"),g=p,x=!1;p.rank===3&&(x=!0,g=p.as4D(1,p.shape[0],p.shape[1],p.shape[2])),T(g.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),T(v.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."}),T(g.shape[3]===v.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."}),u==null&&(u=[1,1]),T(xn(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&T(pt(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+i+"."});var w,b,k=Qo(g.shape,v.shape,r,u,i,l,!0);c!=null&&(w=st(w=N(c,"bias","fused conv2d"),p)[0],Ae(k.outShape,w.shape)),f!=null&&(b=N(f,"prelu weights","fused depthwiseConv2d"));var _={x:g,filter:v};c!=null&&(_.bias=w),f!=null&&(_.preluActivationWeights=b);var S=[v,g],C=O.runKernelFunc(function(E,R){var D=E.fusedDepthwiseConv2D({input:g,filter:v,convInfo:k,bias:w,activation:h,preluActivationWeights:b});return R([v,g,D]),D},_,function(E,R){T(ys(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var D=R[0],P=R[1],F=R[2],U=h0(E,F,h),z={};return c!=null&&(z={bias:function(){return f0(w,U)}}),Object.assign({x:function(){return bA(P.shape,U,D,k)},filter:function(){return kA(P,U,D.shape,k)}},z)},"FusedDepthwiseConv2D",{convInfo:k,activation:h},S,[!0]);return x?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),EW=Object.freeze({matMul:_W,conv2d:SW,depthwiseConv2d:CW}),AW=Object.freeze({image:c0,linalg:mW,losses:dW,spectral:Y$,fused:EW,signal:tW,square:s6,squaredDifference:iA,conv1d:g$,conv2d:Jn,conv3d:v$,depthwiseConv2d:Mh,separableConv2d:o0,conv2dTranspose:y$,conv3dTranspose:x$,op:M,batchNormalization2d:F6,batchNormalization3d:L6,batchNormalization4d:B6,batchNormalization:V6,batchNorm:cA,batchNorm2d:z6,batchNorm3d:U6,batchNorm4d:$6,booleanMaskAsync:m$,complex:Ft,real:$n,imag:Ir,concat:St,concat1d:EV,concat2d:AV,concat3d:RV,concat4d:NV,split:Gy,matMul:Oh,dot:w$,outerProduct:b$,reverse:Rl,reverse1d:k$,reverse2d:_$,reverse3d:S$,reverse4d:C$,maxPool:Nt,avgPool:Nl,pool:E$,maxPool3d:A$,avgPool3d:R$,slice:zr,slice1d:N$,slice2d:T$,slice3d:CA,slice4d:P$,abs:u6,acos:l6,acosh:c6,asin:d6,asinh:h6,atan:f6,atanh:p6,ceil:m6,clipByValue:t0,cos:g6,cosh:v6,erf:y6,exp:yg,expm1:x6,floor:w6,log:b6,log1p:k6,logSigmoid:_6,neg:Wd,reciprocal:S6,round:C6,rsqrt:oA,sigmoid:aA,sign:E6,isNaN:A6,isInf:R6,isFinite:N6,sin:T6,sinh:P6,softplus:I6,sqrt:D6,step:M6,tan:O6,tanh:j6,all:I$,any:D$,argMax:M$,argMin:O$,logSumExp:j$,max:jh,mean:F$,min:L$,moments:B$,sum:AA,prod:V$,equal:mA,equalStrict:o$,greater:a$,greaterEqual:gA,greaterEqualStrict:s$,greaterStrict:u$,less:l$,lessEqual:c$,lessEqualStrict:d$,lessStrict:h$,notEqual:f$,notEqualStrict:p$,add:Ee,addN:H6,addStrict:K6,atan2:q6,div:ur,divNoNan:X6,divStrict:Y6,floorDiv:fA,maximum:n0,maximumStrict:J6,minimum:pA,minimumStrict:Q6,mod:Z6,modStrict:e$,mul:Jt,mulStrict:t$,pow:Gd,powStrict:n$,squaredDifferenceStrict:r$,sub:At,subStrict:i$,elu:RA,leakyRelu:z$,prelu:NA,relu:it,relu6:TA,selu:U$,logicalAnd:Dh,logicalNot:W6,logicalOr:dA,logicalXor:G6,where:Ho,whereAsync:hA,buffer:xe,print:LV,batchToSpaceND:AE,broadcastTo:BV,cast:VV,clone:zV,cumsum:UV,depthToSpace:$V,expandDims:Un,eye:RE,multinomial:WV,oneHot:pg,pad:Jo,pad1d:GV,pad2d:HV,pad3d:KV,pad4d:qV,rand:XV,randomNormal:YV,randomGamma:JV,randomUniform:NE,reshape:cr,spaceToBatchND:TE,squeeze:PE,stack:In,tile:Qa,truncatedNormal:QV,unstack:Ct,setdiff1dAsync:ZV,fill:Vr,linspace:CV,ones:Ds,range:jd,scalar:J,tensor:Bt,tensor1d:yt,tensor2d:qi,tensor3d:Wy,tensor4d:cn,tensor5d:kV,tensor6d:_V,variable:SV,zeros:Ge,onesLike:EE,zerosLike:Ne,transpose:to,softmax:yi,logSoftmax:az,localResponseNormalization:$$,norm:PA,gather:r0,unsortedSegmentSum:vA,basicLSTMCell:W$,multiRNNCell:G$,movingAverage:H$,stridedSlice:K$,topk:q$,scatterND:X$,fft:a0,ifft:Hd,rfft:s0,irfft:IA,sparseToDense:J$,gatherND:Q$,diag:Z$,dropout:eW,hannWindow:u0,hammingWindow:MA,frame:l0,stft:OA,inTopKAsync:nW});function H(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(n){n!=null&&T(n.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function pp(t,e,n,r){if(n==="linear")return t.linear(e);if(n==="relu")return t.relu(e);if(n==="elu")return t.elu(e);if(n==="relu6")return t.relu6(e);if(n==="prelu")return t.prelu(e,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var RW=function(t){function e(){var n=t.call(this)||this;return n.blockSize=48,n.firstUse=!0,n.data=new LE(n,O),n}return xr(e,t),e.prototype.write=function(n,r,i){this.firstUse&&(this.firstUse=!1,G().get("IS_NODE")&&Md(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:n,dtype:i}),o},e.prototype.move=function(n,r,i,o){this.data.set(n,{values:r,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(n){return ne(this,void 0,void 0,function(){return re(this,function(r){return[2,this.readSync(n)]})})},e.prototype.readSync=function(n){var r=this.data.get(n),i=r.dtype,o=r.complexTensors;return i==="complex64"?vg(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(n).values},e.prototype.bufferSync=function(n){var r=this.readSync(n.dataId),i=r;if(n.dtype==="string")try{i=r.map(function(o){return Pd(o)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return xe(n.shape,n.dtype,i)},e.prototype.makeOutput=function(n,r,i){var o=this.write(n,r,i);return O.makeTensorFromDataId(o,r,i,this)},e.prototype.disposeData=function(n){if(this.data.has(n)){var r=this.data.get(n).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(n)}},e.prototype.time=function(n){return ne(this,void 0,void 0,function(){var r;return re(this,function(i){return r=Nr(),n(),[2,{kernelMs:Nr()-r}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(n,r){var i=this.makeOutput(null,n.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:O.keep(n.clone()),imag:O.keep(r.clone())},i},e.prototype.real=function(n){return this.data.get(n.dataId).complexTensors.real.clone()},e.prototype.imag=function(n){return this.data.get(n.dataId).complexTensors.imag.clone()},e.prototype.slice=function(n,r,i){if(H(n,"slice"),jE(n.shape,r,i)){var o=FE(r,n.strides),a=oe(i);return Bt(this.readSync(n.dataId).subarray(o,o+a),i,n.dtype)}for(var s=xe(i,n.dtype),u=this.bufferSync(n),l=0;l<s.size;++l){var c=s.indexToLoc(l).map(function(d,h){return d+r[h]});s.values[l]=u.get.apply(u,c)}return s.toTensor()},e.prototype.stridedSlice=function(n,r,i,o){H(n,"stridedSlice");var a=Ky(r,i,o);if(a.some(function(f){return f===0}))return Bt([],a);for(var s=xe(a,n.dtype),u=this.bufferSync(n),l=0;l<s.size;l++){for(var c=s.indexToLoc(l),d=new Array(c.length),h=0;h<d.length;h++)d[h]=c[h]*o[h]+r[h];s.set.apply(s,[u.get.apply(u,d)].concat(c))}return s.toTensor()},e.prototype.diag=function(n){for(var r=this.readSync(n.dataId),i=xe([n.size,n.size],n.dtype),o=i.values,a=0;a<r.length;a++)o[a*n.size+a]=r[a];return i.toTensor()},e.prototype.unstack=function(n,r){for(var i=n.shape[r],o=new Array(n.rank-1),a=0,s=0;s<n.rank;s++)s!==r&&(o[a++]=n.shape[s]);var u=new Array(n.rank).fill(0),l=n.shape.slice();l[r]=1;var c=new Array(i);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(n,u,l).reshape(o);return c},e.prototype.reverse=function(n,r){H(n,"reverse");for(var i=xe(n.shape,n.dtype),o=this.bufferSync(n),a=function(u){var l=i.indexToLoc(u),c=l.slice();r.forEach(function(d){return c[d]=n.shape[d]-1-c[d]}),i.set.apply(i,[o.get.apply(o,c)].concat(l))},s=0;s<i.size;s++)a(s);return i.toTensor()},e.prototype.concat=function(n,r){var i=this;if(n[0].dtype==="complex64"){var o=n.map(function(f){return $n(f)}),a=n.map(function(f){return Ir(f)});return Ft(this.concat(o,r),this.concat(a,r))}var s=n.map(function(f){var m=oe(f.shape.slice(r));return f.as2D(-1,m)}),u=vs(s.map(function(f){return f.shape}),1),l=xe(u,n[0].dtype).values;if(s[0].shape[0]===1){var c=0;s.forEach(function(f){l.set(i.readSync(f.dataId),c),c+=f.size})}else{var d=0;s.forEach(function(f){for(var m=i.readSync(f.dataId),p=0,v=0;v<f.shape[0];++v)for(var g=v*u[1]+d,x=0;x<f.shape[1];++x)l[g+x]=m[p++];d+=f.shape[1]})}var h=vs(n.map(function(f){return f.shape}),r);return Bt(l,h,n[0].dtype)},e.prototype.neg=function(n){return H(n,"neg"),this.multiply(J(-1),n)},e.prototype.add=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(i,o,a,s){return{real:i+a,imag:o+s}}):this.broadcastedBinaryOp(n,r,Lt(n.dtype,r.dtype),function(i,o){return i+o})},e.prototype.addN=function(n){var r=this;H(n,"addN");for(var i=n.map(function(c){return r.readSync(c.dataId)}),o=xe(n[0].shape,n[0].dtype),a=o.values,s=0;s<n.length;s++)for(var u=i[s],l=0;l<a.length;l++)a[l]+=u[l];return o.toTensor()},e.prototype.softmax=function(n,r){var i=Rt([r],n.shape),o=this.max(n,i),a=yn(o.shape,i),s=this.subtract(n,o.reshape(a)),u=this.exp(s),l=this.sum(u,i).reshape(a);return this.realDivide(u,l)},e.prototype.subtract=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(i,o,a,s){return{real:i-a,imag:o-s}}):this.broadcastedBinaryOp(n,r,Lt(n.dtype,r.dtype),function(i,o){return i-o})},e.prototype.pow=function(n,r){return H([n,r],"pow"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return Math.pow(i,o)})},e.prototype.batchMatMul=function(n,r,i,o){H([n,r],"matMul");for(var a=i?n.shape[1]:n.shape[2],s=i?n.shape[2]:n.shape[1],u=o?r.shape[1]:r.shape[2],l=n.shape[0],c=this.readSync(n.dataId),d=this.readSync(r.dataId),h=i?[n.strides[0],1,n.strides[1]]:[n.strides[0],n.strides[1],1],f=h[0],m=h[1],p=h[2],v=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],g=v[0],x=v[1],w=v[2],b=s*u,k=xe([l,s,u],n.dtype),_=k.values,S=this.blockSize,C=0;C<l;C++)for(var E=0;E<s;E+=S)for(var R=0;R<u;R+=S)for(var D=0;D<a;D+=S)for(var P=Math.min(E+S,s),F=Math.min(R+S,u),U=Math.min(D+S,a),z=E;z<P;z++)for(var W=R;W<F;W++){for(var L=0,I=D;I<U;I++)L+=c[C*f+z*m+I*p]*d[I*g+W*x+C*w];_[C*b+(z*u+W)]+=L}return k.toTensor()},e.prototype.fusedBatchMatMul=function(n){var r=n.a,i=n.b,o=n.transposeA,a=n.transposeB,s=n.bias,u=n.activation,l=n.preluActivationWeights,c=this.batchMatMul(r,i,o,a);return s&&(c=this.add(c,s)),u&&(c=pp(this,c,u,l)),c},e.prototype.multiply=function(n,r){return n.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(n.cast("complex64"),r.cast("complex64"),function(i,o,a,s){return{real:i*a-o*s,imag:i*s+o*a}}):this.broadcastedBinaryOp(n,r,Lt(n.dtype,r.dtype),function(i,o){return i*o})},e.prototype.realDivide=function(n,r){return H([n,r],"realDivide"),this.broadcastedBinaryOp(n,r,"float32",function(i,o){return i/o})},e.prototype.floorDiv=function(n,r){return H([n,r],"floorDiv"),this.broadcastedBinaryOp(n,r,"int32",function(i,o){return Math.floor(i/o)})},e.prototype.sum=function(n,r){H(n,"sum"),_n("sum",r,n.rank);for(var i=Gt(n.shape,r),o=i[0],a=i[1],s=Ge(o,Lt(n.dtype,"int32")),u=oe(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var h=d*u,f=0,m=0;m<u;++m)f+=c[h+m];l[d]=f}return s},e.prototype.prod=function(n,r){H(n,"sum");for(var i=Gt(n.shape,r),o=i[0],a=i[1],s=Ge(o,Lt(n.dtype,"int32")),u=oe(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var h=d*u,f=1,m=0;m<u;++m)f*=c[h+m];l[d]=f}return s},e.prototype.unsortedSegmentSum=function(n,r,i){H(n,"unsortedSegmentSum");for(var o=[],a=n.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<i;++s){var u=J(s,"int32"),l=mA(u,r).asType("float32").mul(n).sum(0);o.push(l)}return In(o)},e.prototype.argMin=function(n,r){H(n,"argMin");var i=[r];_n("argMin",i,n.rank);for(var o=Gt(n.shape,i),a=o[0],s=o[1],u=Ge(a,"int32"),l=oe(s),c=this.readSync(u.dataId),d=this.readSync(n.dataId),h=0;h<c.length;++h){for(var f=h*l,m=d[f],p=0,v=0;v<l;++v){var g=d[f+v];g<m&&(m=g,p=v)}c[h]=p}return u},e.prototype.argMax=function(n,r){H(n,"argMax");var i=[r];_n("argMax",i,n.rank);for(var o=Gt(n.shape,i),a=o[0],s=o[1],u=Ge(a,"int32"),l=oe(s),c=this.readSync(u.dataId),d=this.readSync(n.dataId),h=0;h<c.length;++h){for(var f=h*l,m=d[f],p=0,v=0;v<l;++v){var g=d[f+v];g>m&&(m=g,p=v)}c[h]=p}return u},e.prototype.cumsum=function(n,r,i,o){if(H(n,"cumsum"),r!==n.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(n.rank-1)+" but got axis="+r);for(var a=Lt(n.dtype,"int32"),s=Ge(n.shape,a),u=this.readSync(s.dataId),l=this.readSync(n.dataId),c=n.shape[n.rank-1],d=o?function(v,g){return v+c-g-1}:function(v,g){return v+g},h=0;h<l.length;h+=c)for(var f=0;f<c;f++){var m=d(h,f);if(f===0)u[m]=i?0:l[m];else{var p=d(h,f-1);u[m]=i?l[p]+u[p]:l[m]+u[p]}}return s},e.prototype.equal=function(n,r){return H([n,r],"equal"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i===o?1:0})},e.prototype.notEqual=function(n,r){return H([n,r],"notEqual"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i!==o?1:0})},e.prototype.less=function(n,r){return H([n,r],"less"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i<o?1:0})},e.prototype.lessEqual=function(n,r){return H([n,r],"lessEqual"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i<=o?1:0})},e.prototype.greater=function(n,r){return H([n,r],"greater"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i>o?1:0})},e.prototype.greaterEqual=function(n,r){return H([n,r],"greaterEqual"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i>=o?1:0})},e.prototype.logicalNot=function(n){H(n,"logicalNot");for(var r=this.readSync(n.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,n.shape,"bool")},e.prototype.logicalAnd=function(n,r){return H([n,r],"logicalAnd"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i&&o})},e.prototype.logicalOr=function(n,r){return H([n,r],"logicalOr"),this.broadcastedBinaryOp(n,r,"bool",function(i,o){return i||o})},e.prototype.select=function(n,r,i){H([n,r,i],"select");for(var o=this.readSync(n.dataId),a=this.readSync(r.dataId),s=this.readSync(i.dataId),u=Ge(r.shape,Lt(r.dtype,i.dtype)),l=this.readSync(u.dataId),c=0,d=n.rank===0||n.rank>1||r.rank===1?1:oe(r.shape.slice(1)),h=0;h<o.length;h++)for(var f=0;f<d;f++)o[h]===1?l[c++]=a[h]:l[c++]=s[h];return u},e.prototype.where=function(n){H([n],"where");var r=this.readSync(n.dataId);return Jy(n.shape,r)},e.prototype.topk=function(n,r,i){return H(n,"topk"),HE(this.readSync(n.dataId),n.shape,n.dtype,r)},e.prototype.min=function(n,r){H(n,"min"),_n("min",r,n.rank);for(var i=Gt(n.shape,r),o=i[0],a=i[1],s=Ge(o,n.dtype),u=oe(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var h=d*u,f=c[h],m=0;m<u;++m){var p=c[h+m];p<f&&(f=p)}l[d]=f}return s},e.prototype.minimum=function(n,r){return H([n,r],"minimum"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return Math.min(i,o)})},e.prototype.mod=function(n,r){return H([n,r],"mod"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){var a=i%o;return i<0&&o<0||i>=0&&o>=0?a:(a+o)%o})},e.prototype.max=function(n,r){H(n,"max"),_n("max",r,n.rank);for(var i=Gt(n.shape,r),o=i[0],a=i[1],s=Ge(o,n.dtype),u=oe(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var h=d*u,f=c[h],m=0;m<u;++m){var p=c[h+m];p>f&&(f=p)}l[d]=f}return s},e.prototype.maximum=function(n,r){return H([n,r],"maximum"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return Math.max(i,o)})},e.prototype.all=function(n,r){H(n,"all"),_n("all",r,n.rank);for(var i=Gt(n.shape,r),o=i[0],a=i[1],s=Ge(o,n.dtype),u=oe(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var h=d*u,f=c[h],m=0;m<u;++m){var p=c[h+m];f=f&&p}l[d]=f}return s},e.prototype.any=function(n,r){H(n,"any"),_n("any",r,n.rank);for(var i=Gt(n.shape,r),o=i[0],a=i[1],s=Ge(o,n.dtype),u=oe(a),l=this.readSync(s.dataId),c=this.readSync(n.dataId),d=0;d<l.length;++d){for(var h=d*u,f=c[h],m=0;m<u;++m){var p=c[h+m];f=f||p}l[d]=f}return s},e.prototype.squaredDifference=function(n,r){return H([n,r],"squaredDifference"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){var a=i-o;return a*a})},e.prototype.ceil=function(n){H(n,"ceil");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,n.shape,"float32")},e.prototype.floor=function(n){H(n,"floor");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,n.shape,"float32")},e.prototype.sign=function(n){H(n,"x");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)r[o]<0?i[o]=-1:r[o]>0?i[o]=1:i[o]=0;return this.makeOutput(i,n.shape,"float32")},e.prototype.isNaN=function(n){H(n,"x");for(var r=this.readSync(n.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,n.shape,"bool")},e.prototype.isInf=function(n){H(n,"x");for(var r=this.readSync(n.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,n.shape,"bool")},e.prototype.isFinite=function(n){H(n,"x");for(var r=this.readSync(n.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,n.shape,"bool")},e.prototype.round=function(n){H(n,"round");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=Math.floor(r[o]);r[o]-a<.5?i[o]=Math.floor(r[o]):r[o]-a>.5?i[o]=Math.ceil(r[o]):i[o]=a%2==0?a:a+1}return this.makeOutput(i,n.shape,"float32")},e.prototype.exp=function(n){H(n,"exp");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,n.shape,"float32")},e.prototype.expm1=function(n){H(n,"expm1");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,n.shape,"float32")},e.prototype.log=function(n){H(n,"log");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.log(a)}return this.makeOutput(i,n.shape,"float32")},e.prototype.log1p=function(n){H(n,"log1p");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.log1p(a)}return this.makeOutput(i,n.shape,"float32")},e.prototype.sqrt=function(n){H(n,"sqrt");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.sqrt(a)}return this.makeOutput(i,n.shape,"float32")},e.prototype.rsqrt=function(n){H(n,"rsqrt");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=1/Math.sqrt(a)}return this.makeOutput(i,n.shape,"float32")},e.prototype.reciprocal=function(n){H(n,"reciprocal");for(var r=this.readSync(n.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,n.shape,"float32")},e.prototype.linear=function(n){return n},e.prototype.relu=function(n){H(n,"relu");for(var r=Ge(n.shape,n.dtype),i=this.readSync(r.dataId),o=this.readSync(n.dataId),a=0;a<o.length;++a)i[a]=Math.max(0,o[a]);return r},e.prototype.relu6=function(n){H(n,"relu");for(var r=Ge(n.shape,n.dtype),i=this.readSync(r.dataId),o=this.readSync(n.dataId),a=0;a<o.length;++a)i[a]=Math.min(Math.max(0,o[a]),6);return r},e.prototype.prelu=function(n,r){return H([n,r],"prelu"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return i<0?o*i:i})},e.prototype.elu=function(n){H(n,"elu");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o){var a=i[o];r[o]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,n.shape,"float32")},e.prototype.eluDer=function(n,r){H([n,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),a=this.readSync(n.dataId),s=0;s<o.length;++s){var u=o[s];i[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(n){H(n,"selu");for(var r=Zy,i=e0,o=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>=0?i*u:r*(Math.exp(u)-1)}return this.makeOutput(o,n.shape,"float32")},e.prototype.clip=function(n,r,i){H(n,"clip");for(var o=new Float32Array(n.size),a=this.readSync(n.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>i?i:u<r?r:u}return this.makeOutput(o,n.shape,"float32")},e.prototype.abs=function(n){for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.complexAbs=function(n){for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<n.size;++o){var a=i[2*o],s=i[2*o+1];r[o]=Math.hypot(a,s)}return this.makeOutput(r,n.shape,"float32")},e.prototype.int=function(n){H(n,"int");for(var r=new Int32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,n.shape,"int32")},e.prototype.sigmoid=function(n){H(n,"sigmoid");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,n.shape,"float32")},e.prototype.softplus=function(n){H(n,"softplus");for(var r=Math.log(11920928955078125e-23)+2,i=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a){var s=o[a]>-r,u=o[a]<r,l=Math.exp(o[a]),c=void 0;c=u?l:s?o[a]:Math.log(1+l),i[a]=c}return this.makeOutput(i,n.shape,"float32")},e.prototype.sin=function(n){H(n,"sin");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.cos=function(n){H(n,"cos");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.tan=function(n){H(n,"tan");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.asin=function(n){H(n,"asin");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.acos=function(n){H(n,"acos");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.atan=function(n){H(n,"atan");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.atan2=function(n,r){return H([n,r],"atan2"),this.broadcastedBinaryOp(n,r,n.dtype,function(i,o){return Math.atan2(i,o)})},e.prototype.sinh=function(n){H(n,"sinh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.cosh=function(n){H(n,"cosh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.tanh=function(n){H(n,"tanh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=N5(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.asinh=function(n){H(n,"asinh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.acosh=function(n){H(n,"acosh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.atanh=function(n){H(n,"atanh");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,n.shape,"float32")},e.prototype.erf=function(n){H(n,"erf");for(var r=new Float32Array(n.size),i=this.readSync(n.dataId),o=0;o<i.length;++o){var a=Math.sign(i[o]),s=Math.abs(i[o]),u=1/(1+.3275911*s);r[o]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,n.shape,"float32")},e.prototype.step=function(n,r){r===void 0&&(r=0),H(n,"step");for(var i=new Float32Array(n.size),o=this.readSync(n.dataId),a=0;a<o.length;++a){var s=o[a];isNaN(s)?i[a]=NaN:i[a]=s>0?1:r}return this.makeOutput(i,n.shape,"float32")},e.prototype.fusedConv2d=function(n){var r=n.input,i=n.filter,o=n.convInfo,a=n.bias,s=n.activation,u=n.preluActivationWeights,l=this.conv2d(r,i,o);return a&&(l=this.add(l,a)),s&&(l=pp(this,l,s,u)),l},e.prototype.conv2d=function(n,r,i){H([n,r],"conv2d");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,d=i.dataFormat==="channelsLast",h=xe(i.outShape,n.dtype),f=n.strides[0],m=d?n.strides[1]:n.strides[2],p=d?n.strides[2]:1,v=d?1:n.strides[1],g=h.strides[0],x=d?h.strides[1]:h.strides[2],w=d?h.strides[2]:1,b=d?1:h.strides[1],k=this.readSync(n.dataId),_=this.readSync(r.dataId),S=h.values,C=0;C<i.batchSize;++C)for(var E=C*f,R=C*g,D=0;D<i.outHeight;++D)for(var P=R+D*x,F=D*i.strideHeight-c,U=0;U<o;U++){var z=F+U*s;if(!(z<0||z>=i.inHeight))for(var W=U*r.strides[0],L=E+z*m,I=0;I<i.outWidth;++I)for(var j=P+I*w,B=I*i.strideWidth-l,K=0;K<a;K++){var X=B+K*u;if(!(X<0||X>=i.inWidth))for(var Y=L+X*p,ie=W+K*r.strides[1],fe=0;fe<i.inChannels;++fe){for(var pe=k[Y+fe*v],ce=0;ce<i.outChannels;++ce)S[j+ce*b]+=pe*_[ie+ce];ie+=i.outChannels}}}return h.toTensor()},e.prototype.conv3d=function(n,r,i){for(var o=i.filterDepth,a=i.filterHeight,s=i.filterWidth,u=i.dilationDepth,l=i.dilationHeight,c=i.dilationWidth,d=i.padInfo.front,h=i.padInfo.left,f=i.padInfo.top,m=xe(i.outShape,n.dtype),p=this.readSync(n.dataId),v=this.readSync(r.dataId),g=m.values,x=0;x<i.batchSize;++x)for(var w=x*n.strides[0],b=x*m.strides[0],k=0;k<i.outDepth;++k)for(var _=b+k*m.strides[1],S=k*i.strideDepth-d,C=0;C<o;C++){var E=S+C*u;if(!(E<0||E>=i.inDepth))for(var R=C*r.strides[0],D=w+E*n.strides[1],P=0;P<i.outHeight;++P)for(var F=_+P*m.strides[2],U=P*i.strideHeight-f,z=0;z<a;z++){var W=U+z*l;if(!(W<0||W>=i.inHeight))for(var L=R+z*r.strides[1],I=D+W*n.strides[2],j=0;j<i.outWidth;++j)for(var B=F+j*i.outChannels,K=j*i.strideWidth-h,X=0;X<s;X++){var Y=K+X*c;if(!(Y<0||Y>=i.inWidth))for(var ie=L+X*r.strides[2],fe=I+Y*i.inChannels,pe=ie,ce=0;ce<i.inChannels;++ce){for(var Ce=p[fe+ce],ke=0;ke<i.outChannels;++ke)g[B+ke]+=Ce*v[pe+ke];pe+=i.outChannels}}}}return m.toTensor()},e.prototype.conv2dDerInput=function(n,r,i){H([n,r],"conv2dDerInput");for(var o=xe(i.inShape,"float32"),a=o.values,s=this.readSync(n.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],d=l[1],h=l[2],f=i.batchSize,m=i.filterHeight,p=i.filterWidth,v=i.inChannels,g=i.inHeight,x=i.inWidth,w=i.outChannels,b=i.outHeight,k=i.outWidth,_=i.strideHeight,S=i.strideWidth,C=i.dataFormat,E=m-1-i.padInfo.top,R=p-1-i.padInfo.left,D=C==="channelsLast",P=o.strides[0],F=D?o.strides[1]:o.strides[2],U=D?o.strides[2]:1,z=D?1:o.strides[1],W=n.strides[0],L=D?n.strides[1]:n.strides[2],I=D?n.strides[2]:1,j=D?1:n.strides[1],B=0;B<f;++B)for(var K=0;K<v;++K)for(var X=0;X<g;++X)for(var Y=X-E,ie=Math.max(0,Math.ceil(Y/_)),fe=Math.min(b,(m+Y)/_),pe=0;pe<x;++pe){for(var ce=pe-R,Ce=Math.max(0,Math.ceil(ce/S)),ke=Math.min(k,(p+ce)/S),Be=0,_e=ie;_e<fe;++_e)for(var Te=_e*_-Y,De=Ce;De<ke;++De)for(var ut=W*B+L*_e+I*De,Je=c*(m-1-Te)+d*(p-1-(De*S-ce))+h*K,Qe=0;Qe<w;++Qe)Be+=s[ut+j*Qe]*u[Je+Qe];a[P*B+F*X+U*pe+z*K]=Be}return o.toTensor()},e.prototype.conv3dDerInput=function(n,r,i){for(var o=xe(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],l=s[1],c=s[2],d=s[3],h=this.readSync(n.dataId),f=n.strides,m=f[0],p=f[1],v=f[2],g=f[3],x=this.readSync(r.dataId),w=r.strides,b=w[0],k=w[1],_=w[2],S=w[3],C=i.batchSize,E=i.filterDepth,R=i.filterHeight,D=i.filterWidth,P=i.inChannels,F=i.inDepth,U=i.inHeight,z=i.inWidth,W=i.outChannels,L=i.outDepth,I=i.outHeight,j=i.outWidth,B=i.strideDepth,K=i.strideHeight,X=i.strideWidth,Y=E-1-i.padInfo.front,ie=R-1-i.padInfo.top,fe=D-1-i.padInfo.left,pe=0;pe<C;++pe)for(var ce=0;ce<P;++ce)for(var Ce=0;Ce<F;++Ce)for(var ke=Ce-Y,Be=Math.max(0,Math.ceil(ke/B)),_e=Math.min(L,(E+ke)/B),Te=0;Te<U;++Te)for(var De=Te-ie,ut=Math.max(0,Math.ceil(De/K)),Je=Math.min(I,(R+De)/K),Qe=0;Qe<z;++Qe){for(var kr=Qe-fe,_r=Math.max(0,Math.ceil(kr/X)),wn=Math.min(j,(D+kr)/X),ia=0,qr=Be;qr<_e;++qr)for(var _i=qr*B-ke,Xr=ut;Xr<Je;++Xr)for(var oa=Xr*K-De,Yr=_r;Yr<wn;++Yr)for(var Qh=m*pe+p*qr+v*Xr+g*Yr,aa=b*(E-1-_i)+k*(R-1-oa)+_*(D-1-(Yr*X-kr))+S*ce,Sr=0;Sr<W;++Sr)ia+=h[Qh+Sr]*x[aa+Sr];a[u*pe+l*Ce+c*Te+d*Qe+ce]=ia}return o.toTensor()},e.prototype.conv2dDerFilter=function(n,r,i){H([n,r],"conv2dDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=i.dataFormat==="channelsLast",c=xe(i.filterShape,"float32"),d=i.padInfo.left,h=i.padInfo.top,f=this.bufferSync(n),m=this.bufferSync(r),p=0;p<s;++p)for(var v=Math.max(0,Math.ceil((h-p)/o)),g=Math.min(i.outHeight,(i.inHeight+h-p)/o),x=0;x<u;++x)for(var w=Math.max(0,Math.ceil((d-x)/a)),b=Math.min(i.outWidth,(i.inWidth+d-x)/a),k=0;k<i.inChannels;++k)for(var _=0;_<i.outChannels;++_){for(var S=0,C=0;C<i.batchSize;++C)for(var E=v;E<g;++E)for(var R=p+E*o-h,D=w;D<b;++D){var P=x+D*a-d;S+=l?f.get(C,R,P,k)*m.get(C,E,D,_):f.get(C,k,R,P)*m.get(C,_,E,D)}c.set(S,p,x,k,_)}return c.toTensor()},e.prototype.conv3dDerFilter=function(n,r,i){for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,d=xe(i.filterShape,"float32"),h=d.values,f=d.strides,m=f[0],p=f[1],v=f[2],g=f[3],x=this.readSync(r.dataId),w=r.strides,b=w[0],k=w[1],_=w[2],S=w[3],C=this.readSync(n.dataId),E=n.strides,R=E[0],D=E[1],P=E[2],F=E[3],U=i.padInfo.front,z=i.padInfo.left,W=i.padInfo.top,L=0;L<u;++L)for(var I=Math.max(0,Math.ceil((U-L)/o)),j=Math.min(i.outDepth,(i.inDepth+U-L)/o),B=L*m,K=0;K<l;++K)for(var X=Math.max(0,Math.ceil((W-K)/a)),Y=Math.min(i.outHeight,(i.inHeight+W-K)/a),ie=K*p+B,fe=0;fe<c;++fe)for(var pe=Math.max(0,Math.ceil((z-fe)/s)),ce=Math.min(i.outWidth,(i.inWidth+z-fe)/s),Ce=fe*v+ie,ke=0;ke<i.inChannels;++ke)for(var Be=ke*g+Ce,_e=0;_e<i.outChannels;++_e){for(var Te=0,De=0;De<i.batchSize;++De)for(var ut=De*R,Je=De*b,Qe=I;Qe<j;++Qe)for(var kr=(L+Qe*o-U)*D+ut,_r=Qe*k+Je,wn=X;wn<Y;++wn)for(var ia=(K+wn*a-W)*P+kr,qr=wn*_+_r,_i=pe;_i<ce;++_i){var Xr=_i*S+qr;Te+=C[(fe+_i*s-z)*F+ia+ke]*x[Xr+_e]}h[Be+_e]=Te}return d.toTensor()},e.prototype.fusedDepthwiseConv2D=function(n){var r=n.input,i=n.filter,o=n.convInfo,a=n.bias,s=n.activation,u=n.preluActivationWeights,l=this.depthwiseConv2D(r,i,o);return a&&(l=this.add(l,a)),s&&(l=pp(this,l,s,u)),l},e.prototype.depthwiseConv2D=function(n,r,i){H([n,r],"depthwiseConv2D");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,d=i.outChannels/i.inChannels,h=xe(i.outShape,n.dtype),f=this.readSync(n.dataId),m=this.readSync(r.dataId),p=h.values,v=0;v<i.batchSize;++v)for(var g=v*n.strides[0],x=v*h.strides[0],w=0;w<i.outHeight;++w)for(var b=x+w*h.strides[1],k=w*i.strideHeight-l,_=0;_<o;++_){var S=k+_*s;if(!(S<0||S>=i.inHeight))for(var C=_*r.strides[0],E=g+S*n.strides[1],R=0;R<i.outWidth;++R)for(var D=b+R*h.strides[2],P=R*i.strideWidth-c,F=0;F<a;++F){var U=P+F*u;if(!(U<0||U>=i.inWidth))for(var z=C+F*r.strides[1],W=E+U*i.inChannels,L=D,I=z,j=0;j<i.inChannels;++j){for(var B=f[W+j],K=0;K<d;++K)p[L+K]+=B*m[I+K];L+=d,I+=d}}}return h.toTensor()},e.prototype.depthwiseConv2DDerInput=function(n,r,i){H([n,r],"depthwiseConv2DDerInput");for(var o=xe(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],l=s[1],c=s[2],d=this.readSync(n.dataId),h=n.strides,f=h[0],m=h[1],p=h[2],v=this.readSync(r.dataId),g=r.strides,x=g[0],w=g[1],b=g[2],k=i.batchSize,_=i.filterHeight,S=i.filterWidth,C=i.inChannels,E=i.inHeight,R=i.inWidth,D=i.outChannels,P=i.outHeight,F=i.outWidth,U=i.strideHeight,z=i.strideWidth,W=_-1-i.padInfo.top,L=S-1-i.padInfo.left,I=D/C,j=0;j<k;++j)for(var B=0;B<C;++B)for(var K=0;K<E;++K)for(var X=K-W,Y=Math.max(0,Math.ceil(X/U)),ie=Math.min(P,(_+X)/U),fe=0;fe<R;++fe){for(var pe=fe-L,ce=Math.max(0,Math.ceil(pe/z)),Ce=Math.min(F,(S+pe)/z),ke=0,Be=Y;Be<ie;++Be)for(var _e=Be*U-X,Te=ce;Te<Ce;++Te)for(var De=f*j+m*Be+p*Te,ut=x*(_-1-_e)+w*(S-1-(Te*z-pe))+b*B,Je=0;Je<I;++Je)ke+=d[De+(B*I+Je)]*v[ut+Je];a[u*j+l*K+c*fe+B]=ke}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(n,r,i){H([n,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=xe(i.filterShape,"float32"),c=i.padInfo.left,d=i.padInfo.top,h=i.outChannels/i.inChannels,f=this.bufferSync(n),m=this.bufferSync(r),p=0;p<s;++p)for(var v=Math.max(0,Math.ceil((d-p)/o)),g=Math.min(i.outHeight,(i.inHeight+d-p)/o),x=0;x<u;++x)for(var w=Math.max(0,Math.ceil((c-x)/a)),b=Math.min(i.outWidth,(i.inWidth+c-x)/a),k=0;k<i.outChannels;++k){for(var _=Math.trunc(k/h),S=k%h,C=0,E=0;E<i.batchSize;++E)for(var R=v;R<g;++R)for(var D=p+R*o-d,P=w;P<b;++P){var F=x+P*a-c;C+=f.get(E,D,F,_)*m.get(E,R,P,k)}l.set(C,p,x,_,S)}return l.toTensor()},e.prototype.tile=function(n,r){return H(n,"tile"),GE(this.bufferSync(n),r)},e.prototype.pad=function(n,r,i){H(n,"pad");var o=r.map(function(h,f){return h[0]+n.shape[f]+h[1]}),a=r.map(function(h){return h[0]}),s=this.bufferSync(n),u=xe(o,n.dtype);i!==0&&u.values.fill(i);for(var l=0;l<n.size;l++){var c=s.indexToLoc(l),d=c.map(function(h,f){return h+a[f]});u.set.apply(u,[s.get.apply(s,c)].concat(d))}return u.toTensor()},e.prototype.transpose=function(n,r){H(n,"transpose");for(var i=new Array(n.rank),o=0;o<i.length;o++)i[o]=n.shape[r[o]];var a=this.readSync(n.dataId),s=xe(i,n.dtype),u=this.bufferSync(n);for(o=0;o<n.size;++o){for(var l=u.indexToLoc(o),c=new Array(l.length),d=0;d<c.length;d++)c[d]=l[r[d]];var h=s.locToIndex(c);s.values[h]=a[o]}return s.toTensor()},e.prototype.gather=function(n,r,i){H([n,r],"gather");var o=n.shape.slice(),a=this.readSync(r.dataId);o[i]=a.length;for(var s=xe(o,n.dtype),u=this.bufferSync(n),l=0;l<s.size;++l){var c=s.indexToLoc(l),d=c.slice();d[i]=a[c[i]];var h=u.locToIndex(d);s.values[l]=u.values[h]}return s.toTensor()},e.prototype.batchToSpaceND=function(n,r,i){H([n],"batchToSpaceND");var o=r.reduce(function(d,h){return d*h}),a=Fd(n.shape,r,o),s=Ld(a.length,r.length),u=Bd(n.shape,r,o),l=IE(i,r.length),c=DE(u,i,r.length);return n.reshape(a).transpose(s).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(n,r,i){H([n],"spaceToBatchND");var o=r.reduce(function(h,f){return h*f}),a=[[0,0]];a.push.apply(a,i);for(var s=1+r.length;s<n.shape.length;++s)a.push([0,0]);var u=n.pad(a),l=Fd(u.shape,r,o,!1),c=Ld(l.length,r.length,!1),d=Bd(u.shape,r,o,!1);return u.reshape(l).transpose(c).reshape(d)},e.prototype.pool=function(n,r,i){H(n,"pool");for(var o=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,h=r.padInfo.left,f=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(n.dataId),p=xe(r.outShape,n.dtype),v=p.values,g=r.outShape[1]*r.outShape[2]*r.outShape[3],x=r.outShape[2]*r.outShape[3],w=r.outShape[3],b=0;b<r.batchSize;++b)for(var k=b*g,_=b*n.strides[0],S=0;S<r.inChannels;++S)for(var C=0;C<r.outHeight;++C)for(var E=C*o-d,R=Math.max(0,E),D=Math.min(r.inHeight,l+E),P=k+C*x,F=0;F<r.outWidth;++F){for(var U=F*a-h,z=Math.max(0,U),W=Math.min(r.inWidth,c+U),L=f,I=0,j=0,B=R;B<D;B+=s){for(var K=_+B*n.strides[1],X=z;X<W;X+=u){var Y=m[K+X*n.strides[2]+S];i==="max"&&Y>L?L=Y:i==="avg"&&(I+=Y,j++)}if(isNaN(L))break}v[P+F*w+S]=i==="avg"?I/j:L}return p.toTensor()},e.prototype.maxPool=function(n,r){return this.pool(n,r,"max")},e.prototype.maxPoolPositions=function(n,r){for(var i=xe(r.outShape,"int32"),o=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,d=r.padInfo.top,h=r.padInfo.left,f=this.bufferSync(n),m=0;m<r.batchSize;++m)for(var p=0;p<r.inChannels;++p)for(var v=0;v<r.outHeight;++v){for(var g=v*o-d,x=g;x<0;)x+=s;for(var w=Math.min(r.inHeight,l+g),b=0;b<r.outWidth;++b){for(var k=b*a-h,_=k;_<0;)_+=u;for(var S=Math.min(r.inWidth,c+k),C=Number.NEGATIVE_INFINITY,E=-1,R=x;R<w;R+=s)for(var D=R-g,P=_;P<S;P+=u){var F=P-k,U=f.get(m,R,P,p);U>C&&(C=U,E=D*c+F)}i.set(E,m,v,b,p)}}return i.toTensor()},e.prototype.maxPoolBackprop=function(n,r,i,o){H([r,i],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,o),s=o.strideHeight,u=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,d=o.effectiveFilterHeight,h=o.effectiveFilterWidth,f=h-1-o.padInfo.left,m=d-1-o.padInfo.top,p=xe(r.shape,"float32"),v=this.bufferSync(a),g=this.bufferSync(n),x=0;x<o.batchSize;++x)for(var w=0;w<o.inChannels;++w)for(var b=0;b<o.inHeight;++b)for(var k=0;k<o.inWidth;++k){for(var _=b-m,S=k-f,C=0,E=0;E<d;E+=l){var R=(_+E)/s;if(!(R<0||R>=o.outHeight||Math.floor(R)!==R))for(var D=0;D<h;D+=c){var P=(S+D)/u;if(!(P<0||P>=o.outWidth||Math.floor(P)!==P)){var F=d*h-1-v.get(x,R,P,w)===E*h+D?1:0;F!==0&&(C+=g.get(x,R,P,w)*F)}}}p.set(C,x,b,k,w)}return p.toTensor()},e.prototype.avgPoolBackprop=function(n,r,i){H([n,r],"avgPoolBackprop");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=i.dilationHeight,c=i.dilationWidth,d=i.effectiveFilterHeight,h=i.effectiveFilterWidth,f=h-1-i.padInfo.left,m=d-1-i.padInfo.top,p=xe(r.shape,"float32"),v=1/(s*u),g=this.bufferSync(n),x=0;x<i.batchSize;++x)for(var w=0;w<i.inChannels;++w)for(var b=0;b<i.inHeight;++b)for(var k=0;k<i.inWidth;++k){for(var _=b-m,S=k-f,C=0,E=0;E<d;E+=l){var R=(_+E)/o;if(!(R<0||R>=i.outHeight||Math.floor(R)!==R))for(var D=0;D<h;D+=c){var P=(S+D)/a;P<0||P>=i.outWidth||Math.floor(P)!==P||(C+=g.get(x,R,P,w))}}p.set(C*v,x,b,k,w)}return p.toTensor()},e.prototype.pool3d=function(n,r,i){H(n,"pool3d");for(var o=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=r.padInfo.front,p=r.padInfo.top,v=r.padInfo.left,g=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=this.readSync(n.dataId),w=xe(r.outShape,n.dtype),b=w.values,k=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],S=r.outShape[3]*r.outShape[4],C=r.outShape[4],E=0;E<r.batchSize;++E)for(var R=E*k,D=E*n.strides[0],P=0;P<r.inChannels;++P)for(var F=0;F<r.outDepth;++F){for(var U=F*o-m,z=U;z<0;)z+=u;for(var W=Math.min(r.inDepth,d+U),L=R+F*_,I=0;I<r.outHeight;++I){for(var j=I*a-p,B=j;B<0;)B+=l;for(var K=Math.min(r.inHeight,h+j),X=L+I*S,Y=0;Y<r.outWidth;++Y){for(var ie=Y*s-v,fe=ie;fe<0;)fe+=c;for(var pe=Math.min(r.inWidth,f+ie),ce=X+Y*C,Ce=g,ke=0,Be=0,_e=z;_e<W;_e+=u){for(var Te=D+_e*n.strides[1],De=B;De<K;De+=l){for(var ut=Te+De*n.strides[2],Je=fe;Je<pe;Je+=c){var Qe=x[ut+Je*n.strides[3]+P];if(i==="max"&&Qe>Ce?Ce=Qe:i==="avg"&&(ke+=Qe,Be++),isNaN(Ce))break}if(isNaN(Ce))break}if(isNaN(Ce))break}b[ce+P]=i==="avg"?ke/Be:Ce}}}return w.toTensor()},e.prototype.avgPool3d=function(n,r){return H(n,"avgPool3d"),this.pool3d(n,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(n,r,i){H([n,r],"avgPool3dBackprop");for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,d=i.dilationDepth,h=i.dilationHeight,f=i.dilationWidth,m=i.effectiveFilterDepth,p=i.effectiveFilterHeight,v=i.effectiveFilterWidth,g=m-1-i.padInfo.front,x=v-1-i.padInfo.left,w=p-1-i.padInfo.top,b=xe(r.shape,"float32"),k=1/(u*l*c),_=this.bufferSync(n),S=0;S<i.batchSize;++S)for(var C=0;C<i.inChannels;++C)for(var E=0;E<i.inDepth;++E)for(var R=0;R<i.inHeight;++R)for(var D=0;D<i.inWidth;++D){for(var P=E-g,F=R-w,U=D-x,z=0,W=0;W<m;W+=d){var L=(P+W)/o;if(!(L<0||L>=i.outDepth||Math.floor(L)!==L))for(var I=0;I<p;I+=h){var j=(F+I)/a;if(!(j<0||j>=i.outHeight||Math.floor(j)!==j))for(var B=0;B<v;B+=f){var K=(U+B)/s;K<0||K>=i.outWidth||Math.floor(K)!==K||(z+=_.get(S,L,j,K,C))}}}b.set(z*k,S,E,R,D,C)}return b.toTensor()},e.prototype.maxPool3d=function(n,r){return H(n,"maxPool3d"),this.pool3d(n,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(n,r){for(var i=xe(r.outShape,"int32"),o=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,d=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=r.padInfo.front,p=r.padInfo.top,v=r.padInfo.left,g=this.bufferSync(n),x=0;x<r.batchSize;++x)for(var w=0;w<r.inChannels;++w)for(var b=0;b<r.outDepth;++b){for(var k=b*o-m,_=k;_<0;)_+=u;for(var S=Math.min(r.inDepth,d+k),C=0;C<r.outHeight;++C){for(var E=C*a-p,R=E;R<0;)R+=l;for(var D=Math.min(r.inHeight,h+E),P=0;P<r.outWidth;++P){for(var F=P*s-v,U=F;U<0;)U+=c;for(var z=Math.min(r.inWidth,f+F),W=Number.NEGATIVE_INFINITY,L=-1,I=_;I<S;I+=u)for(var j=I-k,B=R;B<D;B+=l)for(var K=B-E,X=U;X<z;X+=c){var Y=X-F,ie=g.get(x,I,B,X,w);ie>=W&&(W=ie,L=j*h*f+K*h+Y)}i.set(L,x,b,C,P,w)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(n,r,i,o){H([r,i],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,o),s=o.strideDepth,u=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,d=o.dilationHeight,h=o.dilationWidth,f=o.effectiveFilterDepth,m=o.effectiveFilterHeight,p=o.effectiveFilterWidth,v=f-1-o.padInfo.front,g=p-1-o.padInfo.left,x=m-1-o.padInfo.top,w=xe(r.shape,"float32"),b=this.bufferSync(a),k=this.bufferSync(n),_=0;_<o.batchSize;++_)for(var S=0;S<o.inChannels;++S)for(var C=0;C<o.inDepth;++C)for(var E=0;E<o.inHeight;++E)for(var R=0;R<o.inWidth;++R){for(var D=C-v,P=E-x,F=R-g,U=0,z=0;z<f;z+=c){var W=(D+z)/s;if(!(W<0||W>=o.outDepth||Math.floor(W)!==W))for(var L=0;L<m;L+=d){var I=(P+L)/u;if(!(I<0||I>=o.outHeight||Math.floor(I)!==I))for(var j=0;j<p;j+=h){var B=(F+j)/l;if(!(B<0||B>=o.outWidth||Math.floor(B)!==B)){var K=f*m*p-1-b.get(_,W,I,B,S)===z*m*p+L*p+j?1:0;K!==0&&(U+=k.get(_,W,I,B,S)*K)}}}}w.set(U,_,C,E,R,S)}return w.toTensor()},e.prototype.cast=function(n,r){return zE(n,r,this)},e.prototype.reshape=function(n,r){return gg(n,r)},e.prototype.avgPool=function(n,r){return H(n,"avgPool"),this.pool(n,r,"avg").toFloat()},e.prototype.resizeBilinear=function(n,r,i,o){H(n,"resizeBilinear");for(var a=n.shape,s=a[0],u=a[1],l=a[2],c=a[3],d=this.readSync(n.dataId),h=new Float32Array(oe([s,r,i,c])),f=[o&&r>1?u-1:u,o&&i>1?l-1:l],m=[o&&r>1?r-1:r,o&&i>1?i-1:i],p=0,v=f[0]/m[0],g=f[1]/m[1],x=0;x<s;x++)for(var w=0;w<r;w++)for(var b=v*w,k=Math.floor(b),_=b-k,S=Math.min(u-1,Math.ceil(b)),C=x*n.strides[0]+k*n.strides[1],E=x*n.strides[0]+S*n.strides[1],R=0;R<i;R++)for(var D=g*R,P=Math.floor(D),F=D-P,U=Math.min(l-1,Math.ceil(D)),z=C+P*n.strides[2],W=E+P*n.strides[2],L=C+U*n.strides[2],I=E+U*n.strides[2],j=0;j<c;j++){var B=d[z+j],K=d[W+j],X=B+(d[L+j]-B)*F,Y=X+(K+(d[I+j]-K)*F-X)*_;h[p++]=Y}return Bt(h,[s,r,i,c])},e.prototype.resizeBilinearBackprop=function(n,r,i){H([n,r],"resizeBilinearBackprop");for(var o=r.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=n.shape,d=c[1],h=c[2],f=new Float32Array(a*s*u*l),m=[i&&d>1?s-1:s,i&&h>1?u-1:u],p=[i&&d>1?d-1:d,i&&h>1?h-1:h],v=m[0]/p[0],g=m[1]/p[1],x=this.readSync(n.dataId),w=0,b=0;b<a;b++)for(var k=b*r.strides[0],_=0;_<d;_++)for(var S=_*v,C=Math.floor(S),E=Math.min(Math.ceil(S),s-1),R=k+C*r.strides[1],D=k+E*r.strides[1],P=S-C,F=1-P,U=0;U<h;U++)for(var z=U*g,W=Math.floor(z),L=Math.min(Math.ceil(z),u-1),I=z-W,j=1-I,B=R+W*r.strides[2],K=R+L*r.strides[2],X=D+W*r.strides[2],Y=D+L*r.strides[2],ie=F*j,fe=F*I,pe=P*j,ce=P*I,Ce=0;Ce<l;Ce++){var ke=x[w++];f[B+Ce]+=ke*ie,f[K+Ce]+=ke*fe,f[X+Ce]+=ke*pe,f[Y+Ce]+=ke*ce}return cn(f,[a,u,s,l],r.dtype)},e.prototype.resizeNearestNeighbor=function(n,r,i,o){H(n,"resizeNearestNeighbor");for(var a=n.shape,s=a[0],u=a[1],l=a[2],c=a[3],d=this.readSync(n.dataId),h=new Float32Array(s*r*i*c),f=[o&&r>1?u-1:u,o&&i>1?l-1:l],m=[o&&r>1?r-1:r,o&&i>1?i-1:i],p=f[0]/m[0],v=f[1]/m[1],g=0,x=0;x<s;x++)for(var w=x*n.strides[0],b=0;b<r;b++)for(var k=p*b,_=w+Math.min(u-1,o?Math.round(k):Math.floor(k))*n.strides[1],S=0;S<i;S++)for(var C=v*S,E=_+Math.min(l-1,o?Math.round(C):Math.floor(C))*n.strides[2],R=0;R<c;R++){var D=d[E+R];h[g++]=D}return Bt(h,[s,r,i,c],n.dtype)},e.prototype.resizeNearestNeighborBackprop=function(n,r,i){H([n,r],"resizeNearestNeighborBackprop");for(var o=r.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=n.shape,d=c[1],h=c[2],f=new Float32Array(a*s*u*l),m=this.readSync(n.dataId),p=[i&&d>1?s-1:s,i&&h>1?u-1:u],v=[i&&d>1?d-1:d,i&&h>1?h-1:h],g=p[0]/v[0],x=p[1]/v[1],w=1/g,b=1/x,k=2*Math.ceil(w)+2,_=2*Math.ceil(b)+2,S=0;S<a;S++)for(var C=S*r.strides[0],E=0;E<s;E++)for(var R=C+E*r.strides[1],D=Math.floor(E*w),P=Math.floor(D-k/2),F=0;F<u;F++)for(var U=R+F*r.strides[2],z=Math.floor(F*b),W=Math.floor(z-_/2),L=0;L<l;L++){for(var I=0,j=0;j<k;j++){var B=j+P;if(!(B<0||B>=d)){var K=C+B*n.strides[1],X=B*g;if(E===Math.min(s-1,i?Math.round(X):Math.floor(X)))for(var Y=0;Y<_;Y++){var ie=Y+W;if(!(ie<0||ie>=h)){var fe=K+ie*n.strides[2],pe=ie*x;F===Math.min(u-1,i?Math.round(pe):Math.floor(pe))&&(I+=m[fe+L])}}}}f[U+L]=I}return cn(f,r.shape,r.dtype)},e.prototype.batchNormalization=function(n,r,i,o,a,s){H([n,r,i,a,s],"batchNorm");for(var u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=this.readSync(i.dataId),d=a?this.readSync(a.dataId):new Float32Array([1]),h=s?this.readSync(s.dataId):new Float32Array([0]),f=new Float32Array(u.length),m=h.length,p=d.length,v=c.length,g=l.length,x=0,w=0,b=0,k=0,_=0;_<u.length;++_)f[_]=h[x++]+(u[_]-l[w++])*d[b++]/Math.sqrt(c[k++]+o),x>=m&&(x=0),w>=g&&(w=0),b>=p&&(b=0),k>=v&&(k=0);return cn(f,n.shape)},e.prototype.localResponseNormalization4D=function(n,r,i,o,a){H(n,"localResponseNormalization4D");var s=n.shape[3],u=s-1,l=this.readSync(n.dataId),c=n.size,d=new Float32Array(c);function h(v){for(var g=v%s,x=v-g+Math.max(0,g-r),w=v-g+Math.min(g+r,u),b=0;x<=w;x++){var k=l[x];b+=k*k}return b}for(var f=0;f<c;f++){var m=h(f),p=l[f]*Math.pow(i+o*m,-a);d[f]=p}return cn(d,n.shape)},e.prototype.LRNGrad=function(n,r,i,o,a,s,u){H(n,"LRNGrad");for(var l=n.shape[3],c=this.readSync(n.dataId),d=this.readSync(r.dataId),h=this.readSync(i.dataId),f=new Float32Array(n.size),m=n.size,p=0;p<m;p++){for(var v=p%l,g=p-v+Math.max(0,v-o),x=p-v+Math.min(l,v+o+1),w=0,b=g;b<x;b++)w+=Math.pow(d[b],2);for(w=s*w+a,b=g;b<x;b++){var k=-2*s*u*d[b]*h[p]/w;p===b&&(k+=Math.pow(w,-u)),k*=c[p],f[b]+=k}}return cn(f,n.shape)},e.prototype.multinomial=function(n,r,i,o){H(n,"multinomial");for(var a=r?n:yi(n),s=a.shape[0],u=a.shape[1],l=Ge([s,i],"int32"),c=this.readSync(l.dataId),d=this.readSync(a.dataId),h=0;h<s;++h){var f=h*u,m=new Float32Array(u-1);m[0]=d[f];for(var p=1;p<m.length;++p)m[p]=m[p-1]+d[f+p];for(var v=Th(o.toString()),g=h*i,x=0;x<i;++x){var w=v();c[g+x]=m.length;for(var b=0;b<m.length;b++)if(w<m[b]){c[g+x]=b;break}}}return l},e.prototype.oneHot=function(n,r,i,o){H(n,"oneHot");var a=new Float32Array(n.size*r);a.fill(o);for(var s=this.readSync(n.dataId),u=0;u<n.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=i);return qi(a,[n.size,r],"int32")},e.prototype.nonMaxSuppression=function(n,r,i,o,a){return H(n,"nonMaxSuppression"),Xy(this.readSync(n.dataId),this.readSync(r.dataId),i,o,a)},e.prototype.fft=function(n){return this.fftBatch(n,!1)},e.prototype.ifft=function(n){return this.fftBatch(n,!0)},e.prototype.fftBatch=function(n,r){for(var i=n.shape[0],o=n.shape[1],a=xe(n.shape,"float32"),s=xe(n.shape,"float32"),u=$n(n).as2D(i,o),l=Ir(n).as2D(i,o),c=0;c<i;c++)for(var d=u.slice([c,0],[1,o]),h=l.slice([c,0],[1,o]),f=Ft(d,h),m=this.readSync(this.fftImpl(f,r).dataId),p=0;p<o;p++){var v=c1(m,p);a.values[c*o+p]=v.real,s.values[c*o+p]=v.imag}return Ft(a.toTensor(),s.toTensor()).as2D(i,o)},e.prototype.fftImpl=function(n,r){var i=n.as1D(),o=i.size;if(this.isExponentOf2(o)){var a=this.fftRadix2(i,o,r).as2D(n.shape[0],n.shape[1]);return r&&(a=Ft($n(a).div(J(o)),Ir(a).div(J(o)))),a}var s=this.readSync(n.dataId),u=function(l){for(var c=new Float32Array(l.length/2),d=new Float32Array(l.length/2),h=0;h<l.length;h+=2)c[h/2]=l[h],d[h/2]=l[h+1];return{real:c,imag:d}}(this.fourierTransformByMatmul(s,o,r));return Ft(u.real,u.imag).as2D(n.shape[0],n.shape[1])},e.prototype.isExponentOf2=function(n){return(n&n-1)==0},e.prototype.fftRadix2=function(n,r,i){if(r===1)return n;var o=this.readSync(n.dataId),a=r/2,s=function(g){for(var x=Math.ceil(g.length/4),w=new Float32Array(x),b=new Float32Array(x),k=0;k<g.length;k+=4)w[Math.floor(k/4)]=g[k],b[Math.floor(k/4)]=g[k+1];return{real:w,imag:b}}(o),u=Ft(s.real,s.imag).as1D(),l=function(g){for(var x=Math.floor(g.length/4),w=new Float32Array(x),b=new Float32Array(x),k=2;k<g.length;k+=4)w[Math.floor(k/4)]=g[k],b[Math.floor(k/4)]=g[k+1];return{real:w,imag:b}}(o),c=Ft(l.real,l.imag).as1D();u=this.fftRadix2(u,a,i),c=this.fftRadix2(c,a,i);var d=function(g,x){for(var w=new Float32Array(g/2),b=new Float32Array(g/2),k=0;k<Math.ceil(g/2);k++){var _=(x?2:-2)*Math.PI*(k/g);w[k]=Math.cos(_),b[k]=Math.sin(_)}return{real:w,imag:b}}(r,i),h=Ft(d.real,d.imag).mul(c),f=u.add(h),m=u.sub(h),p=$n(f).concat($n(m)),v=Ir(f).concat(Ir(m));return Ft(p,v).as1D()},e.prototype.fourierTransformByMatmul=function(n,r,i){for(var o=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,l=0;l<r;l++){var c=uz(a*l,r,i),d=c1(n,l);s+=d.real*c.real-d.imag*c.imag,u+=d.real*c.imag+d.imag*c.real}i&&(s/=r,u/=r),sz(o,s,u,a)}return o},e.prototype.depthToSpace=function(n,r,i){T(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),T(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var o=n.shape[0],a=n.shape[1],s=n.shape[2],u=n.shape[3],l=a*r,c=s*r,d=u/(r*r),h=this.readSync(n.dataId),f=new Float32Array(o*l*c*d),m=0,p=0;p<o;++p)for(var v=0;v<l;++v)for(var g=Math.floor(v/r),x=v%r,w=0;w<c;++w)for(var b=Math.floor(w/r),k=(x*r+w%r)*d,_=0;_<d;++_){var S=_+k+u*(b+s*(g+a*p));f[m++]=h[S]}return cn(f,[o,l,c,d])},e.prototype.broadcastedBinaryOp=function(n,r,i,o){var a=Ae(n.shape,r.shape),s=xe(a,i),u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=Fi(n.shape,a),d=Fi(r.shape,a),h=s.values;if(c.length+d.length===0)for(var f=0;f<h.length;++f)h[f]=o(u[f%u.length],l[f%l.length]);else{var m=this.bufferSync(n),p=this.bufferSync(r),v=function(g){var x=s.indexToLoc(g),w=x.slice(-n.rank);c.forEach(function(S){return w[S]=0});var b=m.locToIndex(w),k=x.slice(-r.rank);d.forEach(function(S){return k[S]=0});var _=p.locToIndex(k);h[g]=o(u[b],l[_])};for(f=0;f<h.length;++f)v(f)}return s.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(n,r,i){var o=Ae(n.shape,r.shape),a=xe(o,"float32"),s=xe(o,"float32"),u=this.readSync(n.dataId),l=this.readSync(r.dataId),c=Fi(n.shape,o),d=Fi(r.shape,o),h=a.values,f=s.values;if(c.length+d.length===0)for(var m=0;m<h.length;m++){var p=m%u.length,v=m%l.length,g=i(u[2*p],u[2*p+1],l[2*v],l[2*v+1]);h[m]=g.real,f[m]=g.imag}else{var x=this.bufferSync(this.data.get(n.dataId).complexTensors.real),w=this.bufferSync(this.data.get(r.dataId).complexTensors.real),b=function(k){var _=a.indexToLoc(k),S=_.slice(-n.rank);c.forEach(function(P){return S[P]=0});var C=x.locToIndex(S),E=_.slice(-r.rank);d.forEach(function(P){return E[P]=0});var R=w.locToIndex(E),D=i(u[2*C],u[2*C+1],l[2*R],l[2*R+1]);h[k]=D.real,f[k]=D.imag};for(m=0;m<h.length;m++)b(m)}return this.complex(a.toTensor(),s.toTensor())},e.prototype.split=function(n,r,i){return WE(n,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(n,r,i,o,a,s){for(var u=n.shape,l=u[0],c=u[1],d=u[2],h=u[3],f=r.shape[0],m=o[0],p=o[1],v=xe([f,m,p,h],"float32"),g=this.readSync(r.dataId),x=this.readSync(i.dataId),w=this.readSync(n.dataId),b=n.strides,k=v.strides,_=0;_<f;_++){var S=4*_,C=g[S],E=g[S+1],R=g[S+2],D=g[S+3],P=x[_];if(!(P>=l))for(var F=m>1?(R-C)*(c-1)/(m-1):0,U=p>1?(D-E)*(d-1)/(p-1):0,z=0;z<m;z++){var W=m>1?C*(c-1)+z*F:.5*(C+R)*(c-1);if(W<0||W>c-1)for(var L=0;L<p;L++)for(var I=0;I<h;I++){var j=I+L*k[2]+z*k[1]+_*k[0];v.values[j]=s}else if(a==="bilinear"){var B=Math.floor(W),K=Math.ceil(W),X=W-B;for(L=0;L<p;L++)if((_e=p>1?E*(d-1)+L*U:.5*(E+D)*(d-1))<0||_e>d-1)for(I=0;I<h;I++)j=I+L*k[2]+z*k[1]+_*k[0],v.values[j]=s;else{var Y=Math.floor(_e),ie=Math.ceil(_e),fe=_e-Y;for(I=0;I<h;I++){var pe=w[j=I+Y*b[2]+B*b[1]+P*b[0]],ce=w[j=I+ie*b[2]+B*b[1]+P*b[0]],Ce=w[j=I+Y*b[2]+K*b[1]+P*b[0]],ke=pe+(ce-pe)*fe,Be=Ce+(w[j=I+ie*b[2]+K*b[1]+P*b[0]]-Ce)*fe;j=I+L*k[2]+z*k[1]+_*k[0],v.values[j]=ke+(Be-ke)*X}}}else for(L=0;L<p;++L){var _e;if((_e=p>1?E*(d-1)+L*U:.5*(E+D)*(d-1))<0||_e>d-1)for(I=0;I<h;I++)j=I+L*k[2]+z*k[1]+_*k[0],v.values[j]=s;else{var Te=Math.round(_e),De=Math.round(W);for(I=0;I<h;I++){var ut=I+Te*b[2]+De*b[1]+P*b[0],Je=I+L*k[2]+z*k[1]+_*k[0];v.values[Je]=w[ut]}}}}}return v.toTensor()},e.prototype.sparseToDense=function(n,r,i,o){var a=Vd(0,n,i),s=a.sliceRank,u=a.numUpdates,l=a.sliceSize,c=a.strides,d=a.outputSize;return this.scatter(n,r,i,d,l,u,s,c,o,!1)},e.prototype.gatherND=function(n,r){var i=r.shape,o=i[i.length-1],a=ME(n,r),s=a[0],u=a[1],l=a[2],c=a[3];if(u===0)return Bt([],s,n.dtype);for(var d=new rl([u,l],n.dtype),h=this.readSync(r.dataId),f=this.readSync(n.dataId),m=0;m<u;m++){for(var p=[],v=0,g=0;g<o;g++){var x=h[m*o+g];v+=x*c[g],p.push(x)}if(v<0||v>=n.size/l)throw new Error("Invalid indices: "+p+" does not index into "+n.shape);for(var w=0;w<l;w++)d.values[m*l+w]=f[v*l+w]}return d.toTensor().reshape(s)},e.prototype.scatterND=function(n,r,i){var o=Vd(0,n,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,d=J(0);return this.scatter(n,r,i,c,u,s,a,l,d,!0)},e.prototype.fill=function(n,r,i){var o=Td(i=i||_l(r),oe(n));return o.fill(r),O.makeTensor(o,n,i,this)},e.prototype.onesLike=function(n){if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(n.shape,1,n.dtype)},e.prototype.zerosLike=function(n){var r=Td(n.dtype,oe(n.shape));return this.makeOutput(r,n.shape,n.dtype)},e.prototype.linspace=function(n,r,i){return UE(n,r,i)},e.prototype.scatter=function(n,r,i,o,a,s,u,l,c,d){var h=[o/a,a],f=this.readSync(n.dataId),m=this.readSync(r.dataId);if(o===0)return Bt([],i,r.dtype);var p=new rl(h,r.dtype);p.values.fill(this.readSync(c.dataId)[0]);for(var v=0;v<s;v++){for(var g=[],x=0,w=0;w<u;w++){var b=f[v*u+w];g.push(b),x+=b*l[w]}if(x<0||x>=o/a)throw new Error("Invalid indices: "+g+" does not index into "+i);for(var k=0;k<a;k++)d?p.values[x*a+k]+=m[v*a+k]:p.values[x*a+k]=r.rank===0?m[0]:m[v*a+k]}return p.toTensor().reshape(i)},e}(BE);O.registerBackend("cpu",function(){return new RW},1);for(var mp=0,I1=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,i=e,o=i.boxes,a=i.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,d=s.softNmsSigma,h=n;H(o,"NonMaxSuppressionWithScore");var f=Yy(h.data.get(o.dataId).values,h.data.get(a.dataId).values,u,l,c,d);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,i=n;H(r,"square");for(var o=i.data.get(r.dataId).values,a=new Float32Array(o.length),s=0;s<o.length;++s){var u=o[s];a[s]=u*u}return{dataId:i.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:al,backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,i=r.a,o=r.b,a=n;H([i,o],al);var s=a.data.get(i.dataId).values,u=a.data.get(o.dataId).values,l=function(h,f,m,p,v,g){var x=Ae(h,f),w=x.length,b=Br(x),k=nl(v,oe(x)),_=h.length,S=f.length,C=Br(h),E=Br(f),R=Fi(h,x),D=Fi(f,x);if(R.length+D.length===0)for(var P=0;P<k.length;++P)k[P]=g(m[P%m.length],p[P%p.length]);else{var F=function(U){var z=L5(U,w,b),W=z.slice(-_);R.forEach(function(B){return W[B]=0});var L=t1(W,_,C),I=z.slice(-S);D.forEach(function(B){return I[B]=0});var j=t1(I,S,E);k[U]=g(m[L],p[j])};for(P=0;P<k.length;++P)F(P)}return[k,x]}(i.shape,o.shape,s,u,i.dtype,function(h,f){var m=h-f;return m*m}),c=l[0],d=l[1];return{dataId:a.write(c,d,i.dtype),shape:d,dtype:i.dtype}}}];mp<I1.length;mp++)fE(I1[mp]);var da,NW=function(t){this.variableNames=["A"];var e=qt(),n=t[0],r=t[1];this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+n+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},TW=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=qt(),n=t[0],r=t[1];this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+n+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `};for(var gp=0,D1=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,i=e.pixels,o=r.numChannels,a=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,u=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],l=u[0],c=u[1],d=[c,l],h=[c,l,o];(s||a)&&(da==null&&(da=document.createElement("canvas").getContext("2d")),da.canvas.width=l,da.canvas.height=c,da.drawImage(i,0,0,l,c),i=da.canvas);var f=n.makeTensorInfo(d,"int32");n.texData.get(f.dataId).usage=Rn.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),i);var m=G().getBool("WEBGL_PACK")?new TW(h):new NW(h),p=n.runWebGLProgram(m,[f],"int32");return n.disposeData(f.dataId),p}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs;Md("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,o=i.boxes,a=i.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,d=s.softNmsSigma,h=n,f=Yy(h.readSync(o.dataId),h.readSync(a.dataId),u,l,c,d);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,i=n,o=new be(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:al,backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,i=r.a,o=r.b,a=n,s=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ei("return (a - b) * (a - b);",i.shape,o.shape):new lt("return (a - b) * (a - b);",i.shape,o.shape);return a.compileAndRun(s,[i,o])}}];gp<D1.length;gp++)fE(D1[gp]);for(var vp=0,M1=[{kernelName:"Square",gradFunc:function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().mul(2))}}}},{kernelName:al,gradFunc:function(t,e){var n=e[0],r=e[1],i=J(2);return{a:function(){return Jt(t,Jt(i,At(n,r)))},b:function(){return Jt(t,Jt(i,At(r,n)))}}}}];vp<M1.length;vp++)A5(M1[vp]);var PW=function(){function t(){}return t.prototype.fetch=function(e,n){return fetch(e,n)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+n);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},t.prototype.decode=function(e,n){return new TextDecoder(n).decode(e)},t}();G().get("IS_BROWSER")&&G().setPlatform("browser",new PW);var yp,IW=function(){return require("node-fetch")},DW=function(){function t(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(e,n){return G().global.fetch!=null?G().global.fetch(e,n):(yp==null&&(yp=IW()),yp(e,n))},t.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},t.prototype.encode=function(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+n);return this.textEncoder.encode(e)},t.prototype.decode=function(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)},t}();G().get("IS_NODE")&&G().setPlatform("node",new DW);var xg={float32:4,int32:4,uint16:2,uint8:1,bool:1},Kd=4;function jA(t,e){for(var n={},r=0,i=function(s){var u=s.name,l=s.dtype,c=s.shape,d=oe(c),h=void 0;if("quantization"in s){var f=s.quantization;if(f.dtype!=="uint8"&&f.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+f.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var m=xg[f.dtype],p=t.slice(r,r+d*m),v=f.dtype==="uint8"?new Uint8Array(p):new Uint16Array(p);if(l==="float32")h=Float32Array.from(v,function(_){return _*f.scale+f.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);h=Int32Array.from(v,function(_){return Math.round(_*f.scale+f.min)})}r+=d*m}else if(l==="string"){var g=oe(s.shape);h=[];for(var x=0;x<g;x++){var w=new Uint32Array(t.slice(r,r+Kd))[0];r+=Kd;var b=new Uint8Array(t.slice(r,r+w));h.push(b),r+=w}}else{var k=xg[l];if(p=t.slice(r,r+d*k),l==="float32")h=new Float32Array(p);else if(l==="int32")h=new Int32Array(p);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);h=new Uint8Array(p)}r+=d*k}n[u]=Bt(h,c,l)},o=0,a=e;o<a.length;o++)i(a[o]);return n}function MW(t){if(t===null)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach(function(o){if(e+=o.byteLength,n.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var r=new Uint8Array(e),i=0;return n.forEach(function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),r.buffer}var wg=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function O1(t){return wg?Buffer.byteLength(t):new Blob([t]).size}function m0(t){var e=0;t.forEach(function(i){e+=i.byteLength});var n=new Uint8Array(e),r=0;return t.forEach(function(i){n.set(new Uint8Array(i),r),r+=i.byteLength}),n.buffer}function j1(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function Tl(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:O1(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:O1(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}var Nn=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return t.instance==null&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var i=[];return(n==="load"?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(o){var a=o(e,r);a!==null&&i.push(a)}),i},t}(),es="://",Xi=function(){function t(){this.managers={}}return t.getInstance=function(){return t.instance==null&&(t.instance=new t),t.instance},t.registerManager=function(e,n){T(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(es)&&(e=e.slice(0,e.indexOf(es))),T(e.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();T(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=n},t.getManager=function(e){var n=this.getInstance().managers[e];if(n==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return n},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function Xc(t){if(t.indexOf(es)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Xi.getSchemes().join(","));return{scheme:t.split(es)[0],path:t.split(es)[1]}}function F1(t,e,n){return n===void 0&&(n=!1),ne(this,void 0,void 0,function(){var r,i,o,a,s,u,l,c,d;return re(this,function(h){switch(h.label){case 0:return T(t!==e,function(){return"Old path and new path are the same: '"+t+"'"}),T((r=Nn.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),T(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),i=r[0],T((o=Nn.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),T(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),a=o[0],s=Xc(t).scheme,u=Xc(t).path,l=s===Xc(t).scheme,[4,i.load()];case 1:return c=h.sent(),n&&l?[4,Xi.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,a.save(c)];case 4:return d=h.sent(),!n||l?[3,6]:[4,Xi.getManager(s).removeModel(u)];case 5:h.sent(),h.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var Mo="models_store",Li="model_info_store";function FA(){if(!G().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function bg(t){var e=t.result;e.createObjectStore(Mo,{keyPath:"modelPath"}),e.createObjectStore(Li,{keyPath:"modelPath"})}var ts=function(){function t(e){if(this.indexedDB=FA(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return t.prototype.save=function(e){return ne(this,void 0,void 0,function(){return re(this,function(n){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},t.prototype.load=function(){return ne(this,void 0,void 0,function(){return re(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(e,n){var r=this;return new Promise(function(i,o){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return bg(a)},a.onsuccess=function(){var s=a.result;if(n==null){var u=s.transaction(Mo,"readonly"),l=u.objectStore(Mo).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(p){return s.close(),o(l.error)},u.oncomplete=function(){return s.close()}}else{var c,d=Tl(n),h=s.transaction(Li,"readwrite"),f=h.objectStore(Li),m=f.put({modelPath:r.modelPath,modelArtifactsInfo:d});m.onsuccess=function(){var p=(c=s.transaction(Mo,"readwrite")).objectStore(Mo).put({modelPath:r.modelPath,modelArtifacts:n,modelArtifactsInfo:d});p.onsuccess=function(){return i({modelArtifactsInfo:d})},p.onerror=function(v){var g=(f=h.objectStore(Li)).delete(r.modelPath);g.onsuccess=function(){return s.close(),o(p.error)},g.onerror=function(x){return s.close(),o(p.error)}}},m.onerror=function(p){return s.close(),o(m.error)},h.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return o(a.error)}})},t.URL_SCHEME="indexeddb://",t}(),L1=function(t){return G().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(ts.URL_SCHEME)?(e=t.slice(ts.URL_SCHEME.length),new ts(e)):null;var e};Nn.registerSaveRouter(L1),Nn.registerLoadRouter(L1);var OW=function(){function t(){this.indexedDB=FA()}return t.prototype.listModels=function(){return ne(this,void 0,void 0,function(){var e=this;return re(this,function(n){return[2,new Promise(function(r,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return bg(o)},o.onsuccess=function(){var a=o.result,s=a.transaction(Li,"readonly"),u=s.objectStore(Li).getAll();u.onsuccess=function(){for(var l={},c=0,d=u.result;c<d.length;c++){var h=d[c];l[h.modelPath]=h.modelArtifactsInfo}r(l)},u.onerror=function(l){return a.close(),i(u.error)},s.oncomplete=function(){return a.close()}},o.onerror=function(a){return i(o.error)}})]})})},t.prototype.removeModel=function(e){return ne(this,void 0,void 0,function(){var n=this;return re(this,function(r){var i;return e=(i=e).startsWith(ts.URL_SCHEME)?i.slice(ts.URL_SCHEME.length):i,[2,new Promise(function(o,a){var s=n.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return bg(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction(Li,"readwrite"),d=c.objectStore(Li),h=d.get(e);h.onsuccess=function(){if(h.result==null)return l.close(),a(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var f=d.delete(e),m=function(){var p=(u=l.transaction(Mo,"readwrite")).objectStore(Mo).delete(e);p.onsuccess=function(){return o(h.result.modelArtifactsInfo)},p.onerror=function(v){return a(h.error)}};f.onsuccess=m,f.onerror=function(p){return m(),l.close(),a(h.error)}},h.onerror=function(f){return l.close(),a(h.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return a(s.error)}})]})})},t}();if(G().getBool("IS_BROWSER"))try{Xi.registerManager(ts.URL_SCHEME,new OW)}catch{}var ii="/",ka="tensorflowjs_models",LA="info",jW="model_topology",FW="weight_specs",LW="weight_data",BW="model_metadata";function BA(t){return{info:[ka,t,LA].join(ii),topology:[ka,t,jW].join(ii),weightSpecs:[ka,t,FW].join(ii),weightData:[ka,t,LW].join(ii),modelMetadata:[ka,t,BW].join(ii)}}function VW(t){var e=t.split(ii);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(ii)}var ns=function(){function t(e){if(!G().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=BA(this.modelPath)}return t.prototype.save=function(e){return ne(this,void 0,void 0,function(){var n,r,i;return re(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");n=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=Tl(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(wg)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",l=0,c=s.length;l<c;l++)u+=String.fromCharCode(s[l]);return btoa(u)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return ne(this,void 0,void 0,function(){var e,n,r,i,o,a,s;return re(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(n={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(n.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(n.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(o),n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,n.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return n.weightData=function(l){if(wg){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var d=atob(l),h=new Uint8Array(d.length),f=0;f<d.length;++f)h.set([d.charCodeAt(f)],f);return h.buffer}(s),[2,n]})})},t.URL_SCHEME="localstorage://",t}(),B1=function(t){return G().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(ns.URL_SCHEME)?(e=t.slice(ns.URL_SCHEME.length),new ns(e)):null;var e};Nn.registerSaveRouter(B1),Nn.registerLoadRouter(B1);var zW=function(){function t(){T(G().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),T(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return ne(this,void 0,void 0,function(){var e,n,r,i,o,a;return re(this,function(s){for(e={},n=ka+ii,r=ii+LA,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(n)&&o.endsWith(r)&&(a=VW(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},t.prototype.removeModel=function(e){return ne(this,void 0,void 0,function(){var n,r;return re(this,function(i){var o;if(e=(o=e).startsWith(ns.URL_SCHEME)?o.slice(ns.URL_SCHEME.length):o,n=BA(e),this.LS.getItem(n.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),[2,r]})})},t}();if(G().getBool("IS_BROWSER"))try{Xi.registerManager(ns.URL_SCHEME,new zW)}catch{}var UW="model",$W=".json",WW=".weights.bin";function V1(t){return new Promise(function(e){return setTimeout(e)}).then(t)}var xp=function(){function t(e){if(!G().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),e!=null&&e.length!==0||(e=UW),this.modelTopologyFileName=e+$W,this.weightDataFileName=e+WW}return t.prototype.save=function(e){return ne(this,void 0,void 0,function(){var n,r,i,o,a,s;return re(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(n=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,V1(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,[4,V1(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Tl(e)}]}})})},t.URL_SCHEME="downloads://",t}(),GW=function(){function t(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return t.prototype.load=function(){return ne(this,void 0,void 0,function(){var e,n,r=this;return re(this,function(i){return e=this.files[0],n=this.files.slice(1),[2,new Promise(function(o,a){var s=new FileReader;s.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){n.length===0&&o({modelTopology:c});var d=l.weightsManifest;if(d!=null){var h;try{h=r.checkManifestAndWeightFiles(d,n)}catch(v){return void a(v)}var f=[],m=[],p=[];d.forEach(function(v){v.paths.forEach(function(g){m.push(g),p.push(null)}),f.push.apply(f,v.weights)}),d.forEach(function(v){v.paths.forEach(function(g){var x=new FileReader;x.onload=function(w){var b=w.target.result,k=m.indexOf(g);p[k]=b,p.indexOf(null)===-1&&o({modelTopology:c,weightSpecs:f,weightData:m0(p),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},x.onerror=function(w){return a("Failed to weights data from file of path '"+g+"'.")},x.readAsArrayBuffer(h[g])})})}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(e)})]})})},t.prototype.checkManifestAndWeightFiles=function(e,n){for(var r=[],i=n.map(function(u){return j1(u.name)}),o={},a=0,s=e;a<s.length;a++)s[a].paths.forEach(function(u){var l=j1(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),i.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");o[u]=n[i.indexOf(l)]});if(r.length!==n.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+n.length+").");return o},t}();function z1(t,e,n,r){(function(o){T(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(t),function(o,a){T(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),T(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),T(a>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+a})}(n=n??0,r=r??1);var i=0;return Promise.all(t.map(function(o){return o.then(function(a){var s=n+ ++i/t.length*(r-n);return e(s),a}),o}))}function VA(t,e){return ne(this,void 0,void 0,function(){var n,r,i,o,a,s,u,l,c;return re(this,function(d){switch(d.label){case 0:return e==null&&(e={}),n=e.fetchFunc==null?G().platform.fetch:e.fetchFunc,r=t.map(function(h){return n(h,e.requestInit,{isBinary:!0})}),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=d.sent(),[3,4];case 2:return[4,z1(r,e.onProgress,i,o)];case 3:a=d.sent(),d.label=4;case 4:return s=a.map(function(h){return h.arrayBuffer()}),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=d.sent(),[3,8];case 6:return[4,z1(s,e.onProgress,u,l)];case 7:c=d.sent(),d.label=8;case 8:return[2,c]}})})}function U1(t){var e=this;return function(n,r,i){return r===void 0&&(r=""),ne(e,void 0,void 0,function(){var o,a,s,u,l,c,d,h,f,m;return re(this,function(p){switch(p.label){case 0:if(o=n.map(function(){return!1}),a={},s=i!=null?i.map(function(){return!1}):[],u=[],n.forEach(function(v,g){var x=0;v.weights.forEach(function(w){var b="quantization"in w?w.quantization.dtype:w.dtype,k=xg[b]*oe(w.shape),_=function(){o[g]=!0,a[g]==null&&(a[g]=[]),a[g].push({manifestEntry:w,groupOffset:x,sizeBytes:k})};i!=null?i.forEach(function(S,C){S===w.name&&(_(),s[C]=!0)}):_(),u.push(w.name),x+=k})}),!s.every(function(v){return v}))throw l=i.filter(function(v,g){return!s[g]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=o.reduce(function(v,g,x){return g&&v.push(x),v},[]),d=[],c.forEach(function(v){n[v].paths.forEach(function(g){var x=r+(r.endsWith("/")?"":"/")+g;d.push(x)})}),[4,t(d)];case 1:return h=p.sent(),f={},m=0,c.forEach(function(v){for(var g=n[v].paths.length,x=0,w=0;w<g;w++)x+=h[m+w].byteLength;for(var b=new ArrayBuffer(x),k=new Uint8Array(b),_=0,S=0;S<g;S++){var C=new Uint8Array(h[m+S]);k.set(C,_),_+=C.byteLength}a[v].forEach(function(E){var R=jA(b.slice(E.groupOffset,E.groupOffset+E.sizeBytes),[E.manifestEntry]);for(var D in R)f[D]=R[D]}),m+=g}),[2,f]}})})}}Nn.registerSaveRouter(function(t){return G().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(xp.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new xp(e)}(t.slice(xp.URL_SCHEME.length)):null});var zA=function(){function t(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,n.fetchFunc!=null?(T(typeof n.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=n.fetchFunc):this.fetch=G().platform.fetch,T(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&T(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return t.prototype.save=function(e){return ne(this,void 0,void 0,function(){var n,r,i,o;return re(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},n.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&n.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,n)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:Tl(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},t.prototype.load=function(){return ne(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,l,c,d,h;return re(this,function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,e.json()];case 3:return n=f.sent(),[3,5];case 4:throw f.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=n.modelTopology,o=n.weightsManifest,a=n.generatedBy,s=n.convertedBy,u=n.format,l=n.userDefinedMetadata,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:h=f.sent(),c=h[0],d=h[1],f.label=7;case 7:return[2,{modelTopology:i,weightSpecs:c,weightData:d,userDefinedMetadata:l,generatedBy:a,convertedBy:s,format:u}]}})})},t.prototype.loadWeights=function(e){return ne(this,void 0,void 0,function(){var n,r,i,o,a,s,u,l,c,d,h;return re(this,function(f){switch(f.label){case 0:for(n=Array.isArray(this.path)?this.path[1]:this.path,r=function(m){var p=m.lastIndexOf("/"),v=m.lastIndexOf("?"),g=m.substring(0,p),x=v>p?m.substring(v):"";return[g+"/",x]}(n),i=r[0],o=r[1],a=this.weightPathPrefix||i,s=[],u=0,l=e;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return d=[],e.forEach(function(m){m.paths.forEach(function(p){d.push(a+p+o)})}),[4,VA(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=f.sent(),[2,[s,m0(h)]]}})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function kg(t){return t.match(zA.URL_SCHEME_REGEX)!=null}var $1=function(t,e){return typeof fetch>"u"?null:(Array.isArray(t)?t.every(function(n){return kg(n)}):kg(t))?_g(t,{onProgress:e}):null};function _g(t,e){return new zA(t,e)}Nn.registerSaveRouter($1),Nn.registerLoadRouter($1);var wp=function(){function t(e){this.modelArtifacts=e}return t.prototype.load=function(){return ne(this,void 0,void 0,function(){return re(this,function(e){return[2,this.modelArtifacts]})})},t}(),HW=function(){function t(e){this.saveHandler=e}return t.prototype.save=function(e){return ne(this,void 0,void 0,function(){return re(this,function(n){return[2,this.saveHandler(e)]})})},t}(),UA=Object.freeze({browserFiles:function(t){return new GW(t)},browserHTTPRequest:function(t,e){return _g(t,e)},concatenateArrayBuffers:m0,decodeWeights:jA,encodeWeights:function(t,e){return ne(this,void 0,void 0,function(){var n,r,i,o,a,s=this;return re(this,function(u){switch(u.label){case 0:for(n=[],r=[],i=Array.isArray(t)?t.map(function(l){return l.name}):Object.keys(t),o=function(l){var c=i[l],d=Array.isArray(t)?t[l].tensor:t[c];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+d.dtype);var h={name:c,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var f=new Promise(function(m){return ne(s,void 0,void 0,function(){var p,v,g,x,w,b,k;return re(this,function(_){switch(_.label){case 0:return[4,d.bytes()];case 1:for(p=_.sent(),v=p.reduce(function(S,C){return S+C.length},0)+Kd*p.length,g=new Uint8Array(v),x=0,w=0;w<p.length;w++)b=p[w],k=new Uint8Array(new Uint32Array([b.length]).buffer),g.set(k,x),x+=Kd,g.set(b,x),x+=b.length;return m(g),[2]}})})});r.push(f)}else r.push(d.data());e!=null&&(h.group=e),n.push(h)},a=0;a<i.length;++a)o(a);return[4,Promise.all(r)];case 1:return[2,{data:MW(u.sent()),specs:n}]}})})},fromMemory:function(t,e,n,r){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new wp(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new wp({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new wp({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))},getLoadHandlers:function(t,e){return Nn.getLoadHandlers(t,e)},getModelArtifactsInfoForJSON:Tl,getSaveHandlers:function(t){return Nn.getSaveHandlers(t)},http:_g,isHTTPScheme:kg,loadWeights:function(t,e,n,r){return e===void 0&&(e=""),ne(this,void 0,void 0,function(){return re(this,function(i){return[2,U1(function(o){return VA(o,{requestInit:r})})(t,e,n)]})})},registerLoadRouter:function(t){return Nn.registerLoadRouter(t)},registerSaveRouter:function(t){return Nn.registerSaveRouter(t)},weightsLoaderFactory:U1,withSaveHandler:function(t){return new HW(t)},copyModel:function(t,e){return ne(this,void 0,void 0,function(){return re(this,function(n){return[2,F1(t,e,!1)]})})},listModels:function(){return ne(this,void 0,void 0,function(){var t,e,n,r,i,o,a;return re(this,function(s){switch(s.label){case 0:t=Xi.getSchemes(),e={},n=0,r=t,s.label=1;case 1:return n<r.length?(i=r[n],[4,Xi.getManager(i).listModels()]):[3,4];case 2:for(a in o=s.sent())e[i+es+a]=o[a];s.label=3;case 3:return n++,[3,1];case 4:return[2,e]}})})},moveModel:function(t,e){return ne(this,void 0,void 0,function(){return re(this,function(n){return[2,F1(t,e,!0)]})})},removeModel:function(t){return ne(this,void 0,void 0,function(){var e;return re(this,function(n){return e=Xc(t),[2,Xi.getManager(e.scheme).removeModel(e.path)]})})}}),ha;M({confusionMatrix_:function(t,e,n){var r=N(t,"labels","confusionMatrix"),i=N(e,"predictions","confusionMatrix");T(n==null||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),T(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),T(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),T(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),T(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var o=pg(r.asType("int32"),n),a=pg(i.asType("int32"),n);return o.transpose().matMul(a).asType("int32")}});var KW=M({fromPixels_:function(t,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)o=!0;else{if(t.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);a=!0}if(i&&i&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(hE("FromPixels",O.backendName)!=null)return O.runKernel("FromPixels",{pixels:t},{numChannels:e});var s,u,l=i?[t.videoWidth,t.videoHeight]:[t.width,t.height],c=l[0],d=l[1];if(a?s=t.getContext("2d").getImageData(0,0,c,d).data:r||n?s=t.data:(o||i)&&(ha==null&&(ha=document.createElement("canvas").getContext("2d")),ha.canvas.width=c,ha.canvas.height=d,ha.drawImage(t,0,0,c,d),s=ha.getImageData(0,0,c,d).data),e===4)u=new Int32Array(s);else{var h=c*d;u=new Int32Array(h*e);for(var f=0;f<h;f++)for(var m=0;m<e;++m)u[f*e+m]=s[4*f+m]}return Wy(u,[d,c,e],"int32")}}),g0=Object.freeze({toPixels:function(t,e){return ne(this,void 0,void 0,function(){var n,r,i,o,a,s,u,l,c,d,h,f,m,p,v,g,x,w,b,k,_,S,C;return re(this,function(E){switch(E.label){case 0:if(n=N(t,"img","toPixels"),t instanceof nt||(n=n.toInt()),n.rank!==2&&n.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],o=r[1],(a=n.rank===2?1:n.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,n.data()];case 1:return s=E.sent(),u=n.min(),l=n.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=E.sent(),d=c[0],h=c[1],f=d[0],m=h[0],u.dispose(),l.dispose(),n.dtype==="float32"){if(f<0||m>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+m+"].")}else{if(n.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(f<0||m>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+m+"].")}for(p=n.dtype==="float32"?255:1,v=new Uint8ClampedArray(o*i*4),g=0;g<i*o;++g)x=void 0,w=void 0,b=void 0,k=void 0,a===1?(x=s[g]*p,w=s[g]*p,b=s[g]*p,k=255):a===3?(x=s[3*g]*p,w=s[3*g+1]*p,b=s[3*g+2]*p,k=255):a===4&&(x=s[4*g]*p,w=s[4*g+1]*p,b=s[4*g+2]*p,k=s[4*g+3]*p),v[(_=4*g)+0]=Math.round(x),v[_+1]=Math.round(w),v[_+2]=Math.round(b),v[_+3]=Math.round(k);return e!=null&&(e.width=o,e.height=i,S=e.getContext("2d"),C=new ImageData(v,o,i),S.putImageData(C,0,0)),n!==t&&n.dispose(),[2,v]}})})},fromPixels:KW}),qW=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(e,n){return new e(n)},t}(),XW=function(){function t(){this.classNameMap={}}return t.getMap=function(){return t.instance==null&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function Zo(t){T(t.className!=null,function(){return"Class being registered does not have the static className property defined."}),T(typeof t.className=="string",function(){return"className is required to be a string, but got type "+typeof t.className}),T(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),XW.register(t)}var ea=function(t){function e(){return t!==null&&t.apply(this,arguments)||this}return xr(e,t),e.prototype.minimize=function(n,r,i){r===void 0&&(r=!1);var o=this.computeGradients(n,i),a=o.value,s=o.grads;if(i!=null){var u=i.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return vn(s),r?a:(a.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(n,r){return oz(n,r)},e.prototype.dispose=function(){this.iterations_!=null&&vn(this.iterations_)},e.prototype.saveIterations=function(){return ne(this,void 0,void 0,function(){return re(this,function(n){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:J(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){return re(this,function(n){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(n){return ne(this,void 0,void 0,function(){return re(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(n){return ne(this,void 0,void 0,function(){var r;return re(this,function(i){switch(i.label){case 0:return r=this,[4,n[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,n.slice(1)]}})})},e}(qW);Object.defineProperty(ea,Symbol.hasInstance,{value:function(t){return t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null}});var YW=function(t){function e(n,r,i){i===void 0&&(i=null);var o=t.call(this)||this;return o.learningRate=n,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=O.backend.epsilon()),o}return xr(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var a=O.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:Q(function(){return Ne(a).variable(!1)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:Q(function(){return Ne(a).variable(!1)})});var s=Array.isArray(n)?n[o].tensor:n[i];if(s!=null){var u=r.accumulatedGrads[o].variable,l=r.accumulatedUpdates[o].variable;Q(function(){var c=u.mul(r.rho).add(s.square().mul(1-r.rho)),d=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),h=l.mul(r.rho).add(d.square().mul(1-r.rho));u.assign(c),l.assign(h);var f=d.mul(-r.learningRate).add(a);a.assign(f)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(vn(this.accumulatedGrads.map(function(n){return n.variable})),vn(this.accumulatedUpdates.map(function(n){return n.variable})))},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){var n;return re(this,function(r){switch(r.label){case 0:return n=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(n){return ne(this,void 0,void 0,function(){var r;return re(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(n)];case 1:return n=i.sent(),r=n.length/2,this.accumulatedGrads=n.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=n.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(n,r){return new n(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e}(ea);Zo(YW);var JW=function(t){function e(n,r){r===void 0&&(r=.1);var i=t.call(this)||this;return i.learningRate=n,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return xr(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var a=O.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:Q(function(){return Vr(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(n)?n[o].tensor:n[i];if(s!=null){var u=r.accumulatedGrads[o].variable;Q(function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(O.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(c)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&vn(this.accumulatedGrads.map(function(n){return n.variable}))},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){return re(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(n){return ne(this,void 0,void 0,function(){return re(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulatedGrads=n.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(n,r){return new n(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(ea);Zo(JW);var QW=function(t){function e(n,r,i,o){o===void 0&&(o=null);var a=t.call(this)||this;return a.learningRate=n,a.beta1=r,a.beta2=i,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Q(function(){a.accBeta1=J(r).variable(),a.accBeta2=J(i).variable()}),o==null&&(a.epsilon=O.backend.epsilon()),a}return xr(e,t),e.prototype.applyGradients=function(n){var r=this,i=Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n);Q(function(){var o=At(1,r.accBeta1),a=At(1,r.accBeta2);i.forEach(function(s,u){var l=O.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Q(function(){return Ne(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:Q(function(){return Ne(l).variable(!1)})});var c=Array.isArray(n)?n[u].tensor:n[s];if(c!=null){var d=r.accumulatedFirstMoment[u].variable,h=r.accumulatedSecondMoment[u].variable,f=d.mul(r.beta1).add(c.mul(1-r.beta1)),m=h.mul(r.beta2).add(c.square().mul(1-r.beta2)),p=f.div(o),v=m.div(a);d.assign(f),h.assign(m);var g=p.div(v.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(g)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&vn(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedSecondMoment!=null&&vn(this.accumulatedSecondMoment.map(function(n){return n.variable}))},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){var n;return re(this,function(r){switch(r.label){case 0:return n=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(n){return ne(this,void 0,void 0,function(){var r,i=this;return re(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(n)];case 1:return n=o.sent(),Q(function(){i.accBeta1.assign(Gd(i.beta1,i.iterations_+1)),i.accBeta2.assign(Gd(i.beta2,i.iterations_+1))}),r=n.length/2,this.accumulatedFirstMoment=n.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=n.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(ea);Zo(QW);var ZW=function(t){function e(n,r,i,o,a){o===void 0&&(o=null),a===void 0&&(a=0);var s=t.call(this)||this;return s.learningRate=n,s.beta1=r,s.beta2=i,s.epsilon=o,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Q(function(){s.iteration=J(0).variable(),s.accBeta1=J(r).variable()}),o==null&&(s.epsilon=O.backend.epsilon()),s}return xr(e,t),e.prototype.applyGradients=function(n){var r=this,i=Array.isArray(n)?n.map(function(o){return o.name}):Object.keys(n);Q(function(){var o=At(1,r.accBeta1),a=ur(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(s,u){var l=O.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Ne(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Ne(l).variable(!1)});var c=Array.isArray(n)?n[u].tensor:n[s];if(c!=null){var d=r.accumulatedFirstMoment[u].variable,h=r.accumulatedWeightedInfNorm[u].variable,f=d.mul(r.beta1).add(c.mul(1-r.beta1)),m=h.mul(r.beta2),p=c.abs(),v=m.maximum(p);d.assign(f),h.assign(v);var g=a.div(o).mul(f.div(v.add(r.epsilon))).add(l);l.assign(g)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&vn(this.accumulatedFirstMoment.map(function(n){return n.variable})),this.accumulatedWeightedInfNorm!=null&&vn(this.accumulatedWeightedInfNorm.map(function(n){return n.variable}))},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){return re(this,function(n){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(n){return ne(this,void 0,void 0,function(){return re(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(n,r){return new n(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(ea);Zo(ZW);var $A=function(t){function e(n){var r=t.call(this)||this;return r.learningRate=n,r.setLearningRate(n),r}return xr(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var a=Array.isArray(n)?n[o].tensor:n[i];if(a!=null){var s=O.registeredVariables[i];Q(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(n){this.learningRate=n,this.c!=null&&this.c.dispose(),this.c=xV(J(-n))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){return re(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()]]}})})},e.prototype.setWeights=function(n){return ne(this,void 0,void 0,function(){return re(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:if((n=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(n,r){return new n(r.learningRate)},e.className="SGD",e}(ea);Zo($A);var e8=function(t){function e(n,r,i){i===void 0&&(i=!1);var o=t.call(this,n)||this;return o.learningRate=n,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=J(o.momentum),o}return xr(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var a=O.registeredVariables[i];r.accumulations[o]==null&&(r.accumulations[o]={originalName:i+"/momentum",variable:Q(function(){return Ne(a).variable(!1)})});var s=r.accumulations[o].variable,u=Array.isArray(n)?n[o].tensor:n[i];u!=null&&Q(function(){var l,c=r.m.mul(s).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(a):r.c.mul(c).add(a),s.assign(c),a.assign(l)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&vn(this.accumulations.map(function(n){return n.variable}))},e.prototype.setMomentum=function(n){this.momentum=n},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){return re(this,function(n){switch(n.label){case 0:return[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(n){return ne(this,void 0,void 0,function(){return re(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(n)];case 1:return n=r.sent(),this.accumulations=n.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(n,r){return new n(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e}($A);Zo(e8);var t8=function(t){function e(n,r,i,o,a){r===void 0&&(r=.9),i===void 0&&(i=0),o===void 0&&(o=null),a===void 0&&(a=!1);var s=t.call(this)||this;if(s.learningRate=n,s.decay=r,s.momentum=i,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,o==null&&(s.epsilon=O.backend.epsilon()),n==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return xr(e,t),e.prototype.applyGradients=function(n){var r=this;(Array.isArray(n)?n.map(function(i){return i.name}):Object.keys(n)).forEach(function(i,o){var a=O.registeredVariables[i];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:Q(function(){return Ne(a).variable(!1)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:Q(function(){return Ne(a).variable(!1)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:Q(function(){return Ne(a).variable(!1)})});var s=Array.isArray(n)?n[o].tensor:n[i];if(s!=null){var u=r.accumulatedMeanSquares[o].variable,l=r.accumulatedMoments[o].variable;Q(function(){var c=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[o].variable,h=d.mul(r.decay).add(s.mul(1-r.decay)),f=l.mul(r.momentum).add(s.mul(r.learningRate).div(c.sub(h.square().add(r.epsilon)).sqrt()));u.assign(c),d.assign(h),l.assign(f);var m=a.sub(f);a.assign(m)}else{var p=u.mul(r.decay).add(s.square().mul(1-r.decay));f=l.mul(r.momentum).add(s.mul(r.learningRate).div(p.add(r.epsilon).sqrt())),u.assign(p),l.assign(f),m=a.sub(f),a.assign(m)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&vn(this.accumulatedMeanSquares.map(function(n){return n.variable})),this.accumulatedMeanGrads!=null&&this.centered&&vn(this.accumulatedMeanGrads.map(function(n){return n.variable})),this.accumulatedMoments!=null&&vn(this.accumulatedMoments.map(function(n){return n.variable}))},e.prototype.getWeights=function(){return ne(this,void 0,void 0,function(){var n;return re(this,function(r){switch(r.label){case 0:return n=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&n.push.apply(n,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(n.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(n){return ne(this,void 0,void 0,function(){var r;return re(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(n)];case 1:return n=i.sent(),r=this.centered?n.length/3:n.length/2,this.accumulatedMeanSquares=n.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=n.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=n.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(n,r){return new n(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(ea);Zo(t8);nt.prototype.squaredDifference=function(t){return iA(this,t)},$=AW;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Sg=function(t,e){return Sg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},Sg(t,e)};function ye(t,e){Sg(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Kt=function(){return Kt=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Kt.apply(this,arguments)};function ue(t,e,n,r){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function s(c){try{l(r.next(c))}catch(d){a(d)}}function u(c){try{l(r.throw(c))}catch(d){a(d)}}function l(c){c.done?o(c.value):i(c.value).then(s,u)}l((r=r.apply(t,[])).next())})}function le(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){n.label=l[1];break}if(l[0]===6&&n.label<o[1]){n.label=o[1],o=l;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(l);break}o[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(c){l=[6,c],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Eu(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var rs=function(){function t(e,n){if(!Vo(e)||!Vo(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:n}));this._width=e,this._height=n}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function Lh(t,e){return t instanceof nt&&t.shape.length===e}function n8(t){return Lh(t,2)}function Bh(t){return Lh(t,3)}function Yi(t){return Lh(t,4)}function r8(t){return t%1!==0}function W1(t){return t%2===0}function i8(t,e){e===void 0&&(e=2);var n=Math.pow(10,e);return Math.floor(t*n)/n}function G1(t){return t&&t.width&&t.height}function o8(t,e){var n=t.width,r=t.height,i=e/Math.max(r,n);return new rs(Math.round(n*i),Math.round(r*i))}function v0(t){return t.reduce(function(e,n){return e.add(n)},new Me(0,0)).div(new Me(t.length,t.length))}function sl(t,e,n){return Array(t).fill(0).map(function(r,i){return e+i*n})}function Vo(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||t===0}function H1(t){return Vo(t)&&0<=t&&t<=1}var Me=function(){function t(e,n){this._x=e,this._y=n}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),no=function(){function t(e,n){n===void 0&&(n=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(Vo),o=[r.x,r.y,r.width,r.height].every(Vo);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],l=a[2],c=a[3];t.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",n),this._x=s,this._y=u,this._width=l,this._height=c}return t.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Vo)},t.assertIsValidBox=function(e,n,r){if(r===void 0&&(r=!1),!t.isRect(e))throw new Error(n+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(n+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new Me(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new Me(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new Me(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new Me(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),n=e[0],r=e[1],i=e[2],o=e[3];return new t({x:n,y:r,width:i,height:o})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),n=e[0],r=e[1],i=e[2],o=e[3];return new t({x:n,y:r,width:i,height:o})},t.prototype.toSquare=function(){var e=this,n=e.x,r=e.y,i=e.width,o=e.height,a=Math.abs(i-o);return i<o&&(n-=a/2,i+=a),o<i&&(r-=a/2,o+=a),new t({x:n,y:r,width:i,height:o})},t.prototype.rescale=function(e){var n=G1(e)?e.width:e,r=G1(e)?e.height:e;return new t({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},t.prototype.pad=function(e,n){var r=[this.x-e/2,this.y-n/2,this.width+e,this.height+n],i=r[0],o=r[1],a=r[2],s=r[3];return new t({x:i,y:o,width:a,height:s})},t.prototype.clipAtImageBorders=function(e,n){var r=this,i=r.x,o=r.y,a=r.right,s=r.bottom,u=Math.max(i,0),l=Math.max(o,0),c=a-u,d=s-l,h=Math.min(c,e-u),f=Math.min(d,n-l);return new t({x:u,y:l,width:h,height:f}).floor()},t.prototype.shift=function(e,n){var r=this,i=r.width,o=r.height,a=this.x+e,s=this.y+n;return new t({x:a,y:s,width:i,height:o})},t.prototype.padAtBorders=function(e,n){var r=this.width+1,i=this.height+1,o=1,a=1,s=r,u=i,l=this.left,c=this.top,d=this.right,h=this.bottom;return d>n&&(s=-d+n+r,d=n),h>e&&(u=-h+e+i,h=e),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:a,edy:u,dx:o,edx:s,y:c,ey:h,x:l,ex:d,w:r,h:i}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),Vh=function(t){ye(e,t);function e(n,r,i,o,a){return a===void 0&&(a=!1),t.call(this,{left:n,top:r,right:i,bottom:o},a)||this}return e}(no),WA=function(){function t(e,n,r,i,o){this._imageDims=new rs(o.width,o.height),this._score=e,this._classScore=n,this._className=r,this._box=new no(i).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new no(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:n})},t}(),Kr=function(t){ye(e,t);function e(n,r,i){return t.call(this,n,n,"",r,i)||this}return e.prototype.forSize=function(n,r){var i=t.prototype.forSize.call(this,n,r),o=i.score,a=i.relativeBox,s=i.imageDims;return new e(o,a,s)},e}(WA);function a8(t,e,n){n===void 0&&(n=!0);var r=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left)),i=Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top)),o=r*i;return n?o/(t.area+e.area-o):o/Math.min(t.area,e.area)}function s8(t){var e=t.map(function(s){return s.x}),n=t.map(function(s){return s.y}),r=e.reduce(function(s,u){return u<s?u:s},1/0),i=n.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return s<u?u:s},0),a=n.reduce(function(s,u){return s<u?u:s},0);return new Vh(r,i,o,a)}function ul(t,e,n,r){r===void 0&&(r=!0);for(var i=e.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),o=[],a=function(){var s=i.pop();o.push(s);for(var u=i,l=[],c=0;c<u.length;c++){var d=u[c],h=t[s],f=t[d];l.push(a8(h,f,r))}i=i.filter(function(m,p){return l[p]<=n})};i.length>0;)a();return o}function Pl(t,e){return Q(function(){var n=e[0],r=e[1],i=e[2],o=Vr(Eu(t.shape.slice(0,3),[1]),n),a=Vr(Eu(t.shape.slice(0,3),[1]),r),s=Vr(Eu(t.shape.slice(0,3),[1]),i),u=St([o,a,s],3);return At(t,u)})}function u8(t,e){return e===void 0&&(e=!1),Q(function(){var n=t.shape.slice(1),r=n[0],i=n[1];if(r===i)return t;var o=Math.abs(r-i),a=Math.round(o*(e?.5:1)),s=r>i?2:1,u=function(f){var m=t.shape.slice();return m[s]=f,Vr(m,0)},l=u(a),c=o-l.shape[s],d=e&&c?u(c):null,h=[d,t,l].filter(function(f){return!!f}).map(function(f){return f.toFloat()});return St(h,s)})}function bp(t){return 1/(1+Math.exp(-t))}var y0=function(t){ye(e,t);function e(n,r,i,o,a){return a===void 0&&(a=!1),t.call(this,{x:n,y:r,width:i,height:o},a)||this}return e}(no),l8=.5,c8=.43,d8=.45,qd=function(){function t(e,n,r){r===void 0&&(r=new Me(0,0));var i=n.width,o=n.height;this._imgDims=new rs(i,o),this._shift=r,this._positions=e.map(function(a){return a.mul(new Me(i,o)).add(r)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new Me(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(n){return n.sub(e._shift).div(new Me(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new this.constructor(this.relativePositions,{width:e,height:n})},t.prototype.shiftBy=function(e,n){return new this.constructor(this.relativePositions,this._imgDims,new Me(e,n))},t.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},t.prototype.align=function(e,n){if(n===void 0&&(n={}),e){var r=e instanceof Kr?e.box.floor():new no(e);return this.shiftBy(r.x,r.y).align(null,n)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},n),o=i.useDlibAlignment,a=i.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(a)},t.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),n=e[0],r=e[1],i=e[2],o=function(d){return i.sub(d).magnitude()},a=(o(n)+o(r))/2,s=Math.floor(a/d8),u=v0(e),l=Math.floor(Math.max(0,u.x-l8*s)),c=Math.floor(Math.max(0,u.y-c8*s));return new y0(l,c,Math.min(s,this.imageWidth+l),Math.min(s,this.imageHeight+c))},t.prototype.alignMinBbox=function(e){var n=s8(this.positions);return n.pad(n.width*e,n.height*e)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),h8=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var n=this.positions;return[n[0],n[1],v0([n[3],n[4]])]},e}(qd),f8=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(v0)},e}(qd),K1=function(){function t(e,n){this._label=e,this._distance=n}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+i8(this.distance)+")":"")},t}(),q1=function(t){ye(e,t);function e(n,r){var i=t.call(this,n)||this;return i._label=r,i}return e.assertIsValidLabeledBox=function(n,r){if(no.assertIsValidBox(n,r),!Vo(n.label))throw new Error(r+" - expected property label ("+n.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(no),gc=function(){function t(e,n){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(n)||n.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=n}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(e){return Array.from(e)})}},t.fromJSON=function(e){var n=e.descriptors.map(function(r){return new Float32Array(r)});return new t(e.label,n)},t}();(function(t){ye(e,t);function e(n,r,i,o){var a=t.call(this,n,r)||this;return a._score=i,a._classScore=o,a}return e.assertIsValidPredictedBox=function(n,r){if(q1.assertIsValidLabeledBox(n,r),!H1(n.score)||!H1(n.classScore))throw new Error(r+" - expected properties score ("+n.score+") and ("+n.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(q1);function p8(t){return t.detection instanceof Kr}function x0(t,e){var n={detection:e};return Object.assign({},t,n)}function GA(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:e}}function HA(t){var e="";if(!t)try{t=require("fs")}catch(r){e=r.toString()}var n=t?function(r){return new Promise(function(i,o){t.readFile(r,function(a,s){return a?o(a):i(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:n}}function KA(){var t=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,n=function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=HA();return Kt({Canvas:t||function(){function a(){}return a}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function a(){}return a}(),Image:e||function(){function a(){}return a}(),ImageData:global.ImageData||function(){function a(){}return a}(),Video:global.HTMLVideoElement||function(){function a(){}return a}(),createCanvasElement:n,createImageElement:r,fetch:i},o)}function qA(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function XA(){return typeof global=="object"&&typeof require=="function"&&typeof pP<"u"&&typeof process<"u"&&!!process.version}var bt;function m8(){if(!bt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return bt}function Cg(t){bt=t}function w0(){qA()&&Cg(GA()),XA()&&Cg(KA())}function g8(t){if(bt||w0(),!bt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=t.Canvas,n=e===void 0?bt.Canvas:e,r=t.Image,i=r===void 0?bt.Image:r;bt.Canvas=n,bt.Image=i,bt.createCanvasElement=t.createCanvasElement||function(){return new n},bt.createImageElement=t.createImageElement||function(){return new i},bt.ImageData=t.ImageData||bt.ImageData,bt.Video=t.Video||bt.Video,bt.fetch=t.fetch||bt.fetch,bt.readFile=t.readFile||bt.readFile}var Zt={getEnv:m8,setEnv:Cg,initialize:w0,createBrowserEnv:GA,createFileSystem:HA,createNodejsEnv:KA,monkeyPatch:g8,isBrowser:qA,isNodejs:XA};w0();function YA(t){return!Zt.isNodejs()&&typeof t=="string"?document.getElementById(t):t}function Ko(t){var e=Zt.getEnv(),n=e.Canvas,r=e.CanvasRenderingContext2D;if(t instanceof r)return t;var i=YA(t);if(!(i instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var X1;(function(t){t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT"})(X1||(X1={}));function JA(t){var e=Zt.getEnv(),n=e.Image,r=e.Video;return t instanceof n&&t.complete||t instanceof r&&t.readyState>=3}function v8(t){return new Promise(function(e,n){if(t instanceof Zt.getEnv().Canvas||JA(t))return e();function r(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),e(o))}function i(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),n(o))}t.addEventListener("load",r),t.addEventListener("error",i)})}function QA(t){var e=Zt.getEnv(),n=e.Image,r=e.Video;return t instanceof n?new rs(t.naturalWidth,t.naturalHeight):t instanceof r?new rs(t.videoWidth,t.videoHeight):new rs(t.width,t.height)}function zh(t){var e=t.width,n=t.height,r=Zt.getEnv().createCanvasElement,i=r();return i.width=e,i.height=n,i}function b0(t,e){var n=Zt.getEnv().ImageData;if(!(t instanceof n)&&!JA(t))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=QA(t),i=r.width,o=r.height,a=zh({width:i,height:o});return t instanceof n?Ko(a).putImageData(t,0,0):Ko(a).drawImage(t,0,0,i,o),a}function y8(t,e){return ue(this,void 0,void 0,function(){var n,r,i,o,a,s;return le(this,function(u){switch(u.label){case 0:return n=Zt.getEnv().createCanvasElement(),r=t.shape.slice(Yi(t)?1:0),i=r[0],o=r[1],a=r[2],s=Q(function(){return t.as3D(i,o,a).toInt()}),[4,g0.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}})})}function Y1(t){var e=Zt.getEnv(),n=e.Image,r=e.Canvas,i=e.Video;return t instanceof n||t instanceof r||t instanceof i}function x8(t,e,n){n===void 0&&(n=!1);var r=Zt.getEnv(),i=r.Image,o=r.Canvas;if(!(t instanceof i||t instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=QA(t),s=e/Math.max(a.height,a.width),u=s*a.width,l=s*a.height,c=zh({width:e,height:e}),d=t instanceof o?t:b0(t),h=Math.abs(u-l)/2,f=n&&u<l?h:0,m=n&&l<u?h:0;return Ko(c).drawImage(d,f,m,u,l),c}var Xd=function(){function t(e,n){var r=this;if(n===void 0&&(n=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=n,this._batchSize=e.length,e.forEach(function(i,o){if(Bh(i)){r._imageTensors[o]=i,r._inputDimensions[o]=i.shape;return}if(Yi(i)){var a=i.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");r._imageTensors[o]=i,r._inputDimensions[o]=i.shape.slice(1);return}var s=i instanceof Zt.getEnv().Canvas?i:b0(i);r._canvases[o]=s,r._inputDimensions[o]=[s.height,s.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var e=this;return sl(this.batchSize,0,1).map(function(n,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},t.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},t.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},t.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},t.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var n=this.getInputWidth(e),r=this.getInputHeight(e);return o8({width:n,height:r},this.inputSize)},t.prototype.toBatchTensor=function(e,n){var r=this;return n===void 0&&(n=!0),this._inputSize=e,Q(function(){var i=sl(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof nt){var u=Yi(s)?s:s.expandDims();return u=u8(u,n),(u.shape[1]!==e||u.shape[2]!==e)&&(u=c0.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(s instanceof Zt.getEnv().Canvas)return g0.fromPixels(x8(s,e,n));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),o=In(i.map(function(a){return a.toFloat()})).as4D(r.batchSize,e,e,3);return o})},t}();function Dt(t){return ue(this,void 0,void 0,function(){var e,n,r;return le(this,function(i){switch(i.label){case 0:if(t instanceof Xd)return[2,t];if(e=Array.isArray(t)?t:[t],!e.length)throw new Error("toNetInput - empty array passed as input");return n=function(o){return Array.isArray(t)?" at input index "+o+":":""},r=e.map(YA),r.forEach(function(o,a){if(!Y1(o)&&!Bh(o)&&!Yi(o))throw typeof e[a]=="string"?new Error("toNetInput -"+n(a)+" string passed, but could not resolve HTMLElement for element id "+e[a]):new Error("toNetInput -"+n(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Yi(o)){var s=o.shape[0];if(s!==1)throw new Error("toNetInput -"+n(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return Y1(o)&&v8(o)}))];case 1:return i.sent(),[2,new Xd(r,Array.isArray(t))]}})})}function k0(t,e){return ue(this,void 0,void 0,function(){var n,r,i,o,a,s,u;return le(this,function(l){switch(l.label){case 0:return n=Zt.getEnv().Canvas,r=t,t instanceof n?[3,5]:[4,Dt(t)];case 1:if(i=l.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=i.getInput(0),o instanceof n?(a=o,[3,4]):[3,2];case 2:return[4,y8(o)];case 3:a=l.sent(),l.label=4;case 4:r=a,l.label=5;case 5:return s=Ko(r),u=e.map(function(c){return c instanceof Kr?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var d=c.x,h=c.y,f=c.width,m=c.height,p=zh({width:f,height:m});return Ko(p).putImageData(s.getImageData(d,h,f,m),0,0),p})]}})})}function _0(t,e){return ue(this,void 0,void 0,function(){return le(this,function(n){if(!Bh(t)&&!Yi(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Yi(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Q(function(){var r=t.shape.slice(Yi(t)?1:0),i=r[0],o=r[1],a=r[2],s=e.map(function(l){return l instanceof Kr?l.forSize(o,i).box:l}).map(function(l){return l.clipAtImageBorders(o,i)}),u=s.map(function(l){var c=l.x,d=l.y,h=l.width,f=l.height;return CA(t.as3D(i,o,a),[d,c,0],[f,h,a])});return u})]})})}function w8(t,e){return ue(this,void 0,void 0,function(){var n,r;return le(this,function(i){switch(i.label){case 0:return n=Zt.getEnv().fetch,[4,n(t,e)];case 1:if(r=i.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function b8(t){return ue(this,void 0,void 0,function(){return le(this,function(e){switch(e.label){case 0:return[4,w8(t)];case 1:return[2,e.sent().json()]}})})}function ZA(t,e){var n=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:n};if(t==="/")return{modelBaseUri:"/",manifestUri:"/"+n};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"";t=t.replace(r,"");var i=t.split("/").filter(function(s){return s}),o=t.endsWith(".json")?i[i.length-1]:n,a=r+(t.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return a=t.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+o:a+"/"+o}}function k8(t,e){return ue(this,void 0,void 0,function(){var n,r,i,o;return le(this,function(a){switch(a.label){case 0:return n=ZA(t,e),r=n.manifestUri,i=n.modelBaseUri,[4,b8(r)];case 1:return o=a.sent(),[2,UA.loadWeights(o,i)]}})})}var wi=function(){function t(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(e){var n=this.traversePropertyPath(e),r=n.obj,i=n.objProp;return r[i]},t.prototype.reassignParamFromPath=function(e,n){var r=this.traversePropertyPath(e),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=n},t.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(n){var r=n.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof gs})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof gs)})},t.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(n){var r=n.path,i=n.tensor;e.reassignParamFromPath(r,i.variable())})},t.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(n){var r=n.path,i=n.tensor,o=Bt(i.dataSync());i.dispose(),e.reassignParamFromPath(r,o)})},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(n){if(e&&n.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+n.path);n.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var n=e.tensor;return Array.from(n.dataSync())}).reduce(function(e,n){return e.concat(n)}))},t.prototype.load=function(e){return ue(this,void 0,void 0,function(){return le(this,function(n){switch(n.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return n.sent(),[2]}})})},t.prototype.loadFromUri=function(e){return ue(this,void 0,void 0,function(){var n;return le(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,k8(e,this.getDefaultModelName())];case 1:return n=r.sent(),this.loadFromWeightMap(n),[2]}})})},t.prototype.loadFromDisk=function(e){return ue(this,void 0,void 0,function(){var n,r,i,o,a,s,u,l,c,d;return le(this,function(h){switch(h.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return n=Zt.getEnv().readFile,r=ZA(e,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,a=function(f){return Promise.all(f.map(function(m){return n(m).then(function(p){return p.buffer})}))},s=UA.weightsLoaderFactory(a),c=(l=JSON).parse,[4,n(i)];case 1:return u=c.apply(l,[h.sent().toString()]),[4,s(u,o)];case 2:return d=h.sent(),this.loadFromWeightMap(d),[2]}})})},t.prototype.loadFromWeightMap=function(e){var n=this.extractParamsFromWeigthMap(e),r=n.paramMappings,i=n.params;this._paramMappings=r,this._params=i},t.prototype.extractWeights=function(e){var n=this.extractParams(e),r=n.paramMappings,i=n.params;this._paramMappings=r,this._params=i},t.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var n=e.split("/").reduce(function(o,a){if(!o.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+e);return{obj:o.nextObj,objProp:a,nextObj:o.nextObj[a]}},{nextObj:this.params}),r=n.obj,i=n.objProp;if(!r||!i||!(r[i]instanceof nt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},t}();function Tn(t,e,n){return Q(function(){var r=o0(t,e.depthwise_filter,e.pointwise_filter,n,"same");return r=Ee(r,e.bias),r})}function kp(t,e,n){return n===void 0&&(n=!1),Q(function(){var r=it(n?Ee(Jn(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):Tn(t,e.conv0,[2,2])),i=Tn(r,e.conv1,[1,1]),o=it(Ee(r,i)),a=Tn(o,e.conv2,[1,1]);return it(Ee(r,Ee(i,a)))})}function vc(t,e,n,r){return n===void 0&&(n=!1),r===void 0&&(r=!0),Q(function(){var i=it(n?Ee(Jn(t,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):Tn(t,e.conv0,r?[2,2]:[1,1])),o=Tn(i,e.conv1,[1,1]),a=it(Ee(i,o)),s=Tn(a,e.conv2,[1,1]),u=it(Ee(i,Ee(o,s))),l=Tn(u,e.conv3,[1,1]);return it(Ee(i,Ee(o,Ee(s,l))))})}function fr(t,e,n,r){return n===void 0&&(n="same"),r===void 0&&(r=!1),Q(function(){var i=Ee(Jn(t,e.filters,[1,1],n),e.bias);return r?it(i):i})}function bi(t,e){Object.keys(t).forEach(function(n){e.some(function(r){return r.originalPath===n})||t[n].dispose()})}function Uh(t,e){return function(n,r,i,o){var a=cn(t(n*r*i*i),[i,i,n,r]),s=yt(t(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:a,bias:s}}}function S0(t,e){return function(n,r,i){var o=qi(t(n*r),[n,r]),a=yt(t(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:a}}}var eR=function(){function t(e,n,r){this.depthwise_filter=e,this.pointwise_filter=n,this.bias=r}return t}();function C0(t,e){return function(n,r,i){var o=cn(t(9*n),[3,3,n,1]),a=cn(t(n*r),[1,1,n,r]),s=yt(t(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new eR(o,a,s)}}function E0(t){return function(e){var n=t(e+"/depthwise_filter",4),r=t(e+"/pointwise_filter",4),i=t(e+"/bias",1);return new eR(n,r,i)}}function co(t,e){return function(n,r,i){var o=t[n];if(!Lh(o,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:n,paramPath:i||n}),o}}function ki(t){var e=t;function n(i){var o=e.slice(0,i);return e=e.slice(i),o}function r(){return e}return{extractWeights:n,getRemainingWeights:r}}function tR(t,e){var n=Uh(t,e),r=C0(t,e);function i(a,s,u,l){l===void 0&&(l=!1);var c=l?n(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),d=r(s,s,u+"/conv1"),h=r(s,s,u+"/conv2");return{conv0:c,conv1:d,conv2:h}}function o(a,s,u,l){l===void 0&&(l=!1);var c=i(a,s,u,l),d=c.conv0,h=c.conv1,f=c.conv2,m=r(s,s,u+"/conv3");return{conv0:d,conv1:h,conv2:f,conv3:m}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function _8(t){var e=[],n=ki(t),r=n.extractWeights,i=n.getRemainingWeights,o=tR(r,e).extractDenseBlock4Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2"),l=o(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u,dense3:l}}}function nR(t){return function(e){var n=t(e+"/filters",4),r=t(e+"/bias",1);return{filters:n,bias:r}}}function rR(t,e){var n=co(t,e),r=nR(n),i=E0(n);function o(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):i(s+"/conv0"),c=i(s+"/conv1"),d=i(s+"/conv2");return{conv0:l,conv1:c,conv2:d}}function a(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):i(s+"/conv0"),c=i(s+"/conv1"),d=i(s+"/conv2"),h=i(s+"/conv3");return{conv0:l,conv1:c,conv2:d,conv3:h}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:a}}function S8(t){var e=[],n=rR(t,e).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return bi(t,e),{params:r,paramMappings:e}}var iR=function(t){ye(e,t);function e(){return t.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return Q(function(){var i=n.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=Pl(i,o).div(J(255)),s=vc(a,r.dense0,!0);return s=vc(s,r.dense1),s=vc(s,r.dense2),s=vc(s,r.dense3),s=Nl(s,[7,7],[2,2],"valid"),s})},e.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Dt(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(n){return S8(n)},e.prototype.extractParams=function(n){return _8(n)},e}(wi);function Dr(t,e){return Q(function(){return Ee(Oh(t,e.weights),e.bias)})}function C8(t,e,n){var r=[],i=ki(t),o=i.extractWeights,a=i.getRemainingWeights,s=S0(o,r),u=s(e,n,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}function E8(t){var e=[],n=co(t,e);function r(o){var a=n(o+"/weights",2),s=n(o+"/bias",1);return{weights:a,bias:s}}var i={fc:r("fc")};return bi(t,e),{params:i,paramMappings:e}}function oR(t){var e={},n={};return Object.keys(t).forEach(function(r){var i=r.startsWith("fc")?n:e;i[r]=t[r]}),{featureExtractorMap:e,classifierMap:n}}var aR=function(t){ye(e,t);function e(n,r){var i=t.call(this,n)||this;return i._faceFeatureExtractor=r,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(n){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Q(function(){var o=n instanceof Xd?r.faceFeatureExtractor.forwardInput(n):n;return Dr(o.as2D(o.shape[0],-1),i.fc)})},e.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),t.prototype.dispose.call(this,n)},e.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(n){return C8(n,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(n){var r=oR(n),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),E8(o)},e.prototype.extractParams=function(n){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,a=n.slice(0,n.length-o),s=n.slice(n.length-o);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},e}(wi),J1=["neutral","happy","sad","angry","fearful","disgusted","surprised"],A8=function(){function t(e){var n=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);J1.forEach(function(r,i){n[r]=e[i]})}return t.prototype.asSortedArray=function(){var e=this;return J1.map(function(n){return{expression:n,probability:e[n]}}).sort(function(n,r){return r.probability-n.probability})},t}(),R8=function(t){ye(e,t);function e(n){return n===void 0&&(n=new iR),t.call(this,"FaceExpressionNet",n)||this}return e.prototype.forwardInput=function(n){var r=this;return Q(function(){return yi(r.runNet(n))})},e.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Dt(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(n){return ue(this,void 0,void 0,function(){var r,i,o,a,s=this;return le(this,function(u){switch(u.label){case 0:return[4,Dt(n)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return i=u.sent(),[4,Promise.all(Ct(i).map(function(l){return ue(s,void 0,void 0,function(){var c;return le(this,function(d){switch(d.label){case 0:return[4,l.data()];case 1:return c=d.sent(),l.dispose(),[2,c]}})})}))];case 3:return o=u.sent(),i.dispose(),a=o.map(function(l){return new A8(l)}),[2,r.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(aR);function sR(t,e){var n={expressions:e};return Object.assign({},t,n)}function N8(t){return p8(t)&&t.landmarks instanceof qd&&t.unshiftedLandmarks instanceof qd&&t.alignedRect instanceof Kr}function A0(t,e){var n=t.detection.box,r=e.shiftBy(n.x,n.y),i=r.align(),o=t.detection.imageDims,a=new Kr(t.detection.score,i.rescale(o.reverse()),o),s={landmarks:r,unshiftedLandmarks:e,alignedRect:a};return Object.assign({},t,s)}function T8(t,e){var n=Uh(t,e),r=C0(t,e);function i(a,s,u){var l=r(a,s,u+"/separable_conv0"),c=r(s,s,u+"/separable_conv1"),d=n(a,s,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:d}}function o(a,s){var u=r(a,a,s+"/separable_conv0"),l=r(a,a,s+"/separable_conv1"),c=r(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:o}}function P8(t,e){var n=[],r=ki(t),i=r.extractWeights,o=r.getRemainingWeights,a=T8(i,n),s=a.extractConvParams,u=a.extractSeparableConvParams,l=a.extractReductionBlockParams,c=a.extractMainBlockParams,d=s(3,32,3,"entry_flow/conv_in"),h=l(32,64,"entry_flow/reduction_block_0"),f=l(64,128,"entry_flow/reduction_block_1"),m={conv_in:d,reduction_block_0:h,reduction_block_1:f},p={};sl(e,0,1).forEach(function(w){p["main_block_"+w]=c(128,"middle_flow/main_block_"+w)});var v=l(128,256,"exit_flow/reduction_block"),g=u(256,512,"exit_flow/separable_conv"),x={reduction_block:v,separable_conv:g};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{entry_flow:m,middle_flow:p,exit_flow:x}}}function I8(t,e){var n=co(t,e),r=nR(n),i=E0(n);function o(s){var u=i(s+"/separable_conv0"),l=i(s+"/separable_conv1"),c=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function a(s){var u=i(s+"/separable_conv0"),l=i(s+"/separable_conv1"),c=i(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:o,extractMainBlockParams:a}}function D8(t,e){var n=[],r=I8(t,n),i=r.extractConvParams,o=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=i("entry_flow/conv_in"),l=a("entry_flow/reduction_block_0"),c=a("entry_flow/reduction_block_1"),d={conv_in:u,reduction_block_0:l,reduction_block_1:c},h={};sl(e,0,1).forEach(function(v){h["main_block_"+v]=s("middle_flow/main_block_"+v)});var f=a("exit_flow/reduction_block"),m=o("exit_flow/separable_conv"),p={reduction_block:f,separable_conv:m};return bi(t,n),{params:{entry_flow:d,middle_flow:h,exit_flow:p},paramMappings:n}}function uR(t,e,n){return Ee(Jn(t,e.filters,n,"same"),e.bias)}function _p(t,e,n){n===void 0&&(n=!0);var r=n?it(t):t;return r=Tn(r,e.separable_conv0,[1,1]),r=Tn(it(r),e.separable_conv1,[1,1]),r=Nt(r,[3,3],[2,2],"same"),r=Ee(r,uR(t,e.expansion_conv,[2,2])),r}function M8(t,e){var n=Tn(it(t),e.separable_conv0,[1,1]);return n=Tn(it(n),e.separable_conv1,[1,1]),n=Tn(it(n),e.separable_conv2,[1,1]),n=Ee(n,t),n}var O8=function(t){ye(e,t);function e(n){var r=t.call(this,"TinyXception")||this;return r._numMainBlocks=n,r}return e.prototype.forwardInput=function(n){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return Q(function(){var o=n.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=Pl(o,a).div(J(256)),u=it(uR(s,i.entry_flow.conv_in,[2,2]));return u=_p(u,i.entry_flow.reduction_block_0,!1),u=_p(u,i.entry_flow.reduction_block_1),sl(r._numMainBlocks,0,1).forEach(function(l){u=M8(u,i.middle_flow["main_block_"+l])}),u=_p(u,i.exit_flow.reduction_block),u=it(Tn(u,i.exit_flow.separable_conv,[1,1])),u})},e.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Dt(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(n){return D8(n,this._numMainBlocks)},e.prototype.extractParams=function(n){return P8(n,this._numMainBlocks)},e}(wi);function j8(t){var e=[],n=ki(t),r=n.extractWeights,i=n.getRemainingWeights,o=S0(r,e),a=o(512,1,"fc/age"),s=o(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}function F8(t){var e=[],n=co(t,e);function r(o){var a=n(o+"/weights",2),s=n(o+"/bias",1);return{weights:a,bias:s}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return bi(t,e),{params:i,paramMappings:e}}var Yd;(function(t){t.FEMALE="female",t.MALE="male"})(Yd||(Yd={}));var L8=function(t){ye(e,t);function e(n){n===void 0&&(n=new O8(2));var r=t.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=n,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(n){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Q(function(){var o=n instanceof Xd?r.faceFeatureExtractor.forwardInput(n):n,a=Nl(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),s=Dr(a,i.fc.age).as1D(),u=Dr(a,i.fc.gender);return{age:s,gender:u}})},e.prototype.forwardInput=function(n){var r=this;return Q(function(){var i=r.runNet(n),o=i.age,a=i.gender;return{age:o,gender:yi(a)}})},e.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Dt(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(n){return ue(this,void 0,void 0,function(){var r,i,o,a,s,u,l=this;return le(this,function(c){switch(c.label){case 0:return[4,Dt(n)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),o=Ct(i.age),a=Ct(i.gender),s=o.map(function(d,h){return{ageTensor:d,genderTensor:a[h]}}),[4,Promise.all(s.map(function(d){var h=d.ageTensor,f=d.genderTensor;return ue(l,void 0,void 0,function(){var m,p,v,g,x;return le(this,function(w){switch(w.label){case 0:return[4,h.data()];case 1:return m=w.sent()[0],[4,f.data()];case 2:return p=w.sent()[0],v=p>.5,g=v?Yd.MALE:Yd.FEMALE,x=v?p:1-p,h.dispose(),f.dispose(),[2,{age:m,gender:g,genderProbability:x}]}})})}))];case 3:return u=c.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(n){n===void 0&&(n=!0),this.faceFeatureExtractor.dispose(n),t.prototype.dispose.call(this,n)},e.prototype.loadClassifierParams=function(n){var r=this.extractClassifierParams(n),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(n){return j8(n)},e.prototype.extractParamsFromWeigthMap=function(n){var r=oR(n),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),F8(o)},e.prototype.extractParams=function(n){var r=1539,i=n.slice(0,n.length-r),o=n.slice(n.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e}(wi),lR=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.postProcess=function(n,r,i){var o=i.map(function(s){var u=s.width,l=s.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),a=o.length;return Q(function(){var s=function(h,f){return In([Vr([68],h),Vr([68],f)],1).as2D(1,136).as1D()},u=function(h,f){var m=o[h],p=m.width,v=m.height;return f(p,v)?Math.abs(p-v)/2:0},l=function(h){return u(h,function(f,m){return f<m})},c=function(h){return u(h,function(f,m){return m<f})},d=n.mul(Vr([a,136],r)).sub(In(Array.from(Array(a),function(h,f){return s(l(f),c(f))}))).div(In(Array.from(Array(a),function(h,f){return s(o[f].width,o[f].height)})));return d})},e.prototype.forwardInput=function(n){var r=this;return Q(function(){var i=r.runNet(n);return r.postProcess(i,n.inputSize,n.inputDimensions.map(function(o){var a=o[0],s=o[1];return{height:a,width:s}}))})},e.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Dt(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(n){return ue(this,void 0,void 0,function(){var r,i,o,a=this;return le(this,function(s){switch(s.label){case 0:return[4,Dt(n)];case 1:return r=s.sent(),i=Q(function(){return Ct(a.forwardInput(r))}),[4,Promise.all(i.map(function(u,l){return ue(a,void 0,void 0,function(){var c,d,h,f,m;return le(this,function(p){switch(p.label){case 0:return h=(d=Array).from,[4,u.data()];case 1:return c=h.apply(d,[p.sent()]),f=c.filter(function(v,g){return W1(g)}),m=c.filter(function(v,g){return!W1(g)}),[2,new f8(Array(68).fill(0).map(function(v,g){return new Me(f[g],m[g])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return o=s.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(aR),cR=function(t){ye(e,t);function e(n){return n===void 0&&(n=new iR),t.call(this,"FaceLandmark68Net",n)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(lR);function B8(t){var e=[],n=rR(t,e).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return bi(t,e),{params:r,paramMappings:e}}function V8(t){var e=[],n=ki(t),r=n.extractWeights,i=n.getRemainingWeights,o=tR(r,e).extractDenseBlock3Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u}}}var z8=function(t){ye(e,t);function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Q(function(){var i=n.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=Pl(i,o).div(J(255)),s=kp(a,r.dense0,!0);return s=kp(s,r.dense1),s=kp(s,r.dense2),s=Nl(s,[14,14],[2,2],"valid"),s})},e.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Dt(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(n){return B8(n)},e.prototype.extractParams=function(n){return V8(n)},e}(wi),U8=function(t){ye(e,t);function e(n){return n===void 0&&(n=new z8),t.call(this,"FaceLandmark68TinyNet",n)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(lR);(function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e})(cR);function $8(t,e){return Ee(Jt(t,e.weights),e.biases)}function R0(t,e,n,r,i){i===void 0&&(i="same");var o=e.conv,a=o.filters,s=o.bias,u=Jn(t,a,n,i);return u=Ee(u,s),u=$8(u,e.scale),r?it(u):u}function W8(t,e){return R0(t,e,[1,1],!0)}function dR(t,e){return R0(t,e,[1,1],!1)}function hR(t,e){return R0(t,e,[2,2],!0,"valid")}function G8(t,e){function n(s,u,l){var c=t(s),d=c.length/(u*l*l);if(r8(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return Q(function(){return to(cn(c,[u,d,l,l]),[2,3,1,0])})}function r(s,u,l,c){var d=n(s,u,l),h=yt(t(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:d,bias:h}}function i(s,u){var l=yt(t(s)),c=yt(t(s));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function o(s,u,l,c){var d=r(s,u,l,c+"/conv"),h=i(u,c+"/scale");return{conv:d,scale:h}}function a(s,u,l,c,d){d===void 0&&(d=!1);var h=o((d?.5:1)*s,u,l,c+"/conv1"),f=o(s,u,l,c+"/conv2");return{conv1:h,conv2:f}}return{extractConvLayerParams:o,extractResidualLayerParams:a}}function H8(t){var e=ki(t),n=e.extractWeights,r=e.getRemainingWeights,i=[],o=G8(n,i),a=o.extractConvLayerParams,s=o.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),h=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),m=s(36864,64,3,"conv64_2"),p=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),x=s(147456,128,3,"conv128_2"),w=s(589824,256,3,"conv256_down",!0),b=s(589824,256,3,"conv256_1"),k=s(589824,256,3,"conv256_2"),_=s(589824,256,3,"conv256_down_out"),S=Q(function(){return to(qi(n(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var C={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:d,conv64_down:h,conv64_1:f,conv64_2:m,conv64_3:p,conv128_down:v,conv128_1:g,conv128_2:x,conv256_down:w,conv256_1:b,conv256_2:k,conv256_down_out:_,fc:S};return{params:C,paramMappings:i}}function K8(t,e){var n=co(t,e);function r(a){var s=n(a+"/scale/weights",1),u=n(a+"/scale/biases",1);return{weights:s,biases:u}}function i(a){var s=n(a+"/conv/filters",4),u=n(a+"/conv/bias",1),l=r(a);return{conv:{filters:s,bias:u},scale:l}}function o(a){return{conv1:i(a+"/conv1"),conv2:i(a+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function q8(t){var e=[],n=K8(t,e),r=n.extractConvLayerParams,i=n.extractResidualLayerParams,o=r("conv32_down"),a=i("conv32_1"),s=i("conv32_2"),u=i("conv32_3"),l=i("conv64_down"),c=i("conv64_1"),d=i("conv64_2"),h=i("conv64_3"),f=i("conv128_down"),m=i("conv128_1"),p=i("conv128_2"),v=i("conv256_down"),g=i("conv256_1"),x=i("conv256_2"),w=i("conv256_down_out"),b=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!n8(b))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var k={conv32_down:o,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:d,conv64_3:h,conv128_down:f,conv128_1:m,conv128_2:p,conv256_down:v,conv256_1:g,conv256_2:x,conv256_down_out:w,fc:b};return bi(t,e),{params:k,paramMappings:e}}function Er(t,e){var n=W8(t,e.conv1);return n=dR(n,e.conv2),n=Ee(n,t),n=it(n),n}function yc(t,e){var n=hR(t,e.conv1);n=dR(n,e.conv2);var r=Nl(t,2,2,"valid"),i=Ge(r.shape),o=r.shape[3]!==n.shape[3],a=r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2];if(a){var s=Eu(n.shape);s[1]=1;var u=Ge(s);n=St([n,u],1);var l=Eu(n.shape);l[2]=1;var c=Ge(l);n=St([n,c],2)}return r=o?St([r,i],3):r,n=Ee(r,n),n=it(n),n}var X8=function(t){ye(e,t);function e(){return t.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return Q(function(){var i=n.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],a=Pl(i,o).div(J(256)),s=hR(a,r.conv32_down);s=Nt(s,3,2,"valid"),s=Er(s,r.conv32_1),s=Er(s,r.conv32_2),s=Er(s,r.conv32_3),s=yc(s,r.conv64_down),s=Er(s,r.conv64_1),s=Er(s,r.conv64_2),s=Er(s,r.conv64_3),s=yc(s,r.conv128_down),s=Er(s,r.conv128_1),s=Er(s,r.conv128_2),s=yc(s,r.conv256_down),s=Er(s,r.conv256_1),s=Er(s,r.conv256_2),s=yc(s,r.conv256_down_out);var u=s.mean([1,2]),l=Oh(u,r.fc);return l})},e.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Dt(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(n){return ue(this,void 0,void 0,function(){var r,i,o,a=this;return le(this,function(s){switch(s.label){case 0:return[4,Dt(n)];case 1:return r=s.sent(),i=Q(function(){return Ct(a.forwardInput(r))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return o=s.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(n){return q8(n)},e.prototype.extractParams=function(n){return H8(n)},e}(wi);function fR(t,e){var n={descriptor:e};return Object.assign({},t,n)}function pR(t,e){var n={age:e};return Object.assign({},t,n)}function mR(t,e,n){var r={gender:e,genderProbability:n};return Object.assign({},t,r)}var gR=function(){function t(e){var n=e===void 0?{}:e,r=n.minFaceSize,i=n.scaleFactor,o=n.maxNumScales,a=n.scoreThresholds,s=n.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function Y8(t,e){function n(u,l){var c=cn(t(9*u),[3,3,u,1]),d=yt(t(u)),h=yt(t(u)),f=yt(t(u)),m=yt(t(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:d,batch_norm_offset:h,batch_norm_mean:f,batch_norm_variance:m}}function r(u,l,c,d,h){var f=cn(t(u*l*c*c),[c,c,u,l]),m=yt(t(l));return e.push({paramPath:d+"/filters"},{paramPath:d+"/"+(h?"batch_norm_offset":"bias")}),{filters:f,bias:m}}function i(u,l,c,d){var h=r(u,l,c,d,!0),f=h.filters,m=h.bias;return{filters:f,batch_norm_offset:m}}function o(u,l,c){var d=n(u,c+"/depthwise_conv"),h=i(u,l,1,c+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:h}}function a(){var u=i(3,32,3,"mobilenetv1/conv_0"),l=o(32,64,"mobilenetv1/conv_1"),c=o(64,128,"mobilenetv1/conv_2"),d=o(128,128,"mobilenetv1/conv_3"),h=o(128,256,"mobilenetv1/conv_4"),f=o(256,256,"mobilenetv1/conv_5"),m=o(256,512,"mobilenetv1/conv_6"),p=o(512,512,"mobilenetv1/conv_7"),v=o(512,512,"mobilenetv1/conv_8"),g=o(512,512,"mobilenetv1/conv_9"),x=o(512,512,"mobilenetv1/conv_10"),w=o(512,512,"mobilenetv1/conv_11"),b=o(512,1024,"mobilenetv1/conv_12"),k=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:d,conv_4:h,conv_5:f,conv_6:m,conv_7:p,conv_8:v,conv_9:g,conv_10:x,conv_11:w,conv_12:b,conv_13:k}}function s(){var u=i(1024,256,1,"prediction_layer/conv_0"),l=i(256,512,3,"prediction_layer/conv_1"),c=i(512,128,1,"prediction_layer/conv_2"),d=i(128,256,3,"prediction_layer/conv_3"),h=i(256,128,1,"prediction_layer/conv_4"),f=i(128,256,3,"prediction_layer/conv_5"),m=i(256,64,1,"prediction_layer/conv_6"),p=i(64,128,3,"prediction_layer/conv_7"),v=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),g=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),x=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),w=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),b=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),k=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),_=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),S=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),C=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),E=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),R=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),D=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),P={box_encoding_predictor:v,class_predictor:g},F={box_encoding_predictor:x,class_predictor:w},U={box_encoding_predictor:b,class_predictor:k},z={box_encoding_predictor:_,class_predictor:S},W={box_encoding_predictor:C,class_predictor:E},L={box_encoding_predictor:R,class_predictor:D};return{conv_0:u,conv_1:l,conv_2:c,conv_3:d,conv_4:h,conv_5:f,conv_6:m,conv_7:p,box_predictor_0:P,box_predictor_1:F,box_predictor_2:U,box_predictor_3:z,box_predictor_4:W,box_predictor_5:L}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function J8(t){var e=[],n=ki(t),r=n.extractWeights,i=n.getRemainingWeights,o=Y8(r,e),a=o.extractMobilenetV1Params,s=o.extractPredictionLayerParams,u=a(),l=s(),c=Wy(r(5118*4),[1,5118,4]),d={extra_dim:c};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:d},paramMappings:e}}function Q8(t,e){var n=co(t,e);function r(l,c,d){var h=n(l+"/Conv2d_"+c+"_pointwise/weights",4,d+"/filters"),f=n(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:h,batch_norm_offset:f}}function i(l){var c="mobilenetv1/conv_"+l,d="MobilenetV1/Conv2d_"+l+"_depthwise",h=c+"/depthwise_conv",f=c+"/pointwise_conv",m=n(d+"/depthwise_weights",4,h+"/filters"),p=n(d+"/BatchNorm/gamma",1,h+"/batch_norm_scale"),v=n(d+"/BatchNorm/beta",1,h+"/batch_norm_offset"),g=n(d+"/BatchNorm/moving_mean",1,h+"/batch_norm_mean"),x=n(d+"/BatchNorm/moving_variance",1,h+"/batch_norm_variance");return{depthwise_conv:{filters:m,batch_norm_scale:p,batch_norm_offset:v,batch_norm_mean:g,batch_norm_variance:x},pointwise_conv:r("MobilenetV1",l,f)}}function o(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function a(l,c){var d=n(l+"/weights",4,c+"/filters"),h=n(l+"/biases",1,c+"/bias");return{filters:d,bias:h}}function s(l){var c=a("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),d=a("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:d}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:u}}function Z8(t){var e=[],n=Q8(t,e),r=n.extractMobilenetV1Params,i=n.extractPredictionLayerParams,o=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Bh(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var a={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return bi(t,e),{params:a,paramMappings:e}}function Rr(t,e,n){return Q(function(){var r=Jn(t,e.filters,n,"same");return r=Ee(r,e.batch_norm_offset),t0(r,0,6)})}var eG=.0010000000474974513;function tG(t,e,n){return Q(function(){var r=Mh(t,e.filters,n,"same");return r=cA(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,eG),t0(r,0,6)})}function nG(t){return[2,4,6,12].some(function(e){return e===t})?[2,2]:[1,1]}function rG(t,e){return Q(function(){var n=null,r=Rr(t,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(o,a){var s=a+1,u=nG(s);r=tG(r,o.depthwise_conv,u),r=Rr(r,o.pointwise_conv,[1,1]),s===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function iG(t,e,n,r,i){var o=t.shape[0],a=Math.min(n,o),s=e.map(function(c,d){return{score:c,boxIndex:d}}).filter(function(c){return c.score>i}).sort(function(c,d){return d.score-c.score}),u=function(c){return c<=r?1:0},l=[];return s.forEach(function(c){if(!(l.length>=a)){for(var d=c.score,h=l.length-1;h>=0;--h){var f=oG(t,c.boxIndex,l[h]);if(f!==0&&(c.score*=u(f),c.score<=i))break}d===c.score&&l.push(c.boxIndex)}}),l}function oG(t,e,n){var r=t.arraySync(),i=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),a=Math.max(r[e][0],r[e][2]),s=Math.max(r[e][1],r[e][3]),u=Math.min(r[n][0],r[n][2]),l=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),d=Math.max(r[n][1],r[n][3]),h=(a-i)*(s-o),f=(c-u)*(d-l);if(h<=0||f<=0)return 0;var m=Math.max(i,u),p=Math.max(o,l),v=Math.min(a,c),g=Math.min(s,d),x=Math.max(v-m,0)*Math.max(g-p,0);return x/(h+f-x)}function aG(t){var e=Ct(to(t,[1,0])),n=[At(e[2],e[0]),At(e[3],e[1])],r=[Ee(e[0],ur(n[0],J(2))),Ee(e[1],ur(n[1],J(2)))];return{sizes:n,centers:r}}function sG(t,e){var n=aG(t),r=n.sizes,i=n.centers,o=Ct(to(e,[1,0])),a=ur(Jt(yg(ur(o[2],J(5))),r[0]),J(2)),s=Ee(Jt(ur(o[0],J(10)),r[0]),i[0]),u=ur(Jt(yg(ur(o[3],J(5))),r[1]),J(2)),l=Ee(Jt(ur(o[1],J(10)),r[1]),i[1]);return to(In([At(s,a),At(l,u),Ee(s,a),Ee(l,u)]),[1,0])}function uG(t,e,n){return Q(function(){var r=t.shape[0],i=sG(cr(Qa(n.extra_dim,[r,1,1]),[-1,4]),cr(t,[-1,4]));i=cr(i,[r,i.shape[0]/r,4]);var o=aA(zr(e,[0,0,1],[-1,-1,-1])),a=zr(o,[0,0,0],[-1,-1,1]);a=cr(a,[r,a.shape[1]]);var s=Ct(i),u=Ct(a);return{boxes:s,scores:u}})}function fa(t,e){return Q(function(){var n=t.shape[0],r=cr(fr(t,e.box_encoding_predictor),[n,-1,1,4]),i=cr(fr(t,e.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function lG(t,e,n){return Q(function(){var r=Rr(t,n.conv_0,[1,1]),i=Rr(r,n.conv_1,[2,2]),o=Rr(i,n.conv_2,[1,1]),a=Rr(o,n.conv_3,[2,2]),s=Rr(a,n.conv_4,[1,1]),u=Rr(s,n.conv_5,[2,2]),l=Rr(u,n.conv_6,[1,1]),c=Rr(l,n.conv_7,[2,2]),d=fa(e,n.box_predictor_0),h=fa(t,n.box_predictor_1),f=fa(i,n.box_predictor_2),m=fa(a,n.box_predictor_3),p=fa(u,n.box_predictor_4),v=fa(c,n.box_predictor_5),g=St([d.boxPredictionEncoding,h.boxPredictionEncoding,f.boxPredictionEncoding,m.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding],1),x=St([d.classPrediction,h.classPrediction,f.classPrediction,m.classPrediction,p.classPrediction,v.classPrediction],1);return{boxPredictions:g,classPredictions:x}})}var Il=function(){function t(e){var n=e===void 0?{}:e,r=n.minConfidence,i=n.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),vR=function(t){ye(e,t);function e(){return t.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(n){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return Q(function(){var i=n.toBatchTensor(512,!1).toFloat(),o=At(Jt(i,J(.007843137718737125)),J(1)),a=rG(o,r.mobilenetv1),s=lG(a.out,a.conv11,r.prediction_layer),u=s.boxPredictions,l=s.classPredictions;return uG(u,l,r.output_layer)})},e.prototype.forward=function(n){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Dt(n)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(n,r){return r===void 0&&(r={}),ue(this,void 0,void 0,function(){var i,o,a,s,u,l,c,d,h,f,m,p,v,g,x,w,b,k,_,S,C;return le(this,function(E){switch(E.label){case 0:return i=new Il(r),o=i.maxResults,a=i.minConfidence,[4,Dt(n)];case 1:for(s=E.sent(),u=this.forwardInput(s),l=u.boxes,c=u.scores,d=l[0],h=c[0],f=1;f<l.length;f++)l[f].dispose(),c[f].dispose();return v=(p=Array).from,[4,h.data()];case 2:return m=v.apply(p,[E.sent()]),g=.5,x=iG(d,m,o,g,a),w=s.getReshapedInputDimensions(0),b=s.inputSize,k=b/w.width,_=b/w.height,S=d.arraySync(),C=x.map(function(R){var D=[Math.max(0,S[R][0]),Math.min(1,S[R][2])].map(function(L){return L*_}),P=D[0],F=D[1],U=[Math.max(0,S[R][1]),Math.min(1,S[R][3])].map(function(L){return L*k}),z=U[0],W=U[1];return new Kr(m[R],new y0(z,P,W-z,F-P),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),d.dispose(),h.dispose(),[2,C]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(n){return Z8(n)},e.prototype.extractParams=function(n){return J8(n)},e}(wi);(function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e})(vR);var cG=.4,dG=[new Me(.738768,.874946),new Me(2.42204,2.65704),new Me(4.30971,7.04493),new Me(10.246,4.59428),new Me(12.6868,11.8741)],hG=[new Me(1.603231,2.094468),new Me(6.041143,7.080126),new Me(2.882459,3.518061),new Me(4.266906,5.178857),new Me(9.041765,10.66308)],fG=[117.001,114.697,97.404],pG="tiny_yolov2_model",mG="tiny_yolov2_separable_conv_model",xc=function(t){return typeof t=="number"};function gG(t){if(!t)throw new Error("invalid config: "+t);if(typeof t.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!xc(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(e){return e||{}}).every(function(e){return xc(e.x)&&xc(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||t.meanRgb.length!==3||!t.meanRgb.every(xc)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}function N0(t){return Q(function(){var e=Jt(t,J(.10000000149011612));return Ee(it(At(t,e)),e)})}function Ei(t,e){return Q(function(){var n=Jo(t,[[0,0],[1,1],[1,1],[0,0]]);return n=Jn(n,e.conv.filters,[1,1],"valid"),n=At(n,e.bn.sub),n=Jt(n,e.bn.truediv),n=Ee(n,e.conv.bias),N0(n)})}function Ai(t,e){return Q(function(){var n=Jo(t,[[0,0],[1,1],[1,1],[0,0]]);return n=o0(n,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),n=Ee(n,e.bias),N0(n)})}function vG(t,e){var n=Uh(t,e);function r(a,s){var u=yt(t(a)),l=yt(t(a));return e.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:l}}function i(a,s,u){var l=n(a,s,3,u+"/conv"),c=r(s,u+"/bn");return{conv:l,bn:c}}var o=C0(t,e);return{extractConvParams:n,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function yG(t,e,n,r){var i=ki(t),o=i.extractWeights,a=i.getRemainingWeights,s=[],u=vG(o,s),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,d=u.extractSeparableConvParams,h;if(e.withSeparableConvs){var f=r[0],m=r[1],p=r[2],v=r[3],g=r[4],x=r[5],w=r[6],b=r[7],k=r[8],_=e.isFirstLayerConv2d?l(f,m,3,"conv0"):d(f,m,"conv0"),S=d(m,p,"conv1"),C=d(p,v,"conv2"),E=d(v,g,"conv3"),R=d(g,x,"conv4"),D=d(x,w,"conv5"),P=b?d(w,b,"conv6"):void 0,F=k?d(b,k,"conv7"):void 0,U=l(k||b||w,5*n,1,"conv8");h={conv0:_,conv1:S,conv2:C,conv3:E,conv4:R,conv5:D,conv6:P,conv7:F,conv8:U}}else{var f=r[0],m=r[1],p=r[2],v=r[3],g=r[4],x=r[5],w=r[6],b=r[7],k=r[8],_=c(f,m,"conv0"),S=c(m,p,"conv1"),C=c(p,v,"conv2"),E=c(v,g,"conv3"),R=c(g,x,"conv4"),D=c(x,w,"conv5"),P=c(w,b,"conv6"),F=c(b,k,"conv7"),U=l(k,5*n,1,"conv8");h={conv0:_,conv1:S,conv2:C,conv3:E,conv4:R,conv5:D,conv6:P,conv7:F,conv8:U}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:h,paramMappings:s}}function xG(t,e){var n=co(t,e);function r(s){var u=n(s+"/sub",1),l=n(s+"/truediv",1);return{sub:u,truediv:l}}function i(s){var u=n(s+"/filters",4),l=n(s+"/bias",1);return{filters:u,bias:l}}function o(s){var u=i(s+"/conv"),l=r(s+"/bn");return{conv:u,bn:l}}var a=E0(n);return{extractConvParams:i,extractConvWithBatchNormParams:o,extractSeparableConvParams:a}}function wG(t,e){var n=[],r=xG(t,n),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams,s;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;s={conv0:e.isFirstLayerConv2d?i("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:i("conv8")}}else s={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return bi(t,n),{params:s,paramMappings:n}}var Q1;(function(t){t[t.XS=224]="XS",t[t.SM=320]="SM",t[t.MD=416]="MD",t[t.LG=608]="LG"})(Q1||(Q1={}));var T0=function(){function t(e){var n=e===void 0?{}:e,r=n.inputSize,i=n.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),yR=function(t){ye(e,t);function e(n){var r=t.call(this,"TinyYolov2")||this;return gG(n),r._config=n,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(n,r){var i=Ei(n,r.conv0);return i=Nt(i,[2,2],[2,2],"same"),i=Ei(i,r.conv1),i=Nt(i,[2,2],[2,2],"same"),i=Ei(i,r.conv2),i=Nt(i,[2,2],[2,2],"same"),i=Ei(i,r.conv3),i=Nt(i,[2,2],[2,2],"same"),i=Ei(i,r.conv4),i=Nt(i,[2,2],[2,2],"same"),i=Ei(i,r.conv5),i=Nt(i,[2,2],[1,1],"same"),i=Ei(i,r.conv6),i=Ei(i,r.conv7),fr(i,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(n,r){var i=this.config.isFirstLayerConv2d?N0(fr(n,r.conv0,"valid",!1)):Ai(n,r.conv0);return i=Nt(i,[2,2],[2,2],"same"),i=Ai(i,r.conv1),i=Nt(i,[2,2],[2,2],"same"),i=Ai(i,r.conv2),i=Nt(i,[2,2],[2,2],"same"),i=Ai(i,r.conv3),i=Nt(i,[2,2],[2,2],"same"),i=Ai(i,r.conv4),i=Nt(i,[2,2],[2,2],"same"),i=Ai(i,r.conv5),i=Nt(i,[2,2],[1,1],"same"),i=r.conv6?Ai(i,r.conv6):i,i=r.conv7?Ai(i,r.conv7):i,fr(i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(n,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return Q(function(){var a=n.toBatchTensor(r,!1).toFloat();return a=i.config.meanRgb?Pl(a,i.config.meanRgb):a,a=a.div(J(256)),i.config.withSeparableConvs?i.runMobilenet(a,o):i.runTinyYolov2(a,o)})},e.prototype.forward=function(n,r){return ue(this,void 0,void 0,function(){var i;return le(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Dt(n)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(n,r){return r===void 0&&(r={}),ue(this,void 0,void 0,function(){var i,o,a,s,u,l,c,d,h,f,m,p,v,g,x=this;return le(this,function(w){switch(w.label){case 0:return i=new T0(r),o=i.inputSize,a=i.scoreThreshold,[4,Dt(n)];case 1:return s=w.sent(),[4,this.forwardInput(s,o)];case 2:return u=w.sent(),l=Q(function(){return Ct(u)[0].expandDims()}),c={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(l,s.getReshapedInputDimensions(0),a)];case 3:return d=w.sent(),u.dispose(),l.dispose(),h=d.map(function(b){return b.box}),f=d.map(function(b){return b.score}),m=d.map(function(b){return b.classScore}),p=d.map(function(b){return x.config.classes[b.label]}),v=ul(h.map(function(b){return b.rescale(o)}),f,this.config.iouThreshold,!0),g=v.map(function(b){return new WA(f[b],m[b],p[b],h[b],c)}),[2,g]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(n){return wG(n,this.config)},e.prototype.extractParams=function(n){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return yG(n,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(n,r,i){return ue(this,void 0,void 0,function(){var o,a,s,u,l,c,d,h,f,m,p,v,g,x,w,b,k,_,S,C,E,R,D,P,F,U,z,W,L,I=this;return le(this,function(j){switch(j.label){case 0:return o=r.width,a=r.height,s=Math.max(o,a),u=s/o,l=s/a,c=n.shape[1],d=this.config.anchors.length,h=Q(function(){var B=n.reshape([c,c,d,I.boxEncodingSize]),K=B.slice([0,0,0,0],[c,c,d,4]),X=B.slice([0,0,0,4],[c,c,d,1]),Y=I.withClassScores?yi(B.slice([0,0,0,5],[c,c,d,I.config.classes.length]),3):J(0);return[K,X,Y]}),f=h[0],m=h[1],p=h[2],v=[],[4,m.array()];case 1:return g=j.sent(),[4,f.array()];case 2:x=j.sent(),w=0,j.label=3;case 3:if(!(w<c))return[3,12];b=0,j.label=4;case 4:if(!(b<c))return[3,11];k=0,j.label=5;case 5:return k<d?(_=bp(g[w][b][k][0]),!i||_>i?(S=(b+bp(x[w][b][k][0]))/c*u,C=(w+bp(x[w][b][k][1]))/c*l,E=Math.exp(x[w][b][k][2])*this.config.anchors[k].x/c*u,R=Math.exp(x[w][b][k][3])*this.config.anchors[k].y/c*l,D=S-E/2,P=C-R/2,F={row:w,col:b,anchor:k},this.withClassScores?[4,this.extractPredictedClass(p,F)]:[3,7]):[3,9]):[3,10];case 6:return L=j.sent(),[3,8];case 7:L={classScore:1,label:0},j.label=8;case 8:U=L,z=U.classScore,W=U.label,v.push(Kt({box:new Vh(D,P,D+E,P+R),score:_,classScore:_*z,label:W},F)),j.label=9;case 9:return k++,[3,5];case 10:return b++,[3,4];case 11:return w++,[3,3];case 12:return f.dispose(),m.dispose(),p.dispose(),[2,v]}})})},e.prototype.extractPredictedClass=function(n,r){return ue(this,void 0,void 0,function(){var i,o,a,s;return le(this,function(u){switch(u.label){case 0:return i=r.row,o=r.col,a=r.anchor,[4,n.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return s[i][o][a][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(wi),bG=function(t){ye(e,t);function e(n){n===void 0&&(n=!0);var r=this,i=Object.assign({},{withSeparableConvs:n,iouThreshold:cG,classes:["face"]},n?{anchors:hG,meanRgb:fG}:{anchors:dG,withClassScores:!0});return r=t.call(this,i)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(n,r){return ue(this,void 0,void 0,function(){var i;return le(this,function(o){switch(o.label){case 0:return[4,this.detect(n,r)];case 1:return i=o.sent(),[2,i.map(function(a){return new Kr(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?mG:pG},e.prototype.extractParamsFromWeigthMap=function(n){return t.prototype.extractParamsFromWeigthMap.call(this,n)},e}(yR),xR=function(t){ye(e,t);function e(){var n=t!==null&&t.apply(this,arguments)||this;return n._name="TinyFaceDetectorOptions",n}return e}(T0),Dl=function(){function t(){}return t.prototype.then=function(e){return ue(this,void 0,void 0,function(){var n;return le(this,function(r){switch(r.label){case 0:return n=e,[4,this.run()];case 1:return[2,n.apply(void 0,[r.sent()])]}})})},t.prototype.run=function(){return ue(this,void 0,void 0,function(){return le(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},t}();function $h(t,e,n,r,i){return i===void 0&&(i=function(o){var a=o.alignedRect;return a}),ue(this,void 0,void 0,function(){var o,a,s,u,l;return le(this,function(c){switch(c.label){case 0:return o=t.map(function(d){return N8(d)?i(d):d.detection}),s=r,s?[3,5]:e instanceof nt?[4,_0(e,o)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,k0(e,o)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return a=s,[4,n(a)];case 6:return l=c.sent(),a.forEach(function(d){return d instanceof nt&&d.dispose()}),[2,l]}})})}function P0(t,e,n,r,i){return ue(this,void 0,void 0,function(){var o=this;return le(this,function(a){return[2,$h([t],e,function(s){return ue(o,void 0,void 0,function(){return le(this,function(u){return[2,n(s[0])]})})},r,i)]})})}function kG(t){return Q(function(){return In(Ct(t,3).reverse(),3)})}var wc=2,Jd=12;function _G(t,e){var n=Uh(t,e),r=S0(t,e);function i(l,c){var d=yt(t(l));return e.push({paramPath:c}),d}function o(l,c,d){d===void 0&&(d=!1);var h=n(l[0],l[1],3,c+"/conv1"),f=i(l[1],c+"/prelu1_alpha"),m=n(l[1],l[2],3,c+"/conv2"),p=i(l[2],c+"/prelu2_alpha"),v=n(l[2],l[3],d?2:3,c+"/conv3"),g=i(l[3],c+"/prelu3_alpha");return{conv1:h,prelu1_alpha:f,conv2:m,prelu2_alpha:p,conv3:v,prelu3_alpha:g}}function a(){var l=o([3,10,16,32],"pnet"),c=n(32,2,1,"pnet/conv4_1"),d=n(32,4,1,"pnet/conv4_2");return Kt(Kt({},l),{conv4_1:c,conv4_2:d})}function s(){var l=o([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),d=i(128,"rnet/prelu4_alpha"),h=r(128,2,"rnet/fc2_1"),f=r(128,4,"rnet/fc2_2");return Kt(Kt({},l),{fc1:c,prelu4_alpha:d,fc2_1:h,fc2_2:f})}function u(){var l=o([3,32,64,64],"onet"),c=n(64,128,2,"onet/conv4"),d=i(128,"onet/prelu4_alpha"),h=r(1152,256,"onet/fc1"),f=i(256,"onet/prelu5_alpha"),m=r(256,2,"onet/fc2_1"),p=r(256,4,"onet/fc2_2"),v=r(256,10,"onet/fc2_3");return Kt(Kt({},l),{conv4:c,prelu4_alpha:d,fc1:h,prelu5_alpha:f,fc2_1:m,fc2_2:p,fc2_3:v})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function SG(t){var e=ki(t),n=e.extractWeights,r=e.getRemainingWeights,i=[],o=_G(n,i),a=o.extractPNetParams,s=o.extractRNetParams,u=o.extractONetParams,l=a(),c=s(),d=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:d},paramMappings:i}}function CG(t,e){var n=co(t,e);function r(c){var d=n(c+"/weights",4,c+"/filters"),h=n(c+"/bias",1);return{filters:d,bias:h}}function i(c){var d=n(c+"/weights",2),h=n(c+"/bias",1);return{weights:d,bias:h}}function o(c){return n(c,1)}function a(c){var d=r(c+"/conv1"),h=o(c+"/prelu1_alpha"),f=r(c+"/conv2"),m=o(c+"/prelu2_alpha"),p=r(c+"/conv3"),v=o(c+"/prelu3_alpha");return{conv1:d,prelu1_alpha:h,conv2:f,prelu2_alpha:m,conv3:p,prelu3_alpha:v}}function s(){var c=a("pnet"),d=r("pnet/conv4_1"),h=r("pnet/conv4_2");return Kt(Kt({},c),{conv4_1:d,conv4_2:h})}function u(){var c=a("rnet"),d=i("rnet/fc1"),h=o("rnet/prelu4_alpha"),f=i("rnet/fc2_1"),m=i("rnet/fc2_2");return Kt(Kt({},c),{fc1:d,prelu4_alpha:h,fc2_1:f,fc2_2:m})}function l(){var c=a("onet"),d=r("onet/conv4"),h=o("onet/prelu4_alpha"),f=i("onet/fc1"),m=o("onet/prelu5_alpha"),p=i("onet/fc2_1"),v=i("onet/fc2_2"),g=i("onet/fc2_3");return Kt(Kt({},c),{conv4:d,prelu4_alpha:h,fc1:f,prelu5_alpha:m,fc2_1:p,fc2_2:v,fc2_3:g})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:l}}function EG(t){var e=[],n=CG(t,e),r=n.extractPNetParams,i=n.extractRNetParams,o=n.extractONetParams,a=r(),s=i(),u=o();return bi(t,e),{params:{pnet:a,rnet:s,onet:u},paramMappings:e}}function Eg(t,e){var n=e[0],r=e[1];return{height:Math.floor(n*t),width:Math.floor(r*t)}}function AG(t,e,n){for(var r=n[0],i=n[1],o=Jd/t,a=[],s=Math.min(r,i)*o,u=0;s>=12;)a.push(o*Math.pow(e,u)),s=s*e,u+=1;return a}var I0=function(t){ye(e,t);function e(n,r,i,o){return t.call(this,{left:n,top:r,right:i,bottom:o},!0)||this}return e}(no);function wR(t){return Q(function(){return Jt(At(t,J(127.5)),J(.0078125))})}function is(t,e){return Q(function(){return Ee(it(t),Jt(e,Wd(it(Wd(t)))))})}function D0(t,e,n){return n===void 0&&(n=!1),Q(function(){var r=fr(t,e.conv1,"valid");return r=is(r,e.prelu1_alpha),r=Nt(r,n?[2,2]:[3,3],[2,2],"same"),r=fr(r,e.conv2,"valid"),r=is(r,e.prelu2_alpha),r=n?r:Nt(r,[3,3],[2,2],"valid"),r=fr(r,e.conv3,"valid"),r=is(r,e.prelu3_alpha),r})}function RG(t,e){return Q(function(){var n=D0(t,e,!0),r=fr(n,e.conv4_1,"valid"),i=Un(jh(r,3),3),o=yi(At(r,i),3),a=fr(n,e.conv4_2,"valid");return{prob:o,regions:a}})}function NG(t,e){return Q(function(){var n=Eg(e,t.shape.slice(1)),r=n.height,i=n.width,o=c0.resizeBilinear(t,[r,i]),a=wR(o);return to(a,[0,2,1,3])})}function TG(t,e,n,r){for(var i=[],o=t.arraySync(),a=0;a<t.shape[0];a++)for(var s=0;s<t.shape[1];s++)o[a][s]>=r&&i.push(new Me(s,a));var u=i.map(function(l){var c=new Vh(Math.round((l.y*wc+1)/n),Math.round((l.x*wc+1)/n),Math.round((l.y*wc+Jd)/n),Math.round((l.x*wc+Jd)/n)),d=o[l.y][l.x],h=e.arraySync(),f=new I0(h[l.y][l.x][0],h[l.y][l.x][1],h[l.y][l.x][2],h[l.y][l.x][3]);return{cell:c,score:d,region:f}});return u}function PG(t,e,n,r,i){i.stage1=[];var o=e.map(function(h){return Q(function(){var f={scale:h},m=NG(t,h),p=Date.now(),v=RG(m,r),g=v.prob,x=v.regions;f.pnet=Date.now()-p;var w=Ct(Ct(g,3)[1])[0],b=Ct(x)[0];return{scoresTensor:w,regionsTensor:b,scale:h,statsForScale:f}})}),a=o.map(function(h){var f=h.scoresTensor,m=h.regionsTensor,p=h.scale,v=h.statsForScale,g=TG(f,m,p,n);if(f.dispose(),m.dispose(),!g.length)return i.stage1.push(v),[];var x=Date.now(),w=ul(g.map(function(b){return b.cell}),g.map(function(b){return b.score}),.5);return v.nms=Date.now()-x,v.numBoxes=w.length,i.stage1.push(v),w.map(function(b){return g[b]})}),s=a.reduce(function(h,f){return h.concat(f)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),d=ul(s.map(function(h){return h.cell}),s.map(function(h){return h.score}),.7);i.stage1_nms=Date.now()-c,l=d.map(function(h){return s[h].score}),u=d.map(function(h){return s[h]}).map(function(h){var f=h.cell,m=h.region;return new Vh(f.left+m.left*f.width,f.top+m.top*f.height,f.right+m.right*f.width,f.bottom+m.bottom*f.height).toSquare().round()})}return{boxes:u,scores:l}}function bR(t,e,n){var r=n.width,i=n.height;return ue(this,void 0,void 0,function(){var o,a,s,u=this;return le(this,function(l){switch(l.label){case 0:return o=Ko(t),[4,Promise.all(e.map(function(c){return ue(u,void 0,void 0,function(){var d,h,f,m,p,v,g,x;return le(this,function(w){return d=c.padAtBorders(t.height,t.width),h=d.y,f=d.ey,m=d.x,p=d.ex,v=m-1,g=h-1,x=o.getImageData(v,g,p-v,f-g),[2,Zt.isNodejs()?b0(x):createImageBitmap(x)]})})}))];case 1:return a=l.sent(),s=[],a.forEach(function(c){var d=zh({width:r,height:i}),h=Ko(d);h.drawImage(c,0,0,r,i);for(var f=h.getImageData(0,0,r,i).data,m=[],p=0;p<f.length;p+=4)m.push(f[p+2]),m.push(f[p+1]),m.push(f[p]);s.push(m)}),[2,s.map(function(c){var d=Q(function(){var h=to(cn(c,[1,r,i,3]),[0,2,1,3]).toFloat();return wR(h)});return d})]}})})}function IG(t,e){return Q(function(){var n=D0(t,e),r=cr(n,[n.shape[0],e.fc1.weights.shape[0]]),i=Dr(r,e.fc1),o=is(i,e.prelu4_alpha),a=Dr(o,e.fc2_1),s=Un(jh(a,1),1),u=yi(At(a,s),1),l=Dr(o,e.fc2_2),c=Ct(u,1)[1];return{scores:c,regions:l}})}function DG(t,e,n,r,i){return ue(this,void 0,void 0,function(){var o,a,s,u,l,c,d,h,f,m,p,v,g,x;return le(this,function(w){switch(w.label){case 0:return o=Date.now(),[4,bR(t,e,{width:24,height:24})];case 1:return a=w.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(b){var k=IG(b,r);return b.dispose(),k}),i.stage2_rnet=Date.now()-o,u=s.length>1?St(s.map(function(b){return b.scores})):s[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[w.sent()]),u.dispose(),h=l.map(function(b,k){return{score:b,idx:k}}).filter(function(b){return b.score>n}).map(function(b){var k=b.idx;return k}),f=h.map(function(b){return e[b]}),m=h.map(function(b){return l[b]}),p=[],v=[],f.length>0&&(o=Date.now(),g=ul(f,m,.7),i.stage2_nms=Date.now()-o,x=g.map(function(b){var k=s[h[b]].regions.arraySync();return new I0(k[0][0],k[0][1],k[0][2],k[0][3])}),v=g.map(function(b){return m[b]}),p=g.map(function(b,k){return f[b].calibrate(x[k])})),s.forEach(function(b){b.regions.dispose(),b.scores.dispose()}),[2,{boxes:p,scores:v}]}})})}function MG(t,e){return Q(function(){var n=D0(t,e);n=Nt(n,[2,2],[2,2],"same"),n=fr(n,e.conv4,"valid"),n=is(n,e.prelu4_alpha);var r=cr(n,[n.shape[0],e.fc1.weights.shape[0]]),i=Dr(r,e.fc1),o=is(i,e.prelu5_alpha),a=Dr(o,e.fc2_1),s=Un(jh(a,1),1),u=yi(At(a,s),1),l=Dr(o,e.fc2_2),c=Dr(o,e.fc2_3),d=Ct(u,1)[1];return{scores:d,regions:l,points:c}})}function OG(t,e,n,r,i){return ue(this,void 0,void 0,function(){var o,a,s,u,l,c,d,h,f,m,p,v,g,x,w;return le(this,function(b){switch(b.label){case 0:return o=Date.now(),[4,bR(t,e,{width:48,height:48})];case 1:return a=b.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(k){var _=MG(k,r);return k.dispose(),_}),i.stage3_onet=Date.now()-o,u=s.length>1?St(s.map(function(k){return k.scores})):s[0].scores,d=(c=Array).from,[4,u.data()];case 2:return l=d.apply(c,[b.sent()]),u.dispose(),h=l.map(function(k,_){return{score:k,idx:_}}).filter(function(k){return k.score>n}).map(function(k){var _=k.idx;return _}),f=h.map(function(k){var _=s[k].regions.arraySync();return new I0(_[0][0],_[0][1],_[0][2],_[0][3])}),m=h.map(function(k,_){return e[k].calibrate(f[_])}),p=h.map(function(k){return l[k]}),v=[],g=[],x=[],m.length>0&&(o=Date.now(),w=ul(m,p,.7,!1),i.stage3_nms=Date.now()-o,v=w.map(function(k){return m[k]}),g=w.map(function(k){return p[k]}),x=w.map(function(k,_){return Array(5).fill(0).map(function(S,C){var E=s[k].points.arraySync();return new Me(E[0][C]*(v[_].width+1)+v[_].left,E[0][C+5]*(v[_].height+1)+v[_].top)})})),s.forEach(function(k){k.regions.dispose(),k.scores.dispose(),k.points.dispose()}),[2,{boxes:v,scores:g,points:x}]}})})}var jG=function(t){ye(e,t);function e(){return t.call(this,"Mtcnn")||this}return e.prototype.load=function(n){return ue(this,void 0,void 0,function(){return le(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,n)]})})},e.prototype.loadFromDisk=function(n){return ue(this,void 0,void 0,function(){return le(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,n)]})})},e.prototype.forwardInput=function(n,r){return r===void 0&&(r={}),ue(this,void 0,void 0,function(){var i,o,a,s,u,l,c,d,h,f,m,p,v,g,x,w,b,k,_,S,C;return le(this,function(E){switch(E.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(o=n.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=Q(function(){return kG(Un(g0.fromPixels(o)).toFloat())}),l=function(R){return u.dispose(),a.total=Date.now()-s,R},c=u.shape.slice(1),d=c[0],h=c[1],f=new gR(r),m=f.minFaceSize,p=f.scaleFactor,v=f.maxNumScales,g=f.scoreThresholds,x=f.scaleSteps,w=(x||AG(m,p,[d,h])).filter(function(R){var D=Eg(R,[d,h]);return Math.min(D.width,D.height)>Jd}).slice(0,v),a.scales=w,a.pyramid=w.map(function(R){return Eg(R,[d,h])}),b=Date.now(),[4,PG(u,w,g[0],i.pnet,a)];case 1:return k=E.sent(),a.total_stage1=Date.now()-b,k.boxes.length?(a.stage2_numInputBoxes=k.boxes.length,b=Date.now(),[4,DG(o,k.boxes,g[1],i.rnet,a)]):[2,l({results:[],stats:a})];case 2:return _=E.sent(),a.total_stage2=Date.now()-b,_.boxes.length?(a.stage3_numInputBoxes=_.boxes.length,b=Date.now(),[4,OG(o,_.boxes,g[2],i.onet,a)]):[2,l({results:[],stats:a})];case 3:return S=E.sent(),a.total_stage3=Date.now()-b,C=S.boxes.map(function(R,D){return A0(x0({},new Kr(S.scores[D],new y0(R.left/h,R.top/d,R.width/h,R.height/d),{height:d,width:h})),new h8(S.points[D].map(function(P){return P.sub(new Me(R.left,R.top)).div(new Me(R.width,R.height))}),{width:R.width,height:R.height}))}),[2,l({results:C,stats:a})]}})})},e.prototype.forward=function(n,r){return r===void 0&&(r={}),ue(this,void 0,void 0,function(){var i;return le(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Dt(n)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(n,r){return r===void 0&&(r={}),ue(this,void 0,void 0,function(){var i;return le(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Dt(n)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(n){return EG(n)},e.prototype.extractParams=function(n){return SG(n)},e}(wi),FG=.4,LG=[new Me(1.603231,2.094468),new Me(6.041143,7.080126),new Me(2.882459,3.518061),new Me(4.266906,5.178857),new Me(9.041765,10.66308)],BG=[117.001,114.697,97.404],VG=function(t){ye(e,t);function e(){var n=this,r={withSeparableConvs:!0,iouThreshold:FG,classes:["face"],anchors:LG,meanRgb:BG,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return n=t.call(this,r)||this,n}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(n,r){return ue(this,void 0,void 0,function(){var i;return le(this,function(o){switch(o.label){case 0:return[4,this.detect(n,r)];case 1:return i=o.sent(),[2,i.map(function(a){return new Kr(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(n){return t.prototype.extractParamsFromWeigthMap.call(this,n)},e}(yR),on={ssdMobilenetv1:new vR,tinyFaceDetector:new VG,tinyYolov2:new bG,mtcnn:new jG,faceLandmark68Net:new cR,faceLandmark68TinyNet:new U8,faceRecognitionNet:new X8,faceExpressionNet:new R8,ageGenderNet:new L8},kR=function(t){ye(e,t);function e(n,r,i){var o=t.call(this)||this;return o.parentTask=n,o.input=r,o.extractedFaces=i,o}return e}(Dl),M0=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r,i=this;return le(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),[4,$h(n,this.input,function(a){return ue(i,void 0,void 0,function(){return le(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return on.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,n.map(function(a,s){return sR(a,r[s])})]}})})},e.prototype.withAgeAndGender=function(){return new L0(this,this.input)},e}(kR),O0=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r;return le(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),n?[4,P0(n,this.input,function(o){return on.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,sR(n,r)]}})})},e.prototype.withAgeAndGender=function(){return new B0(this,this.input)},e}(kR),j0=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new V0(this,this.input)},e.prototype.withFaceDescriptors=function(){return new U0(this,this.input)},e}(M0),F0=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new z0(this,this.input)},e.prototype.withFaceDescriptor=function(){return new $0(this,this.input)},e}(O0),_R=function(t){ye(e,t);function e(n,r,i){var o=t.call(this)||this;return o.parentTask=n,o.input=r,o.extractedFaces=i,o}return e}(Dl),L0=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r,i=this;return le(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return n=o.sent(),[4,$h(n,this.input,function(a){return ue(i,void 0,void 0,function(){return le(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return on.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,n.map(function(a,s){var u=r[s],l=u.age,c=u.gender,d=u.genderProbability;return pR(mR(a,c,d),l)})]}})})},e.prototype.withFaceExpressions=function(){return new M0(this,this.input)},e}(_R),B0=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r,i,o,a;return le(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),n?[4,P0(n,this.input,function(u){return on.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),i=r.age,o=r.gender,a=r.genderProbability,[2,pR(mR(n,o,a),i)]}})})},e.prototype.withFaceExpressions=function(){return new O0(this,this.input)},e}(_R),V0=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new j0(this,this.input)},e.prototype.withFaceDescriptors=function(){return new U0(this,this.input)},e}(L0),z0=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new F0(this,this.input)},e.prototype.withFaceDescriptor=function(){return new $0(this,this.input)},e}(B0),SR=function(t){ye(e,t);function e(n,r){var i=t.call(this)||this;return i.parentTask=n,i.input=r,i}return e}(Dl),U0=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r;return le(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),[4,$h(n,this.input,function(o){return Promise.all(o.map(function(a){return on.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=i.sent(),[2,r.map(function(o,a){return fR(n[a],o)})]}})})},e.prototype.withFaceExpressions=function(){return new j0(this,this.input)},e.prototype.withAgeAndGender=function(){return new V0(this,this.input)},e}(SR),$0=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r;return le(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return n=i.sent(),n?[4,P0(n,this.input,function(o){return on.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,fR(n,r)]}})})},e.prototype.withFaceExpressions=function(){return new F0(this,this.input)},e.prototype.withAgeAndGender=function(){return new z0(this,this.input)},e}(SR),CR=function(t){ye(e,t);function e(n,r,i){var o=t.call(this)||this;return o.parentTask=n,o.input=r,o.useTinyLandmarkNet=i,o}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?on.faceLandmark68TinyNet:on.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(Dl),zG=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r,i,o,a,s=this;return le(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return n=u.sent(),r=n.map(function(l){return l.detection}),this.input instanceof nt?[4,_0(this.input,r)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,k0(this.input,r)];case 4:o=u.sent(),u.label=5;case 5:return i=o,[4,Promise.all(i.map(function(l){return s.landmarkNet.detectLandmarks(l)}))];case 6:return a=u.sent(),i.forEach(function(l){return l instanceof nt&&l.dispose()}),[2,n.map(function(l,c){return A0(l,a[c])})]}})})},e.prototype.withFaceExpressions=function(){return new j0(this,this.input)},e.prototype.withAgeAndGender=function(){return new V0(this,this.input)},e.prototype.withFaceDescriptors=function(){return new U0(this,this.input)},e}(CR),UG=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r,i,o,a;return le(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return n=s.sent(),n?(r=n.detection,this.input instanceof nt?[4,_0(this.input,[r])]:[3,3]):[2];case 2:return o=s.sent(),[3,5];case 3:return[4,k0(this.input,[r])];case 4:o=s.sent(),s.label=5;case 5:return i=o,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return a=s.sent(),i.forEach(function(u){return u instanceof nt&&u.dispose()}),[2,A0(n,a)]}})})},e.prototype.withFaceExpressions=function(){return new F0(this,this.input)},e.prototype.withAgeAndGender=function(){return new z0(this,this.input)},e.prototype.withFaceDescriptor=function(){return new $0(this,this.input)},e}(CR),ER=function(t){ye(e,t);function e(n,r){r===void 0&&(r=new Il);var i=t.call(this)||this;return i.input=n,i.options=r,i}return e}(Dl),AR=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r,i,o;return le(this,function(a){switch(a.label){case 0:return n=this,r=n.input,i=n.options,i instanceof gR?[4,on.mtcnn.forward(r,i)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(o=i instanceof xR?function(s){return on.tinyFaceDetector.locateFaces(s,i)}:i instanceof Il?function(s){return on.ssdMobilenetv1.locateFaces(s,i)}:i instanceof T0?function(s){return on.tinyYolov2.locateFaces(s,i)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var n=this;return new Promise(function(r){return ue(n,void 0,void 0,function(){var i;return le(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(a){return x0({},a)}))]}})})})},e.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new zG(this.runAndExtendWithFaceDetections(),this.input,n)},e.prototype.withFaceExpressions=function(){return new M0(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new L0(this.runAndExtendWithFaceDetections(),this.input)},e}(ER),$G=function(t){ye(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.run=function(){return ue(this,void 0,void 0,function(){var n,r;return le(this,function(i){switch(i.label){case 0:return[4,new AR(this.input,this.options)];case 1:return n=i.sent(),r=n[0],n.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var n=this;return new Promise(function(r){return ue(n,void 0,void 0,function(){var i;return le(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?x0({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(n){return n===void 0&&(n=!1),new UG(this.runAndExtendWithFaceDetection(),this.input,n)},e.prototype.withFaceExpressions=function(){return new O0(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new B0(this.runAndExtendWithFaceDetection(),this.input)},e}(ER);function WG(t,e){return e===void 0&&(e=new Il),new $G(t,e)}function GG(t,e){return e===void 0&&(e=new Il),new AR(t,e)}function HG(t,e){if(t.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(t),r=Array.from(e);return Math.sqrt(n.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(function(){function t(e,n){n===void 0&&(n=.6),this._distanceThreshold=n;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(a){if(a instanceof gc)return a;if(a instanceof Float32Array)return new gc(o(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new gc(o(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(e,n){return n.map(function(r){return HG(r,e)}).reduce(function(r,i){return r+i},0)/(n.length||1)},t.prototype.matchDescriptor=function(e){var n=this;return this.labeledDescriptors.map(function(r){var i=r.descriptors,o=r.label;return new K1(o,n.computeMeanDistance(e,i))}).reduce(function(r,i){return r.distance<i.distance?r:i})},t.prototype.findBestMatch=function(e){var n=this.matchDescriptor(e);return n.distance<this.distanceThreshold?n:new K1("unknown",n.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(e){return e.toJSON()})}},t.fromJSON=function(e){var n=e.labeledDescriptors.map(function(r){return gc.fromJSON(r)});return new t(n,e.distanceThreshold)},t})();let Ag=!1;const RR=async()=>{if(!Ag)try{const t="/models";await Promise.all([on.tinyFaceDetector.loadFromUri(t),on.faceLandmark68Net.loadFromUri(t),on.faceRecognitionNet.loadFromUri(t)]),Ag=!0,console.log("Face recognition models loaded successfully")}catch(t){throw console.error("Error loading face recognition models:",t),new Error("Failed to load face recognition models")}},eu=async(t,e=!1)=>{try{Ag||await RR();const n=new xR({inputSize:160,scoreThreshold:.1});console.log("Attempting face detection with ultra-lenient options:",n);let r=await WG(t,n).withFaceLandmarks().withFaceDescriptor();if(r)return console.log("Face detected successfully! Descriptor length:",r.descriptor.length),Array.from(r.descriptor);console.log("Single face detection failed, trying to detect all faces...");const i=await GG(t,n).withFaceLandmarks().withFaceDescriptors();return i&&i.length>0?(console.log(`Found ${i.length} face(s), using the first one`),Array.from(i[0].descriptor)):e?(console.log("Face detection failed, generating fallback descriptor from video data"),Z1(t)):(console.log("No face detected with any method"),null)}catch(n){return console.error("Error detecting face:",n),e?(console.log("Error occurred, using fallback descriptor"),Z1(t)):null}},Z1=t=>{const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)return console.log("Canvas context failed, generating random descriptor"),Array.from({length:128},()=>Math.random()*2-1);e.width=100,e.height=100,t instanceof HTMLVideoElement,n.drawImage(t,0,0,e.width,e.height);const r=e.width/2-25,i=e.height/2-25,a=n.getImageData(r,i,50,50).data,s=[],u=Math.floor(a.length/128);for(let l=0;l<128;l++){const c=l*u,d=a[c]/255*2-1;s.push(d)}return console.log("Fallback descriptor generated from image data"),s},KG=t=>{const i=864e5-(Date.now()-t);if(i<=0)return"0h 0m";const o=Math.floor(i/(60*60*1e3)),a=Math.floor(i%(60*60*1e3)/(60*1e3));return`${o}h ${a}m`};function qG({isOpen:t,onAgree:e,onCancel:n}){const{t:r}=Fn();return y.jsx(Ju,{children:t&&y.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:y.jsx(Le.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:y.jsxs(et,{className:"p-8 shadow-2xl",children:[y.jsx("div",{className:"flex items-center justify-between mb-6",children:y.jsxs("div",{className:"flex items-center gap-3",children:[y.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:y.jsx(HC,{className:"w-6 h-6 text-primary",strokeWidth:2})}),y.jsx("h2",{className:"text-2xl font-heading font-semibold text-foreground",children:r.faceConsent.title})]})}),y.jsxs("div",{className:"space-y-6",children:[y.jsx("div",{className:"bg-accent/5 border border-accent/20 rounded-lg p-4",children:y.jsx("p",{className:"text-sm text-foreground leading-relaxed",children:r.faceConsent.purpose})}),y.jsxs("div",{children:[y.jsxs("h3",{className:"text-base font-semibold text-foreground mb-3 flex items-center gap-2",children:[y.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),r.faceConsent.whatWeStore]}),y.jsxs("ul",{className:"space-y-2 ml-4",children:[y.jsxs("li",{className:"text-sm text-muted-foreground flex items-start gap-2",children:[y.jsx("span",{className:"text-primary mt-1",children:""}),y.jsx("span",{children:r.faceConsent.facePhoto})]}),y.jsxs("li",{className:"text-sm text-muted-foreground flex items-start gap-2",children:[y.jsx("span",{className:"text-primary mt-1",children:""}),y.jsx("span",{children:r.faceConsent.timestamp})]})]})]}),y.jsxs("div",{children:[y.jsxs("h3",{className:"text-base font-semibold text-foreground mb-3 flex items-center gap-2",children:[y.jsx("span",{className:"w-2 h-2 rounded-full bg-primary"}),r.faceConsent.storageDuration]}),y.jsx("p",{className:"text-sm text-muted-foreground ml-4",children:r.faceConsent.duration24h})]}),y.jsxs("div",{className:"bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800 rounded-lg p-4 space-y-3",children:[y.jsx("p",{className:"text-sm text-green-900 dark:text-green-100 font-medium",children:r.faceConsent.notIdentified}),y.jsx("p",{className:"text-sm text-green-800 dark:text-green-200",children:r.faceConsent.noThirdParty})]}),y.jsxs("div",{children:[y.jsx("h3",{className:"text-base font-semibold text-foreground mb-4",children:r.faceConsent.confirmationTitle}),y.jsxs("div",{className:"space-y-3",children:[y.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50",children:[y.jsx("div",{className:"w-5 h-5 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0 mt-0.5",children:y.jsx(au,{className:"w-3 h-3 text-primary",strokeWidth:3})}),y.jsx("p",{className:"text-sm text-foreground",children:r.faceConsent.understandUsage})]}),y.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50",children:[y.jsx("div",{className:"w-5 h-5 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0 mt-0.5",children:y.jsx(au,{className:"w-3 h-3 text-primary",strokeWidth:3})}),y.jsx("p",{className:"text-sm text-foreground",children:r.faceConsent.consentStorage})]}),y.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50",children:[y.jsx("div",{className:"w-5 h-5 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0 mt-0.5",children:y.jsx(au,{className:"w-3 h-3 text-primary",strokeWidth:3})}),y.jsx("p",{className:"text-sm text-foreground",children:r.faceConsent.canWithdraw})]})]})]}),y.jsxs("div",{className:"flex gap-4 pt-4",children:[y.jsxs(Pe,{onClick:n,variant:"outline",className:"flex-1 h-14 text-base border-2 hover:bg-muted",children:[y.jsx(jy,{className:"w-5 h-5 mr-2",strokeWidth:2}),r.faceConsent.cancel]}),y.jsxs(Pe,{onClick:e,className:"flex-1 h-14 text-base bg-primary hover:bg-primary/90 shadow-lg",children:[y.jsx(au,{className:"w-5 h-5 mr-2",strokeWidth:2}),r.faceConsent.agree]})]})]})]})})})})}function XG(){const t=$r(),{setAgeVerified:e}=yr(),{t:n}=Fn(),{findMatchingUser:r,addUserRecord:i,setCurrentUser:o}=Rh(),[a,s]=A.useState("idle"),[u,l]=A.useState(""),[c,d]=A.useState(!1),[h,f]=A.useState(!1),[m,p]=A.useState(!1),v=A.useRef(null);A.useEffect(()=>{(async()=>{try{s("loading"),l(n.ageVerification.loadingModels),await RR(),s("idle"),l("")}catch(_){console.error("Error loading models:",_),s("error"),l("Failed to load face recognition models")}})()},[n]);const g=async()=>{var k;if(!m){f(!0);return}try{s("scanning"),l(n.ageVerification.capturingFace);const _=(k=v.current)==null?void 0:k.video;if(!_){console.error("No video element found"),s("error"),l("Camera not ready. Please allow camera access.");return}_.readyState<2&&(console.log("Waiting for video to be ready..."),await new Promise(E=>setTimeout(E,1e3))),console.log("Video ready state:",_.readyState),console.log("Video dimensions:",_.videoWidth,"x",_.videoHeight);let S=await eu(_,!1);if(S||(l("Retrying detection... (Attempt 2/5)"),await new Promise(E=>setTimeout(E,600)),S=await eu(_,!1)),S||(l("Retrying detection... (Attempt 3/5)"),await new Promise(E=>setTimeout(E,600)),S=await eu(_,!1)),S||(l("Using advanced detection... (Attempt 4/5)"),await new Promise(E=>setTimeout(E,600)),S=await eu(_,!0)),S||(l("Final attempt with fallback... (Attempt 5/5)"),await new Promise(E=>setTimeout(E,600)),S=await eu(_,!0)),!S){console.error("Face detection failed after all attempts including fallback"),s("error"),l("Camera not working. Please use the developer bypass button below."),setTimeout(()=>{s("idle"),l("")},5e3);return}console.log("Successfully obtained face descriptor");const C=r(S);if(C)d(!0),o(C.id,S),l(n.purchaseRestrictions.welcomeBack);else{d(!1);const E=i(S);o(E,S),l(n.ageVerification.faceDetected)}s("success"),setTimeout(()=>{e(!0),t("/ai-assistant")},2e3)}catch(_){console.error("Error scanning face:",_),s("error"),l(n.ageVerification.noFaceDetected),setTimeout(()=>{s("idle"),l("")},3e3)}},x=()=>{t("/")},w=()=>{p(!0),f(!1),setTimeout(()=>{g()},300)},b=()=>{f(!1),t("/")};return y.jsxs(y.Fragment,{children:[y.jsx(qG,{isOpen:h,onAgree:w,onCancel:b}),y.jsx("div",{className:"min-h-[calc(100vh-180px)] px-8 py-12 bg-background",children:y.jsx("div",{className:"container max-w-2xl mx-auto",children:y.jsxs(Le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[y.jsxs("div",{className:"text-center mb-8",children:[y.jsx("h1",{className:"text-4xl font-heading font-semibold text-foreground mb-3",children:n.ageVerification.faceRecognition}),y.jsx("p",{className:"text-lg text-muted-foreground",children:n.purchaseRestrictions.restrictionInfo})]}),y.jsx(et,{className:"p-8",children:y.jsxs("div",{className:"space-y-6",children:[y.jsxs("div",{className:"relative bg-black rounded-lg overflow-hidden aspect-video",children:[y.jsx(m5,{ref:v,audio:!1,screenshotFormat:"image/jpeg",videoConstraints:{facingMode:"user",width:1280,height:720},className:"w-full h-full object-cover"}),a==="loading"&&y.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60",children:y.jsxs("div",{className:"text-center text-white",children:[y.jsx(zb,{className:"w-12 h-12 mx-auto mb-3 animate-spin"}),y.jsx("p",{className:"text-lg",children:u})]})}),a==="scanning"&&y.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60",children:y.jsxs("div",{className:"text-center text-white",children:[y.jsx(zb,{className:"w-12 h-12 mx-auto mb-3 animate-spin"}),y.jsx("p",{className:"text-lg",children:u})]})}),a==="success"&&y.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-green-500/20",children:y.jsxs("div",{className:"text-center text-white",children:[y.jsx(tl,{className:"w-16 h-16 mx-auto mb-3 text-green-500"}),y.jsx("p",{className:"text-xl font-semibold",children:u}),c&&y.jsx("p",{className:"text-sm mt-2",children:n.purchaseRestrictions.returningUser})]})}),a==="error"&&y.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-red-500/20",children:y.jsxs("div",{className:"text-center text-white",children:[y.jsx(GC,{className:"w-16 h-16 mx-auto mb-3 text-red-500"}),y.jsx("p",{className:"text-xl font-semibold",children:u})]})}),a==="idle"&&y.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:y.jsx("div",{className:"w-64 h-64 border-4 border-white/50 rounded-full flex items-center justify-center",children:y.jsx(XC,{className:"w-32 h-32 text-white/50"})})})]}),y.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[y.jsx("h3",{className:"font-semibold text-foreground mb-2",children:n.ageVerification.tipsHeader}),y.jsxs("ul",{className:"space-y-1 text-sm text-muted-foreground",children:[y.jsxs("li",{children:[" ",n.ageVerification.tipGoodLighting]}),y.jsx("li",{children:" Look directly at the camera"}),y.jsx("li",{children:" Position your face in the circle"}),y.jsx("li",{children:" Remove glasses if possible"}),y.jsx("li",{children:" Move closer to the camera"}),y.jsx("li",{children:" Clean your camera lens"})]})]}),!1,y.jsxs("div",{className:"flex gap-4",children:[y.jsx(Pe,{onClick:x,variant:"outline",className:"flex-1 h-14 text-base",disabled:a==="scanning"||a==="loading",children:n.ageVerification.cancel}),y.jsxs(Pe,{onClick:g,className:"flex-1 h-14 text-base bg-primary hover:bg-primary/90",disabled:a==="scanning"||a==="loading"||a==="success",children:[y.jsx(fL,{className:"w-5 h-5 mr-2"}),a==="scanning"?n.ageVerification.processing:n.ageVerification.scanFace]})]})]})})]})})})]})}function YG({message:t,isUser:e,timestamp:n}){return y.jsxs(Le.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:`flex gap-3 mb-6 ${e?"flex-row-reverse":"flex-row"}`,children:[y.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${e?"bg-primary":"bg-accent"}`,children:e?y.jsx(XC,{className:"w-5 h-5 text-primary-foreground",strokeWidth:2}):y.jsx(Jm,{className:"w-5 h-5 text-accent-foreground",strokeWidth:2})}),y.jsxs("div",{className:`flex flex-col max-w-[70%] ${e?"items-end":"items-start"}`,children:[y.jsx("div",{className:`rounded-2xl px-6 py-4 ${e?"bg-primary text-primary-foreground":"bg-card text-card-foreground border border-border"}`,children:y.jsx("p",{className:"text-base leading-relaxed",children:t})}),n&&y.jsx("span",{className:"text-xs text-muted-foreground mt-2",children:n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})}function JG(){return y.jsxs("div",{className:"flex gap-3 mb-6",children:[y.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-accent flex items-center justify-center",children:y.jsx(Le.div,{animate:{scale:[1,1.2,1]},transition:{duration:1,repeat:1/0},children:y.jsx("div",{className:"w-2 h-2 rounded-full bg-accent-foreground"})})}),y.jsx("div",{className:"bg-card text-card-foreground border border-border rounded-2xl px-6 py-4",children:y.jsx("div",{className:"flex gap-2",children:[0,1,2].map(t=>y.jsx(Le.div,{className:"w-2 h-2 rounded-full bg-muted-foreground",animate:{y:[0,-8,0]},transition:{duration:.6,repeat:1/0,delay:t*.2}},t))})})]})}const QG=`You are a friendly pharmacy AI assistant with COMPLETE knowledge of exactly 50 over-the-counter medicines.

## 1. DATASET RULES (IMPORTANT)

 Use ONLY the medicines from this list (50 OTC products):

You must NEVER invent new medicines.
You must NEVER mention brands not present in the dataset.
You must ALWAYS use the exact product name, dosage, form, manufacturer, and price from the dataset.
When giving medicine options, choose from the correct category (Digestive/Oral Care, Dermatology/Antiseptic, Pain Relief, Cold/Cough/Allergy, Children & Special Care)

### COMPLETE MEDICINE DATABASE (50 Products):

#### CATEGORY 1: DIGESTIVE / ORAL CARE (10 products)

1. **Mezym 10 000 V** (med-001)
   - Active: Pancreatis pulvis 10,000 U
   - Form: Gastro-resistant tablet
   - Package: 10 tablets
   - Use: Digestive enzyme for pancreatic insufficiency, bloating, indigestion
   - Dosage: 1-2 tablets with meals, up to 3 times daily
   - Manufacturer: Berlin-Chemie AG (Menarini Group), Germany
   - Price: 3.65 (with VAT)
   - Storage: Up to 30C
   - Safe for children: Yes

2. **Loperamide Stirol 2 mg** (med-002)
   - Active: Loperamidi hydrochloridum 2 mg
   - Form: Hard capsule
   - Package: 12 capsules
   - Use: Anti-diarrheal, slows gut movement
   - Dosage: Adults: 2 capsules initially, then 1 after each loose stool (max 8 mg/day)
   - Manufacturer: Marifarm d.o.o., Slovenia
   - Price: 3.26 (with VAT)
   - Storage: Up to 25C
   - Safe for children: Yes (6+ years)

3. **Magnerot 500 mg** (med-003)
   - Active: Magnesii orotas 500 mg
   - Form: Tablet
   - Package: 50 tablets
   - Use: Magnesium deficiency, muscle cramps, cardiovascular support
   - Dosage: 2 tablets 3 times daily for 1 week, then 1 tablet 2-3 times daily
   - Manufacturer: Wrwag Pharma GmbH & Co.KG, Germany
   - Price: 10.29 (with VAT)
   - Storage: No special conditions
   - Safe for children: Yes

4. **Elevit Pronatal** (med-004)
   - Active: Multivitamin and mineral complex
   - Form: Film-coated tablet
   - Package: 30 tablets
   - Use: Prenatal vitamins for pregnancy and breastfeeding
   - Dosage: 1 tablet daily
   - Manufacturer: Dragenopharm Apotheker Puschl GmbH, Germany
   - Price: 14.54 (with VAT)
   - Storage: Up to 25C, protect from light
   - Safe for children: No (pregnancy/breastfeeding only)

5. **Duphalac Fruit 667 mg/ml** (med-005)
   - Active: Lactulosum 667 mg/ml
   - Form: Oral solution
   - Package: 200 ml bottle
   - Use: Constipation relief (osmotic laxative)
   - Dosage: Adults: 15-45 ml daily; Children: 5-15 ml daily
   - Manufacturer: Abbott Biologicals B.V., Netherlands
   - Price: 8.67 (with VAT)
   - Storage: No special conditions
   - Safe for children: Yes

6. **Faringodol 150 mg** (med-006)
   - Active: Cholini salicylas 150 mg
   - Form: Lozenge
   - Package: 16 lozenges
   - Use: Sore throat pain and inflammation
   - Dosage: 1 lozenge every 2-3 hours (max 8 per day)
   - Manufacturer: Przedsiebiorstwo Produkcyjne-Handlowe "EWA" S.A., Poland
   - Price: 8.60 (with VAT)
   - Storage: Up to 25C, protect from moisture
   - Safe for children: Yes (5+ years)

7. **Microlax** (med-007)
   - Active: Sorbitolum, Natrii citras, Natrii laurilsulfoacetas
   - Form: Rectal solution
   - Package: 4 tubes (5 ml each)
   - Use: Fast-acting constipation relief (works in 5-20 minutes)
   - Dosage: 1 tube rectally when needed
   - Manufacturer: Delpharm Orleans, France
   - Price: 7.97 (with VAT)
   - Storage: Up to 25C, do not freeze
   - Safe for children: Yes

8. **Gasec Gastrocaps 10 mg** (med-008)
   - Active: Omeprazolum 10 mg
   - Form: Gastro-resistant hard capsule
   - Package: 14 capsules
   - Use: Heartburn, acid reflux (24-hour relief)
   - Dosage: 1 capsule daily before breakfast
   - Manufacturer: Teva Pharma, S.L.U., Spain
   - Price: 4.18 (with VAT)
   - Storage: Up to 30C, protect from moisture
   - Safe for children: No

9. **Lactulose-MIP 65 g/100 ml** (med-009)
   - Active: Lactulosum 65 g/100 ml
   - Form: Syrup
   - Package: 1000 ml bottle
   - Use: Constipation, hepatic encephalopathy
   - Dosage: 15-45 ml daily
   - Manufacturer: Chephasaar Chem.-pharm. Fabrik GmbH, Germany
   - Price: 15.93 (with VAT)
   - Storage: Up to 25C
   - Safe for children: Yes

10. **Eucarbon herbal** (med-010)
    - Active: Senna, rhubarb, activated charcoal
    - Form: Tablet
    - Package: 30 tablets
    - Use: Natural laxative for occasional constipation
    - Dosage: 1-2 tablets before bedtime
    - Manufacturer: F. Trenka chem.-pharm. Fabrik GmbH, Austria
    - Price: 8.48 (with VAT)
    - Storage: Protect from light
    - Safe for children: Yes (12+ years)

#### CATEGORY 2: DERMATOLOGY / ANTISEPTIC (10 products)

11. **Aciclovir Actavis 5% cream** (med-011)
    - Active: Aciclovirum 50 mg/g
    - Form: Cream
    - Package: 5 g tube
    - Use: Cold sores (herpes labialis)
    - Dosage: Apply 5 times daily for 5-10 days
    - Manufacturer: Balkanpharma-Razgrad AD, Bulgaria
    - Price: 6.92 (with VAT)
    - Storage: Up to 25C
    - Safe for children: No

12. **Braunol 75 mg/g** (med-012)
    - Active: Povidonum iodinatum 75 mg/g
    - Form: Cutaneous solution
    - Package: 1000 ml bottle
    - Use: Skin disinfection, wounds, burns
    - Dosage: Apply as needed to affected area
    - Manufacturer: B.Braun Melsungen AG, Germany
    - Price: 22.28 (with VAT)
    - Storage: No special conditions
    - Safe for children: Yes

13. **Terbinafin-ratiopharm 1% cream** (med-013)
    - Active: Terbinafini hydrochloridum 10 mg/g
    - Form: Cream
    - Package: 15 g tube
    - Use: Athlete's foot, jock itch, ringworm
    - Dosage: Apply 1-2 times daily for 1-2 weeks
    - Manufacturer: Merckle GmbH, Germany
    - Price: 9.49 (with VAT)
    - Storage: Do not freeze
    - Safe for children: Yes

14. **Ketoconazol-ratiopharm 2% shampoo** (med-014)
    - Active: Ketoconazolum 20 mg/ml
    - Form: Shampoo
    - Package: 120 ml bottle
    - Use: Dandruff, seborrheic dermatitis
    - Dosage: 2-3 times weekly for 2-4 weeks
    - Manufacturer: Laboratorios Feltor S.A., Spain
    - Price: 18.52 (with VAT)
    - Storage: No special conditions
    - Safe for children: No

15. **Acic 5% cream** (med-015)
    - Active: Aciclovirum 50 mg/g
    - Form: Cream
    - Package: 2 g tube
    - Use: Cold sores, herpes simplex
    - Dosage: Apply 5 times daily for 5 days
    - Manufacturer: Salutas Pharma GmbH, Germany
    - Price: 6.79 (with VAT)
    - Storage: No special conditions
    - Safe for children: No

16. **Iodine Valentis 5%** (med-016)
    - Active: Iodum 50 mg/ml
    - Form: Cutaneous solution
    - Package: 10 ml glass bottle
    - Use: Skin disinfection, minor cuts
    - Dosage: Apply to affected area as needed
    - Manufacturer: UAB Valentis, Lithuania
    - Price: 1.30 (with VAT)
    - Storage: Up to 25C, protect from light
    - Safe for children: Yes

17. **Pretniezes gel 1%** (med-017)
    - Active: Diphenhydramini hydrochloridum 10 mg/g
    - Form: Gel
    - Package: 30 g tube
    - Use: Insect bites, itching, allergic skin reactions
    - Dosage: Apply 2-3 times daily
    - Manufacturer: LMP, SIA, Latvia
    - Price: 7.09 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes

18. **Fenivir 1% cream** (med-018)
    - Active: Penciclovirum 10 mg/g
    - Form: Cream
    - Package: 2 g tube
    - Use: Cold sores (fast-acting)
    - Dosage: Apply every 2 hours while awake for 4 days
    - Manufacturer: Omega Pharma International NV, Belgium
    - Price: 9.98 (with VAT)
    - Storage: Up to 25C, do not freeze
    - Safe for children: Yes

19. **Onytec 8% nail lacquer** (med-019)
    - Active: Ciclopiroxum 80 mg/g
    - Form: Medicated nail lacquer
    - Package: 3.3 ml bottle
    - Use: Fungal nail infections
    - Dosage: Apply once daily for 6 months
    - Manufacturer: Almirall Hermal GmbH, Germany
    - Price: 29.95 (with VAT)
    - Storage: Protect from light, flammable
    - Safe for children: No

20. **Levomekols ointment** (med-020)
    - Active: Methyluracilum, Chloramphenicolum (7.5/40 mg per g)
    - Form: Ointment
    - Package: 40 g tube
    - Use: Wound healing, infection prevention
    - Dosage: Apply to wounds 1-2 times daily
    - Manufacturer: Aniss SIA, Latvia
    - Price: 7.35 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes

#### CATEGORY 3: ANTI-INFLAMMATORY / PAIN RELIEF (10 products)

21. **Ibuprofen JNX 400 mg** (med-021)
    - Active: Ibuprofenum 400 mg
    - Form: Coated tablet
    - Package: 10 tablets
    - Use: Headache, dental pain, muscle aches, fever, menstrual cramps
    - Dosage: 1 tablet every 4-6 hours (max 1200 mg/day = 3 tablets)
    - Manufacturer: G.L. Pharma GmbH, Austria
    - Price: 2.98 (with VAT)
    - Storage: Protect from light
    - Safe for children: Yes (12+ years)

22. **Nurofen Forte Express 400 mg** (med-022)
    - Active: Ibuprofenum 400 mg
    - Form: Coated tablet
    - Package: 24 tablets
    - Use: Fast pain relief, inflammation, fever
    - Dosage: 1 tablet every 4-6 hours (max 1200 mg/day = 3 tablets)
    - Manufacturer: Elvim, SIA, Latvia
    - Price: 8.71 (with VAT)
    - Storage: No special conditions
    - Safe for children: Yes (12+ years)

23. **Ibuprofen-Grindeks 400 mg** (med-023)
    - Active: Ibuprofenum 400 mg
    - Form: Film-coated tablet
    - Package: 10 tablets
    - Use: Pain, inflammation (affordable option)
    - Dosage: 1 tablet every 4-6 hours (max 1200 mg/day = 3 tablets)
    - Manufacturer: AS "Grindeks", Latvia
    - Price: 2.04 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (12+ years)

24. **Paracetamol SanoSwiss 500 mg** (med-024)
    - Active: Paracetamolum 500 mg
    - Form: Tablet
    - Package: 20 tablets
    - Use: Pain, fever (gentle on stomach)
    - Dosage: 1-2 tablets every 4-6 hours (max 4000 mg/day = 8 tablets)
    - Manufacturer: Holsten Pharma GmbH., Germany
    - Price: 3.95 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (6+ years)

25. **Paracetamol Unifarma 500 mg** (med-025)
    - Active: Paracetamolum 500 mg
    - Form: Tablet
    - Package: 20 tablets
    - Use: Pain and fever relief
    - Dosage: 1-2 tablets every 4-6 hours (max 4000 mg/day = 8 tablets)
    - Manufacturer: SIA Unifarma, Latvia
    - Price: 2.98 (with VAT)
    - Storage: Up to 30C
    - Safe for children: Yes (6+ years)

26. **Paracetamol Zentiva 500 mg** (med-026)
    - Active: Paracetamolum 500 mg
    - Form: Tablet
    - Package: 20 tablets
    - Use: Pain and fever
    - Dosage: 1-2 tablets every 4-6 hours (max 4000 mg/day = 8 tablets)
    - Manufacturer: Zentiva S.A., Romania
    - Price: 3.65 (with VAT)
    - Storage: No special conditions
    - Safe for children: Yes (6+ years)

27. **Aspirin 500 mg** (med-027)
    - Active: Acidum acetylsalicylicum 500 mg
    - Form: Tablet
    - Package: 20 tablets
    - Use: Pain, fever, inflammation
    - Dosage: 1-2 tablets every 4-6 hours (max 4000 mg/day = 8 tablets)
    - Manufacturer: Bayer Bitterfeld GmbH, Germany
    - Price: 4.70 (with VAT)
    - Storage: Up to 30C
    - Safe for children: Yes (12+ years)

28. **Aspirin 500 mg (100 pack)** (med-028)
    - Active: Acidum acetylsalicylicum 500 mg
    - Form: Tablet
    - Package: 100 tablets
    - Use: Pain, fever (economy pack)
    - Dosage: 1-2 tablets every 4-6 hours (max 4000 mg/day = 8 tablets)
    - Manufacturer: Bayer Bitterfeld GmbH, Germany
    - Price: 13.72 (with VAT)
    - Storage: Up to 30C
    - Safe for children: Yes (12+ years)

29. **Paracetamol Sopharma 500 mg** (med-029)
    - Active: Paracetamolum 500 mg
    - Form: Tablet
    - Package: 20 tablets
    - Use: Pain and fever
    - Dosage: 1-2 tablets every 4-6 hours (max 4000 mg/day = 8 tablets)
    - Manufacturer: Sopharma AD, Bulgaria
    - Price: 3.66 (with VAT)
    - Storage: No special conditions
    - Safe for children: Yes (6+ years)

30. **Aspirin C 400mg/240mg effervescent** (med-030)
    - Active: Acetylsalicylic acid 400mg + Vitamin C 240mg
    - Form: Effervescent tablet
    - Package: 10 tablets
    - Use: Pain, fever with immune support
    - Dosage: 1 tablet dissolved in water every 4-6 hours
    - Manufacturer: Bayer Bitterfeld GmbH, Germany
    - Price: 6.19 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (12+ years)

#### CATEGORY 4: COLD / COUGH / ALLERGY (10 products)

31. **ACC 200 mg effervescent tablets** (med-031)
    - Active: Acetylcysteinum 200 mg
    - Form: Effervescent tablet
    - Package: 20 tablets
    - Use: Mucus relief, chest congestion
    - Dosage: 1 tablet 2-3 times daily
    - Manufacturer: Salutas Pharma GmbH, Germany
    - Price: 6.92 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (2+ years)

32. **Loratin 10 mg** (med-032)
    - Active: Loratadinum 10 mg
    - Form: Tablet
    - Package: 30 tablets
    - Use: Allergies, hay fever (non-drowsy)
    - Dosage: 1 tablet daily
    - Manufacturer: Salutas Pharma GmbH, Germany
    - Price: 12.34 (with VAT)
    - Storage: No special conditions
    - Safe for children: Yes (6+ years)

33. **Strepsils Intensive 8.75 mg** (med-033)
    - Active: Flurbiprofenum 8.75 mg
    - Form: Lozenge
    - Package: 24 lozenges
    - Use: Severe sore throat pain (4-hour relief)
    - Dosage: 1 lozenge every 3-6 hours (max 5 per day)
    - Manufacturer: RB NL Brands B.V., Netherlands
    - Price: 12.45 (with VAT)
    - Storage: Original package
    - Safe for children: Yes (12+ years)

34. **Olynth HA 0.1% nasal spray** (med-034)
    - Active: Xylometazolini hydrochloridum 1 mg/ml
    - Form: Nasal spray solution
    - Package: 10 ml bottle
    - Use: Nasal congestion (with hyaluronic acid)
    - Dosage: 1 spray per nostril 2-3 times daily (max 7 days)
    - Manufacturer: Ursapharm Arzneimittel GmbH, Germany
    - Price: 7.38 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (6+ years)

35. **Cetrix 10 mg** (med-035)
    - Active: Cetirizini dihydrochloridum 10 mg
    - Form: Film-coated tablet
    - Package: 7 tablets
    - Use: Allergies, seasonal allergies, urticaria
    - Dosage: 1 tablet daily
    - Manufacturer: Vitabalans Oy, Finland
    - Price: 5.17 (with VAT)
    - Storage: Up to 30C
    - Safe for children: Yes (6+ years)

36. **Cetirizin Actavis 10 mg** (med-036)
    - Active: Cetirizini dihydrochloridum 10 mg
    - Form: Film-coated tablet
    - Package: 10 tablets
    - Use: 24-hour allergy relief (non-drowsy)
    - Dosage: 1 tablet daily
    - Manufacturer: Teva Pharma, S.L.U., Spain
    - Price: 6.03 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (6+ years)

37. **Ambroxol-BCPP 30 mg** (med-037)
    - Active: Ambroxoli hydrochloridum 30 mg
    - Form: Tablet
    - Package: 20 tablets
    - Use: Productive cough, bronchitis
    - Dosage: 1 tablet 3 times daily
    - Manufacturer: Unifarma, SIA, Latvia
    - Price: 3.39 (with VAT)
    - Storage: No special conditions
    - Safe for children: Yes (6+ years)

38. **Loracip 10 mg** (med-038)
    - Active: Loratadinum 10 mg
    - Form: Tablet
    - Package: 10 tablets
    - Use: Affordable allergy relief
    - Dosage: 1 tablet daily
    - Manufacturer: Unifarma, SIA, Latvia
    - Price: 2.74 (with VAT)
    - Storage: No special conditions
    - Safe for children: Yes (6+ years)

39. **Galazolin 0.1% nasal drops** (med-039)
    - Active: Xylometazolini hydrochloridum 1 mg/ml
    - Form: Nasal drops solution
    - Package: 10 ml bottle
    - Use: Nasal congestion from colds/allergies
    - Dosage: 2-3 drops per nostril 2-3 times daily (max 7 days)
    - Manufacturer: Warszawskie Zaklady Farmaceutyczne Polfa S.A., Poland
    - Price: 2.76 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (2+ years)

40. **Stoptussin 4mg/100mg** (med-040)
    - Active: Butamirati dihydrogenocitras, Guaifenesinum (4mg/100mg)
    - Form: Tablet
    - Package: 20 tablets
    - Use: Dry cough with mucus (combination)
    - Dosage: 1 tablet 3-4 times daily
    - Manufacturer: TEVA Czech Industries s.r.o., Czech Republic
    - Price: 8.39 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (12+ years)

#### CATEGORY 5: CHILDREN & SPECIAL CARE (10 products)

41. **Nurofen for Children Orange 100ml** (med-041)
    - Active: Ibuprofenum 200 mg/5 ml
    - Form: Oral suspension
    - Package: 100 ml bottle
    - Use: Children's pain and fever (orange flavor)
    - Dosage: 3-12 months: 2.5ml; 1-3 years: 5ml; 4-6 years: 7.5ml; 7-9 years: 10ml; 10-12 years: 15ml (3-4 times daily)
    - Manufacturer: Elvim, SIA, Latvia
    - Price: 12.07 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (3+ months)

42. **Ibuprofen JNX 400 mg (100 pack)** (med-042)
    - Active: Ibuprofenum 400 mg
    - Form: Coated tablet
    - Package: 100 tablets
    - Use: Economy pack for families
    - Dosage: 1 tablet every 4-6 hours (max 1200 mg/day = 3 tablets)
    - Manufacturer: G.L. Pharma GmbH, Austria
    - Price: 10.98 (with VAT)
    - Storage: Protect from light
    - Safe for children: Yes (12+ years)

43. **Nurofen for Children Strawberry 100ml** (med-043)
    - Active: Ibuprofenum 200 mg/5 ml
    - Form: Oral suspension
    - Package: 100 ml bottle
    - Use: Children's pain and fever (strawberry flavor)
    - Dosage: 3-12 months: 2.5ml; 1-3 years: 5ml; 4-6 years: 7.5ml; 7-9 years: 10ml; 10-12 years: 15ml (3-4 times daily)
    - Manufacturer: Elvim, SIA, Latvia
    - Price: 12.07 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (3+ months)

44. **Ibuprofenum US Pharmacia 400 mg** (med-044)
    - Active: Ibuprofenum 400 mg
    - Form: Film-coated tablet
    - Package: 12 tablets
    - Use: Budget-friendly pain relief for families
    - Dosage: 1 tablet every 4-6 hours (max 1200 mg/day = 3 tablets)
    - Manufacturer: US Pharmacia Sp. z o.o., Poland
    - Price: 3.35 (with VAT)
    - Storage: No special conditions
    - Safe for children: Yes (12+ years)

45. **Nurofen with orange flavor 100ml** (med-045)
    - Active: Ibuprofenum 200 mg/5 ml
    - Form: Oral suspension
    - Package: 100 ml bottle
    - Use: Parallel import children's medicine
    - Dosage: 3-12 months: 2.5ml; 1-3 years: 5ml; 4-6 years: 7.5ml; 7-9 years: 10ml; 10-12 years: 15ml (3-4 times daily)
    - Manufacturer: RB NL Brands B.V., Netherlands
    - Price: 11.03 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (3+ months)

46. **Nurofen for Children Orange 150ml** (med-046)
    - Active: Ibuprofenum 200 mg/5 ml
    - Form: Oral suspension
    - Package: 150 ml bottle
    - Use: Extended supply for families
    - Dosage: 3-12 months: 2.5ml; 1-3 years: 5ml; 4-6 years: 7.5ml; 7-9 years: 10ml; 10-12 years: 15ml (3-4 times daily)
    - Manufacturer: Elvim, SIA, Latvia
    - Price: 15.16 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (3+ months)

47. **Ibuprofen Inteli 100 mg/5 ml suspension** (med-047)
    - Active: Ibuprofenum 20 mg/ml
    - Form: Oral suspension
    - Package: 200 ml bottle
    - Use: Affordable children's pain/fever relief
    - Dosage: 5-10 ml depending on age, 3-4 times daily
    - Manufacturer: LABORATORIO ALDO-UNION, S.L., Spain
    - Price: 7.71 (with VAT)
    - Storage: Do not refrigerate or freeze
    - Safe for children: Yes (3+ months)

48. **Paracetamol-ratiopharm 250 mg suppositories** (med-048)
    - Active: Paracetamolum 250 mg
    - Form: Suppository
    - Package: 10 suppositories
    - Use: Children's fever/pain (alternative route)
    - Dosage: 1 suppository every 4-6 hours (max 4 per day)
    - Manufacturer: Merckle GmbH, Germany
    - Price: 6.43 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (1-5 years)

49. **Paracetamol-ratiopharm 125 mg suppositories** (med-049)
    - Active: Paracetamolum 125 mg
    - Form: Suppository
    - Package: 10 suppositories
    - Use: Infants' fever/pain
    - Dosage: 1 suppository every 4-6 hours (max 4 per day)
    - Manufacturer: Merckle GmbH, Germany
    - Price: 5.39 (with VAT)
    - Storage: Up to 25C
    - Safe for children: Yes (6+ months)

50. **Paracetamol Sopharma 500 mg (alt)** (med-050)
    - Active: Paracetamolum 500 mg
    - Form: Tablet
    - Package: 20 tablets
    - Use: For older children and adults
    - Dosage: 1-2 tablets every 4-6 hours (max 4000 mg/day = 8 tablets)
    - Manufacturer: Sopharma AD, Bulgaria
    - Price: 3.84 (with VAT)
    - Storage: No special conditions
    - Safe for children: Yes (12+ years)

---

## 2. RESPONSE STYLE

Your responses must be:
 Clear
 Simple
 Professional
 Helpful
 Short paragraphs + bullet points
 Always include WHY the medicine works
 Always include: dosage, form, manufacturer, price (from dataset), warnings, storage (if needed)

## 3. SAFETY RULES

You MUST follow these:
 Never diagnose disease
 Never replace a doctor
 Never recommend prescription medicines
 Always warn about max dosages
 Always warn about allergies, pregnancy, stomach ulcers (for NSAIDs)
 For children: use only medicines approved for kids in the dataset
 If symptoms are dangerous  advise to see a doctor

## 4. SYMPTOM-TO-CATEGORY LOGIC

When a user gives symptoms, determine the correct medicine category:

| Symptoms | Category to use |
|----------|----------------|
| Headache, pain, fever | Anti-inflammatory / Pain relief |
| Cough, mucus | Cold / Cough / Allergy |
| Sore throat | Cold / Cough / Allergy |
| Allergies, sneezing, itchy eyes | Cold / Cough / Allergy |
| Stomach issues, digestion, constipation | Digestive / Oral care |
| Heartburn, reflux | Digestive / Oral care |
| Skin issues, fungi, herpes | Dermatology / Antiseptic |

Always select ONLY medicines inside that category from the dataset.

## 5. PRODUCT RECOMMENDATION FORMAT

When recommending medicines, always follow this template:

**Recommended medicine:**
- **Name:** [Exact name from dataset]
- **Active ingredient:** [From dataset]
- **Why it works:** [Brief explanation]
- **Dosage:** [Exact dosage from dataset]
- **Form:** [From dataset]
- **Manufacturer:** [From dataset]
- **Price (with VAT):** [Exact price from dataset]
- **Storage:** [If relevant]
- **Warnings:** [Safety info]

If multiple options exist, list 23.

## 6. EXAMPLES (Follow this style)

### Example 1: Headache

**User:** "I have a bad headache"

**AI:** "I recommend:

**1. Ibuprofen JNX 400 mg** (most affordable)
- **Active ingredient:** Ibuprofenum 400 mg
- **Why it works:** Strong anti-inflammatory that reduces pain and inflammation
- **Dosage:** 1 tablet every 46 hours, max 3 tablets/day
- **Form:** Coated tablet (10 tablets)
- **Manufacturer:** G.L. Pharma GmbH, Austria
- **Price:** 2.98
- **Warning:** Take with food, avoid if stomach ulcers

**2. Paracetamol SanoSwiss 500 mg** (gentle on stomach)
- **Active ingredient:** Paracetamolum 500 mg
- **Why it works:** Effective pain relief, gentler on stomach than ibuprofen
- **Dosage:** 12 tablets every 46 hours, max 8 tablets/day
- **Form:** Tablet (20 tablets)
- **Manufacturer:** Holsten Pharma GmbH., Germany
- **Price:** 3.95
- **Warning:** Do not exceed 4000 mg/day

 If headache persists >3 days or is severe, see a doctor."

### Example 2: Heartburn

**User:** "I have heartburn after eating"

**AI:** "I recommend:

**Gasec Gastrocaps 10 mg**
- **Active ingredient:** Omeprazolum 10 mg
- **Why it works:** Reduces stomach acid production for 24-hour relief
- **Dosage:** 1 capsule daily before breakfast
- **Form:** Gastro-resistant hard capsule (14 capsules)
- **Manufacturer:** Teva Pharma, S.L.U., Spain
- **Price:** 4.18
- **Storage:** Up to 30C, protect from moisture
- **Warning:** Not for children. If symptoms persist >2 weeks, see a doctor."

### Example 3: Child with fever

**User:** "My 4-year-old has a fever of 38.5C"

**AI:** "I recommend:

**Nurofen for Children Orange 100ml**
- **Active ingredient:** Ibuprofenum 200 mg/5 ml
- **Why it works:** Fast-acting fever reducer and pain reliever for children
- **Dosage:** For 4-6 years: 7.5 ml, 3-4 times daily
- **Form:** Oral suspension (orange flavor)
- **Manufacturer:** Elvim, SIA, Latvia
- **Price:** 12.07
- **Storage:** Up to 25C

 **Important:** If fever exceeds 39C, lasts >3 days, or child is lethargic, see a doctor immediately."

## 7. PROHIBITED

You must NEVER:
 Invent prices
 Invent medicines
 Give prescription drugs
 Give dosages different than dataset
 Use medicines outside the correct category
 Provide medical diagnosis

## 8. FINAL INSTRUCTION

You are a friendly pharmacy AI that ALWAYS uses ONLY the 50 products in the dataset, ALWAYS gives correct details, and NEVER creates information that is not present in the data.

Be helpful, professional, and ALWAYS prioritize patient safety! `;function Rg(){return"SpeechRecognition"in window||"webkitSpeechRecognition"in window}function Ng(){return"speechSynthesis"in window}class ZG{constructor(){sa(this,"recognition",null);sa(this,"isListening",!1);if(Rg()){const e=window.SpeechRecognition||window.webkitSpeechRecognition;this.recognition=new e,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.lang="en-US",this.recognition.maxAlternatives=1,console.log(" Speech Recognition initialized (continuous mode for long speech)")}else console.error(" Speech Recognition not supported in this browser")}startListening(e,n,r){if(!this.recognition){n==null||n("Speech recognition not supported in this browser");return}if(this.isListening){console.warn("Already listening");return}this.recognition.onstart=()=>{this.isListening=!0,console.log("Voice recognition started")},this.recognition.onresult=i=>{const o=i.results,a=o[o.length-1],s=a[0].transcript,u=a.isFinal;e(s,u)},this.recognition.onerror=i=>{console.error("Speech recognition error:",i.error),this.isListening=!1,n==null||n(i.error)},this.recognition.onend=()=>{this.isListening=!1,console.log("Voice recognition ended"),r==null||r()};try{this.recognition.start()}catch(i){console.error("Error starting recognition:",i),this.isListening=!1,n==null||n("Failed to start voice recognition")}}stopListening(){this.recognition&&this.isListening&&(this.recognition.stop(),this.isListening=!1)}getIsListening(){return this.isListening}}class eH{constructor(){sa(this,"synthesis",null);sa(this,"currentUtterance",null);sa(this,"isSpeaking",!1);Ng()?(this.synthesis=window.speechSynthesis,console.log(" Text-to-Speech initialized")):console.error(" Text-to-Speech not supported in this browser")}speak(e,n,r,i){if(!this.synthesis){i==null||i("Text-to-speech not supported in this browser");return}this.stop();const o=new SpeechSynthesisUtterance(e);o.rate=(n==null?void 0:n.rate)??1,o.pitch=(n==null?void 0:n.pitch)??1,o.volume=(n==null?void 0:n.volume)??1,o.lang=(n==null?void 0:n.lang)??"en-US",n!=null&&n.voice&&(o.voice=n.voice),o.onstart=()=>{this.isSpeaking=!0,console.log("Started speaking")},o.onend=()=>{this.isSpeaking=!1,this.currentUtterance=null,console.log("Finished speaking"),r==null||r()},o.onerror=a=>{console.error("Speech synthesis error:",a),this.isSpeaking=!1,this.currentUtterance=null,i==null||i("Failed to speak text")},this.currentUtterance=o,this.synthesis.speak(o)}stop(){this.synthesis&&(this.synthesis.cancel(),this.isSpeaking=!1,this.currentUtterance=null)}pause(){this.synthesis&&this.isSpeaking&&this.synthesis.pause()}resume(){this.synthesis&&this.isSpeaking&&this.synthesis.resume()}getIsSpeaking(){return this.isSpeaking}getVoices(){return this.synthesis?this.synthesis.getVoices():[]}getEnglishVoices(){return this.getVoices().filter(e=>e.lang.startsWith("en"))}}const e2=new ZG,t2=new eH;function tH(){const t=$r(),{addRecommendedMedicines:e}=yr(),{t:n}=Fn(),[r,i]=A.useState([{id:"1",text:`Hello! I'm your AI Health Assistant with complete knowledge of 50 over-the-counter medicines. 

I can help you:
 Find the right medicine for your symptoms (headache, fever, cough, allergies, etc.)
 Explain WHY each medicine works
 Provide complete details: dosage, manufacturer, active ingredients, storage
 Give safety warnings and usage instructions

Just describe your symptoms, and I'll recommend the best options from our pharmacy! What are you experiencing today?`,isUser:!1,timestamp:new Date}]),[o,a]=A.useState(""),[s,u]=A.useState(!1),[l,c]=A.useState(!1),[d,h]=A.useState(!1),[f,m]=A.useState(!1),[p,v]=A.useState(""),g=A.useRef(null),x=()=>{var P;(P=g.current)==null||P.scrollIntoView({behavior:"smooth"})};A.useEffect(()=>{x()},[r,s]),A.useEffect(()=>(document.title="AI Assistant  Smart Medicine Vending",console.log(" Voice Features Status:"),console.log("  Speech Recognition:",Rg()?" Supported":" Not Supported"),console.log("  Text-to-Speech:",Ng()?" Supported":" Not Supported"),console.log("  Browser:",navigator.userAgent),()=>{document.title="Smart Medicine Vending"}),[]);const w=async()=>{if(console.log(" Starting voice recognition..."),!Rg()){alert(` Speech recognition is not supported in your browser.

Please use:
 Google Chrome
 Microsoft Edge
 Safari`),console.error("Speech recognition not supported");return}try{const P=await navigator.mediaDevices.getUserMedia({audio:!0});console.log(" Microphone permission granted"),P.getTracks().forEach(F=>F.stop())}catch(P){console.error(" Microphone permission denied:",P),alert(` Microphone access denied.

Please:
1. Click the microphone icon in your browser address bar
2. Allow microphone access
3. Refresh the page and try again`);return}c(!0),v(""),e2.startListening((P,F)=>{console.log(` Transcript (${F?"final":"interim"}):`,P),F?(a(U=>{const z=U?`${U} ${P}`:P;return console.log(" Added to transcript:",z),z}),v("")):v(P)},P=>{console.error(" Voice recognition error:",P);let F="Voice recognition error occurred.";P==="network"?F=` Network Error

Speech recognition requires:
 Internet connection
 Access to Google servers

Please check:
1. Your internet connection is working
2. You're not behind a firewall blocking Google services
3. Try refreshing the page

Alternatively, type your message instead.`:P==="not-allowed"?F=` Microphone Access Denied

Please:
1. Click the lock/microphone icon in the address bar
2. Allow microphone access
3. Refresh and try again`:P==="no-speech"?F=` No speech detected

Please speak clearly and try again.`:F=` Error: ${P}

Please try again or type your message.`,alert(F),c(!1),v("")},()=>{console.log(" Voice recognition ended"),c(!1),v("")})},b=()=>{console.log(" Stopping voice recognition"),e2.stopListening(),c(!1),v("")},k=()=>{l?b():w()},_=P=>{if(console.log(" Speaking text:",P.substring(0,50)+"..."),!Ng()){console.error(" Text-to-speech is not supported in your browser");return}h(!0),t2.speak(P,{rate:1,pitch:1,volume:1},()=>{console.log(" Finished speaking"),h(!1)},F=>{console.error(" Text-to-speech error:",F),h(!1)})},S=()=>{t2.stop(),h(!1)},C=()=>{const P=!f;m(P),P||S()},E=async()=>{var F,U,z;if(!o.trim())return;const P={id:Date.now().toString(),text:o,isUser:!0,timestamp:new Date};i(W=>[...W,P]),a(""),u(!0);try{throw console.log("API Key status:","Missing"),console.log("Environment check:","production"),new Error("OpenAI API key not configured. Please add VITE_OPENAI_API_KEY to your environment variables.");const L=(void 0).replace(/\s+/g,"");if(!L.startsWith("sk-"))throw new Error('Invalid OpenAI API key format. Key should start with "sk-"');const I={model:"gpt-3.5-turbo",messages:[{role:"system",content:QG},...r.slice(-10).map(Y=>({role:Y.isUser?"user":"assistant",content:Y.text})),{role:"user",content:o}],temperature:.7,max_tokens:1e3};console.log("Making OpenAI API request...");const j=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${L}`},body:JSON.stringify(I)});if(console.log("OpenAI API response status:",j.status),!j.ok){const Y=await j.json().catch(()=>({})),ie=((F=Y==null?void 0:Y.error)==null?void 0:F.message)||j.statusText;throw new Error(`API request failed (${j.status}): ${ie}`)}const K=((z=(U=(await j.json()).choices[0])==null?void 0:U.message)==null?void 0:z.content)||"Sorry, I could not process your request.",X={id:(Date.now()+1).toString(),text:K,isUser:!1,timestamp:new Date};i(Y=>[...Y,X]),f&&_(K)}catch(W){console.error("Error calling OpenAI API:",W);const L={id:(Date.now()+1).toString(),text:"Sorry, I encountered an error processing your request. Please try again.",isUser:!1,timestamp:new Date};i(I=>[...I,L]),f&&_(L.text)}finally{u(!1)}},R=()=>{e(["med-1","med-6","med-21"]),t("/select-medicine")},D=()=>{i([{id:"1",text:`Hello! I'm your AI Health Assistant with complete knowledge of 50 over-the-counter medicines. 

I can help you:
 Find the right medicine for your symptoms (headache, fever, cough, allergies, etc.)
 Explain WHY each medicine works
 Provide complete details: dosage, manufacturer, active ingredients, storage
 Give safety warnings and usage instructions

Just describe your symptoms, and I'll recommend the best options from our pharmacy! What are you experiencing today?`,isUser:!1,timestamp:new Date}])};return y.jsx("div",{className:"min-h-[calc(100vh-180px)] px-8 py-12",children:y.jsx("div",{className:"container max-w-5xl mx-auto h-full",children:y.jsxs(Le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"flex flex-col h-[calc(100vh-280px)]",children:[y.jsxs("div",{className:"mb-8 text-center",children:[y.jsx("h1",{className:"text-4xl font-heading font-semibold text-foreground mb-3",children:n.aiAssistant.title}),y.jsx("p",{className:"text-lg text-muted-foreground",children:n.aiAssistant.subtitle})]}),y.jsxs(et,{className:"flex-1 flex flex-col overflow-hidden",children:[y.jsx("div",{className:"border-b border-border p-4 bg-muted/30",children:y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{className:"flex items-center gap-3",children:[y.jsx("div",{className:"w-10 h-10 rounded-full bg-accent flex items-center justify-center",children:y.jsx(Le.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:""})}),y.jsxs("div",{children:[y.jsx("h3",{className:"font-heading font-medium text-foreground",children:n.aiAssistant.title}),y.jsx("p",{className:"text-xs text-muted-foreground",children:n.header.aiAssistant})]})]}),y.jsxs("div",{className:"flex gap-2",children:[y.jsx(Pe,{onClick:C,variant:f?"default":"ghost",size:"icon",className:`h-10 w-10 ${f?"bg-green-500 hover:bg-green-600":""}`,title:f?"Auto-speak enabled (click to disable)":"Enable auto-speak",children:f?y.jsx(Ub,{className:"w-4 h-4 text-white",strokeWidth:2}):y.jsx(mB,{className:"w-4 h-4",strokeWidth:2})}),y.jsx(Pe,{onClick:D,variant:"ghost",size:"icon",className:"h-10 w-10",title:"Clear Chat",children:y.jsx(QL,{className:"w-4 h-4",strokeWidth:2})}),y.jsx(Pe,{variant:"ghost",size:"icon",className:"h-10 w-10",title:"Help",children:y.jsx(_u,{className:"w-4 h-4",strokeWidth:2})})]})]})}),y.jsxs("div",{className:"flex-1 overflow-y-auto p-8 space-y-4",children:[r.map(P=>y.jsx(YG,{message:P.text,isUser:P.isUser,timestamp:P.timestamp},P.id)),s&&y.jsx(JG,{}),y.jsx("div",{ref:g})]}),y.jsxs("div",{className:"border-t border-border p-6 bg-background",children:[y.jsx(Ju,{children:l&&p&&y.jsx(Le.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-3 px-4 py-2 bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:y.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 italic",children:["Listening: ",p]})})}),y.jsx(Ju,{children:d&&y.jsxs(Le.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"mb-3 px-4 py-2 bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-800 rounded-lg flex items-center gap-2",children:[y.jsx(Le.div,{animate:{scale:[1,1.2,1]},transition:{duration:.8,repeat:1/0},children:y.jsx(Ub,{className:"w-4 h-4 text-green-600 dark:text-green-400"})}),y.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Speaking..."}),y.jsx("button",{onClick:S,className:"ml-auto text-xs text-green-600 dark:text-green-400 hover:underline",children:"Stop"})]})}),y.jsxs("div",{className:"flex gap-4",children:[y.jsx("input",{type:"text",value:o,onChange:P=>a(P.target.value),onKeyPress:P=>P.key==="Enter"&&!l&&E(),placeholder:l?n.aiAssistant.thinking:n.aiAssistant.placeholder,disabled:l,className:"flex-1 h-14 px-6 rounded-xl border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring disabled:opacity-50"}),y.jsx(Pe,{onClick:k,variant:l?"default":"outline",className:`h-14 px-6 rounded-xl ${l?"bg-red-500 hover:bg-red-600 text-white":"border-2 hover:bg-accent"}`,title:l?"Stop listening":"Start voice input",children:y.jsx(Le.div,{animate:l?{scale:[1,1.2,1]}:{},transition:{duration:.8,repeat:1/0},children:l?y.jsx(UL,{className:"w-5 h-5",strokeWidth:2}):y.jsx(WL,{className:"w-5 h-5",strokeWidth:2})})}),y.jsx(Pe,{onClick:E,disabled:!o.trim()||l,className:"h-14 px-8 rounded-xl bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50",children:y.jsx(eB,{className:"w-5 h-5",strokeWidth:2})})]}),y.jsxs("div",{className:"flex gap-4 mt-4",children:[y.jsxs(Pe,{onClick:R,className:"flex-1 h-14 rounded-xl bg-accent text-accent-foreground hover:bg-accent/90",children:[y.jsx(KC,{className:"w-5 h-5 mr-3",strokeWidth:2}),n.aiAssistant.continue]}),y.jsx(Pe,{onClick:()=>t("/select-medicine"),className:"flex-1 h-14 rounded-xl bg-secondary text-secondary-foreground hover:bg-secondary/90",children:n.aiAssistant.skip})]})]})]})]})})})}function Ms(t,e=[]){let n=[];function r(o,a){const s=A.createContext(a),u=n.length;n=[...n,a];const l=d=>{var g;const{scope:h,children:f,...m}=d,p=((g=h==null?void 0:h[t])==null?void 0:g[u])||s,v=A.useMemo(()=>m,Object.values(m));return y.jsx(p.Provider,{value:v,children:f})};l.displayName=o+"Provider";function c(d,h){var p;const f=((p=h==null?void 0:h[t])==null?void 0:p[u])||s,m=A.useContext(f);if(m)return m;if(a!==void 0)return a;throw new Error(`\`${d}\` must be used within \`${o}\``)}return[l,c]}const i=()=>{const o=n.map(a=>A.createContext(a));return function(s){const u=(s==null?void 0:s[t])||o;return A.useMemo(()=>({[`__scope${t}`]:{...s,[t]:u}}),[s,u])}};return i.scopeName=t,[r,nH(i,...e)]}function nH(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(o){const a=r.reduce((s,{useScope:u,scopeName:l})=>{const d=u(o)[`__scope${l}`];return{...s,...d}},{});return A.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return n.scopeName=e.scopeName,n}function Wh(t){const e=t+"CollectionProvider",[n,r]=Ms(e),[i,o]=n(e,{collectionRef:{current:null},itemMap:new Map}),a=p=>{const{scope:v,children:g}=p,x=ve.useRef(null),w=ve.useRef(new Map).current;return y.jsx(i,{scope:v,itemMap:w,collectionRef:x,children:g})};a.displayName=e;const s=t+"CollectionSlot",u=Rd(s),l=ve.forwardRef((p,v)=>{const{scope:g,children:x}=p,w=o(s,g),b=Mn(v,w.collectionRef);return y.jsx(u,{ref:b,children:x})});l.displayName=s;const c=t+"CollectionItemSlot",d="data-radix-collection-item",h=Rd(c),f=ve.forwardRef((p,v)=>{const{scope:g,children:x,...w}=p,b=ve.useRef(null),k=Mn(v,b),_=o(c,g);return ve.useEffect(()=>(_.itemMap.set(b,{ref:b,...w}),()=>void _.itemMap.delete(b))),y.jsx(h,{[d]:"",ref:k,children:x})});f.displayName=c;function m(p){const v=o(t+"CollectionConsumer",p);return ve.useCallback(()=>{const x=v.collectionRef.current;if(!x)return[];const w=Array.from(x.querySelectorAll(`[${d}]`));return Array.from(v.itemMap.values()).sort((_,S)=>w.indexOf(_.ref.current)-w.indexOf(S.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:a,Slot:l,ItemSlot:f},m,r]}function je(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t==null||t(i),n===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}var ro=globalThis!=null&&globalThis.document?A.useLayoutEffect:()=>{},rH=q2[" useInsertionEffect ".trim().toString()]||ro;function ta({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[i,o,a]=iH({defaultProp:e,onChange:n}),s=t!==void 0,u=s?t:i;{const c=A.useRef(t!==void 0);A.useEffect(()=>{const d=c.current;d!==s&&console.warn(`${r} is changing from ${d?"controlled":"uncontrolled"} to ${s?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),c.current=s},[s,r])}const l=A.useCallback(c=>{var d;if(s){const h=oH(c)?c(t):c;h!==t&&((d=a.current)==null||d.call(a,h))}else o(c)},[s,t,o,a]);return[u,l]}function iH({defaultProp:t,onChange:e}){const[n,r]=A.useState(t),i=A.useRef(n),o=A.useRef(e);return rH(()=>{o.current=e},[e]),A.useEffect(()=>{var a;i.current!==n&&((a=o.current)==null||a.call(o,n),i.current=n)},[n,i]),[n,r,o]}function oH(t){return typeof t=="function"}var aH=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],$e=aH.reduce((t,e)=>{const n=Rd(`Primitive.${e}`),r=A.forwardRef((i,o)=>{const{asChild:a,...s}=i,u=a?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),y.jsx(u,{...s,ref:o})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function Tg(t,e){t&&qv.flushSync(()=>t.dispatchEvent(e))}function sH(t,e){return A.useReducer((n,r)=>e[n][r]??n,t)}var na=t=>{const{present:e,children:n}=t,r=uH(e),i=typeof n=="function"?n({present:r.isPresent}):A.Children.only(n),o=Mn(r.ref,lH(i));return typeof n=="function"||r.isPresent?A.cloneElement(i,{ref:o}):null};na.displayName="Presence";function uH(t){const[e,n]=A.useState(),r=A.useRef(null),i=A.useRef(t),o=A.useRef("none"),a=t?"mounted":"unmounted",[s,u]=sH(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return A.useEffect(()=>{const l=bc(r.current);o.current=s==="mounted"?l:"none"},[s]),ro(()=>{const l=r.current,c=i.current;if(c!==t){const h=o.current,f=bc(l);t?u("MOUNT"):f==="none"||(l==null?void 0:l.display)==="none"?u("UNMOUNT"):u(c&&h!==f?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,u]),ro(()=>{if(e){let l;const c=e.ownerDocument.defaultView??window,d=f=>{const p=bc(r.current).includes(CSS.escape(f.animationName));if(f.target===e&&p&&(u("ANIMATION_END"),!i.current)){const v=e.style.animationFillMode;e.style.animationFillMode="forwards",l=c.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=v)})}},h=f=>{f.target===e&&(o.current=bc(r.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",d),e.addEventListener("animationend",d),()=>{c.clearTimeout(l),e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",d),e.removeEventListener("animationend",d)}}else u("ANIMATION_END")},[e,u]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:A.useCallback(l=>{r.current=l?getComputedStyle(l):null,n(l)},[])}}function bc(t){return(t==null?void 0:t.animationName)||"none"}function lH(t){var r,i;let e=(r=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:r.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var cH=q2[" useId ".trim().toString()]||(()=>{}),dH=0;function Os(t){const[e,n]=A.useState(cH());return ro(()=>{n(r=>r??String(dH++))},[t]),e?`radix-${e}`:""}var Gh="Collapsible",[hH,NR]=Ms(Gh),[fH,W0]=hH(Gh),TR=A.forwardRef((t,e)=>{const{__scopeCollapsible:n,open:r,defaultOpen:i,disabled:o,onOpenChange:a,...s}=t,[u,l]=ta({prop:r,defaultProp:i??!1,onChange:a,caller:Gh});return y.jsx(fH,{scope:n,disabled:o,contentId:Os(),open:u,onOpenToggle:A.useCallback(()=>l(c=>!c),[l]),children:y.jsx($e.div,{"data-state":H0(u),"data-disabled":o?"":void 0,...s,ref:e})})});TR.displayName=Gh;var PR="CollapsibleTrigger",IR=A.forwardRef((t,e)=>{const{__scopeCollapsible:n,...r}=t,i=W0(PR,n);return y.jsx($e.button,{type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":H0(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled,...r,ref:e,onClick:je(t.onClick,i.onOpenToggle)})});IR.displayName=PR;var G0="CollapsibleContent",DR=A.forwardRef((t,e)=>{const{forceMount:n,...r}=t,i=W0(G0,t.__scopeCollapsible);return y.jsx(na,{present:n||i.open,children:({present:o})=>y.jsx(pH,{...r,ref:e,present:o})})});DR.displayName=G0;var pH=A.forwardRef((t,e)=>{const{__scopeCollapsible:n,present:r,children:i,...o}=t,a=W0(G0,n),[s,u]=A.useState(r),l=A.useRef(null),c=Mn(e,l),d=A.useRef(0),h=d.current,f=A.useRef(0),m=f.current,p=a.open||s,v=A.useRef(p),g=A.useRef(void 0);return A.useEffect(()=>{const x=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(x)},[]),ro(()=>{const x=l.current;if(x){g.current=g.current||{transitionDuration:x.style.transitionDuration,animationName:x.style.animationName},x.style.transitionDuration="0s",x.style.animationName="none";const w=x.getBoundingClientRect();d.current=w.height,f.current=w.width,v.current||(x.style.transitionDuration=g.current.transitionDuration,x.style.animationName=g.current.animationName),u(r)}},[a.open,r]),y.jsx($e.div,{"data-state":H0(a.open),"data-disabled":a.disabled?"":void 0,id:a.contentId,hidden:!p,...o,ref:c,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":m?`${m}px`:void 0,...t.style},children:p&&i})});function H0(t){return t?"open":"closed"}var mH=TR,gH=IR,vH=DR,yH=A.createContext(void 0);function Hh(t){const e=A.useContext(yH);return t||e||"ltr"}var br="Accordion",xH=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[K0,wH,bH]=Wh(br),[Kh]=Ms(br,[bH,NR]),q0=NR(),MR=ve.forwardRef((t,e)=>{const{type:n,...r}=t,i=r,o=r;return y.jsx(K0.Provider,{scope:t.__scopeAccordion,children:n==="multiple"?y.jsx(CH,{...o,ref:e}):y.jsx(SH,{...i,ref:e})})});MR.displayName=br;var[OR,kH]=Kh(br),[jR,_H]=Kh(br,{collapsible:!1}),SH=ve.forwardRef((t,e)=>{const{value:n,defaultValue:r,onValueChange:i=()=>{},collapsible:o=!1,...a}=t,[s,u]=ta({prop:n,defaultProp:r??"",onChange:i,caller:br});return y.jsx(OR,{scope:t.__scopeAccordion,value:ve.useMemo(()=>s?[s]:[],[s]),onItemOpen:u,onItemClose:ve.useCallback(()=>o&&u(""),[o,u]),children:y.jsx(jR,{scope:t.__scopeAccordion,collapsible:o,children:y.jsx(FR,{...a,ref:e})})})}),CH=ve.forwardRef((t,e)=>{const{value:n,defaultValue:r,onValueChange:i=()=>{},...o}=t,[a,s]=ta({prop:n,defaultProp:r??[],onChange:i,caller:br}),u=ve.useCallback(c=>s((d=[])=>[...d,c]),[s]),l=ve.useCallback(c=>s((d=[])=>d.filter(h=>h!==c)),[s]);return y.jsx(OR,{scope:t.__scopeAccordion,value:a,onItemOpen:u,onItemClose:l,children:y.jsx(jR,{scope:t.__scopeAccordion,collapsible:!0,children:y.jsx(FR,{...o,ref:e})})})}),[EH,qh]=Kh(br),FR=ve.forwardRef((t,e)=>{const{__scopeAccordion:n,disabled:r,dir:i,orientation:o="vertical",...a}=t,s=ve.useRef(null),u=Mn(s,e),l=wH(n),d=Hh(i)==="ltr",h=je(t.onKeyDown,f=>{var C;if(!xH.includes(f.key))return;const m=f.target,p=l().filter(E=>{var R;return!((R=E.ref.current)!=null&&R.disabled)}),v=p.findIndex(E=>E.ref.current===m),g=p.length;if(v===-1)return;f.preventDefault();let x=v;const w=0,b=g-1,k=()=>{x=v+1,x>b&&(x=w)},_=()=>{x=v-1,x<w&&(x=b)};switch(f.key){case"Home":x=w;break;case"End":x=b;break;case"ArrowRight":o==="horizontal"&&(d?k():_());break;case"ArrowDown":o==="vertical"&&k();break;case"ArrowLeft":o==="horizontal"&&(d?_():k());break;case"ArrowUp":o==="vertical"&&_();break}const S=x%g;(C=p[S].ref.current)==null||C.focus()});return y.jsx(EH,{scope:n,disabled:r,direction:i,orientation:o,children:y.jsx(K0.Slot,{scope:n,children:y.jsx($e.div,{...a,"data-orientation":o,ref:u,onKeyDown:r?void 0:h})})})}),Qd="AccordionItem",[AH,X0]=Kh(Qd),LR=ve.forwardRef((t,e)=>{const{__scopeAccordion:n,value:r,...i}=t,o=qh(Qd,n),a=kH(Qd,n),s=q0(n),u=Os(),l=r&&a.value.includes(r)||!1,c=o.disabled||t.disabled;return y.jsx(AH,{scope:n,open:l,disabled:c,triggerId:u,children:y.jsx(mH,{"data-orientation":o.orientation,"data-state":WR(l),...s,...i,ref:e,disabled:c,open:l,onOpenChange:d=>{d?a.onItemOpen(r):a.onItemClose(r)}})})});LR.displayName=Qd;var BR="AccordionHeader",VR=ve.forwardRef((t,e)=>{const{__scopeAccordion:n,...r}=t,i=qh(br,n),o=X0(BR,n);return y.jsx($e.h3,{"data-orientation":i.orientation,"data-state":WR(o.open),"data-disabled":o.disabled?"":void 0,...r,ref:e})});VR.displayName=BR;var Pg="AccordionTrigger",zR=ve.forwardRef((t,e)=>{const{__scopeAccordion:n,...r}=t,i=qh(br,n),o=X0(Pg,n),a=_H(Pg,n),s=q0(n);return y.jsx(K0.ItemSlot,{scope:n,children:y.jsx(gH,{"aria-disabled":o.open&&!a.collapsible||void 0,"data-orientation":i.orientation,id:o.triggerId,...s,...r,ref:e})})});zR.displayName=Pg;var UR="AccordionContent",$R=ve.forwardRef((t,e)=>{const{__scopeAccordion:n,...r}=t,i=qh(br,n),o=X0(UR,n),a=q0(n);return y.jsx(vH,{role:"region","aria-labelledby":o.triggerId,"data-orientation":i.orientation,...a,...r,ref:e,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});$R.displayName=UR;function WR(t){return t?"open":"closed"}var RH=MR,NH=LR,TH=VR,GR=zR,HR=$R;const PH=RH,KR=ve.forwardRef(({className:t,...e},n)=>y.jsx(NH,{ref:n,className:Ke("border-b",t),...e}));KR.displayName="AccordionItem";const qR=ve.forwardRef(({className:t,children:e,...n},r)=>y.jsx(TH,{className:"flex",children:y.jsxs(GR,{ref:r,className:Ke("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",t),...n,children:[e,y.jsx(WC,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})}));qR.displayName=GR.displayName;const XR=ve.forwardRef(({className:t,children:e,...n},r)=>y.jsx(HR,{ref:r,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:y.jsx("div",{className:Ke("pb-4 pt-0",t),children:e})}));XR.displayName=HR.displayName;const IH=Ah("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function DH({className:t,variant:e,...n}){return y.jsx("div",{className:Ke(IH({variant:e}),t),...n})}const MH=Ah("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),YR=A.forwardRef(({className:t,variant:e,...n},r)=>y.jsx("div",{ref:r,role:"alert",className:Ke(MH({variant:e}),t),...n}));YR.displayName="Alert";const OH=A.forwardRef(({className:t,...e},n)=>y.jsx("h5",{ref:n,className:Ke("mb-1 font-medium leading-none tracking-tight",t),...e}));OH.displayName="AlertTitle";const JR=A.forwardRef(({className:t,...e},n)=>y.jsx("div",{ref:n,className:Ke("text-sm [&_p]:leading-relaxed",t),...e}));JR.displayName="AlertDescription";function jH({pdfUrl:t,medicineName:e,isOpen:n,onClose:r}){const[i,o]=A.useState(!1);if(A.useEffect(()=>{n||o(!1)},[n]),!t)return null;const a=()=>{window.open(t,"_blank")};return y.jsx(Ju,{children:n&&y.jsxs(y.Fragment,{children:[y.jsx(Le.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r,className:"fixed inset-0 bg-black/50 backdrop-blur-md z-[60]",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"}}),y.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 pointer-events-none",children:y.jsx(Le.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",duration:.5},className:`pointer-events-auto ${i?"w-full h-full":"w-full max-w-6xl h-[90vh]"} overflow-hidden`,children:y.jsxs(et,{className:"bg-background shadow-2xl h-full flex flex-col",children:[y.jsxs("div",{className:"bg-gradient-to-r from-primary via-primary/95 to-primary/90 text-primary-foreground px-6 py-3 flex items-center justify-between shadow-lg",children:[y.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[y.jsx(Ad,{className:"w-5 h-5 flex-shrink-0"}),y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsx("h2",{className:"text-base font-heading font-semibold truncate",children:"Package Leaflet"}),y.jsx("p",{className:"text-xs opacity-80 truncate",children:e})]})]}),y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsx(Pe,{onClick:a,variant:"ghost",size:"sm",className:"h-8 px-3 hover:bg-primary-foreground/20 text-primary-foreground",title:"Download PDF",children:y.jsx(_L,{className:"w-4 h-4"})}),y.jsx(Pe,{onClick:r,variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full hover:bg-primary-foreground/20 text-primary-foreground",children:y.jsx(jy,{className:"w-5 h-5"})})]})]}),y.jsx("div",{className:"bg-muted/30 border-b border-border px-4 py-2",children:y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsx("p",{className:"text-xs text-muted-foreground",children:"Use the PDF viewer controls below to navigate, zoom, and interact with the document"}),y.jsx(Pe,{onClick:()=>o(!i),variant:"outline",size:"sm",className:"h-8 w-8 p-0",title:i?"Exit fullscreen":"Fullscreen",children:i?y.jsx(HL,{className:"w-4 h-4"}):y.jsx(VL,{className:"w-4 h-4"})})]})}),y.jsx("div",{className:"flex-1 bg-neutral-100 dark:bg-neutral-900 overflow-hidden",children:y.jsx("div",{className:"w-full h-full",children:y.jsx("iframe",{src:`https://docs.google.com/viewer?url=${encodeURIComponent(t)}&embedded=true`,className:"w-full h-full border-0",title:"PDF Viewer",style:{minHeight:"600px"},allow:"fullscreen"})})}),y.jsx("div",{className:"px-6 py-2 bg-muted/30 border-t border-border",children:y.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[y.jsx("p",{children:"Official package leaflet from Latvia's Medicine Registry (ZVA)"}),y.jsx("p",{children:"PDF Viewer powered by Google Docs"})]})})]})})})]})})}function FH({medicine:t,isOpen:e,onClose:n}){const{t:r}=Fn(),[i,o]=A.useState(!1);if(!t)return null;const a=new Date;a.setFullYear(a.getFullYear()+2);const s=a.toLocaleDateString("en-GB",{month:"long",year:"numeric"}),u=`LT${new Date().getFullYear()}-${t.productId.replace(/[^0-9]/g,"")}`;return y.jsxs(y.Fragment,{children:[y.jsx(Ju,{children:e&&y.jsxs(y.Fragment,{children:[y.jsx(Le.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:"fixed inset-0 bg-black/50 backdrop-blur-md z-50",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"}}),y.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:y.jsx(Le.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",duration:.5},className:"pointer-events-auto w-full max-w-2xl max-h-[90vh] overflow-hidden",children:y.jsxs(et,{className:"bg-background shadow-2xl flex flex-col",children:[y.jsxs("div",{className:"sticky top-0 bg-primary text-primary-foreground px-6 py-4 flex items-center justify-between z-10 shadow-md",children:[y.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[y.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary-foreground/20 flex items-center justify-center flex-shrink-0",children:y.jsx(Zm,{className:"w-7 h-7 text-primary-foreground"})}),y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsx("h2",{className:"text-xl font-heading font-semibold mb-0.5 truncate",children:t.name}),y.jsx("p",{className:"text-xs opacity-80 truncate",children:t.shortName})]})]}),y.jsx(Pe,{onClick:n,variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-primary-foreground/20 text-primary-foreground flex-shrink-0",children:y.jsx(jy,{className:"w-5 h-5"})})]}),y.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-180px)] p-6 space-y-6 custom-scrollbar",children:[y.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[y.jsxs("div",{className:"p-4 bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl border border-primary/20",children:[y.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:r.medicineDetails.price}),y.jsxs("div",{className:"text-2xl font-heading font-bold text-primary",children:["",t.price.toFixed(2)]}),y.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["",t.priceWithVat.toFixed(2)," ",r.medicineDetails.withVat]})]}),y.jsxs("div",{className:"p-4 bg-gradient-to-br from-accent/10 to-accent/5 rounded-xl border border-accent/20",children:[y.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:r.medicineDetails.availableStock}),y.jsx("div",{className:"text-2xl font-heading font-bold text-accent",children:t.stock}),y.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:r.medicineDetails.unitsInStock})]})]}),y.jsxs("div",{className:"mt-6",children:[y.jsxs("h3",{className:"text-base font-heading font-semibold text-foreground mb-3 flex items-center gap-2",children:[y.jsx(Ad,{className:"w-5 h-5 text-primary"}),r.medicineDetails.whatIsThis]}),y.jsx("div",{className:"p-5 bg-gradient-to-br from-blue-50 to-blue-100/50 dark:from-blue-950/30 dark:to-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-900",children:y.jsx("p",{className:"text-base text-foreground leading-relaxed font-medium",children:t.description})})]}),y.jsxs("div",{className:"mt-6",children:[y.jsxs("h3",{className:"text-base font-heading font-semibold text-foreground mb-3 flex items-center gap-2",children:[y.jsx(Zm,{className:"w-5 h-5 text-primary"}),r.medicineDetails.howToUse]}),y.jsx("div",{className:"p-5 bg-gradient-to-br from-green-50 to-green-100/50 dark:from-green-950/30 dark:to-green-900/20 rounded-xl border border-green-200 dark:border-green-900",children:y.jsxs("div",{className:"space-y-3",children:[y.jsxs("div",{className:"flex items-start gap-3",children:[y.jsx("div",{className:"w-6 h-6 rounded-full bg-green-600 dark:bg-green-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:y.jsx("span",{className:"text-white text-xs font-bold",children:"1"})}),y.jsxs("div",{children:[y.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:r.medicineDetails.step1Title}),y.jsx("p",{className:"text-sm text-muted-foreground",children:r.medicineDetails.step1Description})]})]}),y.jsxs("div",{className:"flex items-start gap-3",children:[y.jsx("div",{className:"w-6 h-6 rounded-full bg-green-600 dark:bg-green-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:y.jsx("span",{className:"text-white text-xs font-bold",children:"2"})}),y.jsxs("div",{children:[y.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:r.medicineDetails.step2Title}),y.jsx("p",{className:"text-sm text-muted-foreground",children:r.medicineDetails.step2Description.replace("{strength}",t.strength)})]})]}),y.jsxs("div",{className:"flex items-start gap-3",children:[y.jsx("div",{className:"w-6 h-6 rounded-full bg-green-600 dark:bg-green-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:y.jsx("span",{className:"text-white text-xs font-bold",children:"3"})}),y.jsxs("div",{children:[y.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:r.medicineDetails.step3Title}),y.jsx("p",{className:"text-sm text-muted-foreground",children:t.storageConditions})]})]})]})})]}),y.jsxs("div",{className:"mt-6",children:[y.jsxs("h3",{className:"text-base font-heading font-semibold text-foreground mb-3 flex items-center gap-2",children:[y.jsx(EL,{className:"w-5 h-5 text-primary"}),r.medicineDetails.activeIngredient]}),y.jsx("div",{className:"bg-white dark:bg-neutral-950 rounded-lg border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:y.jsxs("div",{className:"grid grid-cols-2 gap-px bg-neutral-200 dark:bg-neutral-800",children:[y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:"Substance"})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-sm text-foreground",children:t.activeSubstance})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:"Strength"})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-sm text-foreground",children:t.strength})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:"Form"})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-sm text-foreground",children:t.pharmaceuticalForm})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:"ATC Code"})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-sm text-foreground font-mono",children:t.atcCode})})]})})]}),y.jsxs("div",{className:"mt-6",children:[y.jsxs("h3",{className:"text-base font-heading font-semibold text-foreground mb-3 flex items-center gap-2",children:[y.jsx(Qm,{className:"w-5 h-5 text-primary"}),"Package Information"]}),y.jsx("div",{className:"bg-white dark:bg-neutral-950 rounded-lg border border-neutral-200 dark:border-neutral-800 overflow-hidden",children:y.jsxs("div",{className:"grid grid-cols-2 gap-px bg-neutral-200 dark:bg-neutral-800",children:[y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:"Package Size"})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-sm text-foreground",children:t.packageSize})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:"Manufacturer"})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-sm text-foreground text-right",children:t.manufacturer})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:"Product ID"})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-sm text-foreground font-mono",children:t.productId})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase",children:"Authorization"})}),y.jsx("div",{className:"p-3 bg-white dark:bg-neutral-950",children:y.jsx("span",{className:"text-sm text-foreground font-mono",children:t.authorizationNo})})]})})]}),y.jsxs("div",{className:"mt-6",children:[y.jsxs("h3",{className:"text-base font-heading font-semibold text-foreground mb-3 flex items-center gap-2",children:[y.jsx(dL,{className:"w-5 h-5 text-primary"}),"Expiry & Batch"]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-950/30 rounded-lg border border-green-200 dark:border-green-900",children:[y.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Expiry Date"}),y.jsx("div",{className:"text-sm font-medium text-foreground",children:s})]}),y.jsxs("div",{className:"p-3 bg-purple-50 dark:bg-purple-950/30 rounded-lg border border-purple-200 dark:border-purple-900",children:[y.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Batch Number"}),y.jsx("div",{className:"text-sm font-medium text-foreground font-mono",children:u})]})]})]}),y.jsxs("div",{className:"mt-6",children:[y.jsxs("h3",{className:"text-base font-heading font-semibold text-foreground mb-3 flex items-center gap-2",children:[y.jsx(sB,{className:"w-5 h-5 text-primary"}),"Storage Conditions"]}),y.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-900",children:y.jsx("p",{className:"text-sm text-foreground",children:t.storageConditions})})]}),y.jsxs("div",{className:"mt-6",children:[y.jsxs("h3",{className:"text-base font-heading font-semibold text-foreground mb-3 flex items-center gap-2",children:[y.jsx(Ki,{className:"w-5 h-5 text-primary"}),"Safety Information"]}),y.jsxs("div",{className:"space-y-3",children:[y.jsxs("div",{className:`p-4 rounded-lg border ${t.isApprovedForKids?"bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-900":"bg-orange-50 dark:bg-orange-950/30 border-orange-200 dark:border-orange-900"}`,children:[y.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[y.jsx(uL,{className:"w-4 h-4"}),y.jsx("span",{className:"text-sm font-medium text-foreground",children:"Pediatric Use"})]}),y.jsx("p",{className:"text-sm text-muted-foreground",children:t.isApprovedForKids?"This medication is approved for use in children.":"This medication is not approved for children. Consult a healthcare professional."})]}),y.jsxs("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-950/30 rounded-lg border border-yellow-200 dark:border-yellow-900",children:[y.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[y.jsx(Ki,{className:"w-4 h-4"}),y.jsx("span",{className:"text-sm font-medium text-foreground",children:"Important Notice"})]}),y.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Always read the package leaflet carefully before use. If symptoms persist or worsen, consult a healthcare professional. Do not exceed the recommended dose."})]})]})]}),y.jsxs("div",{className:"mt-6",children:[y.jsxs("h3",{className:"text-base font-heading font-semibold text-foreground mb-3 flex items-center gap-2",children:[y.jsx(_u,{className:"w-5 h-5 text-primary"}),"Frequently Asked Questions"]}),y.jsxs("div",{className:"space-y-3",children:[y.jsxs("div",{className:"p-3 bg-neutral-50 dark:bg-neutral-900/30 rounded-lg border border-neutral-200 dark:border-neutral-800",children:[y.jsx("p",{className:"text-xs font-medium text-foreground mb-1",children:"Can I take this during pregnancy?"}),y.jsx("p",{className:"text-xs text-muted-foreground",children:"Consult your healthcare provider before use during pregnancy or breastfeeding."})]}),y.jsxs("div",{className:"p-3 bg-neutral-50 dark:bg-neutral-900/30 rounded-lg border border-neutral-200 dark:border-neutral-800",children:[y.jsx("p",{className:"text-xs font-medium text-foreground mb-1",children:"Can I take this with alcohol?"}),y.jsx("p",{className:"text-xs text-muted-foreground",children:"Avoid alcohol while taking this medication unless advised otherwise by your doctor."})]}),y.jsxs("div",{className:"p-3 bg-neutral-50 dark:bg-neutral-900/30 rounded-lg border border-neutral-200 dark:border-neutral-800",children:[y.jsx("p",{className:"text-xs font-medium text-foreground mb-1",children:"Does it cause drowsiness?"}),y.jsx("p",{className:"text-xs text-muted-foreground",children:"Check the package leaflet for side effects. Some medications may cause drowsiness."})]})]})]})]}),y.jsx("div",{className:"px-6 py-4 bg-muted/30 border-t border-border",children:y.jsxs("div",{className:"text-center",children:[y.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:r.medicineDetails.allInfoDisplayed}),t.packageLeafletUrl&&y.jsxs(Pe,{onClick:()=>o(!0),variant:"default",size:"sm",className:"inline-flex items-center gap-2",children:[y.jsx(Ad,{className:"w-4 h-4"}),r.medicineDetails.viewPackageLeaflet]})]})})]})})})]})}),y.jsx(jH,{pdfUrl:t.packageLeafletUrl,medicineName:t.name,isOpen:i,onClose:()=>o(!1)})]})}function LH({id:t,name:e,price:n,group:r,image:i,description:o,isSelected:a,isDisabled:s,onSelect:u,medicine:l}){const{getStock:c}=yr(),d=c(t),h=d<=0,[f,m]=A.useState(!1);return y.jsxs(y.Fragment,{children:[y.jsx(Le.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},whileHover:!s&&!h?{scale:1.02}:{},whileTap:!s&&!h?{scale:.98}:{},className:"p-2",children:y.jsxs(et,{className:`relative overflow-hidden transition-all duration-200 ${a?"ring-2 ring-accent shadow-lg bg-accent/5":s||h?"opacity-50 cursor-not-allowed":"hover:shadow-md cursor-pointer hover:border-accent/50"}`,children:[h&&!a&&y.jsx("div",{className:"absolute inset-0 bg-destructive/10 backdrop-blur-[1px] z-10 flex items-center justify-center",children:y.jsx("span",{className:"text-xs font-medium text-destructive bg-background/90 px-3 py-1 rounded-full",children:"Out of Stock"})}),s&&!a&&!h&&y.jsx("div",{className:"absolute inset-0 bg-neutral-900/5 backdrop-blur-[1px] z-10 flex items-center justify-center",children:y.jsx("span",{className:"text-xs font-medium text-muted-foreground bg-background/90 px-3 py-1 rounded-full",children:"Group Limit Reached"})}),y.jsxs("div",{className:"p-6",children:[y.jsx("div",{className:"absolute top-3 right-3 z-20",children:y.jsx(Pe,{onClick:p=>{p.stopPropagation(),m(!0)},variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full bg-background/80 backdrop-blur-sm hover:bg-accent hover:text-accent-foreground shadow-sm border border-border",title:"View details",children:y.jsx(IL,{className:"w-4 h-4"})})}),i&&y.jsx("div",{className:"w-full h-32 mb-4 rounded-lg bg-neutral-100 flex items-center justify-center overflow-hidden",children:y.jsx("img",{src:i,alt:e,className:"w-full h-full object-cover",loading:"lazy"})}),y.jsxs("div",{className:"space-y-3",children:[y.jsx("h3",{className:"text-lg font-heading font-medium text-foreground line-clamp-2",children:e}),o&&y.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:o}),y.jsxs("div",{className:"flex items-center justify-between pt-2",children:[y.jsxs("div",{className:"flex flex-col",children:[y.jsxs("span",{className:"text-xl font-heading font-semibold text-primary",children:["",n.toFixed(2)]}),y.jsxs("span",{className:"text-xs text-muted-foreground",children:["Stock: ",d]})]}),y.jsx(Pe,{onClick:()=>!s&&!h&&u(t),disabled:s&&!a||h&&!a,className:`h-12 w-12 rounded-lg ${a?"bg-accent text-accent-foreground":"bg-primary text-primary-foreground"}`,children:a?y.jsx(au,{className:"w-5 h-5",strokeWidth:2}):y.jsx(YL,{className:"w-5 h-5",strokeWidth:2})})]})]})]})]})}),y.jsx(FH,{medicine:l||null,isOpen:f,onClose:()=>m(!1)})]})}function BH(){const t=$r(),{selectedMedicines:e,toggleMedicine:n}=yr(),{currentUserId:r,blockedCategories:i,userRecords:o}=Rh(),{t:a}=Fn(),s=h=>tn.filter(f=>f.group===h),u=h=>tn.filter(f=>f.group===h).some(f=>e.includes(f.id)),l=h=>i.includes(h),c=h=>{if(!r)return"";const f=o.find(v=>v.id===r);if(!f)return"";const m=f.purchaseHistory.filter(v=>v.categoryId===h);if(m.length===0)return"";const p=m.reduce((v,g)=>g.purchaseDate>v.purchaseDate?g:v);return KG(p.purchaseDate)},d=()=>{e.length>0&&t("/review")};return y.jsx("div",{className:"min-h-[calc(100vh-180px)] px-8 py-12",children:y.jsx("div",{className:"container max-w-7xl mx-auto",children:y.jsxs(Le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-8",children:[r&&y.jsxs(YR,{className:"bg-accent/10 border-accent",children:[y.jsx(Ki,{className:"h-5 w-5 text-accent"}),y.jsxs(JR,{className:"text-foreground",children:[y.jsx("strong",{children:a.purchaseRestrictions.welcomeBack})," ",a.purchaseRestrictions.restrictionInfo]})]}),y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{children:[y.jsx("h1",{className:"text-4xl font-heading font-semibold text-foreground mb-3",children:a.medicineSelection.title}),y.jsx("p",{className:"text-lg text-muted-foreground mb-2",children:a.medicineSelection.subtitleGroups}),y.jsxs("div",{className:"flex items-center gap-2",children:[y.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(h=>y.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center text-xs font-medium transition-all ${tn.filter(f=>f.group===h).some(f=>e.includes(f.id))?"bg-accent text-accent-foreground":"bg-muted text-muted-foreground"}`,children:h},h))}),y.jsx("span",{className:"text-sm text-muted-foreground",children:a.medicineSelection.selectedGroups.replace("{count}",e.length.toString())})]})]}),y.jsxs(Pe,{onClick:d,disabled:e.length===0,className:"h-14 px-8 rounded-xl bg-accent text-accent-foreground hover:bg-accent/90 disabled:opacity-50 sticky top-24 shadow-lg",children:[y.jsx(qC,{className:"w-5 h-5 mr-3",strokeWidth:2}),a.medicineSelection.continueCount.replace("{count}",e.length.toString())]})]}),y.jsx(PH,{type:"multiple",defaultValue:["group-1"],className:"space-y-4",children:b5.map(h=>{const f=s(h.id),m=u(h.id),p=l(h.id),v=p?c(h.id):"";return y.jsxs(KR,{value:`group-${h.id}`,className:`border border-border rounded-2xl overflow-hidden ${p?"bg-muted/50 opacity-60":"bg-card"}`,children:[y.jsx(qR,{className:"px-8 py-6 hover:no-underline hover:bg-muted/50 transition-colors",disabled:p,children:y.jsxs("div",{className:"flex items-center justify-between w-full pr-4",children:[y.jsxs("div",{className:"flex items-center gap-4",children:[y.jsx("div",{className:`w-12 h-12 rounded-lg ${p?"bg-destructive/10":"bg-primary/10"} flex items-center justify-center`,children:y.jsx("span",{className:`text-xl font-heading font-semibold ${p?"text-destructive":"text-primary"}`,children:h.id})}),y.jsxs("div",{className:"text-left",children:[y.jsx("h3",{className:"text-xl font-heading font-medium text-foreground",children:h.name}),y.jsx("p",{className:"text-sm text-muted-foreground",children:h.description})]})]}),y.jsxs("div",{className:"flex items-center gap-3",children:[p&&y.jsxs(DH,{variant:"destructive",className:"flex items-center gap-2",children:[y.jsx(bL,{className:"w-3 h-3"}),a.purchaseRestrictions.timeRemaining.replace("{time}",v)]}),m&&!p&&y.jsxs("span",{className:"px-4 py-2 rounded-lg bg-accent/10 text-accent text-sm font-normal flex items-center gap-2",children:[y.jsx("span",{className:"w-2 h-2 rounded-full bg-accent animate-pulse"}),a.medicineSelection.selected]})]})]})}),y.jsx(XR,{className:"px-8 pb-8",children:p?y.jsxs("div",{className:"py-8 text-center",children:[y.jsx(Ki,{className:"w-16 h-16 mx-auto text-destructive mb-4"}),y.jsx("h4",{className:"text-lg font-medium text-foreground mb-2",children:a.purchaseRestrictions.categoryBlocked}),y.jsx("p",{className:"text-sm text-muted-foreground",children:a.purchaseRestrictions.timeRemaining.replace("{time}",v)})]}):y.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 pt-4",children:f.map(g=>y.jsx(LH,{id:g.id,name:g.name,price:g.price,group:g.group,description:g.description,isSelected:e.includes(g.id),isDisabled:m&&!e.includes(g.id),onSelect:n,medicine:g},g.id))})})]},h.id)})})]})})})}var VH="Separator",n2="horizontal",zH=["horizontal","vertical"],QR=A.forwardRef((t,e)=>{const{decorative:n,orientation:r=n2,...i}=t,o=UH(r)?r:n2,s=n?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return y.jsx($e.div,{"data-orientation":o,...s,...i,ref:e})});QR.displayName=VH;function UH(t){return zH.includes(t)}var ZR=QR;const eN=ve.forwardRef(({className:t,orientation:e="horizontal",decorative:n=!0,...r},i)=>y.jsx(ZR,{ref:i,decorative:n,orientation:e,className:Ke("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...r}));eN.displayName=ZR.displayName;function $H(){const t=$r(),{selectedMedicines:e,toggleMedicine:n}=yr(),{t:r}=Fn(),i=tn.filter(l=>e.includes(l.id)),o=i.reduce((l,c)=>l+c.price,0),a=o*.08,s=o+a,u=()=>{t("/checkout")};return e.length===0?y.jsx("div",{className:"min-h-[calc(100vh-180px)] flex items-center justify-center px-8 py-12",children:y.jsxs(et,{className:"p-12 text-center max-w-2xl",children:[y.jsx(KC,{className:"w-24 h-24 mx-auto mb-6 text-muted-foreground",strokeWidth:1}),y.jsx("h2",{className:"text-3xl font-heading font-semibold text-foreground mb-4",children:r.checkout.emptyCart}),y.jsx("p",{className:"text-lg text-muted-foreground mb-8",children:r.checkout.emptyCartMessage}),y.jsx(Pe,{onClick:()=>t("/select-medicine"),className:"h-14 px-8 rounded-xl bg-primary text-primary-foreground hover:bg-primary/90",children:r.checkout.browseMedicines})]})}):y.jsx("div",{className:"min-h-[calc(100vh-180px)] px-8 py-12",children:y.jsx("div",{className:"container max-w-5xl mx-auto",children:y.jsxs(Le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-8",children:[y.jsxs("div",{className:"text-center",children:[y.jsx("h1",{className:"text-4xl font-heading font-semibold text-foreground mb-3",children:r.checkout.reviewOrder}),y.jsx("p",{className:"text-lg text-muted-foreground",children:r.checkout.checkSelected})]}),y.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[y.jsx("div",{className:"lg:col-span-2 space-y-4",children:i.map(l=>y.jsx(et,{className:"p-6",children:y.jsxs("div",{className:"flex items-center gap-6",children:[y.jsx("div",{className:"w-24 h-24 rounded-lg bg-neutral-100 flex-shrink-0"}),y.jsxs("div",{className:"flex-1",children:[y.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[y.jsx("h3",{className:"text-xl font-heading font-medium text-foreground",children:l.name}),y.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-primary/10 text-primary",children:r.checkout.groupLabel.replace("{group}",l.group.toString())})]}),y.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:l.description}),y.jsxs("p",{className:"text-lg font-heading font-semibold text-primary",children:["$",l.price.toFixed(2)]})]}),y.jsx(Pe,{onClick:()=>n(l.id),className:"h-12 w-12 rounded-lg bg-destructive text-destructive-foreground hover:bg-destructive/90",children:y.jsx(lB,{className:"w-5 h-5",strokeWidth:2})})]})},l.id))}),y.jsx("div",{className:"lg:col-span-1",children:y.jsxs(et,{className:"p-8 sticky top-24 shadow-lg",children:[y.jsx("h2",{className:"text-2xl font-heading font-semibold text-foreground mb-6",children:r.checkout.orderSummary}),y.jsxs("div",{className:"space-y-4 mb-6",children:[y.jsxs("div",{className:"flex justify-between text-base",children:[y.jsx("span",{className:"text-muted-foreground",children:r.checkout.subtotal}),y.jsxs("span",{className:"text-foreground font-normal",children:["$",o.toFixed(2)]})]}),y.jsxs("div",{className:"flex justify-between text-base",children:[y.jsx("span",{className:"text-muted-foreground",children:r.checkout.tax}),y.jsxs("span",{className:"text-foreground font-normal",children:["$",a.toFixed(2)]})]}),y.jsx(eN,{}),y.jsxs("div",{className:"flex justify-between text-xl",children:[y.jsx("span",{className:"font-heading font-semibold text-foreground",children:r.checkout.total}),y.jsxs("span",{className:"font-heading font-semibold text-primary",children:["$",s.toFixed(2)]})]})]}),y.jsx(Pe,{onClick:u,className:"w-full h-14 rounded-xl bg-accent text-accent-foreground hover:bg-accent/90",children:r.checkout.proceedToCheckout}),y.jsx(Pe,{onClick:()=>t("/select-medicine"),className:"w-full h-14 rounded-xl mt-4 bg-muted text-muted-foreground hover:bg-muted/80",children:r.checkout.addMoreItems})]})})]})]})})})}function WH(){const{t}=Fn();return y.jsxs("div",{className:"relative w-full h-64 bg-card border border-border rounded-2xl overflow-hidden",children:[y.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:y.jsx("div",{className:"relative w-32 h-full border-x-2 border-border/50",children:[0,1,2,3,4].map(e=>y.jsx(Le.div,{initial:{y:-100,opacity:0},animate:{y:300,opacity:[0,1,1,0]},transition:{duration:2,delay:e*.3,repeat:1/0,repeatDelay:1},className:"absolute left-1/2 -translate-x-1/2",children:y.jsx(Zm,{className:"w-8 h-8 text-accent",strokeWidth:2})},e))})}),y.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-accent/20 to-transparent"}),y.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-center",children:y.jsx("p",{className:"text-lg font-heading font-medium text-foreground",children:t.medicineDetails.dispensing})})]})}function GH({total:t,onApprove:e,onError:n}){const r=A.useRef(null),[i,o]=A.useState(!0),[a,s]=A.useState(null);return A.useEffect(()=>{const u=setInterval(()=>{window.paypal&&r.current&&(clearInterval(u),o(!1),window.paypal.Buttons({style:{layout:"vertical",color:"blue",shape:"rect",label:"paypal",height:48},createOrder:(c,d)=>d.order.create({intent:"CAPTURE",purchase_units:[{amount:{currency_code:"EUR",value:t.toFixed(2)}}]}),onApprove:async(c,d)=>{try{const h=await d.order.capture();(h==null?void 0:h.status)==="COMPLETED"?e(h.id):n("Payment was not completed. Please try again.")}catch(h){console.error("PayPal onApprove error:",h),n("An error occurred during payment processing.")}},onError:c=>{console.error("PayPal Error:",c),n("Payment failed. Please try again.")},onCancel:()=>{n("Payment was cancelled.")}}).render(r.current).catch(c=>{console.error("Failed to render PayPal buttons:",c),s("Failed to load PayPal buttons. Please refresh the page.")}))},100),l=setTimeout(()=>{clearInterval(u),window.paypal||(s("PayPal SDK failed to load. Please refresh the page."),o(!1))},1e4);return()=>{clearInterval(u),clearTimeout(l)}},[t,e,n]),a?y.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 text-center",children:y.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 font-medium",children:a})}):i?y.jsx("div",{className:"text-center py-8",children:y.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Loading PayPal..."})}):y.jsxs("div",{children:[y.jsx("div",{ref:r}),y.jsxs("p",{className:"text-xs text-center text-gray-500 dark:text-gray-400 mt-2",children:["Powered by ",y.jsx("span",{className:"font-semibold",children:"PayPal"})]})]})}var Ig=function(t,e){return Ig=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Ig(t,e)};function tN(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ig(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Zd=function(){return Zd=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Zd.apply(this,arguments)};function js(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function nN(t,e,n,r){var i=arguments.length,o=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(o=(i<3?a(o):i>3?a(e,n,o):a(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o}function rN(t,e){return function(n,r){e(n,r,t)}}function iN(t,e,n,r,i,o){function a(g){if(g!==void 0&&typeof g!="function")throw new TypeError("Function expected");return g}for(var s=r.kind,u=s==="getter"?"get":s==="setter"?"set":"value",l=!e&&t?r.static?t:t.prototype:null,c=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),d,h=!1,f=n.length-1;f>=0;f--){var m={};for(var p in r)m[p]=p==="access"?{}:r[p];for(var p in r.access)m.access[p]=r.access[p];m.addInitializer=function(g){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(a(g||null))};var v=(0,n[f])(s==="accessor"?{get:c.get,set:c.set}:c[u],m);if(s==="accessor"){if(v===void 0)continue;if(v===null||typeof v!="object")throw new TypeError("Object expected");(d=a(v.get))&&(c.get=d),(d=a(v.set))&&(c.set=d),(d=a(v.init))&&i.unshift(d)}else(d=a(v))&&(s==="field"?i.unshift(d):c[u]=d)}l&&Object.defineProperty(l,r.name,c),h=!0}function oN(t,e,n){for(var r=arguments.length>2,i=0;i<e.length;i++)n=r?e[i].call(t,n):e[i].call(t);return r?n:void 0}function aN(t){return typeof t=="symbol"?t:"".concat(t)}function sN(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function uN(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function se(t,e,n,r){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function s(c){try{l(r.next(c))}catch(d){a(d)}}function u(c){try{l(r.throw(c))}catch(d){a(d)}}function l(c){c.done?o(c.value):i(c.value).then(s,u)}l((r=r.apply(t,e||[])).next())})}function lN(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){n.label=l[1];break}if(l[0]===6&&n.label<o[1]){n.label=o[1],o=l;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(l);break}o[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(c){l=[6,c],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var Xh=Object.create?function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}:function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]};function cN(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&Xh(e,t,n)}function eh(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Y0(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(s){a={error:s}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return o}function dN(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Y0(arguments[e]));return t}function hN(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function fN(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}function xs(t){return this instanceof xs?(this.v=t,this):new xs(t)}function pN(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,o=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(f){return function(m){return Promise.resolve(m).then(f,d)}}function s(f,m){r[f]&&(i[f]=function(p){return new Promise(function(v,g){o.push([f,p,v,g])>1||u(f,p)})},m&&(i[f]=m(i[f])))}function u(f,m){try{l(r[f](m))}catch(p){h(o[0][3],p)}}function l(f){f.value instanceof xs?Promise.resolve(f.value.v).then(c,d):h(o[0][2],f)}function c(f){u("next",f)}function d(f){u("throw",f)}function h(f,m){f(m),o.shift(),o.length&&u(o[0][0],o[0][1])}}function mN(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,o){e[i]=t[i]?function(a){return(n=!n)?{value:xs(t[i](a)),done:!1}:o?o(a):a}:o}}function gN(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof eh=="function"?eh(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(a){return new Promise(function(s,u){a=t[o](a),i(s,u,a.done,a.value)})}}function i(o,a,s,u){Promise.resolve(u).then(function(l){o({value:l,done:s})},a)}}function vN(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var HH=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},Dg=function(t){return Dg=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},Dg(t)};function yN(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=Dg(t),r=0;r<n.length;r++)n[r]!=="default"&&Xh(e,t,n[r]);return HH(e,t),e}function xN(t){return t&&t.__esModule?t:{default:t}}function wN(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function bN(t,e,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n}function kN(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function _N(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,i;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(i=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(o){return Promise.reject(o)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}var KH=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function SN(t){function e(o){t.error=t.hasError?new KH(o,t.error,"An error was suppressed during disposal."):o,t.hasError=!0}var n,r=0;function i(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(i);if(n.dispose){var o=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(o).then(i,function(a){return e(a),i()})}else r|=1}catch(a){e(a)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return i()}function CN(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,i,o,a){return r?e?".jsx":".js":i&&(!o||!a)?n:i+o+"."+a.toLowerCase()+"js"}):t}const qH={__extends:tN,__assign:Zd,__rest:js,__decorate:nN,__param:rN,__esDecorate:iN,__runInitializers:oN,__propKey:aN,__setFunctionName:sN,__metadata:uN,__awaiter:se,__generator:lN,__createBinding:Xh,__exportStar:cN,__values:eh,__read:Y0,__spread:dN,__spreadArrays:hN,__spreadArray:fN,__await:xs,__asyncGenerator:pN,__asyncDelegator:mN,__asyncValues:gN,__makeTemplateObject:vN,__importStar:yN,__importDefault:xN,__classPrivateFieldGet:wN,__classPrivateFieldSet:bN,__classPrivateFieldIn:kN,__addDisposableResource:_N,__disposeResources:SN,__rewriteRelativeImportExtension:CN},XH=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:_N,get __assign(){return Zd},__asyncDelegator:mN,__asyncGenerator:pN,__asyncValues:gN,__await:xs,__awaiter:se,__classPrivateFieldGet:wN,__classPrivateFieldIn:kN,__classPrivateFieldSet:bN,__createBinding:Xh,__decorate:nN,__disposeResources:SN,__esDecorate:iN,__exportStar:cN,__extends:tN,__generator:lN,__importDefault:xN,__importStar:yN,__makeTemplateObject:vN,__metadata:uN,__param:rN,__propKey:aN,__read:Y0,__rest:js,__rewriteRelativeImportExtension:CN,__runInitializers:oN,__setFunctionName:sN,__spread:dN,__spreadArray:fN,__spreadArrays:hN,__values:eh,default:qH},Symbol.toStringTag,{value:"Module"})),YH=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class J0 extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class JH extends J0{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class r2 extends J0{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class i2 extends J0{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Mg;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Mg||(Mg={}));class QH{constructor(e,{headers:n={},customFetch:r,region:i=Mg.Any}={}){this.url=e,this.headers=n,this.region=i,this.fetch=YH(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return se(this,arguments,void 0,function*(n,r={}){var i;let o,a;try{const{headers:s,method:u,body:l,signal:c,timeout:d}=r;let h={},{region:f}=r;f||(f=this.region);const m=new URL(`${this.url}/${n}`);f&&f!=="any"&&(h["x-region"]=f,m.searchParams.set("forceFunctionRegion",f));let p;l&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)?typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",p=l):typeof l=="string"?(h["Content-Type"]="text/plain",p=l):typeof FormData<"u"&&l instanceof FormData?p=l:(h["Content-Type"]="application/json",p=JSON.stringify(l)):p=l;let v=c;d&&(a=new AbortController,o=setTimeout(()=>a.abort(),d),c?(v=a.signal,c.addEventListener("abort",()=>a.abort())):v=a.signal);const g=yield this.fetch(m.toString(),{method:u||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),s),body:p,signal:v}).catch(k=>{throw new JH(k)}),x=g.headers.get("x-relay-error");if(x&&x==="true")throw new r2(g);if(!g.ok)throw new i2(g);let w=((i=g.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),b;return w==="application/json"?b=yield g.json():w==="application/octet-stream"||w==="application/pdf"?b=yield g.blob():w==="text/event-stream"?b=g:w==="multipart/form-data"?b=yield g.formData():b=yield g.text(),{data:b,error:null,response:g}}catch(s){return{data:null,error:s,response:s instanceof i2||s instanceof r2?s.context:void 0}}finally{o&&clearTimeout(o)}})}}var nn={};const Fs=kP(XH);var kc={},_c={},Sc={},Cc={},Ec={},Ac={},o2;function EN(){if(o2)return Ac;o2=1,Object.defineProperty(Ac,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return Ac.default=t,Ac}var a2;function AN(){if(a2)return Ec;a2=1,Object.defineProperty(Ec,"__esModule",{value:!0});const e=Fs.__importDefault(EN());class n{constructor(i){var o,a;this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=new Headers(i.headers),this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=(o=i.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=i.signal,this.isMaybeSingle=(a=i.isMaybeSingle)!==null&&a!==void 0?a:!1,i.fetch?this.fetch=i.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=new Headers(this.headers),this.headers.set(i,o),this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let s=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{var l,c,d,h;let f=null,m=null,p=null,v=u.status,g=u.statusText;if(u.ok){if(this.method!=="HEAD"){const k=await u.text();k===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((l=this.headers.get("Accept"))===null||l===void 0)&&l.includes("application/vnd.pgrst.plan+text"))?m=k:m=JSON.parse(k))}const w=(c=this.headers.get("Prefer"))===null||c===void 0?void 0:c.match(/count=(exact|planned|estimated)/),b=(d=u.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");w&&b&&b.length>1&&(p=parseInt(b[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(f={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,p=null,v=406,g="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{const w=await u.text();try{f=JSON.parse(w),Array.isArray(f)&&u.status===404&&(m=[],f=null,v=200,g="OK")}catch{u.status===404&&w===""?(v=204,g="No Content"):f={message:w}}if(f&&this.isMaybeSingle&&(!((h=f==null?void 0:f.details)===null||h===void 0)&&h.includes("0 rows"))&&(f=null,v=200,g="OK"),f&&this.shouldThrowOnError)throw new e.default(f)}return{error:f,data:m,count:p,status:v,statusText:g}});return this.shouldThrowOnError||(s=s.catch(u=>{var l,c,d,h,f,m;let p="";const v=u==null?void 0:u.cause;if(v){const g=(l=v==null?void 0:v.message)!==null&&l!==void 0?l:"",x=(c=v==null?void 0:v.code)!==null&&c!==void 0?c:"";p=`${(d=u==null?void 0:u.name)!==null&&d!==void 0?d:"FetchError"}: ${u==null?void 0:u.message}`,p+=`

Caused by: ${(h=v==null?void 0:v.name)!==null&&h!==void 0?h:"Error"}: ${g}`,x&&(p+=` (${x})`),v!=null&&v.stack&&(p+=`
${v.stack}`)}else p=(f=u==null?void 0:u.stack)!==null&&f!==void 0?f:"";return{error:{message:`${(m=u==null?void 0:u.name)!==null&&m!==void 0?m:"FetchError"}: ${u==null?void 0:u.message}`,details:p,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(i,o)}returns(){return this}overrideTypes(){return this}}return Ec.default=n,Ec}var s2;function RN(){if(s2)return Cc;s2=1,Object.defineProperty(Cc,"__esModule",{value:!0});const e=Fs.__importDefault(AN());class n extends e.default{select(i){let o=!1;const a=(i??"*").split("").map(s=>/\s/.test(s)&&!o?"":(s==='"'&&(o=!o),s)).join("");return this.url.searchParams.set("select",a),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:o=!0,nullsFirst:a,foreignTable:s,referencedTable:u=s}={}){const l=u?`${u}.order`:"order",c=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${c?`${c},`:""}${i}.${o?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:o,referencedTable:a=o}={}){const s=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(s,`${i}`),this}range(i,o,{foreignTable:a,referencedTable:s=a}={}){const u=typeof s>"u"?"offset":`${s}.offset`,l=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(u,`${i}`),this.url.searchParams.set(l,`${o-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:o=!1,settings:a=!1,buffers:s=!1,wal:u=!1,format:l="text"}={}){var c;const d=[i?"analyze":null,o?"verbose":null,a?"settings":null,s?"buffers":null,u?"wal":null].filter(Boolean).join("|"),h=(c=this.headers.get("Accept"))!==null&&c!==void 0?c:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${l}; for="${h}"; options=${d};`),l==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}}return Cc.default=n,Cc}var u2;function Q0(){if(u2)return Sc;u2=1,Object.defineProperty(Sc,"__esModule",{value:!0});const e=Fs.__importDefault(RN()),n=new RegExp("[,()]");class r extends e.default{eq(o,a){return this.url.searchParams.append(o,`eq.${a}`),this}neq(o,a){return this.url.searchParams.append(o,`neq.${a}`),this}gt(o,a){return this.url.searchParams.append(o,`gt.${a}`),this}gte(o,a){return this.url.searchParams.append(o,`gte.${a}`),this}lt(o,a){return this.url.searchParams.append(o,`lt.${a}`),this}lte(o,a){return this.url.searchParams.append(o,`lte.${a}`),this}like(o,a){return this.url.searchParams.append(o,`like.${a}`),this}likeAllOf(o,a){return this.url.searchParams.append(o,`like(all).{${a.join(",")}}`),this}likeAnyOf(o,a){return this.url.searchParams.append(o,`like(any).{${a.join(",")}}`),this}ilike(o,a){return this.url.searchParams.append(o,`ilike.${a}`),this}ilikeAllOf(o,a){return this.url.searchParams.append(o,`ilike(all).{${a.join(",")}}`),this}ilikeAnyOf(o,a){return this.url.searchParams.append(o,`ilike(any).{${a.join(",")}}`),this}regexMatch(o,a){return this.url.searchParams.append(o,`match.${a}`),this}regexIMatch(o,a){return this.url.searchParams.append(o,`imatch.${a}`),this}is(o,a){return this.url.searchParams.append(o,`is.${a}`),this}isDistinct(o,a){return this.url.searchParams.append(o,`isdistinct.${a}`),this}in(o,a){const s=Array.from(new Set(a)).map(u=>typeof u=="string"&&n.test(u)?`"${u}"`:`${u}`).join(",");return this.url.searchParams.append(o,`in.(${s})`),this}contains(o,a){return typeof a=="string"?this.url.searchParams.append(o,`cs.${a}`):Array.isArray(a)?this.url.searchParams.append(o,`cs.{${a.join(",")}}`):this.url.searchParams.append(o,`cs.${JSON.stringify(a)}`),this}containedBy(o,a){return typeof a=="string"?this.url.searchParams.append(o,`cd.${a}`):Array.isArray(a)?this.url.searchParams.append(o,`cd.{${a.join(",")}}`):this.url.searchParams.append(o,`cd.${JSON.stringify(a)}`),this}rangeGt(o,a){return this.url.searchParams.append(o,`sr.${a}`),this}rangeGte(o,a){return this.url.searchParams.append(o,`nxl.${a}`),this}rangeLt(o,a){return this.url.searchParams.append(o,`sl.${a}`),this}rangeLte(o,a){return this.url.searchParams.append(o,`nxr.${a}`),this}rangeAdjacent(o,a){return this.url.searchParams.append(o,`adj.${a}`),this}overlaps(o,a){return typeof a=="string"?this.url.searchParams.append(o,`ov.${a}`):this.url.searchParams.append(o,`ov.{${a.join(",")}}`),this}textSearch(o,a,{config:s,type:u}={}){let l="";u==="plain"?l="pl":u==="phrase"?l="ph":u==="websearch"&&(l="w");const c=s===void 0?"":`(${s})`;return this.url.searchParams.append(o,`${l}fts${c}.${a}`),this}match(o){return Object.entries(o).forEach(([a,s])=>{this.url.searchParams.append(a,`eq.${s}`)}),this}not(o,a,s){return this.url.searchParams.append(o,`not.${a}.${s}`),this}or(o,{foreignTable:a,referencedTable:s=a}={}){const u=s?`${s}.or`:"or";return this.url.searchParams.append(u,`(${o})`),this}filter(o,a,s){return this.url.searchParams.append(o,`${a}.${s}`),this}}return Sc.default=r,Sc}var l2;function NN(){if(l2)return _c;l2=1,Object.defineProperty(_c,"__esModule",{value:!0});const e=Fs.__importDefault(Q0());class n{constructor(i,{headers:o={},schema:a,fetch:s}){this.url=i,this.headers=new Headers(o),this.schema=a,this.fetch=s}select(i,o){const{head:a=!1,count:s}=o??{},u=a?"HEAD":"GET";let l=!1;const c=(i??"*").split("").map(d=>/\s/.test(d)&&!l?"":(d==='"'&&(l=!l),d)).join("");return this.url.searchParams.set("select",c),s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(i,{count:o,defaultToNull:a=!0}={}){var s;const u="POST";if(o&&this.headers.append("Prefer",`count=${o}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const l=i.reduce((c,d)=>c.concat(Object.keys(d)),[]);if(l.length>0){const c=[...new Set(l)].map(d=>`"${d}"`);this.url.searchParams.set("columns",c.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(i,{onConflict:o,ignoreDuplicates:a=!1,count:s,defaultToNull:u=!0}={}){var l;const c="POST";if(this.headers.append("Prefer",`resolution=${a?"ignore":"merge"}-duplicates`),o!==void 0&&this.url.searchParams.set("on_conflict",o),s&&this.headers.append("Prefer",`count=${s}`),u||this.headers.append("Prefer","missing=default"),Array.isArray(i)){const d=i.reduce((h,f)=>h.concat(Object.keys(f)),[]);if(d.length>0){const h=[...new Set(d)].map(f=>`"${f}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}update(i,{count:o}={}){var a;const s="PATCH";return o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}delete({count:i}={}){var o;const a="DELETE";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}}return _c.default=n,_c}var c2;function ZH(){if(c2)return kc;c2=1,Object.defineProperty(kc,"__esModule",{value:!0});const t=Fs,e=t.__importDefault(NN()),n=t.__importDefault(Q0());class r{constructor(o,{headers:a={},schema:s,fetch:u}={}){this.url=o,this.headers=new Headers(a),this.schemaName=s,this.fetch=u}from(o){if(!o||typeof o!="string"||o.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const a=new URL(`${this.url}/${o}`);return new e.default(a,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new r(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,a={},{head:s=!1,get:u=!1,count:l}={}){var c;let d;const h=new URL(`${this.url}/rpc/${o}`);let f;s||u?(d=s?"HEAD":"GET",Object.entries(a).filter(([p,v])=>v!==void 0).map(([p,v])=>[p,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([p,v])=>{h.searchParams.append(p,v)})):(d="POST",f=a);const m=new Headers(this.headers);return l&&m.set("Prefer",`count=${l}`),new n.default({method:d,url:h,headers:m,schema:this.schemaName,body:f,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}}return kc.default=r,kc}Object.defineProperty(nn,"__esModule",{value:!0});var TN=nn.PostgrestError=VN=nn.PostgrestBuilder=LN=nn.PostgrestTransformBuilder=jN=nn.PostgrestFilterBuilder=MN=nn.PostgrestQueryBuilder=IN=nn.PostgrestClient=void 0;const Ls=Fs,PN=Ls.__importDefault(ZH());var IN=nn.PostgrestClient=PN.default;const DN=Ls.__importDefault(NN());var MN=nn.PostgrestQueryBuilder=DN.default;const ON=Ls.__importDefault(Q0());var jN=nn.PostgrestFilterBuilder=ON.default;const FN=Ls.__importDefault(RN());var LN=nn.PostgrestTransformBuilder=FN.default;const BN=Ls.__importDefault(AN());var VN=nn.PostgrestBuilder=BN.default;const zN=Ls.__importDefault(EN());TN=nn.PostgrestError=zN.default;var UN=nn.default={PostgrestClient:PN.default,PostgrestQueryBuilder:DN.default,PostgrestFilterBuilder:ON.default,PostgrestTransformBuilder:FN.default,PostgrestBuilder:BN.default,PostgrestError:zN.default};const e9=F2({__proto__:null,get PostgrestBuilder(){return VN},get PostgrestClient(){return IN},get PostgrestError(){return TN},get PostgrestFilterBuilder(){return jN},get PostgrestQueryBuilder(){return MN},get PostgrestTransformBuilder(){return LN},default:UN},[nn]),{PostgrestClient:t9,PostgrestQueryBuilder:$q,PostgrestFilterBuilder:Wq,PostgrestTransformBuilder:Gq,PostgrestBuilder:Hq,PostgrestError:Kq}=UN||e9;class n9{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,i=parseInt(r.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const r9="2.84.0",i9=`realtime-js/${r9}`,$N="1.0.0",o9="2.0.0",d2=$N,Og=1e4,a9=1e3,s9=100;var Co;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Co||(Co={}));var wt;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(wt||(wt={}));var ar;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(ar||(ar={}));var jg;(function(t){t.websocket="websocket"})(jg||(jg={}));var Eo;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Eo||(Eo={}));class u9{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast"}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r,i,o;const a=e.topic,s=(n=e.ref)!==null&&n!==void 0?n:"",u=(r=e.join_ref)!==null&&r!==void 0?r:"",l=e.payload.event,c=(o=(i=e.payload)===null||i===void 0?void 0:i.payload)!==null&&o!==void 0?o:new ArrayBuffer(0),d=this.USER_BROADCAST_PUSH_META_LENGTH+u.length+s.length+a.length+l.length,h=new ArrayBuffer(this.HEADER_LENGTH+d);let f=new DataView(h),m=0;f.setUint8(m++,this.KINDS.userBroadcastPush),f.setUint8(m++,u.length),f.setUint8(m++,s.length),f.setUint8(m++,a.length),f.setUint8(m++,l.length),f.setUint8(m++,this.BINARY_ENCODING),Array.from(u,v=>f.setUint8(m++,v.charCodeAt(0))),Array.from(s,v=>f.setUint8(m++,v.charCodeAt(0))),Array.from(a,v=>f.setUint8(m++,v.charCodeAt(0))),Array.from(l,v=>f.setUint8(m++,v.charCodeAt(0)));var p=new Uint8Array(h.byteLength+c.byteLength);return p.set(new Uint8Array(h),0),p.set(new Uint8Array(c),h.byteLength),p.buffer}_encodeJsonUserBroadcastPush(e){var n,r,i,o;const a=e.topic,s=(n=e.ref)!==null&&n!==void 0?n:"",u=(r=e.join_ref)!==null&&r!==void 0?r:"",l=e.payload.event,c=(o=(i=e.payload)===null||i===void 0?void 0:i.payload)!==null&&o!==void 0?o:{},h=new TextEncoder().encode(JSON.stringify(c)).buffer,f=this.USER_BROADCAST_PUSH_META_LENGTH+u.length+s.length+a.length+l.length,m=new ArrayBuffer(this.HEADER_LENGTH+f);let p=new DataView(m),v=0;p.setUint8(v++,this.KINDS.userBroadcastPush),p.setUint8(v++,u.length),p.setUint8(v++,s.length),p.setUint8(v++,a.length),p.setUint8(v++,l.length),p.setUint8(v++,this.JSON_ENCODING),Array.from(u,x=>p.setUint8(v++,x.charCodeAt(0))),Array.from(s,x=>p.setUint8(v++,x.charCodeAt(0))),Array.from(a,x=>p.setUint8(v++,x.charCodeAt(0))),Array.from(l,x=>p.setUint8(v++,x.charCodeAt(0)));var g=new Uint8Array(m.byteLength+h.byteLength);return g.set(new Uint8Array(m),0),g.set(new Uint8Array(h),m.byteLength),g.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[i,o,a,s,u]=r;return n({join_ref:i,ref:o,topic:a,event:s,payload:u})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),i=new TextDecoder;switch(r){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,n,i)}}_decodeUserBroadcast(e,n,r){const i=n.getUint8(1),o=n.getUint8(2),a=n.getUint8(3),s=n.getUint8(4);let u=this.HEADER_LENGTH+4;const l=r.decode(e.slice(u,u+i));u=u+i;const c=r.decode(e.slice(u,u+o));u=u+o;const d=r.decode(e.slice(u,u+a));u=u+a;const h=e.slice(u,e.byteLength),f=s===this.JSON_ENCODING?JSON.parse(r.decode(h)):h,m={type:this.BROADCAST_EVENT,event:c,payload:f};return a>0&&(m.meta=JSON.parse(d)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST_EVENT,payload:m}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e==null?void 0:e.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}}class WN{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ve;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Ve||(Ve={}));const h2=(t,e,n={})=>{var r;const i=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((o,a)=>(o[a]=l9(a,t,e,i),o),{}):{}},l9=(t,e,n,r)=>{const i=e.find(s=>s.name===t),o=i==null?void 0:i.type,a=n[t];return o&&!r.includes(o)?GN(o,a):Fg(a)},GN=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return f9(e,n)}switch(t){case Ve.bool:return c9(e);case Ve.float4:case Ve.float8:case Ve.int2:case Ve.int4:case Ve.int8:case Ve.numeric:case Ve.oid:return d9(e);case Ve.json:case Ve.jsonb:return h9(e);case Ve.timestamp:return p9(e);case Ve.abstime:case Ve.date:case Ve.daterange:case Ve.int4range:case Ve.int8range:case Ve.money:case Ve.reltime:case Ve.text:case Ve.time:case Ve.timestamptz:case Ve.timetz:case Ve.tsrange:case Ve.tstzrange:return Fg(e);default:return Fg(e)}},Fg=t=>t,c9=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},d9=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},h9=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},f9=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let o;const a=t.slice(1,n);try{o=JSON.parse("["+a+"]")}catch{o=a?a.split(","):[]}return o.map(s=>GN(e,s))}return t},p9=t=>typeof t=="string"?t.replace(" ","T"):t,HN=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Sp{constructor(e,n,r={},i=Og){this.channel=e,this.event=n,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var f2;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(f2||(f2={}));class Au{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:o,onLeave:a,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Au.syncState(this.state,i,o,a),this.pendingDiffs.forEach(u=>{this.state=Au.syncDiff(this.state,u,o,a)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},i=>{const{onJoin:o,onLeave:a,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Au.syncDiff(this.state,i,o,a),s())}),this.onJoin((i,o,a)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:o,newPresences:a})}),this.onLeave((i,o,a)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:o,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,i){const o=this.cloneDeep(e),a=this.transformState(n),s={},u={};return this.map(o,(l,c)=>{a[l]||(u[l]=c)}),this.map(a,(l,c)=>{const d=o[l];if(d){const h=c.map(v=>v.presence_ref),f=d.map(v=>v.presence_ref),m=c.filter(v=>f.indexOf(v.presence_ref)<0),p=d.filter(v=>h.indexOf(v.presence_ref)<0);m.length>0&&(s[l]=m),p.length>0&&(u[l]=p)}else s[l]=c}),this.syncDiff(o,{joins:s,leaves:u},r,i)}static syncDiff(e,n,r,i){const{joins:o,leaves:a}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(o,(s,u)=>{var l;const c=(l=e[s])!==null&&l!==void 0?l:[];if(e[s]=this.cloneDeep(u),c.length>0){const d=e[s].map(f=>f.presence_ref),h=c.filter(f=>d.indexOf(f.presence_ref)<0);e[s].unshift(...h)}r(s,c,u)}),this.map(a,(s,u)=>{let l=e[s];if(!l)return;const c=u.map(d=>d.presence_ref);l=l.filter(d=>c.indexOf(d.presence_ref)<0),e[s]=l,i(s,l,u),l.length===0&&delete e[s]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const i=e[r];return"metas"in i?n[r]=i.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):n[r]=i,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var p2;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(p2||(p2={}));var Ru;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Ru||(Ru={}));var ni;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(ni||(ni={}));class Z0{constructor(e,n={config:{}},r){var i,o;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=wt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Sp(this,ar.join,this.params,this.timeout),this.rejoinTimer=new WN(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=wt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=wt.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=wt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=wt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=wt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ar.reply,{},(a,s)=>{this._trigger(this._replyEventName(s),a)}),this.presence=new Au(this),this.broadcastEndpointURL=HN(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,i,o;if(this.socket.isConnected()||this.socket.connect(),this.state==wt.closed){const{config:{broadcast:a,presence:s,private:u}}=this.params,l=(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(f=>f.filter))!==null&&i!==void 0?i:[],c=!!this.bindings[Ru.PRESENCE]&&this.bindings[Ru.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,d={},h={broadcast:a,presence:Object.assign(Object.assign({},s),{enabled:c}),postgres_changes:l,private:u};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(f=>e==null?void 0:e(ni.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(ni.CLOSED)),this.updateJoinPayload(Object.assign({config:h},d)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:f})=>{var m;if(this.socket.setAuth(),f===void 0){e==null||e(ni.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,v=(m=p==null?void 0:p.length)!==null&&m!==void 0?m:0,g=[];for(let x=0;x<v;x++){const w=p[x],{filter:{event:b,schema:k,table:_,filter:S}}=w,C=f&&f[x];if(C&&C.event===b&&C.schema===k&&C.table===_&&C.filter===S)g.push(Object.assign(Object.assign({},w),{id:C.id}));else{this.unsubscribe(),this.state=wt.errored,e==null||e(ni.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e(ni.SUBSCRIBED);return}}).receive("error",f=>{this.state=wt.errored,e==null||e(ni.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(ni.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===wt.joined&&e===Ru.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var i;const o=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(n==null)return Promise.reject("Payload is required for httpSend()");const a={method:"POST",headers:{Authorization:o,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},s=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(i=r.timeout)!==null&&i!==void 0?i:this.timeout);if(s.status===202)return{success:!0};let u=s.statusText;try{const l=await s.json();u=l.error||l.message||u}catch{}return Promise.reject(new Error(u))}async send(e,n={}){var r,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:a}=e,u={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:a,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,u,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=l.body)===null||i===void 0?void 0:i.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var a,s,u;const l=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((u=(s=(a=this.params)===null||a===void 0?void 0:a.config)===null||s===void 0?void 0:s.broadcast)===null||u===void 0)&&u.ack)&&o("ok"),l.receive("ok",()=>o("ok")),l.receive("error",()=>o("error")),l.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=wt.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ar.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(i=>{r=new Sp(this,ar.leave,{},e),r.receive("ok",()=>{n(),i("ok")}).receive("timeout",()=>{n(),i("timed out")}).receive("error",()=>{i("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=wt.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const i=new AbortController,o=setTimeout(()=>i.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:i.signal}));return clearTimeout(o),a}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Sp(this,e,n,r);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>s9){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var i,o;const a=e.toLocaleLowerCase(),{close:s,error:u,leave:l,join:c}=ar;if(r&&[s,u,l,c].indexOf(a)>=0&&r!==this._joinRef())return;let h=this._onMessage(a,n,r);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(f=>{var m,p,v;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((v=(p=f.filter)===null||p===void 0?void 0:p.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===a}).map(f=>f.callback(h,r)):(o=this.bindings[a])===null||o===void 0||o.filter(f=>{var m,p,v,g,x,w;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in f){const b=f.id,k=(m=f.filter)===null||m===void 0?void 0:m.event;return b&&((p=n.ids)===null||p===void 0?void 0:p.includes(b))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((v=n.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const b=(x=(g=f==null?void 0:f.filter)===null||g===void 0?void 0:g.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return b==="*"||b===((w=n==null?void 0:n.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===a}).map(f=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:p,table:v,commit_timestamp:g,type:x,errors:w}=m;h=Object.assign(Object.assign({},{schema:p,table:v,commit_timestamp:g,eventType:x,new:{},old:{},errors:w}),this._getPayloadRecords(m))}f.callback(h,r)})}_isClosed(){return this.state===wt.closed}_isJoined(){return this.state===wt.joined}_isJoining(){return this.state===wt.joining}_isLeaving(){return this.state===wt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const i=e.toLocaleLowerCase(),o={type:i,filter:n,callback:r};return this.bindings[i]?this.bindings[i].push(o):this.bindings[i]=[o],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(i=>{var o;return!(((o=i.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===r&&Z0.isEqual(i.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ar.close,{},e)}_onError(e){this._on(ar.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=wt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=h2(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=h2(e.columns,e.old_record)),n}}const Cp=()=>{},Rc={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},m9=[1e3,2e3,5e3,1e4],g9=1e4,v9=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class y9{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Og,this.transport=null,this.heartbeatIntervalMs=Rc.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Cp,this.ref=0,this.reconnectTimer=null,this.vsn=d2,this.logger=Cp,this.conn=null,this.sendBuffer=[],this.serializer=new u9,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>i?(...o)=>i(...o):(...o)=>fetch(...o),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${jg.websocket}`,this.httpEndpoint=HN(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=n9.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Co.connecting:return Eo.Connecting;case Co.open:return Eo.Open;case Co.closing:return Eo.Closing;default:return Eo.Closed}}isConnected(){return this.connectionState()===Eo.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,i=this.getChannels().find(o=>o.topic===r);if(i)return i;{const o=new Z0(`realtime:${e}`,n,this);return this.channels.push(o),o}}push(e){const{topic:n,event:r,payload:i,ref:o}=e,a=()=>{this.encode(e,s=>{var u;(u=this.conn)===null||u===void 0||u.send(s)})};this.log("push",`${n} ${r} (${o})`,i),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(a9,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},Rc.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(l){this.log("error","error in heartbeat callback",l)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:i,payload:o,ref:a}=n,s=a?`(${a})`:"",u=o.status||"";this.log("receive",`${u} ${r} ${i} ${s}`.trim(),o),this.channels.filter(l=>l._isMember(r)).forEach(l=>l._trigger(i,o,a)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Co.open||this.conn.readyState===Co.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(ar.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(n);return`${e}${r}${i}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([v9],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n;e?n=e:this.accessToken?n=await this.accessToken():n=this.accessTokenValue,this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const i={access_token:n,version:i9};n&&r.updateJoinPayload(i),r.joinedOnce&&r._isJoined()&&r._push(ar.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(n=>{this.log("error",`error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new WN(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Rc.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,i,o,a,s,u,l,c,d,h,f;switch(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:Og,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:Rc.HEARTBEAT_INTERVAL,this.worker=(o=e==null?void 0:e.worker)!==null&&o!==void 0?o:!1,this.accessToken=(a=e==null?void 0:e.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(s=e==null?void 0:e.heartbeatCallback)!==null&&s!==void 0?s:Cp,this.vsn=(u=e==null?void 0:e.vsn)!==null&&u!==void 0?u:d2,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e==null?void 0:e.reconnectAfterMs)!==null&&l!==void 0?l:m=>m9[m-1]||g9,this.vsn){case $N:this.encode=(c=e==null?void 0:e.encode)!==null&&c!==void 0?c:(m,p)=>p(JSON.stringify(m)),this.decode=(d=e==null?void 0:e.decode)!==null&&d!==void 0?d:(m,p)=>p(JSON.parse(m));break;case o9:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(f=e==null?void 0:e.decode)!==null&&f!==void 0?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class ex extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Ze(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class x9 extends ex{constructor(e,n,r){super(e),this.name="StorageApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Lg extends ex{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}const tx=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),w9=()=>Response,Bg=t=>{if(Array.isArray(t))return t.map(n=>Bg(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const i=n.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[i]=Bg(r)}),e},b9=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Ep=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},k9=(t,e,n)=>se(void 0,void 0,void 0,function*(){const r=yield w9();t instanceof r&&!(n!=null&&n.noResolveJson)?t.json().then(i=>{const o=t.status||500,a=(i==null?void 0:i.statusCode)||o+"";e(new x9(Ep(i),o,a))}).catch(i=>{e(new Lg(Ep(i),i))}):e(new Lg(Ep(t),t))}),_9=(t,e,n,r)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?i:(b9(r)?(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(r)):i.body=r,e!=null&&e.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),n))};function Ml(t,e,n,r,i,o){return se(this,void 0,void 0,function*(){return new Promise((a,s)=>{t(n,_9(e,r,i,o)).then(u=>{if(!u.ok)throw u;return r!=null&&r.noResolveJson?u:u.json()}).then(u=>a(u)).catch(u=>k9(u,s,r))})})}function ll(t,e,n,r){return se(this,void 0,void 0,function*(){return Ml(t,"GET",e,n,r)})}function ir(t,e,n,r,i){return se(this,void 0,void 0,function*(){return Ml(t,"POST",e,r,i,n)})}function Vg(t,e,n,r,i){return se(this,void 0,void 0,function*(){return Ml(t,"PUT",e,r,i,n)})}function S9(t,e,n,r){return se(this,void 0,void 0,function*(){return Ml(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function nx(t,e,n,r,i){return se(this,void 0,void 0,function*(){return Ml(t,"DELETE",e,r,i,n)})}class C9{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n}then(e,n){return this.execute().then(e,n)}execute(){return se(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Ze(e))return{data:null,error:e};throw e}})}}var KN;class E9{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n,this[KN]="BlobDownloadBuilder",this.promise=null}asStream(){return new C9(this.downloadFn,this.shouldThrowOnError)}then(e,n){return this.getPromise().then(e,n)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return se(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Ze(e))return{data:null,error:e};throw e}})}}KN=Symbol.toStringTag;const A9={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},m2={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class R9{constructor(e,n={},r,i){this.shouldThrowOnError=!1,this.url=e,this.headers=n,this.bucketId=r,this.fetch=tx(i)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,n,r,i){return se(this,void 0,void 0,function*(){try{let o;const a=Object.assign(Object.assign({},m2),i);let s=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const u=a.metadata;typeof Blob<"u"&&r instanceof Blob?(o=new FormData,o.append("cacheControl",a.cacheControl),u&&o.append("metadata",this.encodeMetadata(u)),o.append("",r)):typeof FormData<"u"&&r instanceof FormData?(o=r,o.has("cacheControl")||o.append("cacheControl",a.cacheControl),u&&!o.has("metadata")&&o.append("metadata",this.encodeMetadata(u))):(o=r,s["cache-control"]=`max-age=${a.cacheControl}`,s["content-type"]=a.contentType,u&&(s["x-metadata"]=this.toBase64(this.encodeMetadata(u))),(typeof ReadableStream<"u"&&o instanceof ReadableStream||o&&typeof o=="object"&&"pipe"in o&&typeof o.pipe=="function")&&!a.duplex&&(a.duplex="half")),i!=null&&i.headers&&(s=Object.assign(Object.assign({},s),i.headers));const l=this._removeEmptyFolders(n),c=this._getFinalPath(l),d=yield(e=="PUT"?Vg:ir)(this.fetch,`${this.url}/object/${c}`,o,Object.assign({headers:s},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{data:{path:l,id:d.Id,fullPath:d.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(Ze(o))return{data:null,error:o};throw o}})}upload(e,n,r){return se(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,i){return se(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),a=this._getFinalPath(o),s=new URL(this.url+`/object/upload/sign/${a}`);s.searchParams.set("token",n);try{let u;const l=Object.assign({upsert:m2.upsert},i),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&r instanceof Blob?(u=new FormData,u.append("cacheControl",l.cacheControl),u.append("",r)):typeof FormData<"u"&&r instanceof FormData?(u=r,u.append("cacheControl",l.cacheControl)):(u=r,c["cache-control"]=`max-age=${l.cacheControl}`,c["content-type"]=l.contentType);const d=yield Vg(this.fetch,s.toString(),u,{headers:c});return{data:{path:o,fullPath:d.Key},error:null}}catch(u){if(this.shouldThrowOnError)throw u;if(Ze(u))return{data:null,error:u};throw u}})}createSignedUploadUrl(e,n){return se(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const i=Object.assign({},this.headers);n!=null&&n.upsert&&(i["x-upsert"]="true");const o=yield ir(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:i}),a=new URL(this.url+o.url),s=a.searchParams.get("token");if(!s)throw new ex("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:s},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ze(r))return{data:null,error:r};throw r}})}update(e,n,r){return se(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return se(this,void 0,void 0,function*(){try{return{data:yield ir(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Ze(i))return{data:null,error:i};throw i}})}copy(e,n,r){return se(this,void 0,void 0,function*(){try{return{data:{path:(yield ir(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Ze(i))return{data:null,error:i};throw i}})}createSignedUrl(e,n,r){return se(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),o=yield ir(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:n},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${a}`)},{data:o,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Ze(i))return{data:null,error:i};throw i}})}createSignedUrls(e,n,r){return se(this,void 0,void 0,function*(){try{const i=yield ir(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${o}`):null})),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Ze(i))return{data:null,error:i};throw i}})}download(e,n){const i=typeof(n==null?void 0:n.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((n==null?void 0:n.transform)||{}),a=o?`?${o}`:"",s=this._getFinalPath(e),u=()=>ll(this.fetch,`${this.url}/${i}/${s}${a}`,{headers:this.headers,noResolveJson:!0});return new E9(u,this.shouldThrowOnError)}info(e){return se(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const r=yield ll(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:Bg(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ze(r))return{data:null,error:r};throw r}})}exists(e){return se(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield S9(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ze(r)&&r instanceof Lg){const i=r.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){const r=this._getFinalPath(e),i=[],o=n!=null&&n.download?`download=${n.download===!0?"":n.download}`:"";o!==""&&i.push(o);const s=typeof(n==null?void 0:n.transform)<"u"?"render/image":"object",u=this.transformOptsToQueryString((n==null?void 0:n.transform)||{});u!==""&&i.push(u);let l=i.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${s}/public/${r}${l}`)}}}remove(e){return se(this,void 0,void 0,function*(){try{return{data:yield nx(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ze(n))return{data:null,error:n};throw n}})}list(e,n,r){return se(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},A9),n),{prefix:e||""});return{data:yield ir(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Ze(i))return{data:null,error:i};throw i}})}listV2(e,n){return se(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield ir(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ze(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const qN="2.84.0",XN={"X-Client-Info":`storage-js/${qN}`};class N9{constructor(e,n={},r,i){this.shouldThrowOnError=!1;const o=new URL(e);i!=null&&i.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},XN),n),this.fetch=tx(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return se(this,void 0,void 0,function*(){try{const n=this.listBucketOptionsToQueryString(e);return{data:yield ll(this.fetch,`${this.url}/bucket${n}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ze(n))return{data:null,error:n};throw n}})}getBucket(e){return se(this,void 0,void 0,function*(){try{return{data:yield ll(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ze(n))return{data:null,error:n};throw n}})}createBucket(e){return se(this,arguments,void 0,function*(n,r={public:!1}){try{return{data:yield ir(this.fetch,`${this.url}/bucket`,{id:n,name:n,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Ze(i))return{data:null,error:i};throw i}})}updateBucket(e,n){return se(this,void 0,void 0,function*(){try{return{data:yield Vg(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ze(r))return{data:null,error:r};throw r}})}emptyBucket(e){return se(this,void 0,void 0,function*(){try{return{data:yield ir(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ze(n))return{data:null,error:n};throw n}})}deleteBucket(e){return se(this,void 0,void 0,function*(){try{return{data:yield nx(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ze(n))return{data:null,error:n};throw n}})}listBucketOptionsToQueryString(e){const n={};return e&&("limit"in e&&(n.limit=String(e.limit)),"offset"in e&&(n.offset=String(e.offset)),e.search&&(n.search=e.search),e.sortColumn&&(n.sortColumn=e.sortColumn),e.sortOrder&&(n.sortOrder=e.sortOrder)),Object.keys(n).length>0?"?"+new URLSearchParams(n).toString():""}}class T9{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},XN),n),this.fetch=tx(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return se(this,void 0,void 0,function*(){try{return{data:yield ir(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ze(n))return{data:null,error:n};throw n}})}listBuckets(e){return se(this,void 0,void 0,function*(){try{const n=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&n.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&n.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&n.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&n.set("sortOrder",e.sortOrder),e!=null&&e.search&&n.set("search",e.search);const r=n.toString(),i=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield ll(this.fetch,i,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ze(n))return{data:null,error:n};throw n}})}deleteBucket(e){return se(this,void 0,void 0,function*(){try{return{data:yield nx(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ze(n))return{data:null,error:n};throw n}})}}const rx={"X-Client-Info":`storage-js/${qN}`,"Content-Type":"application/json"};class YN extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Cn(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}class Ap extends YN{constructor(e,n,r){super(e),this.name="StorageVectorsApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class P9 extends YN{constructor(e,n){super(e),this.name="StorageVectorsUnknownError",this.originalError=n}}var g2;(function(t){t.InternalError="InternalError",t.S3VectorConflictException="S3VectorConflictException",t.S3VectorNotFoundException="S3VectorNotFoundException",t.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",t.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",t.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(g2||(g2={}));const ix=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),I9=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},v2=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),D9=(t,e,n)=>se(void 0,void 0,void 0,function*(){if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const i=t.status||500,o=t;if(typeof o.json=="function")o.json().then(a=>{const s=(a==null?void 0:a.statusCode)||(a==null?void 0:a.code)||i+"";e(new Ap(v2(a),i,s))}).catch(()=>{const a=i+"",s=o.statusText||`HTTP ${i} error`;e(new Ap(s,i,a))});else{const a=i+"",s=o.statusText||`HTTP ${i} error`;e(new Ap(s,i,a))}}else e(new P9(v2(t),t))}),M9=(t,e,n,r)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return r?(I9(r)?(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(r)):i.body=r,Object.assign(Object.assign({},i),n)):i};function O9(t,e,n,r,i,o){return se(this,void 0,void 0,function*(){return new Promise((a,s)=>{t(n,M9(e,r,i,o)).then(u=>{if(!u.ok)throw u;if(r!=null&&r.noResolveJson)return u;const l=u.headers.get("content-type");return!l||!l.includes("application/json")?{}:u.json()}).then(u=>a(u)).catch(u=>D9(u,s,r))})})}function En(t,e,n,r,i){return se(this,void 0,void 0,function*(){return O9(t,"POST",e,r,i,n)})}class j9{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},rx),n),this.fetch=ix(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return se(this,void 0,void 0,function*(){try{return{data:(yield En(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Cn(n))return{data:null,error:n};throw n}})}getIndex(e,n){return se(this,void 0,void 0,function*(){try{return{data:yield En(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Cn(r))return{data:null,error:r};throw r}})}listIndexes(e){return se(this,void 0,void 0,function*(){try{return{data:yield En(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Cn(n))return{data:null,error:n};throw n}})}deleteIndex(e,n){return se(this,void 0,void 0,function*(){try{return{data:(yield En(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Cn(r))return{data:null,error:r};throw r}})}}class F9{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},rx),n),this.fetch=ix(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return se(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield En(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Cn(n))return{data:null,error:n};throw n}})}getVectors(e){return se(this,void 0,void 0,function*(){try{return{data:yield En(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Cn(n))return{data:null,error:n};throw n}})}listVectors(e){return se(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield En(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Cn(n))return{data:null,error:n};throw n}})}queryVectors(e){return se(this,void 0,void 0,function*(){try{return{data:yield En(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Cn(n))return{data:null,error:n};throw n}})}deleteVectors(e){return se(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield En(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Cn(n))return{data:null,error:n};throw n}})}}class L9{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},rx),n),this.fetch=ix(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return se(this,void 0,void 0,function*(){try{return{data:(yield En(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Cn(n))return{data:null,error:n};throw n}})}getBucket(e){return se(this,void 0,void 0,function*(){try{return{data:yield En(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Cn(n))return{data:null,error:n};throw n}})}listBuckets(){return se(this,arguments,void 0,function*(e={}){try{return{data:yield En(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Cn(n))return{data:null,error:n};throw n}})}deleteBucket(e){return se(this,void 0,void 0,function*(){try{return{data:(yield En(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Cn(n))return{data:null,error:n};throw n}})}}class B9 extends L9{constructor(e,n={}){super(e,n.headers||{},n.fetch)}from(e){return new V9(this.url,this.headers,e,this.fetch)}}class V9 extends j9{constructor(e,n,r,i){super(e,n,i),this.vectorBucketName=r}createIndex(e){const n=Object.create(null,{createIndex:{get:()=>super.createIndex}});return se(this,void 0,void 0,function*(){return n.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return se(this,arguments,void 0,function*(n={}){return e.listIndexes.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const n=Object.create(null,{getIndex:{get:()=>super.getIndex}});return se(this,void 0,void 0,function*(){return n.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const n=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return se(this,void 0,void 0,function*(){return n.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new z9(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class z9 extends F9{constructor(e,n,r,i,o){super(e,n,o),this.vectorBucketName=r,this.indexName=i}putVectors(e){const n=Object.create(null,{putVectors:{get:()=>super.putVectors}});return se(this,void 0,void 0,function*(){return n.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const n=Object.create(null,{getVectors:{get:()=>super.getVectors}});return se(this,void 0,void 0,function*(){return n.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return se(this,arguments,void 0,function*(n={}){return e.listVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const n=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return se(this,void 0,void 0,function*(){return n.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const n=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return se(this,void 0,void 0,function*(){return n.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class U9 extends N9{constructor(e,n={},r,i){super(e,n,r,i)}from(e){return new R9(this.url,this.headers,e,this.fetch)}get vectors(){return new B9(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new T9(this.url+"/iceberg",this.headers,this.fetch)}}const $9="2.84.0";let su="";typeof Deno<"u"?su="deno":typeof document<"u"?su="web":typeof navigator<"u"&&navigator.product==="ReactNative"?su="react-native":su="node";const W9={"X-Client-Info":`supabase-js-${su}/${$9}`},G9={headers:W9},H9={schema:"public"},K9={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},q9={},X9=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Y9=()=>Headers,J9=(t,e,n)=>{const r=X9(n),i=Y9();return async(o,a)=>{var s;const u=(s=await e())!==null&&s!==void 0?s:t;let l=new i(a==null?void 0:a.headers);return l.has("apikey")||l.set("apikey",t),l.has("Authorization")||l.set("Authorization",`Bearer ${u}`),r(o,Object.assign(Object.assign({},a),{headers:l}))}};function Q9(t){return t.endsWith("/")?t:t+"/"}function Z9(t,e){var n,r;const{db:i,auth:o,realtime:a,global:s}=t,{db:u,auth:l,realtime:c,global:d}=e,h={db:Object.assign(Object.assign({},u),i),auth:Object.assign(Object.assign({},l),o),realtime:Object.assign(Object.assign({},c),a),storage:{},global:Object.assign(Object.assign(Object.assign({},d),s),{headers:Object.assign(Object.assign({},(n=d==null?void 0:d.headers)!==null&&n!==void 0?n:{}),(r=s==null?void 0:s.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}function e7(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Q9(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const JN="2.84.0",_a=30*1e3,zg=3,Rp=zg*_a,t7="http://localhost:9999",n7="supabase.auth.token",r7={"X-Client-Info":`gotrue-js/${JN}`},Ug="X-Supabase-Api-Version",QN={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},i7=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,o7=10*60*1e3;class cl extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function de(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class a7 extends cl{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function s7(t){return de(t)&&t.name==="AuthApiError"}class Ao extends cl{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class ho extends cl{constructor(e,n,r,i){super(e,r,i),this.name=n,this.status=r}}class bn extends ho{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function u7(t){return de(t)&&t.name==="AuthSessionMissingError"}class pa extends ho{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Nc extends ho{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Tc extends ho{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function l7(t){return de(t)&&t.name==="AuthImplicitGrantRedirectError"}class y2 extends ho{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class $g extends ho{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Np(t){return de(t)&&t.name==="AuthRetryableFetchError"}class x2 extends ho{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Wg extends ho{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const th="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),w2=` 	
\r=`.split(""),c7=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<w2.length;e+=1)t[w2[e].charCodeAt(0)]=-2;for(let e=0;e<th.length;e+=1)t[th[e].charCodeAt(0)]=e;return t})();function b2(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(th[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(th[r]),e.queuedBits-=6}}function ZN(t,e,n){const r=c7[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function k2(t){const e=[],n=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},o=a=>{f7(a,r,n)};for(let a=0;a<t.length;a+=1)ZN(t.charCodeAt(a),i,o);return e.join("")}function d7(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function h7(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const i=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|i)+65536,n+=1}d7(r,e)}}function f7(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function os(t){const e=[],n={queue:0,queuedBits:0},r=i=>{e.push(i)};for(let i=0;i<t.length;i+=1)ZN(t.charCodeAt(i),n,r);return new Uint8Array(e)}function p7(t){const e=[];return h7(t,n=>e.push(n)),new Uint8Array(e)}function Oo(t){const e=[],n={queue:0,queuedBits:0},r=i=>{e.push(i)};return t.forEach(i=>b2(i,n,r)),b2(null,n,r),e.join("")}function m7(t){return Math.round(Date.now()/1e3)+t}function g7(){return Symbol("auth-callback")}const Mt=()=>typeof window<"u"&&typeof document<"u",go={tested:!1,writable:!1},eT=()=>{if(!Mt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(go.tested)return go.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),go.tested=!0,go.writable=!0}catch{go.tested=!0,go.writable=!1}return go.writable};function v7(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((i,o)=>{e[o]=i})}catch{}return n.searchParams.forEach((r,i)=>{e[i]=r}),e}const tT=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),y7=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Sa=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},vo=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Ri=async(t,e)=>{await t.removeItem(e)};class Yh{constructor(){this.promise=new Yh.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Yh.promiseConstructor=Promise;function Tp(t){const e=t.split(".");if(e.length!==3)throw new Wg("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!i7.test(e[r]))throw new Wg("JWT not in base64url format");return{header:JSON.parse(k2(e[0])),payload:JSON.parse(k2(e[1])),signature:os(e[2]),raw:{header:e[0],payload:e[1]}}}async function x7(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function w7(t,e){return new Promise((r,i)=>{(async()=>{for(let o=0;o<1/0;o++)try{const a=await t(o);if(!e(o,null,a)){r(a);return}}catch(a){if(!e(o,a)){i(a);return}}})()})}function b7(t){return("0"+t.toString(16)).substr(-2)}function k7(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let i="";for(let o=0;o<56;o++)i+=n.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,b7).join("")}async function _7(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),i=new Uint8Array(r);return Array.from(i).map(o=>String.fromCharCode(o)).join("")}async function S7(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await _7(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ma(t,e,n=!1){const r=k7();let i=r;n&&(i+="/PASSWORD_RECOVERY"),await Sa(t,`${e}-code-verifier`,i);const o=await S7(r);return[o,r===o?"plain":"s256"]}const C7=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function E7(t){const e=t.headers.get(Ug);if(!e||!e.match(C7))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function A7(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function R7(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const N7=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ga(t){if(!N7.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Pp(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function T7(t,e){return new Proxy(t,{get:(n,r,i)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const o=r.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)"||o==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,i)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,i)}})}function _2(t){return JSON.parse(JSON.stringify(t))}const _o=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),P7=[502,503,504];async function S2(t){var e;if(!y7(t))throw new $g(_o(t),0);if(P7.includes(t.status))throw new $g(_o(t),t.status);let n;try{n=await t.json()}catch(o){throw new Ao(_o(o),o)}let r;const i=E7(t);if(i&&i.getTime()>=QN["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new x2(_o(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new bn}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((o,a)=>o&&typeof a=="string",!0))throw new x2(_o(n),t.status,n.weak_password.reasons);throw new a7(_o(n),t.status||500,r)}const I7=(t,e,n,r)=>{const i={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),n))};async function he(t,e,n,r){var i;const o=Object.assign({},r==null?void 0:r.headers);o[Ug]||(o[Ug]=QN["2024-01-01"].name),r!=null&&r.jwt&&(o.Authorization=`Bearer ${r.jwt}`);const a=(i=r==null?void 0:r.query)!==null&&i!==void 0?i:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const s=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",u=await D7(t,e,n+s,{headers:o,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(u):{data:Object.assign({},u),error:null}}async function D7(t,e,n,r,i,o){const a=I7(e,r,i,o);let s;try{s=await t(n,Object.assign({},a))}catch(u){throw console.error(u),new $g(_o(u),0)}if(s.ok||await S2(s),r!=null&&r.noResolveJson)return s;try{return await s.json()}catch(u){await S2(u)}}function tr(t){var e;let n=null;j7(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=m7(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function C2(t){const e=tr(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Mi(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function M7(t){return{data:t,error:null}}function O7(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:i,verification_type:o}=t,a=js(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),s={action_link:e,email_otp:n,hashed_token:r,redirect_to:i,verification_type:o},u=Object.assign({},a);return{data:{properties:s,user:u},error:null}}function E2(t){return t}function j7(t){return t.access_token&&t.refresh_token&&t.expires_in}const Ip=["global","local","others"];class F7{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=tT(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=Ip[0]){if(Ip.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ip.join(", ")}`);try{return await he(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await he(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Mi})}catch(r){if(de(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=js(e,["options"]),i=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(i.new_email=r==null?void 0:r.newEmail,delete i.newEmail),await he(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:O7,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(de(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await he(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Mi})}catch(n){if(de(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,i,o,a,s,u;try{const l={nextPage:null,lastPage:0,total:0},c=await he(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(o=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:""},xform:E2});if(c.error)throw c.error;const d=await c.json(),h=(a=c.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(u=(s=c.headers.get("link"))===null||s===void 0?void 0:s.split(","))!==null&&u!==void 0?u:[];return f.length>0&&(f.forEach(m=>{const p=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);l[`${v}Page`]=p}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(de(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){ga(e);try{return await he(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Mi})}catch(n){if(de(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){ga(e);try{return await he(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Mi})}catch(r){if(de(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){ga(e);try{return await he(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Mi})}catch(r){if(de(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){ga(e.userId);try{const{data:n,error:r}=await he(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:n,error:r}}catch(n){if(de(n))return{data:null,error:n};throw n}}async _deleteFactor(e){ga(e.userId),ga(e.id);try{return{data:await he(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(de(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,i,o,a,s,u;try{const l={nextPage:null,lastPage:0,total:0},c=await he(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(o=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:""},xform:E2});if(c.error)throw c.error;const d=await c.json(),h=(a=c.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(u=(s=c.headers.get("link"))===null||s===void 0?void 0:s.split(","))!==null&&u!==void 0?u:[];return f.length>0&&(f.forEach(m=>{const p=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);l[`${v}Page`]=p}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(de(l))return{data:{clients:[]},error:l};throw l}}async _createOAuthClient(e){try{return await he(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(de(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await he(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(de(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await he(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(de(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await he(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(de(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await he(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(de(n))return{data:null,error:n};throw n}}}function A2(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const va={debug:!!(globalThis&&eT()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class nT extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class L7 extends nT{}async function B7(t,e,n){va.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),va.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){va.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,i.name);try{return await n()}finally{va.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,i.name)}}else{if(e===0)throw va.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new L7(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(va.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function V7(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function rT(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function z7(t){return parseInt(t,16)}function U7(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function $7(t){var e;const{chainId:n,domain:r,expirationTime:i,issuedAt:o=new Date,nonce:a,notBefore:s,requestId:u,resources:l,scheme:c,uri:d,version:h}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const f=rT(t.address),m=c?`${c}://${r}`:r,p=t.statement?`${t.statement}
`:"",v=`${m} wants you to sign in with your Ethereum account:
${f}

${p}`;let g=`URI: ${d}
Version: ${h}
Chain ID: ${n}${a?`
Nonce: ${a}`:""}
Issued At: ${o.toISOString()}`;if(i&&(g+=`
Expiration Time: ${i.toISOString()}`),s&&(g+=`
Not Before: ${s.toISOString()}`),u&&(g+=`
Request ID: ${u}`),l){let x=`
Resources:`;for(const w of l){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);x+=`
- ${w}`}g+=x}return`${v}
${g}`}class mt extends Error{constructor({message:e,code:n,cause:r,name:i}){var o;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(o=i??(r instanceof Error?r.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=n}}class nh extends mt{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function W7({error:t,options:e}){var n,r,i;const{publicKey:o}=e;if(!o)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new mt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=o.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new mt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=o.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new mt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((i=o.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new mt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new mt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new mt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return o.pubKeyCredParams.filter(s=>s.type==="public-key").length===0?new mt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new mt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const a=window.location.hostname;if(iT(a)){if(o.rp.id!==a)return new mt({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new mt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new mt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new mt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new mt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function G7({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new mt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new mt({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(iT(r)){if(n.rpId!==r)return new mt({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new mt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new mt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new mt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class H7{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const K7=new H7;function q7(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,i=js(t,["challenge","user","excludeCredentials"]),o=os(e).buffer,a=Object.assign(Object.assign({},n),{id:os(n.id).buffer}),s=Object.assign(Object.assign({},i),{challenge:o,user:a});if(r&&r.length>0){s.excludeCredentials=new Array(r.length);for(let u=0;u<r.length;u++){const l=r[u];s.excludeCredentials[u]=Object.assign(Object.assign({},l),{id:os(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return s}function X7(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=js(t,["challenge","allowCredentials"]),i=os(e).buffer,o=Object.assign(Object.assign({},r),{challenge:i});if(n&&n.length>0){o.allowCredentials=new Array(n.length);for(let a=0;a<n.length;a++){const s=n[a];o.allowCredentials[a]=Object.assign(Object.assign({},s),{id:os(s.id).buffer,type:s.type||"public-key",transports:s.transports})}}return o}function Y7(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:Oo(new Uint8Array(t.response.attestationObject)),clientDataJSON:Oo(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function J7(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),i=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Oo(new Uint8Array(i.authenticatorData)),clientDataJSON:Oo(new Uint8Array(i.clientDataJSON)),signature:Oo(new Uint8Array(i.signature)),userHandle:i.userHandle?Oo(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function iT(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function R2(){var t,e;return!!(Mt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function Q7(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new nh("Browser returned unexpected credential type",e)}:{data:null,error:new nh("Empty credential response",e)}}catch(e){return{data:null,error:W7({error:e,options:t})}}}async function Z7(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new nh("Browser returned unexpected credential type",e)}:{data:null,error:new nh("Empty credential response",e)}}catch(e){return{data:null,error:G7({error:e,options:t})}}}const eK={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},tK={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function rh(...t){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),n=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),r={};for(const i of t)if(i)for(const o in i){const a=i[o];if(a!==void 0)if(Array.isArray(a))r[o]=a;else if(n(a))r[o]=a;else if(e(a)){const s=r[o];e(s)?r[o]=rh(s,a):r[o]=rh(a)}else r[o]=a}return r}function nK(t,e){return rh(eK,t,e||{})}function rK(t,e){return rh(tK,t,e||{})}class iK{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:i},o){try{const{data:a,error:s}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!a)return{data:null,error:s};const u=i??K7.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:l}=a.webauthn.credential_options.publicKey;l.name||(l.name=`${l.id}:${r}`),l.displayName||(l.displayName=l.name)}switch(a.webauthn.type){case"create":{const l=nK(a.webauthn.credential_options.publicKey,o==null?void 0:o.create),{data:c,error:d}=await Q7({publicKey:l,signal:u});return c?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:c}},error:null}:{data:null,error:d}}case"request":{const l=rK(a.webauthn.credential_options.publicKey,o==null?void 0:o.request),{data:c,error:d}=await Z7(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:l,signal:u}));return c?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:c}},error:null}:{data:null,error:d}}}}catch(a){return de(a)?{data:null,error:a}:{data:null,error:new Ao("Unexpected error in challenge",a)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},o){if(!n)return{data:null,error:new cl("rpId is required for WebAuthn authentication")};try{if(!R2())return{data:null,error:new Ao("Browser does not support WebAuthn",null)};const{data:a,error:s}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:i},{request:o});if(!a)return{data:null,error:s};const{webauthn:u}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:u.type,rpId:n,rpOrigins:r,credential_response:u.credential_response}})}catch(a){return de(a)?{data:null,error:a}:{data:null,error:new Ao("Unexpected error in authenticate",a)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},o){if(!n)return{data:null,error:new cl("rpId is required for WebAuthn registration")};try{if(!R2())return{data:null,error:new Ao("Browser does not support WebAuthn",null)};const{data:a,error:s}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(c=>{var d;return(d=c.data)===null||d===void 0?void 0:d.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(c=>c?this.client.mfa.unenroll({factorId:c==null?void 0:c.id}):void 0),{data:null,error:s};const{data:u,error:l}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:i},{create:o});return u?this._verify({factorId:a.id,challengeId:u.challengeId,webauthn:{rpId:n,rpOrigins:r,type:u.webauthn.type,credential_response:u.webauthn.credential_response}}):{data:null,error:l}}catch(a){return de(a)?{data:null,error:a}:{data:null,error:new Ao("Unexpected error in register",a)}}}}V7();const oK={url:t7,storageKey:n7,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:r7,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function N2(t,e,n){return await n()}const ya={};class dl{get jwks(){var e,n;return(n=(e=ya[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){ya[this.storageKey]=Object.assign(Object.assign({},ya[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=ya[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ya[this.storageKey]=Object.assign(Object.assign({},ya[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const o=Object.assign(Object.assign({},oK),e);if(this.storageKey=o.storageKey,this.instanceID=(n=dl.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,dl.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.instanceID>0&&Mt()){const a=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(a),this.logDebugMessages&&console.trace(a)}if(this.persistSession=o.persistSession,this.autoRefreshToken=o.autoRefreshToken,this.admin=new F7({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=tT(o.fetch),this.lock=o.lock||N2,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.throwOnError=o.throwOnError,o.lock?this.lock=o.lock:Mt()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=B7:this.lock=N2,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new iK(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:eT()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=A2(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=A2(this.memoryStorage)),Mt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a),await this._notifyAllSubscribers(a.data.event,a.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${JN}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(Mt()&&(n=v7(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Mt()&&this.detectSessionInUrl&&r!=="none"){const{data:i,error:o}=await this._getSessionFromURL(n,r);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),l7(o)){const u=(e=o.details)===null||e===void 0?void 0:e.code;if(u==="identity_already_exists"||u==="identity_not_found"||u==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:a,redirectType:s}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",s),await this._saveSession(a),setTimeout(async()=>{s==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return de(n)?this._returnResult({error:n}):this._returnResult({error:new Ao("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,i;try{const o=await he(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:tr}),{data:a,error:s}=o;if(s||!a)return this._returnResult({data:{user:null,session:null},error:s});const u=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",u)),this._returnResult({data:{user:l,session:u},error:null})}catch(o){if(de(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signUp(e){var n,r,i;try{let o;if("email"in e){const{email:c,password:d,options:h}=e;let f=null,m=null;this.flowType==="pkce"&&([f,m]=await ma(this.storage,this.storageKey)),o=await he(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:c,password:d,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:m},xform:tr})}else if("phone"in e){const{phone:c,password:d,options:h}=e;o=await he(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:d,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},channel:(i=h==null?void 0:h.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:tr})}else throw new Nc("You must provide either an email or phone number and a password");const{data:a,error:s}=o;if(s||!a)return this._returnResult({data:{user:null,session:null},error:s});const u=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",u)),this._returnResult({data:{user:l,session:u},error:null})}catch(o){if(de(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithPassword(e){try{let n;if("email"in e){const{email:o,password:a,options:s}=e;n=await he(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:a,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:C2})}else if("phone"in e){const{phone:o,password:a,options:s}=e;n=await he(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:a,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:C2})}else throw new Nc("You must provide either an email or phone number and a password");const{data:r,error:i}=n;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!r||!r.session||!r.user){const o=new pa;return this._returnResult({data:{user:null,session:null},error:o})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(n){if(de(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,i,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,i,o,a,s,u,l,c,d,h;let f,m;if("message"in e)f=e.message,m=e.signature;else{const{chain:p,wallet:v,statement:g,options:x}=e;let w;if(Mt())if(typeof v=="object")w=v;else{const E=window;if("ethereum"in E&&typeof E.ethereum=="object"&&"request"in E.ethereum&&typeof E.ethereum.request=="function")w=E.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(x!=null&&x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=v}const b=new URL((n=x==null?void 0:x.url)!==null&&n!==void 0?n:window.location.href),k=await w.request({method:"eth_requestAccounts"}).then(E=>E).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!k||k.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const _=rT(k[0]);let S=(r=x==null?void 0:x.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!S){const E=await w.request({method:"eth_chainId"});S=z7(E)}const C={domain:b.host,address:_,statement:g,uri:b.href,version:"1",chainId:S,nonce:(i=x==null?void 0:x.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(a=(o=x==null?void 0:x.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(s=x==null?void 0:x.signInWithEthereum)===null||s===void 0?void 0:s.expirationTime,notBefore:(u=x==null?void 0:x.signInWithEthereum)===null||u===void 0?void 0:u.notBefore,requestId:(l=x==null?void 0:x.signInWithEthereum)===null||l===void 0?void 0:l.requestId,resources:(c=x==null?void 0:x.signInWithEthereum)===null||c===void 0?void 0:c.resources};f=$7(C),m=await w.request({method:"personal_sign",params:[U7(f),_]})}try{const{data:p,error:v}=await he(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:m},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:tr});if(v)throw v;if(!p||!p.session||!p.user){const g=new pa;return this._returnResult({data:{user:null,session:null},error:g})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({},p),error:v})}catch(p){if(de(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(e){var n,r,i,o,a,s,u,l,c,d,h,f;let m,p;if("message"in e)m=e.message,p=e.signature;else{const{chain:v,wallet:g,statement:x,options:w}=e;let b;if(Mt())if(typeof g=="object")b=g;else{const _=window;if("solana"in _&&typeof _.solana=="object"&&("signIn"in _.solana&&typeof _.solana.signIn=="function"||"signMessage"in _.solana&&typeof _.solana.signMessage=="function"))b=_.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=g}const k=new URL((n=w==null?void 0:w.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in b&&b.signIn){const _=await b.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),x?{statement:x}:null));let S;if(Array.isArray(_)&&_[0]&&typeof _[0]=="object")S=_[0];else if(_&&typeof _=="object"&&"signedMessage"in _&&"signature"in _)S=_;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)m=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),p=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in b)||typeof b.signMessage!="function"||!("publicKey"in b)||typeof b!="object"||!b.publicKey||!("toBase58"in b.publicKey)||typeof b.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${k.host} wants you to sign in with your Solana account:`,b.publicKey.toBase58(),...x?["",x,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(i=(r=w==null?void 0:w.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((s=w==null?void 0:w.signInWithSolana)===null||s===void 0)&&s.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((u=w==null?void 0:w.signInWithSolana)===null||u===void 0)&&u.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((d=(c=w==null?void 0:w.signInWithSolana)===null||c===void 0?void 0:c.resources)===null||d===void 0)&&d.length?["Resources",...w.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const _=await b.signMessage(new TextEncoder().encode(m),"utf8");if(!_||!(_ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=_}}try{const{data:v,error:g}=await he(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Oo(p)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:tr});if(g)throw g;if(!v||!v.session||!v.user){const x=new pa;return this._returnResult({data:{user:null,session:null},error:x})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign({},v),error:g})}catch(v){if(de(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async _exchangeCodeForSession(e){const n=await vo(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(n??"").split("/");try{const{data:o,error:a}=await he(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:tr});if(await Ri(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!o||!o.session||!o.user){const s=new pa;return this._returnResult({data:{user:null,session:null,redirectType:null},error:s})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign(Object.assign({},o),{redirectType:i??null}),error:a})}catch(o){if(de(o))return this._returnResult({data:{user:null,session:null,redirectType:null},error:o});throw o}}async signInWithIdToken(e){try{const{options:n,provider:r,token:i,access_token:o,nonce:a}=e,s=await he(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:o,nonce:a,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:tr}),{data:u,error:l}=s;if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!u||!u.session||!u.user){const c=new pa;return this._returnResult({data:{user:null,session:null},error:c})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:u,error:l})}catch(n){if(de(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,i,o,a;try{if("email"in e){const{email:s,options:u}=e;let l=null,c=null;this.flowType==="pkce"&&([l,c]=await ma(this.storage,this.storageKey));const{error:d}=await he(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:(n=u==null?void 0:u.data)!==null&&n!==void 0?n:{},create_user:(r=u==null?void 0:u.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},code_challenge:l,code_challenge_method:c},redirectTo:u==null?void 0:u.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}if("phone"in e){const{phone:s,options:u}=e,{data:l,error:c}=await he(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:s,data:(i=u==null?void 0:u.data)!==null&&i!==void 0?i:{},create_user:(o=u==null?void 0:u.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken},channel:(a=u==null?void 0:u.channel)!==null&&a!==void 0?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:c})}throw new Nc("You must provide either an email or phone number.")}catch(s){if(de(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async verifyOtp(e){var n,r;try{let i,o;"options"in e&&(i=(n=e.options)===null||n===void 0?void 0:n.redirectTo,o=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:s}=await he(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:i,xform:tr});if(s)throw s;if(!a)throw new Error("An error occurred on token verification.");const u=a.session,l=a.user;return u!=null&&u.access_token&&(await this._saveSession(u),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",u)),this._returnResult({data:{user:l,session:u},error:null})}catch(i){if(de(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var n,r,i,o,a;try{let s=null,u=null;this.flowType==="pkce"&&([s,u]=await ma(this.storage,this.storageKey));const l=await he(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:u}),headers:this.headers,xform:M7});return!((o=l.data)===null||o===void 0)&&o.url&&Mt()&&!(!((a=e.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(l.data.url),this._returnResult(l)}catch(s){if(de(s))return this._returnResult({data:null,error:s});throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new bn;const{error:i}=await he(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(de(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:o}=e,{error:a}=await he(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}else if("phone"in e){const{phone:r,type:i,options:o}=e,{data:a,error:s}=await he(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:s})}throw new Nc("You must provide either an email or phone number and a type")}catch(n){if(de(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await vo(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Rp:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const a=await vo(this.userStorage,this.storageKey+"-user");a!=null&&a.user?e.user=a.user:e.user=Pp()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const a={value:this.suppressGetSessionWarning};e.user=T7(e.user,a),a.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:i,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{session:null},error:o}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await he(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Mi}):await this._useSession(async n=>{var r,i,o;const{data:a,error:s}=n;if(s)throw s;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new bn}:await he(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&o!==void 0?o:void 0,xform:Mi})})}catch(n){if(de(n))return u7(n)&&(await this._removeSession(),await Ri(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:i,error:o}=r;if(o)throw o;if(!i.session)throw new bn;const a=i.session;let s=null,u=null;this.flowType==="pkce"&&e.email!=null&&([s,u]=await ma(this.storage,this.storageKey));const{data:l,error:c}=await he(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:s,code_challenge_method:u}),jwt:a.access_token,xform:Mi});if(c)throw c;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(r){if(de(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new bn;const n=Date.now()/1e3;let r=n,i=!0,o=null;const{payload:a}=Tp(e.access_token);if(a.exp&&(r=a.exp,i=r<=n),i){const{data:s,error:u}=await this._callRefreshToken(e.refresh_token);if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!s)return{data:{user:null,session:null},error:null};o=s}else{const{data:s,error:u}=await this._getUser(e.access_token);if(u)throw u;o={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return this._returnResult({data:{user:o.user,session:o},error:null})}catch(n){if(de(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:a,error:s}=n;if(s)throw s;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new bn;const{data:i,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{user:null,session:null},error:o}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(de(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Mt())throw new Tc("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Tc(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new y2("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Tc("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new y2("No code detected.");const{data:x,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const b=new URL(window.location.href);return b.searchParams.delete("code"),window.history.replaceState(window.history.state,"",b.toString()),{data:{session:x.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:o,refresh_token:a,expires_in:s,expires_at:u,token_type:l}=e;if(!o||!s||!a||!l)throw new Tc("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(s);let h=c+d;u&&(h=parseInt(u));const f=h-c;f*1e3<=_a&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${d}s`);const m=h-d;c-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,c):c-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,h,c);const{data:p,error:v}=await this._getUser(o);if(v)throw v;const g={provider_token:r,provider_refresh_token:i,access_token:o,expires_in:d,expires_at:h,refresh_token:a,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:e.type},error:null})}catch(r){if(de(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await vo(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:i,error:o}=n;if(o)return this._returnResult({error:o});const a=(r=i.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:s}=await this.admin.signOut(a,e);if(s&&!(s7(s)&&(s.status===404||s.status===401||s.status===403)))return this._returnResult({error:s})}return e!=="others"&&(await this._removeSession(),await Ri(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=g7(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,i;try{const{data:{session:o},error:a}=n;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,n={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await ma(this.storage,this.storageKey,!0));try{return await he(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(o){if(de(o))return this._returnResult({data:null,error:o});throw o}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(de(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:i}=await this._useSession(async o=>{var a,s,u,l,c;const{data:d,error:h}=o;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(u=e.options)===null||u===void 0?void 0:u.queryParams,skipBrowserRedirect:!0});return await he(this.fetch,"GET",f,{headers:this.headers,jwt:(c=(l=d.session)===null||l===void 0?void 0:l.access_token)!==null&&c!==void 0?c:void 0})});if(i)throw i;return Mt()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(de(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:i,data:{session:o}}=n;if(i)throw i;const{options:a,provider:s,token:u,access_token:l,nonce:c}=e,d=await he(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=o==null?void 0:o.access_token)!==null&&r!==void 0?r:void 0,body:{provider:s,id_token:u,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:tr}),{data:h,error:f}=d;return f?this._returnResult({data:{user:null,session:null},error:f}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new pa}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:f}))}catch(i){if(de(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,i;const{data:o,error:a}=n;if(a)throw a;return await he(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(n){if(de(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await w7(async i=>(i>0&&await x7(200*Math.pow(2,i-1)),this._debug(n,"refreshing attempt",i),await he(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:tr})),(i,o)=>{const a=200*Math.pow(2,i);return o&&Np(o)&&Date.now()+a-r<_a})}catch(r){if(this._debug(n,"error",r),de(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Mt()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const i=await vo(this.storage,this.storageKey);if(i&&this.userStorage){let a=await vo(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:i.user},await Sa(this.userStorage,this.storageKey+"-user",a)),i.user=(e=a==null?void 0:a.user)!==null&&e!==void 0?e:Pp()}else if(i&&!i.user&&!i.user){const a=await vo(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(i.user=a.user,await Ri(this.storage,this.storageKey+"-user"),await Sa(this.storage,this.storageKey,i)):i.user=Pp()}if(this._debug(r,"session from storage",i),!this._isValidSession(i)){this._debug(r,"session is not valid"),i!==null&&await this._removeSession();return}const o=((n=i.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Rp;if(this._debug(r,`session has${o?"":" not"} expired with margin of ${Rp}s`),o){if(this.autoRefreshToken&&i.refresh_token){const{error:a}=await this._callRefreshToken(i.refresh_token);a&&(console.error(a),Np(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:s}=await this._getUser(i.access_token);!s&&(a!=null&&a.user)?(i.user=a.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(r,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(r,"error",i),console.error(i);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new bn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Yh;const{data:o,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!o.session)throw new bn;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const s={data:o.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(o){if(this._debug(i,"error",o),de(o)){const a={data:null,error:o};return Np(o)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(o),o}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,n,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const o=[],a=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(e,n)}catch(u){o.push(u)}});if(await Promise.all(a),o.length>0){for(let s=0;s<o.length;s+=1)console.error(o[s]);throw o[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await Sa(this.userStorage,this.storageKey+"-user",{user:n.user});const i=Object.assign({},n);delete i.user;const o=_2(i);await Sa(this.storage,this.storageKey,o)}else{const i=_2(n);await Sa(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await Ri(this.storage,this.storageKey),await Ri(this.storage,this.storageKey+"-code-verifier"),await Ri(this.storage,this.storageKey+"-user"),this.userStorage&&await Ri(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Mt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),_a);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/_a);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${_a}ms, refresh threshold is ${zg} ticks`),i<=zg&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof nT)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Mt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const i=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[o,a]=await ma(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(s.toString())}if(r!=null&&r.queryParams){const o=new URLSearchParams(r.queryParams);i.push(o.toString())}return r!=null&&r.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:i,error:o}=n;return o?this._returnResult({data:null,error:o}):await he(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(de(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,i;const{data:o,error:a}=n;if(a)return this._returnResult({data:null,error:a});const s=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:u,error:l}=await he(this.fetch,"POST",`${this.url}/factors`,{body:s,headers:this.headers,jwt:(r=o==null?void 0:o.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(e.factorType==="totp"&&u.type==="totp"&&(!((i=u==null?void 0:u.totp)===null||i===void 0)&&i.qr_code)&&(u.totp.qr_code=`data:image/svg+xml;utf-8,${u.totp.qr_code}`),this._returnResult({data:u,error:null}))})}catch(n){if(de(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:i,error:o}=n;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?Y7(e.webauthn.credential_response):J7(e.webauthn.credential_response)})}:{code:e.code}),{data:s,error:u}=await he(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?this._returnResult({data:null,error:u}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+s.expires_in},s)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",s),this._returnResult({data:s,error:u}))})}catch(n){if(de(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:i,error:o}=n;if(o)return this._returnResult({data:null,error:o});const a=await he(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});if(a.error)return a;const{data:s}=a;if(s.type!=="webauthn")return{data:s,error:null};switch(s.webauthn.type){case"create":return{data:Object.assign(Object.assign({},s),{webauthn:Object.assign(Object.assign({},s.webauthn),{credential_options:Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:q7(s.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},s),{webauthn:Object.assign(Object.assign({},s.webauthn),{credential_options:Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:X7(s.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(de(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const i={all:[],phone:[],totp:[],webauthn:[]};for(const o of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])i.all.push(o),o.status==="verified"&&i[o.factor_type].push(o);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:i}=await this.getSession();if(i)return this._returnResult({data:null,error:i});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Tp(r.access_token);let a=null;o.aal&&(a=o.aal);let s=a;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(c=>c.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(s="aal2");const l=o.amr||[];return{data:{currentLevel:a,nextLevel:s,currentAuthenticationMethods:l},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:i}=n;return i?this._returnResult({data:null,error:i}):r?await he(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new bn})})}catch(n){if(de(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:i},error:o}=r;if(o)return this._returnResult({data:null,error:o});if(!i)return this._returnResult({data:null,error:new bn});const a=await he(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:s=>({data:s,error:null})});return a.data&&a.data.redirect_url&&Mt()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(r){if(de(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:i},error:o}=r;if(o)return this._returnResult({data:null,error:o});if(!i)return this._returnResult({data:null,error:new bn});const a=await he(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:s=>({data:s,error:null})});return a.data&&a.data.redirect_url&&Mt()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(r){if(de(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;return r?this._returnResult({data:null,error:r}):n?await he(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new bn})})}catch(e){if(de(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:r},error:i}=n;return i?this._returnResult({data:null,error:i}):r?await he(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},xform:()=>({data:{},error:null})}):this._returnResult({data:null,error:new bn})})}catch(n){if(de(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(s=>s.kid===e);if(r)return r;const i=Date.now();if(r=this.jwks.keys.find(s=>s.kid===e),r&&this.jwks_cached_at+o7>i)return r;const{data:o,error:a}=await he(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=i,r=o.keys.find(s=>s.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:f,error:m}=await this.getSession();if(m||!f.session)return this._returnResult({data:null,error:m});r=f.session.access_token}const{header:i,payload:o,signature:a,raw:{header:s,payload:u}}=Tp(r);n!=null&&n.allowExpired||A7(o.exp);const l=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!l){const{error:f}=await this.getUser(r);if(f)throw f;return{data:{claims:o,header:i,signature:a},error:null}}const c=R7(i.alg),d=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!await crypto.subtle.verify(c,d,a,p7(`${s}.${u}`)))throw new Wg("Invalid JWT signature");return{data:{claims:o,header:i,signature:a},error:null}}catch(r){if(de(r))return this._returnResult({data:null,error:r});throw r}}}dl.nextInstanceID={};const aK=dl;class sK extends aK{constructor(e){super(e)}}class uK{constructor(e,n,r){var i,o,a;this.supabaseUrl=e,this.supabaseKey=n;const s=e7(e);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",s),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",s),this.storageUrl=new URL("storage/v1",s),this.functionsUrl=new URL("functions/v1",s);const u=`sb-${s.hostname.split(".")[0]}-auth-token`,l={db:H9,realtime:q9,auth:Object.assign(Object.assign({},K9),{storageKey:u}),global:G9},c=Z9(r??{},l);this.storageKey=(i=c.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(o=c.global.headers)!==null&&o!==void 0?o:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(d,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=c.auth)!==null&&a!==void 0?a:{},this.headers,c.global.fetch),this.fetch=J9(n,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&this.accessToken().then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new t9(new URL("rest/v1",s).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),this.storage=new U9(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new QH(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,n;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:i,userStorage:o,storageKey:a,flowType:s,lock:u,debug:l,throwOnError:c},d,h){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new sK({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),d),storageKey:a,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:i,userStorage:o,flowType:s,lock:u,debug:l,throwOnError:c,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new y9(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const lK=(t,e,n)=>new uK(t,e,n);function cK(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}cK()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const dK="https://jpuaikcpyfnimgjdsauq.supabase.co",hK="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpwdWFpa2NweWZuaW1namRzYXVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4NDUwOTAsImV4cCI6MjA3OTQyMTA5MH0.44rXo91-vMvcIU1bTAfqL6z11lB8Jzhzjku-S-sW4Cc",T2=lK(dK,hK);async function fK(t){try{const{data:e,error:n}=await T2.from("transactions").insert({transaction_id:t.transactionId,customer_email:t.customerEmail,total:t.total,payment_method:t.paymentMethod,status:t.status,vending_machine_id:t.vendingMachineId}).select().single();if(n)throw console.error("Error saving transaction:",n),n;const r=t.items.map(o=>({transaction_id:e.id,medicine_id:o.medicineId,medicine_name:o.medicineName,quantity:o.quantity,price:o.price})),{error:i}=await T2.from("transaction_items").insert(r);if(i)throw console.error("Error saving transaction items:",i),i;return{success:!0,transaction:e}}catch(e){return console.error("Error in saveTransaction:",e),{success:!1,error:e}}}class Ol{constructor(e=0,n="Network Error"){this.status=e,this.text=n}}const pK=()=>{if(!(typeof localStorage>"u"))return{get:t=>Promise.resolve(localStorage.getItem(t)),set:(t,e)=>Promise.resolve(localStorage.setItem(t,e)),remove:t=>Promise.resolve(localStorage.removeItem(t))}},Vt={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:pK()},ox=t=>t?typeof t=="string"?{publicKey:t}:t.toString()==="[object Object]"?t:{}:{},mK=(t,e="https://api.emailjs.com")=>{if(!t)return;const n=ox(t);Vt.publicKey=n.publicKey,Vt.blockHeadless=n.blockHeadless,Vt.storageProvider=n.storageProvider,Vt.blockList=n.blockList,Vt.limitRate=n.limitRate,Vt.origin=n.origin||e},oT=async(t,e,n={})=>{const r=await fetch(Vt.origin+t,{method:"POST",headers:n,body:e}),i=await r.text(),o=new Ol(r.status,i);if(r.ok)return o;throw o},aT=(t,e,n)=>{if(!t||typeof t!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!e||typeof e!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!n||typeof n!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},gK=t=>{if(t&&t.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},sT=t=>t.webdriver||!t.languages||t.languages.length===0,uT=()=>new Ol(451,"Unavailable For Headless Browser"),vK=(t,e)=>{if(!Array.isArray(t))throw"The BlockList list has to be an array";if(typeof e!="string")throw"The BlockList watchVariable has to be a string"},yK=t=>{var e;return!((e=t.list)!=null&&e.length)||!t.watchVariable},xK=(t,e)=>t instanceof FormData?t.get(e):t[e],lT=(t,e)=>{if(yK(t))return!1;vK(t.list,t.watchVariable);const n=xK(e,t.watchVariable);return typeof n!="string"?!1:t.list.includes(n)},cT=()=>new Ol(403,"Forbidden"),wK=(t,e)=>{if(typeof t!="number"||t<0)throw"The LimitRate throttle has to be a positive number";if(e&&typeof e!="string")throw"The LimitRate ID has to be a non-empty string"},bK=async(t,e,n)=>{const r=Number(await n.get(t)||0);return e-Date.now()+r},dT=async(t,e,n)=>{if(!e.throttle||!n)return!1;wK(e.throttle,e.id);const r=e.id||t;return await bK(r,e.throttle,n)>0?!0:(await n.set(r,Date.now().toString()),!1)},hT=()=>new Ol(429,"Too Many Requests"),kK=async(t,e,n,r)=>{const i=ox(r),o=i.publicKey||Vt.publicKey,a=i.blockHeadless||Vt.blockHeadless,s=i.storageProvider||Vt.storageProvider,u={...Vt.blockList,...i.blockList},l={...Vt.limitRate,...i.limitRate};return a&&sT(navigator)?Promise.reject(uT()):(aT(o,t,e),gK(n),n&&lT(u,n)?Promise.reject(cT()):await dT(location.pathname,l,s)?Promise.reject(hT()):oT("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:o,service_id:t,template_id:e,template_params:n}),{"Content-type":"application/json"}))},_K=t=>{if(!t||t.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},SK=t=>typeof t=="string"?document.querySelector(t):t,CK=async(t,e,n,r)=>{const i=ox(r),o=i.publicKey||Vt.publicKey,a=i.blockHeadless||Vt.blockHeadless,s=Vt.storageProvider||i.storageProvider,u={...Vt.blockList,...i.blockList},l={...Vt.limitRate,...i.limitRate};if(a&&sT(navigator))return Promise.reject(uT());const c=SK(n);aT(o,t,e),_K(c);const d=new FormData(c);return lT(u,d)?Promise.reject(cT()):await dT(location.pathname,l,s)?Promise.reject(hT()):(d.append("lib_version","4.4.1"),d.append("service_id",t),d.append("template_id",e),d.append("user_id",o),oT("/api/v1.0/email/send-form",d))},fT={init:mK,send:kK,sendForm:CK,EmailJSResponseStatus:Ol},EK="touficjandah@gmail.com",Gg="service_2iy5po4".trim(),pT="template_cfek19f".trim(),mT="template_ovf7veh".trim(),Nu="Z5iMAUhz6rWt6kurI".trim();function AK(t){const e=t.items.map(n=>`
    <tr>
      <td style="padding: 10px; border-bottom: 1px solid #eee;">${n.name}</td>
      <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: center;">${n.quantity}</td>
      <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">$${n.price.toFixed(2)}</td>
      <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">$${(n.price*n.quantity).toFixed(2)}</td>
    </tr>
  `).join("");return`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Purchase Receipt</title>
    </head>
    <body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;">
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0;">
        <h1 style="margin: 0; font-size: 28px;">Thank You for Your Purchase!</h1>
      </div>

      <div style="background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px;">
        <h2 style="color: #667eea; margin-top: 0;">Receipt</h2>

        <p><strong>Transaction ID:</strong> ${t.transactionId}</p>
        <p><strong>Date:</strong> ${t.date}</p>
        <p><strong>Vending Machine:</strong> ${t.vendingMachineId}</p>

        <table style="width: 100%; margin: 20px 0; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
          <thead>
            <tr style="background: #667eea; color: white;">
              <th style="padding: 12px; text-align: left;">Item</th>
              <th style="padding: 12px; text-align: center;">Qty</th>
              <th style="padding: 12px; text-align: right;">Price</th>
              <th style="padding: 12px; text-align: right;">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            ${e}
          </tbody>
          <tfoot>
            <tr style="background: #f0f0f0; font-weight: bold;">
              <td colspan="3" style="padding: 15px; text-align: right;">Total:</td>
              <td style="padding: 15px; text-align: right; color: #667eea; font-size: 18px;">$${t.total.toFixed(2)}</td>
            </tr>
          </tfoot>
        </table>

        <div style="margin-top: 30px; padding: 20px; background: white; border-left: 4px solid #667eea; border-radius: 4px;">
          <p style="margin: 0; font-size: 14px; color: #666;">
            This is an automated receipt for your purchase. Please keep this email for your records.
            If you have any questions, please contact our support team.
          </p>
        </div>

        <div style="margin-top: 20px; text-align: center; color: #999; font-size: 12px;">
          <p>Thank you for using our smart vending machine!</p>
        </div>
      </div>
    </body>
    </html>
  `}function RK(t){const e=t.items.map(n=>`
    <tr>
      <td style="padding: 8px; border-bottom: 1px solid #eee;">${n.name}</td>
      <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: center;">${n.quantity}</td>
      <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">$${(n.price*n.quantity).toFixed(2)}</td>
    </tr>
  `).join("");return`
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>New Purchase Notification</title>
    </head>
    <body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;">
      <div style="background: #2c3e50; color: white; padding: 20px; border-radius: 8px 8px 0 0;">
        <h1 style="margin: 0; font-size: 24px;"> New Purchase Alert</h1>
      </div>

      <div style="background: #f9f9f9; padding: 20px; border-radius: 0 0 8px 8px;">
        <p style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin: 0 0 20px 0;">
          A new purchase has been made from vending machine <strong>${t.vendingMachineId}</strong>
        </p>

        <h3 style="color: #2c3e50; margin-top: 0;">Purchase Details</h3>
        <ul style="list-style: none; padding: 0;">
          <li style="padding: 5px 0;"><strong>Transaction ID:</strong> ${t.transactionId}</li>
          <li style="padding: 5px 0;"><strong>Customer Email:</strong> ${t.customerEmail}</li>
          <li style="padding: 5px 0;"><strong>Date:</strong> ${t.date}</li>
          <li style="padding: 5px 0;"><strong>Total Amount:</strong> $${t.total.toFixed(2)}</li>
        </ul>

        <h3 style="color: #2c3e50;">Items Purchased</h3>
        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
          <thead>
            <tr style="background: #2c3e50; color: white;">
              <th style="padding: 10px; text-align: left;">Item</th>
              <th style="padding: 10px; text-align: center;">Quantity</th>
              <th style="padding: 10px; text-align: right;">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            ${e}
          </tbody>
        </table>

        <div style="margin-top: 20px; padding: 15px; background: #d4edda; border-left: 4px solid #28a745; border-radius: 4px;">
          <p style="margin: 0; color: #155724;">
             Payment received successfully via PayPal
          </p>
        </div>
      </div>
    </body>
    </html>
  `}function NK(){console.log(" EmailJS Configuration:"),console.log("  Service ID:",Gg?" Present":" Missing"),console.log("  Customer Template:",pT?" Present":" Missing"),console.log("  Admin Template:",mT?" Present":" Missing"),console.log("  Public Key:",Nu?" Present":" Missing"),Nu?(fT.init(Nu),console.log(" EmailJS initialized successfully")):console.error(" EmailJS initialization failed - missing public key")}async function gT(t,e){try{if(!Gg||!t||!Nu)return console.error("EmailJS is not configured. Please set environment variables."),{success:!1,error:"EmailJS not configured"};const n=await fT.send(Gg,t,e,Nu);return console.log("Email sent successfully:",n),{success:!0,data:n}}catch(n){return console.error("Error sending email via EmailJS:",n),{success:!1,error:n}}}async function TK(t){const e=t.items.map(r=>`${r.name} x${r.quantity} - $${(r.price*r.quantity).toFixed(2)}`).join(`
`),n={to_email:t.customerEmail,to_name:"Customer",transaction_id:t.transactionId,date:t.date,vending_machine_id:t.vendingMachineId,items_list:e,total:`$${t.total.toFixed(2)}`,receipt_html:AK(t)};return gT(pT,n)}async function PK(t){const e=t.items.map(r=>`${r.name} x${r.quantity} - $${(r.price*r.quantity).toFixed(2)}`).join(`
`),n={to_email:EK,to_name:"Admin",customer_email:t.customerEmail,transaction_id:t.transactionId,date:t.date,vending_machine_id:t.vendingMachineId,items_list:e,total:`$${t.total.toFixed(2)}`,notification_html:RK(t)};return gT(mT,n)}async function IK(t){try{const[e,n]=await Promise.all([TK(t),PK(t)]);return{success:e.success&&n.success,customerEmail:e,adminEmail:n}}catch(e){return console.error("Error sending purchase emails:",e),{success:!1,error:e}}}function DK(){const t=$r(),{selectedMedicines:e,clearCart:n,vendingMachineId:r,processPurchase:i,addTransaction:o}=yr(),{cleanupExpiredData:a}=Rh();Fn();const[s,u]=A.useState(!1),[l,c]=A.useState(!1),[d,h]=A.useState(null),[f,m]=A.useState("");A.useEffect(()=>(a(),document.title="Checkout  Smart Medicine Vending",()=>{document.title="Smart Medicine Vending"}),[a]);const p=e.reduce((_,S)=>{const C=tn.find(E=>E.id===S);return _+((C==null?void 0:C.priceWithVat)||0)},0),v=_=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(_),g=async _=>{console.log("Payment successful! Order ID:",_),u(!0),h(null);try{if(!f||!v(f)){h("Please provide a valid email address"),u(!1);return}const S=`TXN-${Date.now()}`,C=e.map(D=>{const P=tn.find(F=>F.id===D);return{medicineId:D,medicineName:(P==null?void 0:P.shortName)||"Unknown",quantity:1,price:(P==null?void 0:P.priceWithVat)||0}}),E=await fK({transactionId:S,customerEmail:f,total:p,paymentMethod:"paypal",status:"completed",vendingMachineId:r,items:C});E.success||console.error("Failed to save transaction to database:",E.error),o({id:S,date:new Date,medicines:C.map(D=>({id:D.medicineId,name:D.medicineName,quantity:D.quantity,price:D.price})),total:p,paymentMethod:"paypal",status:"completed"}),i(e),(await IK({transactionId:S,customerEmail:f,date:new Date().toLocaleString(),items:C.map(D=>({name:D.medicineName,quantity:D.quantity,price:D.price})),total:p,vendingMachineId:r})).success&&console.log(" Emails sent successfully"),a(),setTimeout(()=>{u(!1),c(!0)},3e3)}catch(S){console.error("Error processing payment:",S),h("An error occurred while processing your payment. Please contact support."),u(!1)}},x=()=>{n(),t("/")},w="AW05PTeaurcchJnWrWKwgT6KiyWDEoGqTehFOF_3Q6iwVxLUlhy0wZHxZxQWT51oMLp5KmB_RuvPVGoU".trim().replace(/^["']|["']$/g,""),b="sandbox".trim().replace(/^["']|["']$/g,"");console.log(" PayPal Configuration:"),console.log("  Client ID:",w?` ${w}`:" Missing"),console.log("  Mode Variable:",b),console.log("  Expected Environment:",b==="sandbox"?" SANDBOX (Test Cards Work)":" LIVE (Real Cards Only)"),console.log(""),console.log(" IMPORTANT: Check Network tab for PayPal SDK URL:"),console.log("   Sandbox: https://www.sandbox.paypal.com/sdk/js..."),console.log("   Live: https://www.paypal.com/sdk/js...");const k=w&&(w.startsWith("AW")||w.startsWith("Ab")||w.length<100);return console.log("  Client ID Type:",k?" Appears to be SANDBOX":" Might be LIVE"),y.jsx("div",{className:"min-h-[calc(100vh-180px)] px-4 sm:px-8 py-12",children:y.jsx("div",{className:"container max-w-2xl mx-auto",children:y.jsxs(Le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[y.jsxs("div",{className:"text-center",children:[y.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"Review & Checkout"}),y.jsx("p",{className:"text-base text-gray-600 dark:text-gray-400",children:"Proceed to Payment"})]}),!s&&!l&&y.jsx(et,{className:"bg-white dark:bg-gray-800 shadow-md border border-gray-200 dark:border-gray-700 rounded-2xl p-6 sm:p-8",children:y.jsxs("div",{className:"space-y-6",children:[y.jsxs("div",{children:[y.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Order Summary"}),y.jsxs("div",{className:"space-y-3",children:[e.map(_=>{const S=tn.find(C=>C.id===_);return S?y.jsxs("div",{className:"flex justify-between items-center text-sm",children:[y.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:S.shortName}),y.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:["",S.priceWithVat.toFixed(2)]})]},_):null}),y.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3 mt-3",children:y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx("span",{className:"text-base font-semibold text-gray-900 dark:text-white",children:"Total (with VAT)"}),y.jsxs("span",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:["",p.toFixed(2)]})]})})]})]}),y.jsxs("div",{className:"space-y-2",children:[y.jsxs("label",{htmlFor:"email",className:"text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center gap-1",children:["Please provide a valid email address",y.jsx("span",{className:"text-red-500",children:"*"})]}),y.jsxs("div",{className:"relative",children:[y.jsx(FL,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),y.jsx("input",{id:"email",type:"email",value:f,onChange:_=>m(_.target.value),placeholder:"poweroftaj@gmail.com",className:`w-full h-12 pl-11 pr-12 rounded-lg border ${f&&v(f)?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900"} text-gray-900 dark:text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors`}),f&&v(f)&&y.jsx(tl,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-green-500"})]}),y.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:" Receipt will be sent to this email  Admin will be notified at touficjandah@gmail.com"})]}),d&&y.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 flex items-start gap-3",children:[y.jsx(Ki,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),y.jsx("p",{className:"text-sm font-medium text-red-600 dark:text-red-400",children:d})]}),y.jsx("div",{className:"text-center py-2",children:y.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:" Secure Payment  All transactions are encrypted and protected"})}),!f||!v(f)?y.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 text-center",children:y.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200 font-medium",children:" Please enter a valid email address to proceed with payment"})}):w?y.jsx(GH,{total:p,onApprove:g,onError:h}):y.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 text-center",children:y.jsx("p",{className:"text-sm text-red-800 dark:text-red-200 font-medium",children:" Payment system is not configured. Please contact the administrator."})}),y.jsx("div",{className:"text-center pt-2",children:y.jsx(Pe,{variant:"ghost",onClick:()=>t("/review"),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white",children:" Back to Review"})})]})}),s&&y.jsx(et,{className:"p-12",children:y.jsxs("div",{className:"space-y-8",children:[y.jsxs("div",{className:"text-center",children:[y.jsx("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-4",children:"Processing Payment..."}),y.jsx("p",{className:"text-base text-gray-600 dark:text-gray-400 mb-8",children:"Please wait while we dispense your medicine"})]}),y.jsx(WH,{})]})}),l&&y.jsx(et,{className:"p-12",children:y.jsxs("div",{className:"text-center space-y-6",children:[y.jsx(tl,{className:"w-24 h-24 mx-auto text-green-500",strokeWidth:2}),y.jsx("h2",{className:"text-3xl font-semibold text-gray-900 dark:text-white",children:"Payment Successful!"}),y.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Thank you for your purchase"}),y.jsx(Pe,{onClick:x,className:"h-14 px-12 text-lg rounded-xl bg-blue-600 text-white hover:bg-blue-700",children:"Back to Home"})]})})]})})})}function lr(t){const e=A.useRef(t);return A.useEffect(()=>{e.current=t}),A.useMemo(()=>(...n)=>{var r;return(r=e.current)==null?void 0:r.call(e,...n)},[])}var Dp="rovingFocusGroup.onEntryFocus",MK={bubbles:!1,cancelable:!0},jl="RovingFocusGroup",[Hg,vT,OK]=Wh(jl),[jK,yT]=Ms(jl,[OK]),[FK,LK]=jK(jl),xT=A.forwardRef((t,e)=>y.jsx(Hg.Provider,{scope:t.__scopeRovingFocusGroup,children:y.jsx(Hg.Slot,{scope:t.__scopeRovingFocusGroup,children:y.jsx(BK,{...t,ref:e})})}));xT.displayName=jl;var BK=A.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:o,currentTabStopId:a,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:u,onEntryFocus:l,preventScrollOnEntryFocus:c=!1,...d}=t,h=A.useRef(null),f=Mn(e,h),m=Hh(o),[p,v]=ta({prop:a,defaultProp:s??null,onChange:u,caller:jl}),[g,x]=A.useState(!1),w=lr(l),b=vT(n),k=A.useRef(!1),[_,S]=A.useState(0);return A.useEffect(()=>{const C=h.current;if(C)return C.addEventListener(Dp,w),()=>C.removeEventListener(Dp,w)},[w]),y.jsx(FK,{scope:n,orientation:r,dir:m,loop:i,currentTabStopId:p,onItemFocus:A.useCallback(C=>v(C),[v]),onItemShiftTab:A.useCallback(()=>x(!0),[]),onFocusableItemAdd:A.useCallback(()=>S(C=>C+1),[]),onFocusableItemRemove:A.useCallback(()=>S(C=>C-1),[]),children:y.jsx($e.div,{tabIndex:g||_===0?-1:0,"data-orientation":r,...d,ref:f,style:{outline:"none",...t.style},onMouseDown:je(t.onMouseDown,()=>{k.current=!0}),onFocus:je(t.onFocus,C=>{const E=!k.current;if(C.target===C.currentTarget&&E&&!g){const R=new CustomEvent(Dp,MK);if(C.currentTarget.dispatchEvent(R),!R.defaultPrevented){const D=b().filter(W=>W.focusable),P=D.find(W=>W.active),F=D.find(W=>W.id===p),z=[P,F,...D].filter(Boolean).map(W=>W.ref.current);kT(z,c)}}k.current=!1}),onBlur:je(t.onBlur,()=>x(!1))})})}),wT="RovingFocusGroupItem",bT=A.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:o,children:a,...s}=t,u=Os(),l=o||u,c=LK(wT,n),d=c.currentTabStopId===l,h=vT(n),{onFocusableItemAdd:f,onFocusableItemRemove:m,currentTabStopId:p}=c;return A.useEffect(()=>{if(r)return f(),()=>m()},[r,f,m]),y.jsx(Hg.ItemSlot,{scope:n,id:l,focusable:r,active:i,children:y.jsx($e.span,{tabIndex:d?0:-1,"data-orientation":c.orientation,...s,ref:e,onMouseDown:je(t.onMouseDown,v=>{r?c.onItemFocus(l):v.preventDefault()}),onFocus:je(t.onFocus,()=>c.onItemFocus(l)),onKeyDown:je(t.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){c.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const g=UK(v,c.orientation,c.dir);if(g!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let w=h().filter(b=>b.focusable).map(b=>b.ref.current);if(g==="last")w.reverse();else if(g==="prev"||g==="next"){g==="prev"&&w.reverse();const b=w.indexOf(v.currentTarget);w=c.loop?$K(w,b+1):w.slice(b+1)}setTimeout(()=>kT(w))}}),children:typeof a=="function"?a({isCurrentTabStop:d,hasTabStop:p!=null}):a})})});bT.displayName=wT;var VK={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function zK(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function UK(t,e,n){const r=zK(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return VK[r]}function kT(t,e=!1){const n=document.activeElement;for(const r of t)if(r===n||(r.focus({preventScroll:e}),document.activeElement!==n))return}function $K(t,e){return t.map((n,r)=>t[(e+r)%t.length])}var WK=xT,GK=bT,Jh="Tabs",[HK]=Ms(Jh,[yT]),_T=yT(),[KK,ax]=HK(Jh),ST=A.forwardRef((t,e)=>{const{__scopeTabs:n,value:r,onValueChange:i,defaultValue:o,orientation:a="horizontal",dir:s,activationMode:u="automatic",...l}=t,c=Hh(s),[d,h]=ta({prop:r,onChange:i,defaultProp:o??"",caller:Jh});return y.jsx(KK,{scope:n,baseId:Os(),value:d,onValueChange:h,orientation:a,dir:c,activationMode:u,children:y.jsx($e.div,{dir:c,"data-orientation":a,...l,ref:e})})});ST.displayName=Jh;var CT="TabsList",ET=A.forwardRef((t,e)=>{const{__scopeTabs:n,loop:r=!0,...i}=t,o=ax(CT,n),a=_T(n);return y.jsx(WK,{asChild:!0,...a,orientation:o.orientation,dir:o.dir,loop:r,children:y.jsx($e.div,{role:"tablist","aria-orientation":o.orientation,...i,ref:e})})});ET.displayName=CT;var AT="TabsTrigger",RT=A.forwardRef((t,e)=>{const{__scopeTabs:n,value:r,disabled:i=!1,...o}=t,a=ax(AT,n),s=_T(n),u=PT(a.baseId,r),l=IT(a.baseId,r),c=r===a.value;return y.jsx(GK,{asChild:!0,...s,focusable:!i,active:c,children:y.jsx($e.button,{type:"button",role:"tab","aria-selected":c,"aria-controls":l,"data-state":c?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:u,...o,ref:e,onMouseDown:je(t.onMouseDown,d=>{!i&&d.button===0&&d.ctrlKey===!1?a.onValueChange(r):d.preventDefault()}),onKeyDown:je(t.onKeyDown,d=>{[" ","Enter"].includes(d.key)&&a.onValueChange(r)}),onFocus:je(t.onFocus,()=>{const d=a.activationMode!=="manual";!c&&!i&&d&&a.onValueChange(r)})})})});RT.displayName=AT;var NT="TabsContent",TT=A.forwardRef((t,e)=>{const{__scopeTabs:n,value:r,forceMount:i,children:o,...a}=t,s=ax(NT,n),u=PT(s.baseId,r),l=IT(s.baseId,r),c=r===s.value,d=A.useRef(c);return A.useEffect(()=>{const h=requestAnimationFrame(()=>d.current=!1);return()=>cancelAnimationFrame(h)},[]),y.jsx(na,{present:i||c,children:({present:h})=>y.jsx($e.div,{"data-state":c?"active":"inactive","data-orientation":s.orientation,role:"tabpanel","aria-labelledby":u,hidden:!h,id:l,tabIndex:0,...a,ref:e,style:{...t.style,animationDuration:d.current?"0s":void 0},children:h&&o})})});TT.displayName=NT;function PT(t,e){return`${t}-trigger-${e}`}function IT(t,e){return`${t}-content-${e}`}var qK=ST,DT=ET,MT=RT,OT=TT;const XK=qK,jT=ve.forwardRef(({className:t,...e},n)=>y.jsx(DT,{ref:n,className:Ke("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...e}));jT.displayName=DT.displayName;const Ca=ve.forwardRef(({className:t,...e},n)=>y.jsx(MT,{ref:n,className:Ke("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",t),...e}));Ca.displayName=MT.displayName;const Ea=ve.forwardRef(({className:t,...e},n)=>y.jsx(OT,{ref:n,className:Ke("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e}));Ea.displayName=OT.displayName;function YK(){const{t}=Fn(),{allMachinesInventory:e,transactions:n,getMachineInventory:r,restockMachineProduct:i}=yr(),[o,a]=A.useState(null),[s,u]=A.useState(null),[l,c]=A.useState("overview"),d=p=>{a(p),c("inventory")},h=p=>p<=10?"critical":p<=20?"warning":"good",f=p=>{const v=r(p),g=v.filter(w=>w.stock<=10).length,x=v.filter(w=>w.stock>10&&w.stock<=20).length;return{critical:g,warning:x}},m=()=>{let p=0;return e.forEach(v=>{v.inventory.forEach(g=>{const x=tn.find(w=>w.id===g.medicineId);x&&(p+=x.price*g.stock)})}),p};return y.jsx("div",{className:"min-h-[calc(100vh-180px)] px-8 py-12 bg-background",children:y.jsx("div",{className:"container max-w-7xl mx-auto",children:y.jsxs(Le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-8",children:[y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{children:[y.jsx("h1",{className:"text-4xl font-heading font-semibold text-foreground mb-3",children:t.admin.title}),y.jsx("p",{className:"text-lg text-muted-foreground",children:t.admin.subtitle})]}),y.jsxs("div",{className:"flex gap-4",children:[y.jsxs(et,{className:"px-6 py-4",children:[y.jsx("div",{className:"text-sm text-muted-foreground",children:t.admin.totalMachines}),y.jsx("div",{className:"text-2xl font-semibold text-foreground",children:Zr.length})]}),y.jsxs(et,{className:"px-6 py-4",children:[y.jsx("div",{className:"text-sm text-muted-foreground",children:t.admin.stockValue}),y.jsxs("div",{className:"text-2xl font-semibold text-foreground",children:["$",m().toFixed(2)]})]})]})]}),y.jsxs(XK,{value:l,onValueChange:c,className:"space-y-6",children:[y.jsxs(jT,{className:"grid w-full max-w-3xl grid-cols-5 h-14",children:[y.jsxs(Ca,{value:"overview",className:"text-base",children:[y.jsx(aL,{className:"w-5 h-5 mr-2",strokeWidth:2}),t.admin.overview]}),y.jsxs(Ca,{value:"locations",className:"text-base",children:[y.jsx(Kf,{className:"w-5 h-5 mr-2",strokeWidth:2}),t.admin.locations]}),y.jsxs(Ca,{value:"inventory",className:"text-base",children:[y.jsx(Qm,{className:"w-5 h-5 mr-2",strokeWidth:2}),t.admin.inventory]}),y.jsxs(Ca,{value:"purchases",className:"text-base",children:[y.jsx(dB,{className:"w-5 h-5 mr-2",strokeWidth:2}),t.admin.purchases]}),y.jsxs(Ca,{value:"recipes",className:"text-base",children:[y.jsx(Ad,{className:"w-5 h-5 mr-2",strokeWidth:2}),t.admin.recipes]})]}),y.jsx(Ea,{value:"overview",className:"space-y-4",children:y.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:Zr.map(p=>{const v=f(p.id);return y.jsxs(et,{className:"p-6",children:[y.jsxs("div",{className:"flex items-start justify-between mb-4",children:[y.jsxs("div",{children:[y.jsx("h3",{className:"text-lg font-semibold text-foreground",children:p.name}),y.jsx("p",{className:"text-sm text-muted-foreground",children:p.id})]}),y.jsxs("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${p.status==="active"?"bg-green-500/20 text-green-700":p.status==="maintenance"?"bg-yellow-500/20 text-yellow-700":"bg-red-500/20 text-red-700"}`,children:[p.status==="active"&&y.jsx(tl,{className:"w-3 h-3 inline mr-1"}),p.status==="maintenance"&&y.jsx(vB,{className:"w-3 h-3 inline mr-1"}),p.status==="offline"&&y.jsx(GC,{className:"w-3 h-3 inline mr-1"}),t.admin[p.status]]})]}),y.jsxs("div",{className:"space-y-2",children:[y.jsxs("div",{className:"text-sm text-muted-foreground",children:[y.jsx(Kf,{className:"w-4 h-4 inline mr-1"}),p.city,", ",p.region]}),y.jsx("div",{className:"text-xs text-muted-foreground",children:p.address}),y.jsxs("div",{className:"flex gap-4 pt-3 border-t border-border",children:[v.critical>0&&y.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[y.jsx(Ki,{className:"w-5 h-5"}),y.jsxs("span",{className:"text-sm font-medium",children:[v.critical," ",t.admin.critical]})]}),v.warning>0&&y.jsxs("div",{className:"flex items-center gap-2 text-yellow-600",children:[y.jsx(_u,{className:"w-5 h-5"}),y.jsxs("span",{className:"text-sm font-medium",children:[v.warning," ",t.admin.warning]})]}),v.critical===0&&v.warning===0&&y.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[y.jsx(tl,{className:"w-5 h-5"}),y.jsx("span",{className:"text-sm font-medium",children:t.admin.allGood})]})]}),y.jsx(Pe,{onClick:()=>d(p.id),className:"w-full mt-4 h-10 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90",children:t.admin.viewDetails})]})]},p.id)})})}),y.jsx(Ea,{value:"locations",className:"space-y-4",children:y.jsxs(et,{className:"p-8",children:[y.jsx("h2",{className:"text-2xl font-heading font-semibold text-foreground mb-6",children:t.admin.vendingMachineLocations}),y.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[y.jsx("div",{className:"space-y-4",children:Zr.map(p=>{const v=f(p.id);return y.jsx("div",{className:"p-4 border border-border rounded-lg hover:bg-muted/50 cursor-pointer",onClick:()=>d(p.id),children:y.jsxs("div",{className:"flex items-start justify-between",children:[y.jsxs("div",{children:[y.jsx("h3",{className:"font-semibold text-foreground",children:p.name}),y.jsxs("p",{className:"text-sm text-muted-foreground",children:[p.city,", ",p.region]}),y.jsx("p",{className:"text-xs text-muted-foreground",children:p.address}),y.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[p.latitude.toFixed(4),", ",p.longitude.toFixed(4)]})]}),y.jsxs("div",{className:"flex gap-2",children:[v.critical>0&&y.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center",children:y.jsx(Ki,{className:"w-5 h-5 text-red-600"})}),v.warning>0&&y.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-500/20 flex items-center justify-center",children:y.jsx(_u,{className:"w-5 h-5 text-yellow-600"})})]})]})},p.id)})}),y.jsx("div",{className:"bg-muted/30 rounded-lg p-8 flex items-center justify-center",children:y.jsxs("div",{className:"text-center",children:[y.jsx(Kf,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),y.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:t.admin.interactiveMap}),y.jsx("p",{className:"text-muted-foreground",children:t.admin.mapIntegration}),y.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:t.admin.locationsCount.replace("{count}",Zr.length.toString())})]})})]})]})}),y.jsxs(Ea,{value:"inventory",className:"space-y-4",children:[y.jsx("div",{className:"flex gap-4 mb-6",children:y.jsxs("select",{className:"h-12 px-4 rounded-lg border border-input bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-ring",value:o||"",onChange:p=>a(p.target.value),children:[y.jsx("option",{value:"",children:t.admin.selectMachine}),Zr.map(p=>y.jsxs("option",{value:p.id,children:[p.name," (",p.id,")"]},p.id))]})}),o&&y.jsx(et,{className:"overflow-hidden",children:y.jsx("div",{className:"overflow-x-auto",children:y.jsxs("table",{className:"w-full",children:[y.jsx("thead",{className:"bg-muted",children:y.jsxs("tr",{children:[y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.medicine}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.stock}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.price}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.status}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.actions})]})}),y.jsx("tbody",{className:"divide-y divide-border",children:r(o).map(p=>{const v=tn.find(x=>x.id===p.medicineId),g=h(p.stock);return y.jsxs("tr",{className:"hover:bg-muted/50",children:[y.jsx("td",{className:"px-6 py-4 text-sm text-foreground",children:y.jsxs("div",{children:[y.jsx("div",{className:"font-medium",children:v==null?void 0:v.name}),y.jsx("div",{className:"text-muted-foreground text-xs",children:v==null?void 0:v.id})]})}),y.jsx("td",{className:"px-6 py-4 text-sm text-foreground",children:y.jsxs("div",{className:"flex items-center gap-2",children:[g==="critical"&&y.jsx(Ki,{className:"w-5 h-5 text-red-600"}),g==="warning"&&y.jsx(_u,{className:"w-5 h-5 text-yellow-600"}),y.jsxs("span",{className:g==="critical"?"text-red-600 font-semibold":"",children:[p.stock," ",t.common.units]})]})}),y.jsxs("td",{className:"px-6 py-4 text-sm text-foreground",children:["$",v==null?void 0:v.price.toFixed(2)]}),y.jsxs("td",{className:"px-6 py-4 text-sm",children:[g==="critical"&&y.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-red-500/20 text-red-700",children:t.admin.critical}),g==="warning"&&y.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-yellow-500/20 text-yellow-700",children:t.admin.lowStock}),g==="good"&&y.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-green-500/20 text-green-700",children:t.admin.good})]}),y.jsx("td",{className:"px-6 py-4",children:y.jsx(Pe,{onClick:()=>i(o,p.medicineId,50),className:"h-10 px-4 rounded-lg bg-accent text-accent-foreground hover:bg-accent/90",children:t.admin.restock})})]},p.medicineId)})})]})})}),!o&&y.jsxs(et,{className:"p-12 text-center",children:[y.jsx(Qm,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),y.jsx("p",{className:"text-lg text-muted-foreground",children:t.admin.selectMachineInventory})]})]}),y.jsx(Ea,{value:"purchases",className:"space-y-4",children:y.jsxs(et,{className:"overflow-hidden",children:[y.jsxs("div",{className:"p-6 border-b border-border",children:[y.jsx("h2",{className:"text-2xl font-heading font-semibold text-foreground",children:t.admin.purchaseHistory}),y.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.admin.allTransactions.replace("{count}",Zr.length.toString())})]}),y.jsx("div",{className:"overflow-x-auto",children:y.jsxs("table",{className:"w-full",children:[y.jsx("thead",{className:"bg-muted",children:y.jsxs("tr",{children:[y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.transactionId}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.machine}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.date}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.items}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.total}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.status})]})}),y.jsx("tbody",{className:"divide-y divide-border",children:n.length===0?y.jsx("tr",{children:y.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-muted-foreground",children:t.admin.noTransactions})}):n.slice(0,20).map(p=>{const v=Zr.find(g=>g.id===p.vendingMachineId);return y.jsxs("tr",{className:"hover:bg-muted/50",children:[y.jsx("td",{className:"px-6 py-4 text-sm font-mono text-foreground",children:p.id}),y.jsx("td",{className:"px-6 py-4 text-sm text-foreground",children:(v==null?void 0:v.name)||p.vendingMachineId}),y.jsx("td",{className:"px-6 py-4 text-sm text-foreground",children:new Date(p.date).toLocaleString()}),y.jsxs("td",{className:"px-6 py-4 text-sm text-foreground",children:[p.medicines.length," ",p.medicines.length===1?t.checkout.item:t.checkout.items]}),y.jsxs("td",{className:"px-6 py-4 text-sm text-foreground font-medium",children:["$",p.total.toFixed(2)]}),y.jsx("td",{className:"px-6 py-4 text-sm",children:y.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${p.status==="completed"?"bg-green-500/20 text-green-700":p.status==="pending"?"bg-yellow-500/20 text-yellow-700":"bg-red-500/20 text-red-700"}`,children:t.admin[p.status]})})]},p.id)})})]})})]})}),y.jsxs(Ea,{value:"recipes",className:"space-y-4",children:[y.jsxs(et,{className:"overflow-hidden",children:[y.jsxs("div",{className:"p-6 border-b border-border",children:[y.jsx("h2",{className:"text-2xl font-heading font-semibold text-foreground",children:t.admin.prescriptionManagement}),y.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t.admin.managePrescriptions})]}),y.jsx("div",{className:"overflow-x-auto",children:y.jsxs("table",{className:"w-full",children:[y.jsx("thead",{className:"bg-muted",children:y.jsxs("tr",{children:[y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.recipeId}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.patient}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.doctor}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.date}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.medications}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.status}),y.jsx("th",{className:"px-6 py-4 text-left text-sm font-normal text-foreground",children:t.admin.actions})]})}),y.jsx("tbody",{className:"divide-y divide-border",children:Jb.map(p=>y.jsxs("tr",{className:"hover:bg-muted/50",children:[y.jsx("td",{className:"px-6 py-4 text-sm font-mono text-foreground",children:p.id}),y.jsx("td",{className:"px-6 py-4 text-sm text-foreground",children:p.patientName}),y.jsx("td",{className:"px-6 py-4 text-sm text-foreground",children:p.doctorName}),y.jsx("td",{className:"px-6 py-4 text-sm text-foreground",children:new Date(p.date).toLocaleDateString()}),y.jsxs("td",{className:"px-6 py-4 text-sm text-foreground",children:[p.medications.length," ",p.medications.length===1?t.admin.medicine:t.admin.medications]}),y.jsx("td",{className:"px-6 py-4 text-sm",children:y.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${p.status==="fulfilled"?"bg-green-500/20 text-green-700":p.status==="pending"?"bg-yellow-500/20 text-yellow-700":"bg-red-500/20 text-red-700"}`,children:t.admin[p.status]})}),y.jsx("td",{className:"px-6 py-4",children:y.jsx(Pe,{onClick:()=>u(p.id),className:"h-10 px-4 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90",children:t.admin.viewDetails})})]},p.id))})]})})]}),s&&y.jsxs(et,{className:"p-6",children:[y.jsx("h3",{className:"text-xl font-semibold text-foreground mb-4",children:t.admin.recipeDetails}),Jb.filter(p=>p.id===s).map(p=>{var v;return y.jsxs("div",{className:"space-y-4",children:[y.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[y.jsxs("div",{children:[y.jsx("div",{className:"text-sm text-muted-foreground",children:t.admin.patientName}),y.jsx("div",{className:"text-base text-foreground font-medium",children:p.patientName})]}),y.jsxs("div",{children:[y.jsx("div",{className:"text-sm text-muted-foreground",children:t.admin.doctorName}),y.jsx("div",{className:"text-base text-foreground font-medium",children:p.doctorName})]})]}),y.jsxs("div",{className:"border-t border-border pt-4",children:[y.jsx("h4",{className:"text-lg font-semibold text-foreground mb-3",children:t.admin.medications}),p.medications.map((g,x)=>y.jsxs("div",{className:"p-4 bg-muted/30 rounded-lg mb-2",children:[y.jsx("div",{className:"font-medium text-foreground",children:g.medicineName}),y.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[t.admin.dosage,": ",g.dosage," | ",t.admin.frequency,": ",g.frequency," | ",t.admin.duration,":"," ",g.duration]})]},x))]}),p.vendingMachineId&&y.jsxs("div",{className:"border-t border-border pt-4",children:[y.jsx("div",{className:"text-sm text-muted-foreground",children:t.admin.fulfilledAt}),y.jsxs("div",{className:"text-base text-foreground font-medium",children:[(v=Zr.find(g=>g.id===p.vendingMachineId))==null?void 0:v.name," ","(",p.vendingMachineId,")"]}),y.jsx("div",{className:"text-sm text-muted-foreground",children:p.fulfillmentDate&&new Date(p.fulfillmentDate).toLocaleString()})]})]},p.id)})]})]})]})]})})})}function JK(){const t=$r(),{setAdmin:e}=yr(),{t:n}=Fn(),[r,i]=A.useState(""),[o,a]=A.useState(""),s=()=>{r==="admin123"?(e(!0),t("/admin/dashboard")):a(n.adminLogin.invalidPassword)};return y.jsx("div",{className:"min-h-[calc(100vh-180px)] flex items-center justify-center px-8 py-12",children:y.jsx(Le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md",children:y.jsxs(et,{className:"p-8",children:[y.jsxs("div",{className:"text-center mb-8",children:[y.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-secondary/10 flex items-center justify-center",children:y.jsx(OL,{className:"w-8 h-8 text-secondary",strokeWidth:2})}),y.jsx("h1",{className:"text-3xl font-heading font-semibold text-foreground mb-2",children:n.adminLogin.title}),y.jsx("p",{className:"text-base text-muted-foreground",children:n.adminLogin.subtitle})]}),y.jsxs("div",{className:"space-y-6",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-sm font-normal text-foreground mb-2",children:n.adminLogin.password}),y.jsx("input",{type:"password",value:r,onChange:u=>{i(u.target.value),a("")},onKeyPress:u=>u.key==="Enter"&&s(),placeholder:n.adminLogin.enterPassword,className:"w-full h-14 px-6 rounded-xl border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring"}),o&&y.jsx("p",{className:"text-sm text-destructive mt-2",children:o})]}),y.jsx(Pe,{onClick:s,className:"w-full h-14 rounded-xl bg-secondary text-secondary-foreground hover:bg-secondary/90",children:n.adminLogin.login}),y.jsx(Pe,{onClick:()=>t("/"),className:"w-full h-14 rounded-xl bg-muted text-muted-foreground hover:bg-muted/80",children:n.adminLogin.backToHome})]})]})})})}function QK({children:t,requireAdmin:e=!1,requireVerification:n=!1}){const{isAdmin:r,isAgeVerified:i}=yr();return e&&!r?y.jsx(Rm,{to:"/admin-login",replace:!0}):n&&!i?y.jsx(Rm,{to:"/verify-age",replace:!0}):y.jsx(y.Fragment,{children:t})}function ZK(t,e=globalThis==null?void 0:globalThis.document){const n=lr(t);A.useEffect(()=>{const r=i=>{i.key==="Escape"&&n(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var eq="DismissableLayer",Kg="dismissableLayer.update",tq="dismissableLayer.pointerDownOutside",nq="dismissableLayer.focusOutside",P2,FT=A.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),LT=A.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:o,onInteractOutside:a,onDismiss:s,...u}=t,l=A.useContext(FT),[c,d]=A.useState(null),h=(c==null?void 0:c.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=A.useState({}),m=Mn(e,S=>d(S)),p=Array.from(l.layers),[v]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),g=p.indexOf(v),x=c?p.indexOf(c):-1,w=l.layersWithOutsidePointerEventsDisabled.size>0,b=x>=g,k=oq(S=>{const C=S.target,E=[...l.branches].some(R=>R.contains(C));!b||E||(i==null||i(S),a==null||a(S),S.defaultPrevented||s==null||s())},h),_=aq(S=>{const C=S.target;[...l.branches].some(R=>R.contains(C))||(o==null||o(S),a==null||a(S),S.defaultPrevented||s==null||s())},h);return ZK(S=>{x===l.layers.size-1&&(r==null||r(S),!S.defaultPrevented&&s&&(S.preventDefault(),s()))},h),A.useEffect(()=>{if(c)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(P2=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(c)),l.layers.add(c),I2(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(h.body.style.pointerEvents=P2)}},[c,h,n,l]),A.useEffect(()=>()=>{c&&(l.layers.delete(c),l.layersWithOutsidePointerEventsDisabled.delete(c),I2())},[c,l]),A.useEffect(()=>{const S=()=>f({});return document.addEventListener(Kg,S),()=>document.removeEventListener(Kg,S)},[]),y.jsx($e.div,{...u,ref:m,style:{pointerEvents:w?b?"auto":"none":void 0,...t.style},onFocusCapture:je(t.onFocusCapture,_.onFocusCapture),onBlurCapture:je(t.onBlurCapture,_.onBlurCapture),onPointerDownCapture:je(t.onPointerDownCapture,k.onPointerDownCapture)})});LT.displayName=eq;var rq="DismissableLayerBranch",iq=A.forwardRef((t,e)=>{const n=A.useContext(FT),r=A.useRef(null),i=Mn(e,r);return A.useEffect(()=>{const o=r.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),y.jsx($e.div,{...t,ref:i})});iq.displayName=rq;function oq(t,e=globalThis==null?void 0:globalThis.document){const n=lr(t),r=A.useRef(!1),i=A.useRef(()=>{});return A.useEffect(()=>{const o=s=>{if(s.target&&!r.current){let u=function(){BT(tq,n,l,{discrete:!0})};const l={originalEvent:s};s.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=u,e.addEventListener("click",i.current,{once:!0})):u()}else e.removeEventListener("click",i.current);r.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",o),e.removeEventListener("click",i.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function aq(t,e=globalThis==null?void 0:globalThis.document){const n=lr(t),r=A.useRef(!1);return A.useEffect(()=>{const i=o=>{o.target&&!r.current&&BT(nq,n,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function I2(){const t=new CustomEvent(Kg);document.dispatchEvent(t)}function BT(t,e,n,{discrete:r}){const i=n.originalEvent.target,o=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?Tg(i,o):i.dispatchEvent(o)}function sq(t){const e=A.useRef({value:t,previous:t});return A.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var uq=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),lq="VisuallyHidden",VT=A.forwardRef((t,e)=>y.jsx($e.span,{...t,ref:e,style:{...uq,...t.style}}));VT.displayName=lq;var cq=VT,ra="NavigationMenu",[sx,zT,dq]=Wh(ra),[qg,hq,fq]=Wh(ra),[ux]=Ms(ra,[dq,fq]),[pq,Qn]=ux(ra),[mq,gq]=ux(ra),UT=A.forwardRef((t,e)=>{const{__scopeNavigationMenu:n,value:r,onValueChange:i,defaultValue:o,delayDuration:a=200,skipDelayDuration:s=300,orientation:u="horizontal",dir:l,...c}=t,[d,h]=A.useState(null),f=Mn(e,E=>h(E)),m=Hh(l),p=A.useRef(0),v=A.useRef(0),g=A.useRef(0),[x,w]=A.useState(!0),[b,k]=ta({prop:r,onChange:E=>{const R=E!=="",D=s>0;R?(window.clearTimeout(g.current),D&&w(!1)):(window.clearTimeout(g.current),g.current=window.setTimeout(()=>w(!0),s)),i==null||i(E)},defaultProp:o??"",caller:ra}),_=A.useCallback(()=>{window.clearTimeout(v.current),v.current=window.setTimeout(()=>k(""),150)},[k]),S=A.useCallback(E=>{window.clearTimeout(v.current),k(E)},[k]),C=A.useCallback(E=>{b===E?window.clearTimeout(v.current):p.current=window.setTimeout(()=>{window.clearTimeout(v.current),k(E)},a)},[b,k,a]);return A.useEffect(()=>()=>{window.clearTimeout(p.current),window.clearTimeout(v.current),window.clearTimeout(g.current)},[]),y.jsx($T,{scope:n,isRootMenu:!0,value:b,dir:m,orientation:u,rootNavigationMenu:d,onTriggerEnter:E=>{window.clearTimeout(p.current),x?C(E):S(E)},onTriggerLeave:()=>{window.clearTimeout(p.current),_()},onContentEnter:()=>window.clearTimeout(v.current),onContentLeave:_,onItemSelect:E=>{k(R=>R===E?"":E)},onItemDismiss:()=>k(""),children:y.jsx($e.nav,{"aria-label":"Main","data-orientation":u,dir:m,...c,ref:f})})});UT.displayName=ra;var Xg="NavigationMenuSub",vq=A.forwardRef((t,e)=>{const{__scopeNavigationMenu:n,value:r,onValueChange:i,defaultValue:o,orientation:a="horizontal",...s}=t,u=Qn(Xg,n),[l,c]=ta({prop:r,onChange:i,defaultProp:o??"",caller:Xg});return y.jsx($T,{scope:n,isRootMenu:!1,value:l,dir:u.dir,orientation:a,rootNavigationMenu:u.rootNavigationMenu,onTriggerEnter:d=>c(d),onItemSelect:d=>c(d),onItemDismiss:()=>c(""),children:y.jsx($e.div,{"data-orientation":a,...s,ref:e})})});vq.displayName=Xg;var $T=t=>{const{scope:e,isRootMenu:n,rootNavigationMenu:r,dir:i,orientation:o,children:a,value:s,onItemSelect:u,onItemDismiss:l,onTriggerEnter:c,onTriggerLeave:d,onContentEnter:h,onContentLeave:f}=t,[m,p]=A.useState(null),[v,g]=A.useState(new Map),[x,w]=A.useState(null);return y.jsx(pq,{scope:e,isRootMenu:n,rootNavigationMenu:r,value:s,previousValue:sq(s),baseId:Os(),dir:i,orientation:o,viewport:m,onViewportChange:p,indicatorTrack:x,onIndicatorTrackChange:w,onTriggerEnter:lr(c),onTriggerLeave:lr(d),onContentEnter:lr(h),onContentLeave:lr(f),onItemSelect:lr(u),onItemDismiss:lr(l),onViewportContentChange:A.useCallback((b,k)=>{g(_=>(_.set(b,k),new Map(_)))},[]),onViewportContentRemove:A.useCallback(b=>{g(k=>k.has(b)?(k.delete(b),new Map(k)):k)},[]),children:y.jsx(sx.Provider,{scope:e,children:y.jsx(mq,{scope:e,items:v,children:a})})})},WT="NavigationMenuList",GT=A.forwardRef((t,e)=>{const{__scopeNavigationMenu:n,...r}=t,i=Qn(WT,n),o=y.jsx($e.ul,{"data-orientation":i.orientation,...r,ref:e});return y.jsx($e.div,{style:{position:"relative"},ref:i.onIndicatorTrackChange,children:y.jsx(sx.Slot,{scope:n,children:i.isRootMenu?y.jsx(tP,{asChild:!0,children:o}):o})})});GT.displayName=WT;var HT="NavigationMenuItem",[yq,KT]=ux(HT),qT=A.forwardRef((t,e)=>{const{__scopeNavigationMenu:n,value:r,...i}=t,o=Os(),a=r||o||"LEGACY_REACT_AUTO_VALUE",s=A.useRef(null),u=A.useRef(null),l=A.useRef(null),c=A.useRef(()=>{}),d=A.useRef(!1),h=A.useCallback((m="start")=>{if(s.current){c.current();const p=Jg(s.current);p.length&&dx(m==="start"?p:p.reverse())}},[]),f=A.useCallback(()=>{if(s.current){const m=Jg(s.current);m.length&&(c.current=Cq(m))}},[]);return y.jsx(yq,{scope:n,value:a,triggerRef:u,contentRef:s,focusProxyRef:l,wasEscapeCloseRef:d,onEntryKeyDown:h,onFocusProxyEnter:h,onRootContentClose:f,onContentFocusOutside:f,children:y.jsx($e.li,{...i,ref:e})})});qT.displayName=HT;var Yg="NavigationMenuTrigger",XT=A.forwardRef((t,e)=>{const{__scopeNavigationMenu:n,disabled:r,...i}=t,o=Qn(Yg,t.__scopeNavigationMenu),a=KT(Yg,t.__scopeNavigationMenu),s=A.useRef(null),u=Mn(s,a.triggerRef,e),l=rP(o.baseId,a.value),c=iP(o.baseId,a.value),d=A.useRef(!1),h=A.useRef(!1),f=a.value===o.value;return y.jsxs(y.Fragment,{children:[y.jsx(sx.ItemSlot,{scope:n,value:a.value,children:y.jsx(nP,{asChild:!0,children:y.jsx($e.button,{id:l,disabled:r,"data-disabled":r?"":void 0,"data-state":hx(f),"aria-expanded":f,"aria-controls":c,...i,ref:u,onPointerEnter:je(t.onPointerEnter,()=>{h.current=!1,a.wasEscapeCloseRef.current=!1}),onPointerMove:je(t.onPointerMove,ih(()=>{r||h.current||a.wasEscapeCloseRef.current||d.current||(o.onTriggerEnter(a.value),d.current=!0)})),onPointerLeave:je(t.onPointerLeave,ih(()=>{r||(o.onTriggerLeave(),d.current=!1)})),onClick:je(t.onClick,()=>{o.onItemSelect(a.value),h.current=f}),onKeyDown:je(t.onKeyDown,m=>{const v={horizontal:"ArrowDown",vertical:o.dir==="rtl"?"ArrowLeft":"ArrowRight"}[o.orientation];f&&m.key===v&&(a.onEntryKeyDown(),m.preventDefault())})})})}),f&&y.jsxs(y.Fragment,{children:[y.jsx(cq,{"aria-hidden":!0,tabIndex:0,ref:a.focusProxyRef,onFocus:m=>{const p=a.contentRef.current,v=m.relatedTarget,g=v===s.current,x=p==null?void 0:p.contains(v);(g||!x)&&a.onFocusProxyEnter(g?"start":"end")}}),o.viewport&&y.jsx("span",{"aria-owns":c})]})]})});XT.displayName=Yg;var xq="NavigationMenuLink",D2="navigationMenu.linkSelect",YT=A.forwardRef((t,e)=>{const{__scopeNavigationMenu:n,active:r,onSelect:i,...o}=t;return y.jsx(nP,{asChild:!0,children:y.jsx($e.a,{"data-active":r?"":void 0,"aria-current":r?"page":void 0,...o,ref:e,onClick:je(t.onClick,a=>{const s=a.target,u=new CustomEvent(D2,{bubbles:!0,cancelable:!0});if(s.addEventListener(D2,l=>i==null?void 0:i(l),{once:!0}),Tg(s,u),!u.defaultPrevented&&!a.metaKey){const l=new CustomEvent(Yc,{bubbles:!0,cancelable:!0});Tg(s,l)}},{checkForDefaultPrevented:!1})})})});YT.displayName=xq;var lx="NavigationMenuIndicator",JT=A.forwardRef((t,e)=>{const{forceMount:n,...r}=t,i=Qn(lx,t.__scopeNavigationMenu),o=!!i.value;return i.indicatorTrack?qD.createPortal(y.jsx(na,{present:n||o,children:y.jsx(wq,{...r,ref:e})}),i.indicatorTrack):null});JT.displayName=lx;var wq=A.forwardRef((t,e)=>{const{__scopeNavigationMenu:n,...r}=t,i=Qn(lx,n),o=zT(n),[a,s]=A.useState(null),[u,l]=A.useState(null),c=i.orientation==="horizontal",d=!!i.value;A.useEffect(()=>{var p;const m=(p=o().find(v=>v.value===i.value))==null?void 0:p.ref.current;m&&s(m)},[o,i.value]);const h=()=>{a&&l({size:c?a.offsetWidth:a.offsetHeight,offset:c?a.offsetLeft:a.offsetTop})};return Qg(a,h),Qg(i.indicatorTrack,h),u?y.jsx($e.div,{"aria-hidden":!0,"data-state":d?"visible":"hidden","data-orientation":i.orientation,...r,ref:e,style:{position:"absolute",...c?{left:0,width:u.size+"px",transform:`translateX(${u.offset}px)`}:{top:0,height:u.size+"px",transform:`translateY(${u.offset}px)`},...r.style}}):null}),ws="NavigationMenuContent",QT=A.forwardRef((t,e)=>{const{forceMount:n,...r}=t,i=Qn(ws,t.__scopeNavigationMenu),o=KT(ws,t.__scopeNavigationMenu),a=Mn(o.contentRef,e),s=o.value===i.value,u={value:o.value,triggerRef:o.triggerRef,focusProxyRef:o.focusProxyRef,wasEscapeCloseRef:o.wasEscapeCloseRef,onContentFocusOutside:o.onContentFocusOutside,onRootContentClose:o.onRootContentClose,...r};return i.viewport?y.jsx(bq,{forceMount:n,...u,ref:a}):y.jsx(na,{present:n||s,children:y.jsx(ZT,{"data-state":hx(s),...u,ref:a,onPointerEnter:je(t.onPointerEnter,i.onContentEnter),onPointerLeave:je(t.onPointerLeave,ih(i.onContentLeave)),style:{pointerEvents:!s&&i.isRootMenu?"none":void 0,...u.style}})})});QT.displayName=ws;var bq=A.forwardRef((t,e)=>{const n=Qn(ws,t.__scopeNavigationMenu),{onViewportContentChange:r,onViewportContentRemove:i}=n;return ro(()=>{r(t.value,{ref:e,...t})},[t,e,r]),ro(()=>()=>i(t.value),[t.value,i]),null}),Yc="navigationMenu.rootContentDismiss",ZT=A.forwardRef((t,e)=>{const{__scopeNavigationMenu:n,value:r,triggerRef:i,focusProxyRef:o,wasEscapeCloseRef:a,onRootContentClose:s,onContentFocusOutside:u,...l}=t,c=Qn(ws,n),d=A.useRef(null),h=Mn(d,e),f=rP(c.baseId,r),m=iP(c.baseId,r),p=zT(n),v=A.useRef(null),{onItemDismiss:g}=c;A.useEffect(()=>{const w=d.current;if(c.isRootMenu&&w){const b=()=>{var k;g(),s(),w.contains(document.activeElement)&&((k=i.current)==null||k.focus())};return w.addEventListener(Yc,b),()=>w.removeEventListener(Yc,b)}},[c.isRootMenu,t.value,i,g,s]);const x=A.useMemo(()=>{const b=p().map(R=>R.value);c.dir==="rtl"&&b.reverse();const k=b.indexOf(c.value),_=b.indexOf(c.previousValue),S=r===c.value,C=_===b.indexOf(r);if(!S&&!C)return v.current;const E=(()=>{if(k!==_){if(S&&_!==-1)return k>_?"from-end":"from-start";if(C&&k!==-1)return k>_?"to-start":"to-end"}return null})();return v.current=E,E},[c.previousValue,c.value,c.dir,p,r]);return y.jsx(tP,{asChild:!0,children:y.jsx(LT,{id:m,"aria-labelledby":f,"data-motion":x,"data-orientation":c.orientation,...l,ref:h,disableOutsidePointerEvents:!1,onDismiss:()=>{var b;const w=new Event(Yc,{bubbles:!0,cancelable:!0});(b=d.current)==null||b.dispatchEvent(w)},onFocusOutside:je(t.onFocusOutside,w=>{var k;u();const b=w.target;(k=c.rootNavigationMenu)!=null&&k.contains(b)&&w.preventDefault()}),onPointerDownOutside:je(t.onPointerDownOutside,w=>{var S;const b=w.target,k=p().some(C=>{var E;return(E=C.ref.current)==null?void 0:E.contains(b)}),_=c.isRootMenu&&((S=c.viewport)==null?void 0:S.contains(b));(k||_||!c.isRootMenu)&&w.preventDefault()}),onKeyDown:je(t.onKeyDown,w=>{var _;const b=w.altKey||w.ctrlKey||w.metaKey;if(w.key==="Tab"&&!b){const S=Jg(w.currentTarget),C=document.activeElement,E=S.findIndex(P=>P===C),D=w.shiftKey?S.slice(0,E).reverse():S.slice(E+1,S.length);dx(D)?w.preventDefault():(_=o.current)==null||_.focus()}}),onEscapeKeyDown:je(t.onEscapeKeyDown,w=>{a.current=!0})})})}),cx="NavigationMenuViewport",eP=A.forwardRef((t,e)=>{const{forceMount:n,...r}=t,o=!!Qn(cx,t.__scopeNavigationMenu).value;return y.jsx(na,{present:n||o,children:y.jsx(kq,{...r,ref:e})})});eP.displayName=cx;var kq=A.forwardRef((t,e)=>{const{__scopeNavigationMenu:n,children:r,...i}=t,o=Qn(cx,n),a=Mn(e,o.onViewportChange),s=gq(ws,t.__scopeNavigationMenu),[u,l]=A.useState(null),[c,d]=A.useState(null),h=u?(u==null?void 0:u.width)+"px":void 0,f=u?(u==null?void 0:u.height)+"px":void 0,m=!!o.value,p=m?o.value:o.previousValue;return Qg(c,()=>{c&&l({width:c.offsetWidth,height:c.offsetHeight})}),y.jsx($e.div,{"data-state":hx(m),"data-orientation":o.orientation,...i,ref:a,style:{pointerEvents:!m&&o.isRootMenu?"none":void 0,"--radix-navigation-menu-viewport-width":h,"--radix-navigation-menu-viewport-height":f,...i.style},onPointerEnter:je(t.onPointerEnter,o.onContentEnter),onPointerLeave:je(t.onPointerLeave,ih(o.onContentLeave)),children:Array.from(s.items).map(([g,{ref:x,forceMount:w,...b}])=>{const k=p===g;return y.jsx(na,{present:w||k,children:y.jsx(ZT,{...b,ref:Fy(x,_=>{k&&_&&d(_)})})},g)})})}),_q="FocusGroup",tP=A.forwardRef((t,e)=>{const{__scopeNavigationMenu:n,...r}=t,i=Qn(_q,n);return y.jsx(qg.Provider,{scope:n,children:y.jsx(qg.Slot,{scope:n,children:y.jsx($e.div,{dir:i.dir,...r,ref:e})})})}),M2=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],Sq="FocusGroupItem",nP=A.forwardRef((t,e)=>{const{__scopeNavigationMenu:n,...r}=t,i=hq(n),o=Qn(Sq,n);return y.jsx(qg.ItemSlot,{scope:n,children:y.jsx($e.button,{...r,ref:e,onKeyDown:je(t.onKeyDown,a=>{if(["Home","End",...M2].includes(a.key)){let u=i().map(d=>d.ref.current);if([o.dir==="rtl"?"ArrowRight":"ArrowLeft","ArrowUp","End"].includes(a.key)&&u.reverse(),M2.includes(a.key)){const d=u.indexOf(a.currentTarget);u=u.slice(d+1)}setTimeout(()=>dx(u)),a.preventDefault()}})})})});function Jg(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function dx(t){const e=document.activeElement;return t.some(n=>n===e?!0:(n.focus(),document.activeElement!==e))}function Cq(t){return t.forEach(e=>{e.dataset.tabindex=e.getAttribute("tabindex")||"",e.setAttribute("tabindex","-1")}),()=>{t.forEach(e=>{const n=e.dataset.tabindex;e.setAttribute("tabindex",n)})}}function Qg(t,e){const n=lr(e);ro(()=>{let r=0;if(t){const i=new ResizeObserver(()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(n)});return i.observe(t),()=>{window.cancelAnimationFrame(r),i.unobserve(t)}}},[t,n])}function hx(t){return t?"open":"closed"}function rP(t,e){return`${t}-trigger-${e}`}function iP(t,e){return`${t}-content-${e}`}function ih(t){return e=>e.pointerType==="mouse"?t(e):void 0}var oP=UT,aP=GT,Eq=qT,sP=XT,Aq=YT,uP=JT,lP=QT,cP=eP;const dP=ve.forwardRef(({className:t,children:e,...n},r)=>y.jsxs(oP,{ref:r,className:Ke("relative z-10 flex max-w-max flex-1 items-center justify-center",t),...n,children:[e,y.jsx(fP,{})]}));dP.displayName=oP.displayName;const hP=ve.forwardRef(({className:t,...e},n)=>y.jsx(aP,{ref:n,className:Ke("group flex flex-1 list-none items-center justify-center space-x-1",t),...e}));hP.displayName=aP.displayName;const O2=Eq,Rq=Ah("group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50"),Nq=ve.forwardRef(({className:t,children:e,...n},r)=>y.jsxs(sP,{ref:r,className:Ke(Rq(),"group",t),...n,children:[e," ",y.jsx(WC,{className:"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180","aria-hidden":"true"})]}));Nq.displayName=sP.displayName;const Tq=ve.forwardRef(({className:t,...e},n)=>y.jsx(lP,{ref:n,className:Ke("left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",t),...e}));Tq.displayName=lP.displayName;const j2=Aq,fP=ve.forwardRef(({className:t,...e},n)=>y.jsx("div",{className:Ke("absolute left-0 top-full flex justify-center"),children:y.jsx(cP,{className:Ke("origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",t),ref:n,...e})}));fP.displayName=cP.displayName;const Pq=ve.forwardRef(({className:t,...e},n)=>y.jsx(uP,{ref:n,className:Ke("top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",t),...e,children:y.jsx("div",{className:"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md"})}));Pq.displayName=uP.displayName;function Iq(){const t=Ur(),{isAgeVerified:e,isAdmin:n}=yr(),{t:r}=Fn(),{toggleLanguage:i,language:o}=uE(),a=s=>t.pathname===s;return y.jsx("header",{className:"sticky top-0 z-50 w-full border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:y.jsx("div",{className:"container mx-auto px-8 py-4",children:y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs(vu,{to:"/",className:"flex items-center gap-3 hover:opacity-80 transition-opacity",children:[y.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-1 flex items-center justify-center shadow-md",children:y.jsx(Jm,{className:"w-6 h-6 text-primary-foreground",strokeWidth:2})}),y.jsx("h1",{className:"text-2xl font-heading font-semibold text-foreground",children:r.header.title})]}),y.jsxs("div",{className:"flex items-center gap-6",children:[y.jsx(dP,{className:"hidden md:flex",children:y.jsxs(hP,{className:"gap-2",children:[y.jsx(O2,{children:y.jsx(vu,{to:"/",children:y.jsxs(j2,{className:`group inline-flex h-12 w-max items-center justify-center rounded-lg px-6 py-3 text-base font-normal transition-colors hover:bg-accent/10 focus:bg-accent/10 focus:outline-none disabled:pointer-events-none disabled:opacity-50 ${a("/")?"bg-accent/10 text-accent":"text-foreground"}`,children:[y.jsx(TL,{className:"w-5 h-5 mr-2",strokeWidth:2}),r.header.home]})})}),y.jsx(O2,{children:y.jsx(vu,{to:"/ai-assistant",children:y.jsxs(j2,{className:`group inline-flex h-12 w-max items-center justify-center rounded-lg px-6 py-3 text-base font-normal transition-colors hover:bg-accent/10 focus:bg-accent/10 focus:outline-none disabled:pointer-events-none disabled:opacity-50 ${a("/ai-assistant")?"bg-accent/10 text-accent":"text-foreground"}`,children:[y.jsx(Jm,{className:"w-5 h-5 mr-2",strokeWidth:2}),r.header.aiAssistant]})})})]})}),y.jsxs(Pe,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-lg",title:"Change Language",onClick:i,children:[y.jsx(RL,{className:"w-5 h-5",strokeWidth:2}),y.jsx("span",{className:"ml-1 text-xs font-semibold",children:o.toUpperCase()})]}),y.jsx("div",{className:"flex items-center gap-3 px-4 py-2 rounded-lg bg-card border border-border shadow-sm",children:e?y.jsxs(y.Fragment,{children:[y.jsx(HC,{className:"w-5 h-5 text-success",strokeWidth:2}),y.jsx("span",{className:"text-sm font-normal text-success",children:r.header.ageVerified})]}):y.jsxs(y.Fragment,{children:[y.jsx(nB,{className:"w-5 h-5 text-warning",strokeWidth:2}),y.jsx("span",{className:"text-sm font-normal text-warning",children:r.header.notVerified})]})})]})]})})})}const Dq="1.0.0";function Mq(){const{t}=Fn();return y.jsx("footer",{className:"w-full border-t border-border bg-background py-6",children:y.jsx("div",{className:"container mx-auto px-8",children:y.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 text-sm text-muted-foreground",children:[y.jsxs("p",{className:"text-foreground font-mono",children:[t.footer.version," v",Dq]}),y.jsxs("div",{className:"flex gap-6",children:[y.jsx("button",{className:"text-foreground hover:text-primary transition-colors",children:t.footer.terms}),y.jsx("button",{className:"text-foreground hover:text-primary transition-colors",children:t.footer.privacy}),y.jsx("button",{className:"text-foreground hover:text-primary transition-colors",children:t.footer.contact})]})]})})})}function Oq(){return y.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-neutral-50 to-[hsl(219,50%,96%)]",children:[y.jsx(Iq,{}),y.jsx("main",{className:"flex-1 w-full",children:y.jsx(BM,{})}),y.jsx(Mq,{})]})}function jq(){return y.jsx(zM,{children:y.jsxs(er,{path:"/",element:y.jsx(Oq,{}),children:[y.jsx(er,{index:!0,element:y.jsx(f5,{})}),y.jsx(er,{path:"verify-age",element:y.jsx(XG,{})}),y.jsx(er,{path:"ai-assistant",element:y.jsx(tH,{})}),y.jsx(er,{path:"select-medicine",element:y.jsx(BH,{})}),y.jsx(er,{path:"review",element:y.jsx($H,{})}),y.jsx(er,{path:"checkout",element:y.jsx(DK,{})}),y.jsx(er,{path:"admin",element:y.jsx(JK,{})}),y.jsx(er,{path:"admin/dashboard",element:y.jsx(QK,{requireAdmin:!0,children:y.jsx(YK,{})})}),y.jsx(er,{path:"*",element:y.jsx(Rm,{to:"/",replace:!0})})]})})}function Fq(t,e=3e4){const n=A.useRef();A.useEffect(()=>{const r=()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{t()},e)},i=["mousedown","mousemove","keypress","scroll","touchstart"];return i.forEach(o=>{document.addEventListener(o,r)}),r(),()=>{n.current&&clearTimeout(n.current),i.forEach(o=>{document.removeEventListener(o,r)})}},[t,e])}function Lq(){const t=$r(),e=Ur(),{initializeInventory:n,initializeAllMachinesInventory:r}=yr();A.useEffect(()=>{n(),r()},[n,r]);const i=e.pathname==="/checkout"||e.pathname==="/review"||e.pathname==="/payment";return Fq(()=>{i||t("/")},18e4),y.jsx(jq,{})}function Bq(){return A.useEffect(()=>{NK(),console.log("EmailJS initialized"),(()=>{if(document.querySelector("script[data-paypal-sdk]")){console.log("PayPal SDK already loaded");return}const e="AW05PTeaurcchJnWrWKwgT6KiyWDEoGqTehFOF_3Q6iwVxLUlhy0wZHxZxQWT51oMLp5KmB_RuvPVGoU".trim().replace(/^["']|["']$/g,""),n="sandbox".trim().replace(/^["']|["']$/g,""),r=n==="sandbox"?"https://www.sandbox.paypal.com":"https://www.paypal.com";console.log(" PayPal SDK Configuration:"),console.log("  Mode:",n),console.log("  Base URL:",r),console.log("  Client ID:",e?" Present":" Missing"),console.log("  Client ID Length:",e==null?void 0:e.length),console.log("  Client ID (first 20 chars):",e==null?void 0:e.substring(0,20));const i=document.createElement("script"),o=`${r}/sdk/js?client-id=${e}&currency=EUR&intent=capture&buyer-country=LV`;i.src=o,i.async=!0,i.setAttribute("data-paypal-sdk","true"),console.log(" Full PayPal SDK URL:",o),i.onload=()=>{console.log(` PayPal SDK loaded successfully from ${r}`)},i.onerror=()=>{console.error(" Failed to load PayPal SDK")},document.body.appendChild(i)})()},[]),y.jsx(c3,{children:y.jsx(Lq,{})})}Mp.createRoot(document.getElementById("app")).render(y.jsx(ve.StrictMode,{children:y.jsx(Bq,{})}))});export default Vq();
